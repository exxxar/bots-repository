/* empty css                                                                  */import{_ as m}from"./_plugin-vue_export-helper-c27b6911.js";import{o as l,k as d,n as i,a0 as h,F as u,K as b,H as g,a1 as w,a8 as _,L as S,M as a,t as v}from"./index.es-c4852431.js";const f={name:"StoryItem",props:{story:{type:Object,required:!0},isViewed:{type:Boolean,default:!1}}},k=["src","alt"];function V(r,s,o,c,t,e){return l(),d("div",{class:h(["story-item flex-shrink-0 rounded-circle overflow-hidden cursor-pointer border",{"border-primary":!o.isViewed,"border-secondary":o.isViewed}]),style:{width:"80px",height:"80px"},onClick:s[0]||(s[0]=y=>r.$emit("open-story"))},[i("img",{src:o.story.thumbnail,class:h(["w-100 h-100 object-fit-cover",{"filter-grayscale":o.isViewed}]),alt:o.story.title},null,10,k)],2)}const x=m(f,[["render",V],["__scopeId","data-v-ee760bbe"]]),I={name:"StoryList",components:{StoryItem:x},props:{stories:{type:Array,required:!0}},data(){return{currentStory:null,progress:0,timer:null,viewedStories:JSON.parse(localStorage.getItem("viewedStories"))||[]}},computed:{sortedStories(){return[...this.stories].sort((r,s)=>{const o=this.viewedStories.includes(r.id),c=this.viewedStories.includes(s.id);return o&&!c?1:!o&&c?-1:0})}},methods:{goToProductLink(r){try{const o=new URL(r).searchParams.get("start"),t=atob(o).match(/^001slug(\d+)product(\d+)$/);t||this.$router.push({name:"CatalogV2"});const e=t[2];this.$router.push({name:"ProductV2",params:{productId:e}})}catch{this.$router.push({name:"CatalogV2"})}},openStory(r){this.currentStory=r,this.progress=0,this.startTimer(),this.markAsViewed(this.sortedStories[r].id)},closeStory(){this.currentStory=null,this.progress=0,clearInterval(this.timer)},startTimer(){clearInterval(this.timer),this.timer=setInterval(()=>{this.progress+=2,this.progress>=100&&this.nextStory()},100)},nextStory(){this.currentStory<this.sortedStories.length-1?(this.currentStory++,this.progress=0,this.markAsViewed(this.sortedStories[this.currentStory].id),this.startTimer()):this.closeStory()},markAsViewed(r){this.viewedStories.includes(r)||(this.viewedStories.push(r),localStorage.setItem("viewedStories",JSON.stringify(this.viewedStories)))},isStoryViewed(r){return this.viewedStories.includes(r)}}},C={class:"story-list-container d-flex overflow-auto p-3"},L={class:"modal-dialog modal-dialog-centered w-100 mw-100 m-0 h-100 mh-100"},O={class:"modal-content bg-transparent border-0 h-100 position-relative"},j={class:"progress position-absolute top-0 start-0 end-0",style:{height:"4px","z-index":"10"}},B=["src"],P={class:"text-white p-3 bg-black bg-opacity-50 position-absolute bottom-0 start-0 end-0"},T={class:"mb-1"},z={class:"mb-0"},A=["href"];function N(r,s,o,c,t,e){const y=v("StoryItem");return l(),d(u,null,[i("div",C,[(l(!0),d(u,null,b(e.sortedStories,(n,p)=>(l(),g(y,{key:n.id,story:n,"is-viewed":e.isStoryViewed(n.id),onOpenStory:M=>e.openStory(p)},null,8,["story","is-viewed","onOpenStory"]))),128))]),t.currentStory!==null?(l(),d("div",{key:0,class:"modal fade show d-block",style:{"background-color":"rgba(0, 0, 0, 0.9)"},onClick:s[2]||(s[2]=w((...n)=>e.closeStory&&e.closeStory(...n),["self"]))},[i("div",L,[i("div",O,[i("div",j,[i("div",{class:"progress-bar bg-primary",role:"progressbar",style:_({width:`${t.progress}%`})},null,4)]),i("img",{src:e.sortedStories[t.currentStory].image,class:"w-100 h-100 object-fit-cover",alt:"Story"},null,8,B),i("div",P,[i("h5",T,S(e.sortedStories[t.currentStory].title),1),i("p",z,S(e.sortedStories[t.currentStory].description),1),e.sortedStories[t.currentStory].link?(l(),d(u,{key:0},[e.sortedStories[t.currentStory].link_type==="url"||e.sortedStories[t.currentStory].link_type==="bot"?(l(),d("a",{key:0,href:e.sortedStories[t.currentStory].link,target:"_blank",class:"btn btn-primary rounded-5 w-100 p-3"}," Перейти по ссылке ",8,A)):a("",!0),e.sortedStories[t.currentStory].link_type==="product"?(l(),d("a",{key:1,href:"javascript:void(0)",onClick:s[0]||(s[0]=n=>e.goToProductLink(e.sortedStories[t.currentStory].link)),class:"btn btn-primary rounded-5 w-100 p-3"}," Открыть товар ")):a("",!0)],64)):a("",!0)]),i("button",{type:"button",class:"btn-close btn-close-white position-absolute top-0 end-0 m-2",style:{"z-index":"10"},onClick:s[1]||(s[1]=(...n)=>e.closeStory&&e.closeStory(...n))})])])])):a("",!0)],64)}const D=m(I,[["render",N],["__scopeId","data-v-2e3941ad"]]);export{D as S};
