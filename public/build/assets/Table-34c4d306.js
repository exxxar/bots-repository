import{g as v,o,j as i,F as r,n as a,L as b,l as t,K as d,M as h,a2 as _,J as u,G as p,a0 as k,W as f,$ as y}from"./index.es-db843bab.js";import{P as g}from"./ProfileCard-5d81c033.js";import"./AdminProductCard-df07a238.js";import{P as w}from"./PreloaderV1-97f38083.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./ProductCardSimple-a61f6e6c.js";/* empty css                                                    */const T={class:"container"},$={key:0,class:"alert alert-danger my-2"},j=t("strong",{class:"fw-bold text-primary"},"закрыт",-1),C={class:"list-group list-group-flush"},O={class:"list-group-item"},S={class:"d-flex justify-content-between mb-0"},M={class:"fw-bold text-primary"},B={class:"list-group-item"},F={class:"d-flex justify-content-between mb-0"},L={key:0,href:"javascript:void(0)","data-bs-toggle":"modal","data-bs-target":"#creator-profile-modal",class:"fw-bold text-primary",style:{"text-align":"right"}},I=t("i",{class:"fa-solid fa-arrow-up-right-from-square"},null,-1),V={key:1},D={class:"list-group-item"},W={class:"d-flex justify-content-between mb-0"},q={key:0,"data-bs-toggle":"modal","data-bs-target":"#officiant-profile-modal",href:"javascript:void(0)",style:{"text-align":"right"},class:"fw-bold text-primary"},N=t("i",{class:"fa-solid fa-arrow-up-right-from-square"},null,-1),P={key:1},U={class:"list-group-item"},A={"data-bs-toggle":"modal","data-bs-target":"#clients-list-modal",class:"d-flex justify-content-between mb-0"},J={class:"fw-bold text-primary"},z={class:"list-group-item"},E={class:"d-flex justify-content-between mb-0"},G={class:"fw-bold text-primary"},K={class:"list-group-item"},H={"data-bs-toggle":"modal","data-bs-target":"#add-additional-modal",class:"d-flex justify-content-between mb-0"},Q={class:"fw-bold text-primary"},R=t("i",{class:"fa-solid fa-plus"},null,-1),X={class:"list-group-item"},Y={class:"d-flex justify-content-between mb-0 fw-bold"},Z={class:"fw-bold text-primary"},x=t("div",{class:"divider my-3"},"Действия",-1),tt=["disabled"],et={key:0},st={key:1},lt={class:"alert alert-light mb-2"},at=t("p",{class:"mb-2"},"Внимание! Закрывая столик вы подтверждаете что клиент уже завершает посещение заведения и оплатил заказ!",-1),ot={class:"form-check form-switch"},it=t("label",{class:"form-check-label",for:"need-automatic-cashback"},"Начислить автоматически баллы после закрытия!",-1),dt={class:"form-check form-switch"},nt=t("label",{class:"form-check-label",for:"can-close-table"},"Всё проверено, точно можно закрыть!",-1),ct=["disabled"],rt=t("i",{class:"fa-solid fa-lock"},null,-1),bt=t("p",{class:"divider my-3"},"Заказы клиентов",-1),ht={class:"my-3"},ut={class:"fw-bold"},mt={class:"list-group"},pt=["onClick"],_t={class:"fw-bold",style:{"font-size":"10px"}},ft={key:1},yt={class:"alert alert-light d-flex justify-content-between my-2"},gt={class:"fw-bold"},vt=t("div",{class:"divider my-3"},"Действия",-1),kt={class:"btn-group-vertical w-100 mb-3"},wt=["disabled"],Tt=t("i",{class:"fa-solid fa-xmark"},null,-1),$t=["disabled"],jt=t("i",{class:"fa-solid fa-plus"},null,-1),Ct=["disabled"],Ot=t("i",{class:"fa-solid fa-hand"},null,-1),St={class:"btn-group-vertical w-100"},Mt=["disabled"],Bt=t("i",{class:"fa-solid fa-check"},null,-1),Ft=["disabled"],Lt=t("i",{class:"fa-solid fa-ban"},null,-1),It=["disabled"],Vt=t("i",{class:"fa-solid fa-download"},null,-1),Dt={class:"modal fade",id:"creator-profile-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Wt={class:"modal-dialog modal-fullscreen"},qt={class:"modal-content"},Nt=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Профиль клиента"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Pt={class:"modal-body"},Ut={class:"modal fade",id:"officiant-profile-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},At={class:"modal-dialog modal-fullscreen"},Jt={class:"modal-content"},zt=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Профиль официанта"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Et={class:"modal-body"},Gt={class:"modal fade",id:"clients-list-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Kt={class:"modal-dialog modal-fullscreen"},Ht={class:"modal-content"},Qt=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Посетители за столиком"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Rt={class:"modal-body"},Xt={key:0,class:"list-group list-group-numbered"},Yt={class:"list-group-item d-flex justify-content-between align-items-start"},Zt={class:"ms-2 me-auto"},xt={class:"fw-bold"},te={class:"mb-0"},ee={class:"fw-bold"},se={class:"mb-0"},le={class:"fw-bold"},ae={class:"badge text-bg-primary rounded-pill"},oe={class:"modal fade",id:"add-additional-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ie={class:"modal-dialog modal-fullscreen"},de={class:"modal-content"},ne=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Дополнительные услуги"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ce={class:"modal-body"},re={class:"form-floating mb-3"},be=t("label",{for:"floatingInput"},"Описание",-1),he={class:"form-floating mb-3"},ue=t("label",{for:"floatingInput"},"Цена, руб",-1),me=t("button",{class:"btn btn-primary w-100 p-3"}," Создать сервис ",-1),pe=t("h6",{class:"divider my-3"},"Добавленные сервисы",-1),_e={class:"list-group"},fe={class:"list-group-item d-flex justify-content-between"},ye={class:"fw-bold"},ge=["onClick"],ve=t("i",{class:"fa-solid fa-xmark"},null,-1),ke=[ve],we={class:"modal-footer"},Te=["disabled"],$e={data(){return{can_close_table:!1,need_automatic_cashback:!0,serviceForm:{title:null,price:0},services:[],summary_price:0,summary_count:0,selected:[],table:null,clients:[],basket:[]}},computed:{...v(["getSelf"]),tg(){return window.Telegram.WebApp}},mounted(){this.loadTable(),this.tg.BackButton.show(),this.tg.BackButton.onClick(()=>{document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(n=>n.click()),this.$router.back()})},methods:{closeTable(){let n=this.$route.params.tableId;this.$store.dispatch("closeTableOrder",{dataObject:{table_id:n}}).then(e=>{this.$notify({title:"Заказ",text:"Столик успешно закрыт",type:"success"}),this.loadTable()}).catch(()=>{this.$notify({title:"Упс!",text:"Ошибка завершения работы столика",type:"error"})})},downloadTableData(){},acceptTableOrder(){this.changeOrderStatus(0)},declineTableOrder(){this.changeOrderStatus(1)},changeOrderStatus(n){let e=this.$route.params.tableId;this.$store.dispatch("acceptTableOder",{dataObject:{table_id:e,type:n}}).then(l=>{this.$notify({title:"Заказ",text:"Статус заказа успешно изменен",type:"success"}),this.loadTable()}).catch(()=>{this.$notify({title:"Упс!",text:"Ошибка изменения статуса заказа",type:"error"})})},storeServices(){let n=this.$route.params.tableId;this.$store.dispatch("storeTableAdditionalServices",{dataObject:{table_id:n,services:this.services}}).then(e=>{this.$notify({title:"Заказ",text:"Заказ успешно передан на кухню",type:"success"}),this.services=[],this.loadTable()}).catch(()=>{this.$notify({title:"Упс!",text:"Ошибка передачи заказа",type:"error"})})},deselect(){this.selected=[]},removeService(n){this.services.splice(n,1)},pushService(){const n=JSON.parse(JSON.stringify(this.serviceForm));this.services.push(n),this.serviceForm.price=0,this.serviceForm.title=null},selectBasketItem(n){let e=this.selected.findIndex(l=>n.id===l);e!==-1?this.selected.splice(e,1):this.selected.push(n.id)},changeTableWaiter(){let n=this.$route.params.tableId;this.$store.dispatch("changeTableWaiter",{dataObject:{table_id:n}}).then(e=>{this.$notify({title:"Смена официанта",text:"Официант успешно изменен",type:"success"}),this.table=e.data}).catch(()=>{this.$notify({title:"Упс!",text:"Ошибка смены официанта",type:"error"})})},loadTable(){let n=this.$route.params.tableId;this.$store.dispatch("loadTableData",{dataObject:{table_id:n}}).then(e=>{this.summary_price=e.summary_price||0,this.summary_count=e.summary_count||0,this.table=e.table||null,this.services=[...this.services,...this.table.additional_services||[]],this.clients=e.clients||[],this.basket=e.basket||[]})}}},Ie=Object.assign($e,{__name:"Table",setup(n){return(e,l)=>(o(),i("div",T,[e.table?(o(),i(r,{key:0},[e.table.closed_at!=null?(o(),i("div",$,[a(" Внимание! Данный столик уже "),j,a("! Операции со столиком недоступны! ")])):b("",!0),t("ul",C,[t("li",O,[t("p",S,[a("Номер столика "),t("span",M,"#"+d(e.table.number||"1"),1)])]),t("li",B,[t("p",F,[a("Столик оформлен на "),e.table.creator?(o(),i("a",L,[I,a(" "+d(e.table.creator.fio_from_telegram||"-"),1)])):(o(),i("span",V," не указано "))])]),t("li",D,[t("p",W,[a("Столик обслуживает "),e.table.officiant?(o(),i("a",q,[N,a(" "+d(e.table.officiant.name||e.table.officiant.fio_from_telegram||"-"),1)])):(o(),i("span",P," не указано "))])]),t("li",U,[t("p",A,[a("Кол-во гостей "),t("span",J,d(e.clients.length)+" чел.",1)])]),t("li",z,[t("p",E,[a("Заказано позиций "),t("span",G,d(e.summary_count)+" ед.",1)])]),t("li",K,[t("p",H,[a("Дополнительные услуги "),t("span",Q,[R,a(" "+d((e.table.additional_services||[]).length)+" ед.",1)])])]),t("li",X,[t("p",Y,[a("Итого "),t("span",Z,d(e.summary_price)+" ₽",1)])])]),x,t("button",{type:"button",disabled:e.table.closed_at!=null,onClick:l[0]||(l[0]=(...s)=>e.changeTableWaiter&&e.changeTableWaiter(...s)),class:"btn btn-primary w-100 p-3 mb-2"},[e.table.officiant_id==null?(o(),i("span",et,"Взять столик в работу")):(o(),i("span",st,"Перестать обслуживать столик"))],8,tt),t("div",lt,[at,t("div",ot,[h(t("input",{class:"form-check-input","onUpdate:modelValue":l[1]||(l[1]=s=>e.need_automatic_cashback=s),type:"checkbox",role:"switch",id:"need-automatic-cashback"},null,512),[[_,e.need_automatic_cashback]]),it]),t("div",dt,[h(t("input",{class:"form-check-input","onUpdate:modelValue":l[2]||(l[2]=s=>e.can_close_table=s),type:"checkbox",role:"switch",id:"can-close-table"},null,512),[[_,e.can_close_table]]),nt])]),t("button",{type:"button",disabled:!e.can_close_table||e.table.closed_at!=null,onClick:l[3]||(l[3]=(...s)=>e.closeTable&&e.closeTable(...s)),class:"btn btn-primary w-100 p-3"},[rt,a(" Закрыть столик ")],8,ct),bt,e.basket.length>0?(o(!0),i(r,{key:1},u(e.basket,s=>(o(),i(r,null,[t("p",ht,[a("Клиент "),t("span",ut,d(s.name||"-"),1)]),t("ul",mt,[(o(!0),i(r,null,u(s.basket,c=>{var m;return o(),i("li",{class:y(["list-group-item d-flex justify-content-between align-items-center",{"bg-warning text-white fw-bold":(e.selected||[]).indexOf(c.id)!=-1}]),onClick:je=>e.selectBasketItem(c)},[c.product?(o(),i(r,{key:0},[t("span",null,[t("i",{class:y([{"text-secondary":c.table_approved_at==null,"text-success":c.table_approved_at!=null},"fa-solid fa-check-double"])},null,2),a(" "+d(((m=c.product)==null?void 0:m.title)||"-"),1)]),t("span",_t,d(c.count)+"ед. x "+d(c.product.current_price)+"₽ = "+d(c.count*c.product.current_price)+"₽",1)],64)):(o(),i("span",ft,"товар не найден"))],10,pt)}),256))]),t("p",yt,[a("Итого по клиенту "),t("span",gt,d(s.summary_price||0)+"₽",1)])],64))),256)):b("",!0),vt,e.selected.length>0?(o(),i(r,{key:2},[t("p",null,[a("Вы выбрали "+d(e.selected.length||0)+" позиций ",1),t("span",{onClick:l[4]||(l[4]=(...s)=>e.deselect&&e.deselect(...s)),class:"text-primary"},"(отменить выделение)")]),t("div",kt,[t("button",{type:"button",disabled:e.table.officiant_id==null||e.table.closed_at!=null,class:"btn btn-outline-primary p-3"},[Tt,a(" Убрать выбранные из заказ ")],8,wt),t("button",{type:"button",disabled:e.table.officiant_id==null||e.table.closed_at!=null,class:"btn btn-outline-primary p-3"},[jt,a(" Увеличить кол-во в заказе ")],8,$t),t("button",{type:"button",disabled:e.table.officiant_id==null||e.table.closed_at!=null,class:"btn btn-outline-primary p-3"},[Ot,a(" Добавить выбранное в стоп-лист ")],8,Ct)])],64)):b("",!0),t("div",St,[t("button",{type:"button",onClick:l[5]||(l[5]=(...s)=>e.acceptTableOrder&&e.acceptTableOrder(...s)),disabled:e.table.officiant_id==null||e.table.closed_at!=null,class:"btn btn-success p-3"},[Bt,a(" Подтвердить заказ ")],8,Mt),t("button",{onClick:l[6]||(l[6]=(...s)=>e.declineTableOrder&&e.declineTableOrder(...s)),disabled:e.table.officiant_id==null||e.table.closed_at!=null,type:"button",class:"btn btn-danger p-3"},[Lt,a(" Отклонить заказ ")],8,Ft),t("button",{onClick:l[7]||(l[7]=(...s)=>e.downloadTableData&&e.downloadTableData(...s)),disabled:e.table.officiant_id==null,type:"button",class:"btn btn-info p-3"},[Vt,a(" Скачать данные файлом ")],8,It)]),t("div",Dt,[t("div",Wt,[t("div",qt,[Nt,t("div",Pt,[e.table.creator?(o(),p(g,{key:0,"can-edit":!1,data:e.table.creator},null,8,["data"])):b("",!0)])])])]),t("div",Ut,[t("div",At,[t("div",Jt,[zt,t("div",Et,[e.table.officiant?(o(),p(g,{key:0,"can-edit":!1,data:e.table.officiant},null,8,["data"])):b("",!0)])])])]),t("div",Gt,[t("div",Kt,[t("div",Ht,[Qt,t("div",Rt,[e.clients.length>0?(o(),i("ol",Xt,[(o(!0),i(r,null,u(e.clients,s=>(o(),i("li",Yt,[t("div",Zt,[t("div",xt,d(s.name||s.fio_from_telegram||s.telegram_chat_id||"-"),1),t("p",te,[a("Номер телефона "),t("span",ee,d(s.phone||"не указан"),1)]),t("p",se,[a("День рождения "),t("span",le,d(s.birthday||"не указано"),1)])]),t("span",ae,"#"+d(s.id),1)]))),256))])):b("",!0)])])])]),t("div",oe,[t("div",ie,[t("div",de,[ne,t("div",ce,[t("form",{onSubmit:l[10]||(l[10]=k((...s)=>e.pushService&&e.pushService(...s),["prevent"]))},[t("div",re,[h(t("input",{type:"text","onUpdate:modelValue":l[8]||(l[8]=s=>e.serviceForm.title=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[f,e.serviceForm.title]]),be]),t("div",he,[h(t("input",{type:"number","onUpdate:modelValue":l[9]||(l[9]=s=>e.serviceForm.price=s),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[f,e.serviceForm.price]]),ue]),me],32),e.services.length>0?(o(),i(r,{key:0},[pe,t("ul",_e,[(o(!0),i(r,null,u(e.services,(s,c)=>(o(),i("li",fe,[t("span",null,[a(d((s==null?void 0:s.title)||"-")+" ",1),t("strong",ye,d(s.price)+" ₽",1)]),t("a",{onClick:m=>e.removeService(c),href:"javascript:void(0)"},ke,8,ge)]))),256))])],64)):b("",!0)]),t("div",we,[t("button",{type:"button",onClick:l[11]||(l[11]=(...s)=>e.storeServices&&e.storeServices(...s)),disabled:e.services.length===0,class:"btn btn-primary w-100 p-3"},"Перенести сервисы в чек ",8,Te)])])])])],64)):(o(),p(w,{key:1}))]))}});export{Ie as default};
