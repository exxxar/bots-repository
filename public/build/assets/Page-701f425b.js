import{o,j as n,l as t,M as d,a8 as C,W as _,G as b,L as r,a0 as $,n as m,K as h,F as c,J as f,a2 as u,k as p,$ as k,N as S}from"./index.es-db843bab.js";import{_ as v}from"./KeyboardConstructor-90166f82.js";import{B as R}from"./KeyboardConstructor-588c524a.js";import{_ as T}from"./KeyboardCard-a639a598.js";import{v as j}from"./v4-4a60fe23.js";import{_ as w,a as U,b as K}from"./BotDialogGroupListSimple-287bb644.js";import{T as B}from"./TelegramChannelHelper-fd9e25b4.js";import{_ as y}from"./BotMediaList-e761023c.js";/* empty css                                                               */const P={key:0},I=t("h6",null,"Форма создания шаблона клавиатуры",-1),M={class:"mb-3"},D=t("label",{class:"form-label",id:"bot-domain"},"Тип",-1),O=t("option",{value:"reply"},"Нижняя клавиатура",-1),q=t("option",{value:"inline"},"Встроенная клавиатура",-1),E=[O,q],L={class:"mb-3"},N={class:"form-label d-flex justify-content-between",id:"bot-domain"},z=t("span",null,"Мнемоническое имя",-1),A=t("i",{class:"fa-solid fa-arrows-rotate"},null,-1),J=[A],x={class:"col-12"},G=t("button",{class:"btn btn-m btn-full mb-0 rounded-xs text-uppercase font-900 shadow-s bg-green1-dark w-100"}," Добавить новый шаблон клавиатуры ",-1),H=t("div",{class:"divider divider-small my-3 bg-highlight"},null,-1),Q={key:1,class:"mb-1"},W={class:"badge bg-warning"},X={class:"mb-3"},Y={key:1,class:"card"},Z={class:"card-body"},ee={key:3,class:"mb-3"},se=t("div",{class:"alert alert-warning",role:"alert"},[t("p",null,"Список шаблонов клавиатур пуст!")],-1),te=[se],le={props:["selectMode","type"],data(){return{keyboards:[],load:!1,editedKeyboard:null,selectMenuIndex:null,keyboardForm:{type:"reply",slug:null,menu:[]}}},computed:{filteredKeyboard(){return this.type?this.keyboards.filter(s=>s.type==this.type):this.keyboards}},mounted(){this.loadMenusByBotTemplate(),this.generateSlug()},methods:{selectCard(s){this.$emit("select",s)},keyboardCallbackAction(s){let e=this.keyboards.find(l=>l.id===s);e.deleted_at=new Date,this.loadMenusByBotTemplate()},loadMenusByBotTemplate(){this.$store.dispatch("loadBotKeyboards").then(s=>{this.$nextTick(()=>{this.keyboards=s.data})})},submitKeyboard(){let s=new FormData;Object.keys(this.keyboardForm).forEach(e=>{const l=this.keyboardForm[e]||"";typeof l=="object"?s.append(e,JSON.stringify(l)):s.append(e,l)}),this.$store.dispatch("createKeyboardTemplate",{keyboardForm:s}).then(e=>{this.keyboardForm={type:"reply",slug:null,menu:[]},this.load=!0,this.$nextTick(()=>{this.load=!1}),this.loadMenusByBotTemplate()})},generateSlug(){this.keyboardForm.slug=j()},changeKeyboardFormMenu(s){this.keyboardForm.menu=s}}},F=Object.assign(le,{__name:"KeyboardList",setup(s){return(e,l)=>(o(),n(c,null,[s.selectMode?r("",!0):(o(),n("div",P,[I,t("form",{onSubmit:l[3]||(l[3]=$((...a)=>e.submitKeyboard&&e.submitKeyboard(...a),["prevent"]))},[t("div",M,[D,d(t("select",{"onUpdate:modelValue":l[0]||(l[0]=a=>e.keyboardForm.type=a),class:"form-control"},E,512),[[C,e.keyboardForm.type]])]),t("div",L,[t("label",N,[z,t("a",{onClick:l[1]||(l[1]=(...a)=>e.generateSlug&&e.generateSlug(...a)),href:"javascript:void(0)"},J)]),d(t("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя","onUpdate:modelValue":l[2]||(l[2]=a=>e.keyboardForm.slug=a),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[_,e.keyboardForm.slug]])]),t("div",x,[e.load?r("",!0):(o(),b(R,{key:0,onSave:e.changeKeyboardFormMenu,"edited-keyboard":e.keyboardForm},null,8,["onSave","edited-keyboard"]))]),G],32),H])),e.keyboards?(o(),n("p",Q,[m("В списке клавиатур "),t("span",W,h(e.filteredKeyboard.length)+" ед.",1)])):r("",!0),e.keyboards?(o(!0),n(c,{key:2},f(e.filteredKeyboard,(a,i)=>(o(),n("div",X,[a.deleted_at?(o(),n("div",Y,[t("div",Z,[t("p",null,"Удаленная клавиатура #"+h(a.id),1)])])):(o(),b(T,{key:0,"select-mode":s.selectMode,onSelect:e.selectCard,onReload:e.loadMenusByBotTemplate,onCallback:e.keyboardCallbackAction,keyboard:a},null,8,["select-mode","onSelect","onReload","onCallback","keyboard"]))]))),256)):r("",!0),e.filteredKeyboard.length===0?(o(),n("div",ee,te)):r("",!0)],64))}}),oe=t("div",{class:"alert alert-success",role:"alert"},' Проверка правил идет по методу "И" - все правила должны выполняться для перехода на данную страницу, иначе будет вызвана страница из блока "иначе". Действия для "иначе" добавлять не обязательно. ',-1),ne=t("h6",{class:"my-2 fw-bold"},"Блок условий (если)",-1),ie=t("div",{class:"alert-light alert mb-2",id:"bot-domain"}," Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие будет выполнено. Не обязательно ",-1),ae={class:"form-floating mb-2"},re=t("label",{for:"rules-if-message"},"Текст сообщения",-1),de={class:"dropdown"},ue=t("button",{class:"btn btn-outline-primary w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Доступные для выбора условия ",-1),me={class:"dropdown-menu w-100"},ce=["onClick"],_e={class:"dropdown-item",href:"javascript:void(0)"},he={key:1,class:"my-2"},pe={key:2,class:"list-group"},be={key:0,class:"list-group-item d-flex justify-content-between align-items-center"},ge={class:"form-check"},fe={class:"form-check-label",for:"bot-user-is-vip"},ye={key:0},ke={key:1},ve=t("i",{class:"fa-solid fa-trash-can"},null,-1),Fe=[ve],$e={key:1,class:"list-group-item d-flex justify-content-between align-items-center"},we={class:"form-check"},Ve={class:"form-check-label",for:"bot-user-is-admin"},Ce={key:0},Se={key:1},Re=t("i",{class:"fa-solid fa-trash-can"},null,-1),Te=[Re],je={key:2,class:"list-group-item d-flex justify-content-between align-items-center"},Ue={class:"form-check"},Ke={class:"form-check-label",for:"bot-user-is-deliveryman"},Be={key:0},Pe={key:1},Ie=t("i",{class:"fa-solid fa-trash-can"},null,-1),Me=[Ie],De={key:3,class:"list-group-item d-flex justify-content-between align-items-center"},Oe={class:"form-check"},qe={class:"form-check-label",for:"bot-user-is-work"},Ee={key:0},Le={key:1},Ne=t("i",{class:"fa-solid fa-trash-can"},null,-1),ze=[Ne],Ae={key:4,class:"list-group-item d-flex justify-content-between align-items-center"},Je={class:"form-check"},xe={class:"form-check-label",for:"bot-user-in-location"},Ge={key:0},He={key:1},Qe=t("i",{class:"fa-solid fa-trash-can"},null,-1),We=[Qe],Xe={key:5,class:"list-group-item d-flex justify-content-between align-items-center"},Ye=t("label",{class:"form-label",id:"bot-domain"}," Возраст от ",-1),Ze=t("i",{class:"fa-solid fa-trash-can"},null,-1),es=[Ze],ss={key:6,class:"list-group-item d-flex justify-content-between align-items-center"},ts=t("label",{class:"form-label",id:"bot-domain"}," Только для города ",-1),ls=t("i",{class:"fa-solid fa-trash-can"},null,-1),os=[ls],ns={key:7,class:"list-group-item d-flex justify-content-between align-items-center"},is={class:"form-check"},as={class:"form-check-label",for:"bot-user-sex"},rs={key:0},ds={key:1},us=t("i",{class:"fa-solid fa-trash-can"},null,-1),ms=[us],cs={key:8,class:"list-group-item"},_s={class:"mb-3"},hs={class:"d-flex justify-content-between align-items-center"},ps={class:"form-label d-flex w-100 align-items-center",id:"bot-order-channel"},bs=["onClick"],gs=t("i",{class:"fa-solid fa-trash-can"},null,-1),fs=[gs],ys={class:"form-floating"},ks=["onUpdate:modelValue"],vs=t("label",{for:""},"id канала",-1),Fs={key:3,class:"my-3 fw-bold"},$s={key:4,class:"d-flex justify-content-between"},ws=t("div",{class:"alert-light alert mb-2",id:"bot-domain"},' Напишите текст, который будет отображен пользователю вместе с основным контентом в случае если условие не будет выполнено и будет вызван блок "иначе" ',-1),Vs={class:"form-floating mb-2"},Cs=t("label",{for:"rules-else-message"},"Текст сообщения",-1),Ss={props:["bot","rulesForm"],data(){return{rules:[{id:1,title:"Является администратором",rules_block:"bot_user",rule:{is_admin:!0}},{id:2,title:"Является VIP-пользователем",rules_block:"bot_user",rule:{is_vip:!0}},{id:3,title:"Находится в заведении",rules_block:"bot_user",rule:{user_in_location:!0}},{id:4,title:"За работой",rules_block:"bot_user",rule:{is_work:!0}},{id:5,title:"Возраст от ...",rules_block:"bot_user",rule:{age:18}},{id:6,title:"Находится в городе ...",rules_block:"bot_user",rule:{city:"Краснодар"}},{id:7,title:"Пол",rules_block:"bot_user",rule:{sex:!0}},{id:8,title:"Состоит в канале",rules_block:"channels",rule:{channel:1}},{id:9,title:"Является Менеджером",rules_block:"bot_user",rule:{is_manager:!0}}]}},mounted(){window.addEventListener("select-rule-event",s=>{this.addRulesFromEvent(s.detail.rule)})},methods:{hasRuleKey(s){return this.rulesForm.rules_if==null?!1:Object.keys(this.rulesForm.rules_if.bot_user).find(e=>e===s)!=null},modifyChannel(s){this.rulesForm.rules_if.channels[s.param]=s.text},removeChannelFromRule(s){this.rulesForm.rules_if.channels.splice(s,1),this.checkRules()},checkRules(){const s=Object.getOwnPropertyNames(this.rulesForm.rules_if.bot_user),e=this.rulesForm.rules_if.channels;s.length===0&&e.length===0&&(this.rulesForm.rules_if=null)},removeRule(s){delete this.rulesForm.rules_if.bot_user[s],this.checkRules()},addRulesFromEvent(s){this.rulesForm.rules_if||(this.rulesForm.rules_if={bot_user:{},channels:[]}),s.rules_block==="bot_user"&&(this.rulesForm.rules_if.bot_user={...this.rulesForm.rules_if.bot_user,...s.rule}),s.rules_block==="channels"&&this.rulesForm.rules_if.channels.push(s.rule.channel)},attachPageToRule(s){s.id!=this.rulesForm.id?this.rulesForm.rules_else_page_id=s.id:this.$notify({title:"Правила страниц",text:"Вы не можете связать данную страницу с собой!",type:"error"})},openRulesModal(){this.$botPages.rules()}}},Rs=Object.assign(Ss,{__name:"PageRules",setup(s){return(e,l)=>(o(),n(c,null,[oe,ne,s.rulesForm.rules_if?(o(),n(c,{key:0},[ie,t("div",ae,[d(t("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":l[0]||(l[0]=a=>s.rulesForm.rules_if_message=a),maxlength:"255",id:"rules-if-message","aria-describedby":"rules-if-message"},`
            `,512),[[_,s.rulesForm.rules_if_message]]),re])],64)):r("",!0),t("div",de,[ue,t("ul",me,[(o(!0),n(c,null,f(e.rules,a=>(o(),n("li",{onClick:i=>e.addRulesFromEvent(a)},[t("a",_e,h(a.title||"Не указан"),1)],8,ce))),256))])]),s.rulesForm.rules_if?(o(),n("h6",he,"Выбранные условия")):r("",!0),s.rulesForm.rules_if?(o(),n("ul",pe,[e.hasRuleKey("is_vip")?(o(),n("li",be,[t("div",ge,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[1]||(l[1]=a=>s.rulesForm.rules_if.bot_user.is_vip=a),type:"checkbox",id:"bot-user-is-vip"},null,512),[[u,s.rulesForm.rules_if.bot_user.is_vip]]),t("label",fe,[s.rulesForm.rules_if.bot_user.is_vip?(o(),n("span",ye,"Является VIP-пользователем")):(o(),n("span",ke,"Не является VIP-пользователем"))])]),t("button",{type:"button",class:"btn btn-outline-info",onClick:l[2]||(l[2]=a=>e.removeRule("is_vip"))},Fe)])):r("",!0),e.hasRuleKey("is_admin")?(o(),n("li",$e,[t("div",we,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[3]||(l[3]=a=>s.rulesForm.rules_if.bot_user.is_admin=a),type:"checkbox",id:"bot-user-is-admin"},null,512),[[u,s.rulesForm.rules_if.bot_user.is_admin]]),t("label",Ve,[s.rulesForm.rules_if.bot_user.is_admin?(o(),n("span",Ce,"Является администратором")):(o(),n("span",Se,"Не является администратором"))])]),t("button",{type:"button",class:"btn btn-outline-info",onClick:l[4]||(l[4]=a=>e.removeRule("is_admin"))},Te)])):r("",!0),e.hasRuleKey("is_deliveryman")?(o(),n("li",je,[t("div",Ue,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[5]||(l[5]=a=>s.rulesForm.rules_if.bot_user.is_deliveryman=a),type:"checkbox",id:"bot-user-is-deliveryman"},null,512),[[u,s.rulesForm.rules_if.bot_user.is_deliveryman]]),t("label",Ke,[s.rulesForm.rules_if.bot_user.is_deliveryman?(o(),n("span",Be,"Является доставщиком")):(o(),n("span",Pe,"Не является доставщиком"))])]),t("button",{type:"button",class:"btn btn-outline-info",onClick:l[6]||(l[6]=a=>e.removeRule("is_deliveryman"))},Me)])):r("",!0),e.hasRuleKey("is_work")?(o(),n("li",De,[t("div",Oe,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[7]||(l[7]=a=>s.rulesForm.rules_if.bot_user.is_work=a),type:"checkbox",id:"bot-user-is-work"},null,512),[[u,s.rulesForm.rules_if.bot_user.is_work]]),t("label",qe,[s.rulesForm.rules_if.bot_user.is_work?(o(),n("span",Ee,"За работой")):(o(),n("span",Le,"Не работает"))])]),t("button",{type:"button",class:"btn btn-outline-info",onClick:l[8]||(l[8]=a=>e.removeRule("is_work"))},ze)])):r("",!0),e.hasRuleKey("user_in_location")?(o(),n("li",Ae,[t("div",Je,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[9]||(l[9]=a=>s.rulesForm.rules_if.bot_user.user_in_location=a),type:"checkbox",id:"bot-user-in-location"},null,512),[[u,s.rulesForm.rules_if.bot_user.user_in_location]]),t("label",xe,[s.rulesForm.rules_if.bot_user.user_in_location?(o(),n("span",Ge,"Находится в заведении")):(o(),n("span",He,"Не находится в заведении"))])]),t("button",{type:"button",class:"btn btn-outline-info",onClick:l[10]||(l[10]=a=>e.removeRule("user_in_location"))},We)])):r("",!0),e.hasRuleKey("age")?(o(),n("li",Xe,[t("div",null,[Ye,d(t("input",{type:"text",class:"form-control",placeholder:"Возраст от","aria-label":"Возраст от","onUpdate:modelValue":l[11]||(l[11]=a=>s.rulesForm.rules_if.bot_user.age=a),maxlength:"255","aria-describedby":"bot-user-age"},null,512),[[_,s.rulesForm.rules_if.bot_user.age]])]),t("button",{type:"button",class:"btn btn-outline-info",onClick:l[12]||(l[12]=a=>e.removeRule("age"))},es)])):r("",!0),e.hasRuleKey("city")?(o(),n("li",ss,[t("div",null,[ts,d(t("input",{type:"text",class:"form-control",placeholder:"Город","aria-label":"Город","onUpdate:modelValue":l[13]||(l[13]=a=>s.rulesForm.rules_if.bot_user.city=a),maxlength:"255","aria-describedby":"bot-user-city"},null,512),[[_,s.rulesForm.rules_if.bot_user.city]])]),t("button",{type:"button",class:"btn btn-outline-info",onClick:l[14]||(l[14]=a=>e.removeRule("city"))},os)])):r("",!0),e.hasRuleKey("sex")?(o(),n("li",ns,[t("div",is,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[15]||(l[15]=a=>s.rulesForm.rules_if.bot_user.sex=a),type:"checkbox",id:"bot-user-sex"},null,512),[[u,s.rulesForm.rules_if.bot_user.sex]]),t("label",as,[s.rulesForm.rules_if.bot_user.sex?(o(),n("span",rs,"Только для мужчин")):(o(),n("span",ds,"Только для женщин"))])]),t("button",{type:"button",class:"btn btn-outline-info",onClick:l[16]||(l[16]=a=>e.removeRule("sex"))},ms)])):r("",!0),s.rulesForm.rules_if.channels.length>0?(o(),n("li",cs,[m("Проверка нахождения в канале \\ группе: "),(o(!0),n(c,null,f(s.rulesForm.rules_if.channels,(a,i)=>(o(),n("div",_s,[t("div",hs,[t("label",ps,[p(B,{token:s.bot.bot_token,param:`${i}`,onCallback:e.modifyChannel},null,8,["token","param","onCallback"]),m(" Канал для проверки ")]),t("button",{type:"button",class:"btn btn-link text-danger",onClick:g=>e.removeChannelFromRule(i)},fs,8,bs)]),t("div",ys,[d(t("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":g=>s.rulesForm.rules_if.channels[i]=g,maxlength:"255","aria-describedby":"bot-order-channel"},null,8,ks),[[_,s.rulesForm.rules_if.channels[i]]]),vs])]))),256))])):r("",!0)])):r("",!0),s.rulesForm.rules_if?(o(),n("h6",Fs,"Иначе")):r("",!0),s.rulesForm.rules_else_page_id?(o(),n("p",$s,[m("Вы выбрали страницу #"+h(s.rulesForm.rules_else_page_id)+' в качестве условия "иначе" ',1),t("a",{href:"javascript:void(0)",onClick:l[17]||(l[17]=a=>s.rulesForm.rules_else_page_id=null)},"Очистить")])):r("",!0),s.rulesForm.rules_if?(o(),b(w,{key:5,current:s.rulesForm.id,onCallback:e.attachPageToRule,editor:!1},null,8,["current","onCallback"])):r("",!0),s.rulesForm.rules_if?(o(),n(c,{key:6},[ws,t("div",Vs,[d(t("textarea",{type:"text",class:"form-control",placeholder:"Текст сообщения","aria-label":"Текст сообщения","onUpdate:modelValue":l[18]||(l[18]=a=>s.rulesForm.rules_else_message=a),maxlength:"255",id:"rules-else-message","aria-describedby":"rules-else-message"},`
            `,512),[[_,s.rulesForm.rules_else_message]]),Cs])],64)):r("",!0)],64))}}),Ts=t("i",{class:"fa-solid fa-xmark mr-1"},null,-1),js={key:1,class:"form-check form-switch mb-2"},Us=t("label",{class:"form-check-label",for:"flexSwitchCheckDefault"},"Отобразить QR-код и ссылку на страницу",-1),Ks={key:2,class:"alert alert-info mb-2"},Bs={class:"d-flex justify-content-center"},Ps={style:{width:"300px",height:"300px"}},Is=t("div",{class:"alert alert-light mb-2"},[m(" Команда должна начинаться с символа . и *"),t("br"),m(" Например: .*Меню ")],-1),Ms={class:"form-floating mb-2"},Ds=t("label",{class:"form-label",id:"bot-domain"},[m(" Команда "),t("span",{class:"fw-bold text-danger"},"*")],-1),Os={class:"form-floating mb-2"},qs=t("label",{class:"form-label",id:"bot-domain"},[m(" Описание страницы "),t("span",{class:"fw-bold text-danger"},"*")],-1),Es={class:"mb-2"},Ls={class:"form-check"},Ns=t("label",{class:"form-check-label",for:"is_external"}," Внешнее управление страницей ",-1),zs={class:"form-floating mb-2"},As={for:"floatingTextarea2"},Js={key:0},xs={class:"mb-2"},Gs={class:"form-check"},Hs=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),Qs={key:0,class:"mb-2"},Ws=t("h6",null,"Изображения на странице",-1),Xs={class:"d-flex flex-wrap justify-content-center"},Ys={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},Zs={class:"mb-2 mr-2 img-preview"},et={class:"remove"},st=["onClick"],tt={key:0},lt={key:1,class:"d-flex flex-wrap justify-content-center"},ot={class:"mb-2 img-preview",style:{"margin-right":"10px"}},nt={class:"remove"},it=["onClick"],at={class:"form-check mb-2"},rt=t("label",{class:"form-check-label",for:"need-page-video"}," Видео к странице ",-1),dt={key:1,class:"mb-2"},ut=t("p",{class:"alert alert-danger mb-2 rounded-s"}," Внимание! не больше 10 видео на 1й странице! ",-1),mt={class:"form-check mb-2"},ct=t("label",{class:"form-check-label",for:"need-page-sticker"}," Стикер к странице ",-1),_t={key:2,class:"mb-2"},ht={class:"form-check mb-2"},pt=t("label",{class:"form-check-label",for:"need-reply-menu"}," Нижнее меню страницы ",-1),bt={class:"form-check mb-2"},gt=t("label",{class:"form-check-label",for:"need-page-audio"}," Звук к странице ",-1),ft={key:3,class:"mb-2"},yt=t("p",{class:"alert alert-danger"}," Внимание! не больше 10 аудио (audio) на 1й странице! Или 1 голосовое (voice) ",-1),kt={class:"form-check mb-2"},vt=t("label",{class:"form-check-label",for:"need-page-document"}," Документ \\ презентацию к странице \\ картинку в оригинале ",-1),Ft={key:4,class:"mb-2"},$t=t("p",{class:"alert alert-danger"}," Внимание! не больше 10 документов на 1й странице! ",-1),wt={key:5,class:"mb-2"},Vt=t("h6",{class:"mb-2"},"Конструктор нижнего меню",-1),Ct={class:"form-floating mb-2"},St=t("label",{class:"form-check-label",for:"bot-reply_keyboard_title"}," Заголовок нижнего меню ",-1),Rt={key:0},Tt={key:1},jt={class:"form-check mb-2"},Ut=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Kt={key:6,class:"mb-2"},Bt=t("h6",null,"Конструктор меню в сообщении",-1),Pt={key:0},It={key:1},Mt={class:"form-check mb-2"},Dt=t("label",{class:"form-check-label",for:"need-page-attach"}," Связать с другой страницей ",-1),Ot={key:7,class:"mb-2"},qt={key:0,class:"d-flex justify-content-between mb-0 align-items-center"},Et=t("i",{class:"fa-solid fa-trash"},null,-1),Lt=[Et],Nt={class:"form-check mb-2"},zt=t("label",{class:"form-check-label",for:"need-slug-attach"}," Привязать скрипт ",-1),At={key:8,class:"mb-2"},Jt={key:0,class:"d-flex justify-content-between mb-0 align-items-center"},xt=t("i",{class:"fa-solid fa-trash"},null,-1),Gt=[xt],Ht={class:"form-check mb-2"},Qt=t("label",{class:"form-check-label",for:"need-dialog-attach"}," Привязать начало диалога ",-1),Wt={key:9,class:"mb-2"},Xt={key:0,class:"d-flex justify-content-between mb-0 align-items-center"},Yt=t("i",{class:"fa-solid fa-trash"},null,-1),Zt=[Yt],el={class:"form-check mb-2"},sl=t("label",{class:"form-check-label",for:"need-rules"}," Нужны правила загрузки страницы ",-1),tl=t("button",{style:{"z-index":"100"},type:"submit",class:"btn btn-success w-100 p-3 mb-3"},"Сохранить изменения ",-1),ll={props:["page","onlyEdit"],data(){return{need_show_qr_and_link:!1,need_clean:!1,load:!1,photos:[],showReplyTemplateSelector:!1,showInlineTemplateSelector:!1,need_page_sticker:!1,need_page_audios:!1,need_page_documents:!1,need_page_video:!1,need_page_images:!1,need_rules:!1,need_inline_menu:!1,need_reply_menu:!1,need_attach_page:!1,need_attach_dialog:!1,need_attach_slug:!1,bot:null,pageForm:{id:null,content:"",command:null,slug:null,comment:null,sticker:null,images:[],videos:[],audios:[],documents:[],reply_keyboard_title:null,reply_keyboard:null,inline_keyboard:null,is_external:!1,next_page_id:null,next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if:null,rules_else_page_id:null,rules_if_message:null,rules_else_message:null}}},watch:{need_rules:function(s,e){this.need_rules||(this.pageForm.rules_if=null,this.pageForm.rules_else_page_id=null,this.pageForm.rules_if_message=null,this.pageForm.rules_else_message=null)},need_page_audios:function(s,e){this.need_page_audios||(this.pageForm.audios=[])},need_page_documents:function(s,e){this.need_page_documents||(this.pageForm.documents=[])},need_page_sticker:function(s,e){this.need_page_sticker||(this.pageForm.sticker=null)},need_page_images:function(s,e){this.need_page_images||(this.photos=[],this.pageForm.images=[])},need_page_video:function(s,e){this.need_page_video||(this.pageForm.videos=[])},need_inline_menu:function(s,e){this.need_inline_menu||(this.pageForm.inline_keyboard=null,this.pageForm.inline_keyboard_id=null)},need_reply_menu:function(s,e){this.need_reply_menu||(this.pageForm.reply_keyboard=null,this.pageForm.reply_keyboard_id=null)},need_attach_page:function(s,e){this.need_attach_page||(this.pageForm.next_page_id=null)},need_attach_dialog:function(s,e){this.need_attach_dialog||(this.pageForm.next_bot_dialog_command_id=null)},need_attach_slug:function(s,e){this.need_attach_slug||(this.pageForm.next_bot_menu_slug_id=null)},pageForm:{handler:function(s){this.pageForm.reply_keyboard!=null&&(this.need_reply_menu=!0),this.pageForm.inline_keyboard!=null&&(this.need_inline_menu=!0),this.pageForm.images.length>0&&(this.need_page_images=!0),this.pageForm.next_bot_dialog_command_id!=null&&(this.need_attach_dialog=!0),this.pageForm.next_bot_menu_slug_id!=null&&(this.need_attach_slug=!0),this.pageForm.next_page_id!=null&&(this.need_attach_page=!0),this.pageForm.rules_if!=null&&(this.need_rules=!0),this.pageForm.videos.length>0&&(this.need_page_video=!0),this.pageForm.audios.length>0&&(this.need_page_audios=!0),this.pageForm.documents.length>0&&(this.need_page_documents=!0),this.pageForm.sticker&&(this.need_page_sticker=!0),this.need_clean=!0},deep:!0}},computed:{currentBot(){return window.currentBot},qr(){return"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link},pageLink(){if(!this.pageForm.id)return"Ссылка недоступна";let s="";for(let e=0;e<10-(""+this.pageForm.id).length;e++)s+="0";return s+=this.pageForm.id,"https://t.me/"+this.currentBot.bot_domain+"?start="+btoa("004"+s)}},mounted(){if(this.loadBot(),this.page){let s=this.page;this.photos=[],this.pageForm={id:s.id,slug_id:s.slug?s.slug.id:null,content:s.content,command:s.slug?s.slug.command:null,slug:s.slug?s.slug.slug:null,comment:s.slug?s.slug.comment:null,images:s.images||[],reply_keyboard_title:s.reply_keyboard_title||null,reply_keyboard_id:s.reply_keyboard_id||null,inline_keyboard_id:s.inline_keyboard_id||null,reply_keyboard:s.replyKeyboard||null,inline_keyboard:s.inlineKeyboard||null,next_page_id:s.next_page_id||null,next_bot_dialog_command_id:s.next_bot_dialog_command_id||null,next_bot_menu_slug_id:s.next_bot_menu_slug_id||null,is_external:s.is_external||!1,videos:s.videos||[],audios:s.audios||[],sticker:s.sticker||null,documents:s.documents||[],rules_if:s.rules_if||null,rules_else_page_id:s.rules_else_page_id||null,rules_if_message:s.rules_if_message||null,rules_else_message:s.rules_else_message||null}}else this.clearForm()},methods:{copyToClipBoard(s){navigator.clipboard.writeText(s).then(()=>{this.$notify({title:"Конструктор страниц",text:"Ссылка скопирована в буфер",type:"success"})}).catch(e=>{this.$notify({title:"Конструктор страниц",text:"Ошибка копирования",type:"error"})})},loadBot(){this.$store.dispatch("loadBotAdminConfig").then(s=>{this.bot=s.data})},associateDialog(s){this.pageForm.next_bot_dialog_command_id=s.id},associateSlug(s){this.pageForm.next_bot_menu_slug_id=s.id},attachPage(s){s.id!=this.pageForm.id?this.pageForm.next_page_id=s.id:this.$notify({title:"Конструктор страниц",text:"Вы не можете связать данную страницу с собой",type:"error"})},injectContent(s){this.pageForm.content?this.pageForm.content+=s.text:this.pageForm.content=s.text},clearForm(){this.photos=[],this.pageForm={id:null,content:null,command:null,slug:null,comment:null,sticker:null,images:[],reply_keyboard_title:null,reply_keyboard:null,inline_keyboard:null,is_external:!1,reply_keyboard_id:null,inline_keyboard_id:null,next_page_id:null,videos:[],audios:[],documents:[],next_bot_dialog_command_id:null,next_bot_menu_slug_id:null,rules_if_message:null,rules_else_message:null},this.photos=[],this.showReplyTemplateSelector=!1,this.showInlineTemplateSelector=!1,this.need_page_sticker=!1,this.need_page_video=!1,this.need_page_images=!1,this.need_inline_menu=!1,this.need_reply_menu=!1,this.need_attach_page=!1,this.need_attach_dialog=!1,this.need_attach_slug=!1,this.need_rules=!1,this.need_page_audios=!1,this.need_page_documents=!1,this.$nextTick(()=>{this.need_clean=!1})},submitPage(){let s=new FormData;if(Object.keys(this.pageForm).forEach(e=>{const l=this.pageForm[e]||"";typeof l=="object"?s.append(e,JSON.stringify(l)):s.append(e,l)}),this.photos.length>0)for(let e=0;e<this.photos.length;e++)s.append("photos[]",this.photos[e]);this.$store.dispatch(this.pageForm.id==null?"createPage":"updatePage",{pageForm:s}).then(e=>{this.load=!0,this.$nextTick(()=>{this.load=!1,this.clearForm()}),this.$emit("callback",e.data),this.$notify({title:"Конструктор страниц",text:this.pageForm.id==null?"Страница успешно создана!":"Страница успешно обновлена!",type:"success"})}).catch(e=>{})},saveInlineKeyboard(s){this.pageForm.inline_keyboard=s},selectReplyKeyboard(s){this.pageForm.reply_keyboard=s,this.showReplyTemplateSelector=!1},selectInlineKeyboard(s){this.pageForm.inline_keyboard=s,this.showInlineTemplateSelector=!1},saveReplyKeyboard(s){this.pageForm.reply_keyboard=s},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s){this.photos.splice(s,1)},removeImage(s){this.pageForm.images.splice(s,1)},onChangePhotos(s){const e=s.target.files;for(let l=0;l<e.length;l++)this.photos.push(e[l])},onChange(s){this.pageForm.content=s},selectVideo(s){this.pageForm.videos||(this.pageForm.videos=[]);let e=this.pageForm.videos.indexOf(s.file_id);e!==-1?this.pageForm.videos.splice(e,1):this.pageForm.videos.push(s.file_id)},selectAudio(s){this.pageForm.audios||(this.pageForm.audios=[]);let e=this.pageForm.audios.indexOf(s.file_id);if(s.type==="voice"){if(e!==-1){this.pageForm.audios.splice(e,1);return}this.pageForm.audios=[s.file_id];return}e!==-1?this.pageForm.audios.splice(e,1):this.pageForm.audios.push(s.file_id)},selectSticker(s){this.pageForm.sticker=s.file_id},selectDocument(s){this.pageForm.documents||(this.pageForm.documents=[]);let e=this.pageForm.documents.indexOf(s.file_id);e!==-1?this.pageForm.documents.splice(e,1):this.pageForm.documents.push(s.file_id)}}},_l=Object.assign(ll,{__name:"Page",setup(s){return(e,l)=>{const a=S("lazy");return e.bot?(o(),n("form",{key:0,onSubmit:l[27]||(l[27]=$((...i)=>e.submitPage&&e.submitPage(...i),["prevent"]))},[s.onlyEdit?r("",!0):(o(),n(c,{key:0},[e.pageForm.id||e.need_clean?(o(),n("a",{key:0,href:"javascript:void(0)",class:"w-100 btn text-center btn mb-2",onClick:l[0]||(l[0]=(...i)=>e.clearForm&&e.clearForm(...i))},[Ts,m(" Очистить форму")])):r("",!0)],64)),e.pageForm.id?(o(),n("div",js,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[1]||(l[1]=i=>e.need_show_qr_and_link=i),type:"checkbox",role:"switch",id:"flexSwitchCheckDefault"},null,512),[[u,e.need_show_qr_and_link]]),Us])):r("",!0),e.pageForm.id&&e.need_show_qr_and_link?(o(),n("div",Ks,[t("p",null,[m("Ссылка на текущую страницу: "),t("span",{class:"font-weight-bold",onClick:l[2]||(l[2]=i=>e.copyToClipBoard(e.pageLink))},h(e.pageLink),1)]),t("div",Bs,[d(t("img",Ps,null,512),[[a,e.qr]])])])):r("",!0),Is,t("div",Ms,[d(t("input",{type:"text",class:"form-control",placeholder:"Команда","aria-label":"Команда","onUpdate:modelValue":l[3]||(l[3]=i=>e.pageForm.command=i),maxlength:"255","aria-describedby":"bot-domain",required:""},null,512),[[_,e.pageForm.command]]),Ds]),t("div",Os,[d(t("textarea",{type:"text",class:"form-control",placeholder:"Описание страницы","aria-label":"Описание страницы","onUpdate:modelValue":l[4]||(l[4]=i=>e.pageForm.comment=i),maxlength:"255",style:{"min-height":"150px"},"aria-describedby":"bot-domain",required:""},`
            `,512),[[_,e.pageForm.comment]]),qs]),t("div",Es,[t("div",Ls,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[5]||(l[5]=i=>e.pageForm.is_external=i),type:"checkbox",id:"is_external"},null,512),[[u,e.pageForm.is_external]]),Ns])]),e.pageForm.is_external?r("",!0):(o(),n(c,{key:3},[t("div",zs,[d(t("textarea",{class:"form-control","onUpdate:modelValue":l[6]||(l[6]=i=>e.pageForm.content=i),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"}},null,512),[[_,e.pageForm.content]]),t("label",As,[m("Содержимое страницы "),e.pageForm.content?(o(),n("span",Js,h(e.pageForm.content.length)+"/4096 ",1)):r("",!0)])]),t("div",xs,[t("div",Gs,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[7]||(l[7]=i=>e.need_page_images=i),type:"checkbox",id:"need-page-images"},null,512),[[u,e.need_page_images]]),Hs])]),e.need_page_images?(o(),n("div",Qs,[Ws,t("div",Xs,[t("label",Ys,[m(" + "),t("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:l[8]||(l[8]=(...i)=>e.onChangePhotos&&e.onChangePhotos(...i)),style:{display:"none"}},null,32)]),e.photos.length>0?(o(!0),n(c,{key:0},f(e.photos,(i,g)=>(o(),n("div",Zs,[d(t("img",null,null,512),[[a,e.getPhoto(i).imageUrl]]),t("div",et,[t("a",{href:"javascript:void(0)",onClick:V=>e.removePhoto(g)},"Удалить",8,st)])]))),256)):r("",!0)]),e.pageForm.images.length>0?(o(),n("h6",tt,"Ранее загруженные фотографии")):r("",!0),e.pageForm.images.length>0?(o(),n("div",lt,[(o(!0),n(c,null,f(e.pageForm.images,(i,g)=>(o(),n("div",ot,[d(t("img",null,null,512),[[a,"/images-by-bot-id/"+e.bot.id+"/"+i]]),t("div",nt,[t("a",{href:"javascript:void(0)",onClick:V=>e.removeImage(g)},"Удалить",8,it)])]))),256))])):r("",!0)])):r("",!0),t("div",at,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[9]||(l[9]=i=>e.need_page_video=i),type:"checkbox",id:"need-page-video"},null,512),[[u,e.need_page_video]]),rt]),e.need_page_video?(o(),n("div",dt,[ut,p(y,{"need-video":!0,"need-video-note":!0,selected:e.pageForm.videos,onSelect:e.selectVideo},null,8,["selected","onSelect"])])):r("",!0),t("div",mt,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[10]||(l[10]=i=>e.need_page_sticker=i),type:"checkbox",id:"need-page-sticker"},null,512),[[u,e.need_page_sticker]]),ct]),e.need_page_sticker?(o(),n("div",_t,[p(y,{"need-sticker":!0,selected:[e.pageForm.sticker],onSelect:e.selectSticker},null,8,["selected","onSelect"])])):r("",!0),t("div",ht,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[11]||(l[11]=i=>e.need_reply_menu=i),type:"checkbox",id:"need-reply-menu"},null,512),[[u,e.need_reply_menu]]),pt]),t("div",bt,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[12]||(l[12]=i=>e.need_page_audios=i),type:"checkbox",id:"need-page-audio"},null,512),[[u,e.need_page_audios]]),gt]),e.need_page_audios?(o(),n("div",ft,[yt,p(y,{"need-audio":!0,selected:e.pageForm.audios,onSelect:e.selectAudio},null,8,["selected","onSelect"])])):r("",!0),t("div",kt,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[13]||(l[13]=i=>e.need_page_documents=i),type:"checkbox",id:"need-page-document"},null,512),[[u,e.need_page_documents]]),vt]),e.need_page_documents?(o(),n("div",Ft,[$t,p(y,{"need-document":!0,selected:e.pageForm.documents,onSelect:e.selectDocument},null,8,["selected","onSelect"])])):r("",!0),e.need_reply_menu?(o(),n("div",wt,[Vt,t("div",Ct,[d(t("input",{type:"text",class:"form-control",placeholder:"Заголовок нижнего меню","aria-label":"Заголовок нижнего меню","onUpdate:modelValue":l[14]||(l[14]=i=>e.pageForm.reply_keyboard_title=i),maxlength:"255","aria-describedby":"bot-reply_keyboard_title"},null,512),[[_,e.pageForm.reply_keyboard_title]]),St]),t("button",{class:k(["btn mb-2 w-100",{"btn-outline-primary":!e.showReplyTemplateSelector,"btn-primary":e.showReplyTemplateSelector}]),type:"button",onClick:l[15]||(l[15]=i=>e.showReplyTemplateSelector=!e.showReplyTemplateSelector)},[e.showReplyTemplateSelector?(o(),n("span",Tt," Скрыть шаблоны меню")):(o(),n("span",Rt," Открыть шаблоны меню"))],2),e.showReplyTemplateSelector?(o(),b(F,{key:0,class:"mb-2",type:"reply",onSelect:e.selectReplyKeyboard,"select-mode":!0},null,8,["onSelect"])):(o(),b(v,{key:1,type:"reply",onSave:e.saveReplyKeyboard,modelValue:e.pageForm.reply_keyboard,"onUpdate:modelValue":l[16]||(l[16]=i=>e.pageForm.reply_keyboard=i)},null,8,["onSave","modelValue"]))])):r("",!0),t("div",jt,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[17]||(l[17]=i=>e.need_inline_menu=i),type:"checkbox",id:"need-inline-menu"},null,512),[[u,e.need_inline_menu]]),Ut]),e.need_inline_menu?(o(),n("div",Kt,[Bt,t("button",{class:k(["btn mb-2 w-100",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:l[18]||(l[18]=i=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(o(),n("span",It," Скрыть шаблоны меню")):(o(),n("span",Pt," Открыть шаблоны меню"))],2),e.showInlineTemplateSelector?(o(),b(F,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(o(),b(v,{key:1,type:"inline",onSave:e.saveInlineKeyboard,modelValue:e.pageForm.inline_keyboard,"onUpdate:modelValue":l[19]||(l[19]=i=>e.pageForm.inline_keyboard=i)},null,8,["onSave","modelValue"]))])):r("",!0),t("div",Mt,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[20]||(l[20]=i=>e.need_attach_page=i),type:"checkbox",id:"need-page-attach"},null,512),[[u,e.need_attach_page]]),Dt]),e.need_attach_page?(o(),n("div",Ot,[e.pageForm.next_page_id?(o(),n("p",qt,[m("Связано со страницей #"+h(e.pageForm.next_page_id)+" ",1),t("a",{href:"javascript:void(0)",class:"btn font-16 text-danger font-weight-bold",onClick:l[21]||(l[21]=i=>e.pageForm.next_page_id=null)},Lt)])):r("",!0),p(w,{current:e.pageForm.id,onCallback:e.attachPage,editor:!1},null,8,["current","onCallback"])])):r("",!0),t("div",Nt,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[22]||(l[22]=i=>e.need_attach_slug=i),type:"checkbox",id:"need-slug-attach"},null,512),[[u,e.need_attach_slug]]),zt]),e.need_attach_slug?(o(),n("div",At,[e.pageForm.next_bot_menu_slug_id?(o(),n("p",Jt,[m("Связано со скриптом #"+h(e.pageForm.next_bot_menu_slug_id)+" ",1),t("a",{href:"javascript:void(0)",class:"btn font-16 text-danger font-weight-bold",onClick:l[23]||(l[23]=i=>e.pageForm.next_bot_menu_slug_id=null)},Gt)])):r("",!0),p(U,{global:!0,selected:e.pageForm.next_bot_menu_slug_id,onCallback:e.associateSlug},null,8,["selected","onCallback"])])):r("",!0),t("div",Ht,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[24]||(l[24]=i=>e.need_attach_dialog=i),type:"checkbox",id:"need-dialog-attach"},null,512),[[u,e.need_attach_dialog]]),Qt]),e.need_attach_dialog?(o(),n("div",Wt,[e.pageForm.next_bot_dialog_command_id?(o(),n("p",Xt,[m(" Связано с диалогом #"+h(e.pageForm.next_bot_dialog_command_id)+" ",1),t("a",{href:"javascript:void(0)",class:"btn font-16 text-danger font-weight-bold",onClick:l[25]||(l[25]=i=>e.pageForm.next_bot_dialog_command_id=null)},Zt)])):r("",!0),p(K,{onSelectDialog:e.associateDialog},null,8,["onSelectDialog"])])):r("",!0),t("div",el,[d(t("input",{class:"form-check-input","onUpdate:modelValue":l[26]||(l[26]=i=>e.need_rules=i),type:"checkbox",id:"need-rules"},null,512),[[u,e.need_rules]]),sl])],64)),e.need_rules?(o(),b(Rs,{key:4,bot:e.bot,"rules-form":e.pageForm},null,8,["bot","rules-form"])):r("",!0),tl],32)):r("",!0)}}});export{_l as _};
