/* empty css                                                   */import{j as F,O as $,o as n,k as l,n as o,L as m,p as g,M as a,N as d,Y as _,a3 as p,a9 as y,F as r,K as c,l as k,a0 as w,a1 as D,H as b}from"./index.es-c4852431.js";import{K as v}from"./KeyboardConstructor-8a23a78e.js";import"./vue3-json-editor.esm.prod-a2876a2f.js";/* empty css                                                            */import"./_plugin-vue_export-helper-c27b6911.js";import"./v4-4a60fe23.js";const V={key:0,class:"mb-2"},j={class:"badge bg-success text-white"},O=o("span",{class:"ml-1 mr-1"},[o("i",{class:"fa-solid fa-arrow-right"})],-1),U={key:0,class:"badge bg-primary text-white"},P={key:1},z={class:"form-floating mb-2"},M=["for"],B=["id"],N={class:"mb-2"},G={class:"form-check"},S=o("label",{class:"form-check-label font-12",for:"need-empty-dialog"}," Диалог без ожидания ответа ",-1),x={key:1,class:"form-floating mb-2"},I=["for"],K=["id"],L={key:2,class:"form-floating mb-2"},T=["for"],q=["id"],Y={key:3,class:"mb-2"},E={class:"mb-2"},R=["for"],A=["value"],H=["for"],J=["id"],Q={key:4,class:"mb-2"},W=["for"],X=["id"],Z=o("option",{value:null,selected:""},"Не указан",-1),ee=["value"],oe={class:"mb-2"},te={class:"d-flex justify-content-between"},se=["for"],ie=o("i",{class:"fa-brands fa-telegram ml-2 color-blue2-dark"},null,-1),ne=[ie],le=["id"],ae={class:"mb-2"},de={class:"form-check"},re=o("label",{class:"form-check-label font-12",for:"need-dialog-image"}," В диалоге нужно изображение ",-1),me={class:"form-check"},ce=o("label",{class:"form-check-label font-12",for:"need-dialog-menu-inline"}," В диалоге нужно меню к тексту ",-1),ue={class:"form-check"},he=o("label",{class:"form-check-label font-12",for:"need-dialog-menu-reply"}," В диалоге нужно нижнее меню ",-1),_e={key:5,class:"mb-2"},pe=o("h6",null,"Фотографии к диалогу",-1),ge={class:"photo-preview d-flex justify-content-center flex-wrap w-100"},be={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},fe=o("span",null,"+",-1),ye={class:"mb-2 img-preview",style:{"margin-right":"10px"}},ke={class:"remove"},ve=["onClick"],Fe={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ce={class:"remove"},$e=["onClick"],we={key:6,class:"mb-2"},De=o("h6",null,"Кнопки к вопросу",-1),Ve={key:7,class:"mb-2"},je=o("h6",null,"Кнопки нижнего меню к вопросу",-1),Oe={class:"mb-2"},Ue=o("label",{class:"form-check-label font-12",for:"need-empty-dialog"}," Сохранить в переменную ",-1),Pe=o("option",{selected:""},"Не выбрано",-1),ze=["value"],Me={class:"form-check mb-2"},Be=o("label",{class:"form-check-label font-12",for:"need-set-flags"}," Установить флаги в соответствующее значение ",-1),Ne={key:8,class:"mb-2"},Ge=o("h6",{class:"my-3"},"Выберите необходимые флаги",-1),Se=["onClick"],xe={class:"mb-2"},Ie={type:"submit",class:"btn btn-m btn-full mb-2 rounded-xs text-uppercase font-900 shadow-s bg-green2-dark w-100"},Ke={key:0},Le={key:1},Te={key:9,class:"divider divider-small my-3 bg-highlight"},qe=o("i",{class:"fa-solid fa-trash-can mr-1"},null,-1),Ye={props:["item","bot"],data(){return{need_images:!1,need_inline_keyboard:!1,need_reply_keyboard:!1,need_set_flags:!1,commands:[],flags_variants:[{title:"Является VIP",key:"is_vip",value:null},{title:"Является Админом",key:"is_admin",value:null},{title:"За работой",key:"is_work",value:null},{title:"Является менеджером",key:"is_manager",value:null}],store_variants:[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Возраст",key:"age"},{title:"Город",key:"city"},{title:"Страна",key:"country"},{title:"Адрес",key:"address"},{title:"Телефон",key:"phone"},{title:"День рождение",key:"birthday"}],expressions:[{expression:null,description:"Нет проверки"},{expression:"/([a-z0-9]+)/i",description:"Проверка набора из латинских букв и цифр"},{expression:"/([а-яё0-9]+)/iu",description:"Проверка на кириллицу и цифры"},{expression:"/(?P<digit>\\d+)/",description:"Проверка на число"},{expression:"/^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$/",description:"Проверка Email"},{expression:"/^((8|+7)[- ]?)?((?d{3})?[- ]?)?[d- ]{7,10}$/",description:"Проверка номера телефона"},{expression:"/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)dd$/",description:"Проверка даты по формату"},{expression:"/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])$/",description:"Проверка даты по формату YYYY-MM-DD"},{expression:"/^(https?://)?([da-z.-]+).([a-z.]{2,6})([/w .-]*)*/?$/",description:"Проверка доменного имени"}],commandForm:{id:null,slug:null,pre_text:null,post_text:null,error_text:null,bot_id:null,input_pattern:null,inline_keyboard_id:null,reply_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,reply_keyboard:null,is_empty:!1,result_flags:[],store_to:null},photos:[]}},computed:{...F(["getDialogs"])},mounted(){window.addEventListener("select-telegram-channel-id",s=>{this.commandForm[s.detail.param]=s.detail.channel}),this.item&&this.$nextTick(()=>{this.commandForm={id:this.item.id||null,slug:this.item.slug||null,pre_text:this.item.pre_text||null,post_text:this.item.post_text||null,error_text:this.item.error_text||null,is_empty:this.item.is_empty||!1,input_pattern:this.item.input_pattern||null,inline_keyboard_id:this.item.inline_keyboard_id||null,reply_keyboard_id:this.item.reply_keyboard_id||null,images:this.item.images||[],next_bot_dialog_command_id:this.item.next_bot_dialog_command_id||null,bot_dialog_group_id:this.item.bot_dialog_group_id||null,result_channel:this.item.result_channel||null,inline_keyboard:this.item.inline_keyboard||null,reply_keyboard:this.item.reply_keyboard||null,result_flags:this.item.result_flags||[],store_to:this.item.store_to||null},this.bot&&(this.commandForm.bot_id=this.bot.id||null),this.commandForm.inline_keyboard_id!=null&&(this.need_inline_keyboard=!0),this.commandForm.reply_keyboard_id!=null&&(this.need_reply_keyboard=!0),this.commandForm.images.length>0&&(this.need_images=!0),this.commandForm.result_flags.length>0&&(this.need_set_flags=!0)}),this.bot&&this.$nextTick(()=>{this.commandForm.bot_id=this.bot.id}),this.loadGroups()},methods:{unlinkCommand(){this.loading=!0,this.$store.dispatch("unlinkDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$botNotification.success("Команды","Диалоговая команда успешно продублирована!"),this.$emit("callback")}).catch(s=>{this.loading=!1})},removeCommand(){this.loading=!0,this.$store.dispatch("removeDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$botNotification.success("Команды","Диалоговая команда успешно удалена!"),this.$emit("callback")}).catch(s=>{this.loading=!1})},loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogs",{dataObject:{simple:!0},page:s,size:100}).then(e=>{this.loading=!1,this.commands=this.getDialogs}).catch(()=>{this.loading=!1})},requestChannelId(s){this.$botPages.telegramChannelHelper(s)},submit(){this.loading=!0;let s=new FormData;if(Object.keys(this.commandForm).forEach(e=>{const i=this.commandForm[e]||"";typeof i=="object"?s.append(e,JSON.stringify(i)):s.append(e,i)}),this.photos){for(let e=0;e<this.photos.length;e++)s.append("files[]",this.photos[e]);s.delete("photos")}this.$store.dispatch(this.commandForm.id?"updateDialogCommand":"createDialogCommand",{dialogCommandForm:s}).then(e=>{this.loading=!1,this.$botNotification.success("Команды","Успешная обработка диалоговой команды!"),this.commandForm.id==null&&(this.commandForm={id:null,slug:null,pre_text:null,post_text:null,error_text:null,input_pattern:null,inline_keyboard_id:null,is_empty:!1,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,result_flags:[],store_to:null},this.photos=[]),this.$emit("callback")}).catch(e=>{this.loading=!1})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s,e){this[s].splice(e,1)},onChangePhotos(s){const e=s.target.files;for(let i=0;i<e.length;i++)this.photos.push(e[i])},saveInlineKeyboard(s){this.commandForm.inline_keyboard=s},saveReplyKeyboard(s){this.commandForm.reply_keyboard=s},addTextTo(s={param:null,text:null}){this.commandForm[s.param]=s.text},selectFlag(s){this.commandForm.result_flags||(this.commandForm.result_flags=[]);let e=this.commandForm.result_flags.indexOf(s.key);e===-1?this.commandForm.result_flags.push(s.key):this.commandForm.result_flags.splice(e,1)}}},C=Object.assign(Ye,{__name:"BotDialogCommandForm",setup(s){return(e,i)=>{const u=$("lazy");return n(),l("form",{onSubmit:i[16]||(i[16]=D((...t)=>e.submit&&e.submit(...t),["prevent"]))},[e.commandForm.id?(n(),l("p",V,[o("span",j,"#"+m(e.commandForm.id),1),O,e.commandForm.next_bot_dialog_command_id?(n(),l("span",U,[g("#"+m(e.commandForm.next_bot_dialog_command_id||"-")+" ",1),o("i",{class:"ml-2 fa-solid fa-link-slash",onClick:i[0]||(i[0]=(...t)=>e.unlinkCommand&&e.unlinkCommand(...t))})])):(n(),l("span",P,"не связан"))])):a("",!0),o("div",z,[o("label",{for:"commandForm-pre-text-"+e.commandForm.id,class:"font-12"},"Текст диалога",8,M),d(o("textarea",{style:{"min-height":"200px"},class:"form-control font-12",id:"commandForm-pre-text-"+e.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":i[1]||(i[1]=t=>e.commandForm.pre_text=t),required:""},`

            `,8,B),[[_,e.commandForm.pre_text]])]),o("div",N,[o("div",G,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[2]||(i[2]=t=>e.commandForm.is_empty=t),id:"need-empty-dialog",checked:""},null,512),[[p,e.commandForm.is_empty]]),S])]),e.commandForm.is_empty?a("",!0):(n(),l("div",x,[o("label",{for:"commandForm-post-text-"+e.commandForm.id,class:"font-12"},"Текст после успешного завершения диалога",8,I),d(o("textarea",{style:{"min-height":"200px"},class:"form-control font-12",id:"commandForm-post-text-"+e.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":i[3]||(i[3]=t=>e.commandForm.post_text=t),required:""},`
            `,8,K),[[_,e.commandForm.post_text]])])),e.commandForm.is_empty?a("",!0):(n(),l("div",L,[o("label",{for:"commandForm-error-text-"+e.commandForm.id,class:"font-12"},"Текст на случай ошибки корректности данных",8,T),d(o("textarea",{style:{"min-height":"200px"},class:"form-control font-12",id:"commandForm-error-text-"+e.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":i[4]||(i[4]=t=>e.commandForm.error_text=t),required:""},`
            `,8,q),[[_,e.commandForm.error_text]])])),e.commandForm.is_empty?a("",!0):(n(),l("div",Y,[o("div",E,[o("label",{class:"form-label font-12",for:"commandForm-result-channel-"+e.commandForm.id},"Регулярное выражение для автоматической проверки данных ",8,R),d(o("select",{id:"next-dialog-select",class:"form-select form-control font-12","onUpdate:modelValue":i[5]||(i[5]=t=>e.commandForm.input_pattern=t)},[(n(!0),l(r,null,c(e.expressions,t=>(n(),l("option",{value:t.expression},m(t.description||"-"),9,A))),256))],512),[[y,e.commandForm.input_pattern]])]),o("label",{for:"custom-regular-expression"+e.commandForm.id,class:"font-12"},"или впишите своё",8,H),d(o("input",{id:"custom-regular-expression"+e.commandForm.id,type:"text",class:"form-control",placeholder:"Регулярное выражение","aria-label":"Регулярное выражение","onUpdate:modelValue":i[6]||(i[6]=t=>e.commandForm.input_pattern=t),maxlength:"255","aria-describedby":"commandForm-input-pattern"},null,8,J),[[_,e.commandForm.input_pattern]])])),e.commandForm.is_empty?a("",!0):(n(),l("div",Q,[o("label",{for:"next-dialog-select"+e.commandForm.id,class:"font-12"},"Следующий диалог",8,W),o("select",{id:"next-dialog-select"+e.commandForm.id,class:"form-select form-control font-12","aria-label":"Default select example"},[Z,(n(!0),l(r,null,c(e.commands,(t,h)=>(n(),l("option",{value:t.id},"#"+m(t.id)+" "+m(t.pre_text||"Без текста"),9,ee))),256))],8,X)])),o("div",oe,[o("div",te,[o("label",{class:"form-label",for:"commandForm-result-channel-"+e.commandForm.id},"Канал для отправки данных ",8,se),o("span",{onClick:i[7]||(i[7]=t=>e.requestChannelId("result_channel"))},ne)]),d(o("input",{type:"number",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":i[8]||(i[8]=t=>e.commandForm.result_channel=t),id:"commandForm-result-channel-"+e.commandForm.id,"aria-describedby":"bot-order-channel"},null,8,le),[[_,e.commandForm.result_channel]])]),o("div",ae,[o("div",de,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[9]||(i[9]=t=>e.need_images=t),id:"need-dialog-image",checked:""},null,512),[[p,e.need_images]]),re]),o("div",me,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[10]||(i[10]=t=>e.need_inline_keyboard=t),id:"need-dialog-menu-inline",checked:""},null,512),[[p,e.need_inline_keyboard]]),ce]),o("div",ue,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[11]||(i[11]=t=>e.need_reply_keyboard=t),id:"need-dialog-menu-reply",checked:""},null,512),[[p,e.need_reply_keyboard]]),he])]),e.need_images?(n(),l("div",_e,[pe,o("div",ge,[o("label",be,[fe,o("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:i[12]||(i[12]=(...t)=>e.onChangePhotos&&e.onChangePhotos(...t)),style:{display:"none"}},null,32)]),e.photos.length>0?(n(!0),l(r,{key:0},c(e.photos,(t,h)=>(n(),l("div",ye,[d(o("img",null,null,512),[[u,e.getPhoto(t).imageUrl]]),o("div",ke,[o("a",{onClick:f=>e.removePhoto("photos",h)},"Удалить",8,ve)])]))),256)):a("",!0),e.commandForm.images&&s.bot?(n(!0),l(r,{key:1},c(e.commandForm.images,(t,h)=>(n(),l("div",Fe,[d(o("img",null,null,512),[[u,"/images-by-bot-id/"+s.bot.id+"/"+t]]),o("div",Ce,[o("a",{onClick:f=>e.removePhoto("images",h)},"Удалить",8,$e)])]))),256)):a("",!0)])])):a("",!0),e.need_inline_keyboard?(n(),l("div",we,[De,k(v,{onSave:e.saveInlineKeyboard,"edited-keyboard":e.commandForm.inline_keyboard},null,8,["onSave","edited-keyboard"])])):a("",!0),e.need_reply_keyboard?(n(),l("div",Ve,[je,k(v,{onSave:e.saveReplyKeyboard,"edited-keyboard":e.commandForm.reply_keyboard},null,8,["onSave","edited-keyboard"])])):a("",!0),o("div",Oe,[Ue,d(o("select",{class:"form-control font-12","onUpdate:modelValue":i[13]||(i[13]=t=>e.commandForm.store_to=t)},[Pe,(n(!0),l(r,null,c(e.store_variants,t=>(n(),l("option",{value:t.key},m(t.title||"Не указано"),9,ze))),256))],512),[[y,e.commandForm.store_to]])]),o("div",Me,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i[14]||(i[14]=t=>e.need_set_flags=t),id:"need-set-flags",checked:""},null,512),[[p,e.need_set_flags]]),Be]),e.need_set_flags?(n(),l("div",Ne,[Ge,(n(!0),l(r,null,c(e.flags_variants,t=>(n(),l("span",{class:w(["badge mr-2",{"bg-info text-white":e.commandForm.result_flags.indexOf(t.key)!=-1}]),onClick:h=>e.selectFlag(t)},m(t.title),11,Se))),256))])):a("",!0),o("div",xe,[o("button",Ie,[e.commandForm.id?(n(),l("span",Ke,"Обновить диалог")):(n(),l("span",Le,"Добавить диалог"))])]),e.commandForm.id?(n(),l("div",Te)):a("",!0),e.commandForm.id?(n(),l("a",{key:10,onClick:i[15]||(i[15]=(...t)=>e.removeCommand&&e.removeCommand(...t)),title:"Удаление команды",class:"btn btn-m btn-full mb-2 rounded-xs text-uppercase font-900 shadow-s bg-red2-dark"},[qe,g(" Удалить диалог ")])):a("",!0)],32)}}});const Ee={class:"btn w-100 text-left border-blue2-light",type:"button"},Re={key:0,class:"fa-solid fa-chevron-up"},Ae={key:1,class:"fa-solid fa-chevron-down"},He={props:["item","bot"],data(){return{showMenu:!1}},methods:{selectDialog(){this.$emit("select",this.item)}}},Je=Object.assign(He,{__name:"DialogCommandCard",setup(s){return(e,i)=>(n(),l("div",Ee,[o("p",{onClick:i[0]||(i[0]=u=>e.showMenu=!e.showMenu),class:"w-100 mb-0"},[e.showMenu?(n(),l("i",Re)):(n(),l("i",Ae)),g(" "+m(s.item.pre_text||"Нет команды"),1)]),e.showMenu?(n(),b(C,{key:0,bot:s.bot,item:s.item},null,8,["bot","item"])):a("",!0)]))}}),Qe={key:0},We=o("i",{class:"fa-regular fa-comment-dots mr-2"},null,-1),Xe={key:1},Ze=o("i",{class:"fa-solid fa-chevron-up mr-2"},null,-1),eo=o("div",{class:"divider divider-small my-3 bg-highlight"},null,-1),oo={key:1},to={class:"mb-2"},so={key:0},io={class:"mb-2"},no={key:1},lo={key:2,class:"row"},ao=o("div",{class:"col-12"},[o("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),ro=[ao],mo={props:["bot"],data(){return{needCreate:!1,loading:!0,dialog_groups:[],search:null,link:null,group:null}},computed:{...F(["getDialogs","getDialogsPaginateObject"]),filteredCommands(){return this.link?this.dialog_groups.find(e=>e.id===this.link.group_id).bot_dialog_commands.filter(e=>e.id!=this.link.id):[]}},mounted(){this.loadGroups()},methods:{loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogs",{dataObject:{search:this.search},page:s}).then(e=>{this.loading=!1,this.dialog_groups=this.getDialogs,this.dialog_groups_paginate_object=this.getDialogsPaginateObject}).catch(()=>{this.loading=!1})}}},co=Object.assign(mo,{__name:"BotDialogGroupList",setup(s){return(e,i)=>(n(),l(r,null,[o("button",{type:"button",onClick:i[0]||(i[0]=u=>e.needCreate=!e.needCreate),class:"btn btn-m btn-full mb-2 rounded-xs text-uppercase font-900 shadow-s bg-green2-dark w-100"},[e.needCreate?(n(),l("span",Xe,[Ze,g("Скрыть создание диалога ")])):(n(),l("span",Qe,[We,g("Создать новый диалог ")]))]),s.bot&&e.needCreate?(n(),b(C,{key:0,onCallback:e.loadGroups,bot:s.bot},null,8,["onCallback","bot"])):a("",!0),eo,e.dialog_groups.length>0?(n(),l("div",oo,[(n(!0),l(r,null,c(e.dialog_groups,(u,t)=>(n(),l("div",to,[u.bot_dialog_commands.length>0?(n(),l("div",so,[(n(!0),l(r,null,c(u.bot_dialog_commands,(h,f)=>(n(),l("div",io,[s.bot?(n(),b(Je,{key:0,bot:s.bot,onCallback:e.loadGroups,item:h},null,8,["bot","onCallback","item"])):a("",!0)]))),256))])):(n(),l("p",no,"Диалоговых скриптов не найдено"))]))),256))])):(n(),l("div",lo,ro))],64))}}),uo={class:"card card-style"},ho={class:"card-body"},_o={data(){return{load:!1,bot:null}},mounted(){this.loadBotAdminConfig()},methods:{loadBotAdminConfig(){this.$store.dispatch("loadBotAdminConfig").then(s=>{this.bot=s.data})}}},Fo=Object.assign(_o,{__name:"Dialogs",setup(s){return(e,i)=>(n(),l("div",uo,[o("div",ho,[e.load?a("",!0):(n(),b(co,{key:0,bot:e.bot},null,8,["bot"]))])]))}});export{Fo as default};
