import{V as v}from"./vue3-json-editor.esm.prod-a76b57fc.js";import{o as d,j as m,l as e,M as r,W as c,G as y,L as h,F as _,J as b,a8 as g,K as p,n as f,a0 as A,s as k}from"./index.es-db843bab.js";import{_ as V}from"./_plugin-vue_export-helper-c27b6911.js";const x={props:["data","bot"],components:{Vue3JsonEditor:v},data(){return{load:!1,custom_fields:null,fields:[{title:"Телефонный номер",field:"phone"},{title:"Ф.И.О.",field:"fio_from_telegram"},{title:"Почта",field:"email"},{title:"Дата рождения",field:"birthday"},{title:"Возраст",field:"age"},{title:"Страна",field:"country"},{title:"Адрес",field:"address"},{title:"Пол",field:"sex"},{title:"Идентификатор чата",field:"fio_from_telegram"}],hasConnect:!1,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null,fields:null}}},mounted(){this.data&&this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null,this.amoForm.fields=this.data.fields||null})},methods:{loadAmoFields(){this.load=!0,this.custom_fields=null,this.$store.dispatch("loadAmoFields").then(l=>{this.custom_fields=l._embedded.custom_fields.contacts||null,this.$nextTick(()=>{this.load=!1}),this.$notify({title:"Работа с AMO",text:"Справочная информация успешно загружена",type:"success"})}).catch(l=>{this.$notify({title:"Работа с AMO",text:"Ошибка работы со справочной информацией",type:"error"})})},removeField(l){this.amoForm.fields&&this.amoForm.fields.splice(l,1)},addField(){this.amoForm.fields||(this.amoForm.fields=[]),this.amoForm.fields.push({key:null,field:null,enum:null})},syncAmo(){this.$store.dispatch("syncAmo").then(l=>{this.$notify({title:"Работа с AMO",text:"Данные CRM успешно сохранены",type:"success"})}).catch(l=>{this.$notify({title:"Работа с AMO",text:"Ошибка работы",type:"error"})})},submitAmo(){let l=new FormData;Object.keys(this.amoForm).forEach(t=>{const u=this.amoForm[t]||"";typeof u=="object"?l.append(t,JSON.stringify(u)):l.append(t,u)}),this.$store.dispatch("saveAmoCRM",{amoForm:l}).then(t=>{this.$notify({title:"Работа с AMO",text:"Данные CRM успешно сохранены",type:"success"})}).catch(t=>{this.$notify({title:"Работа с AMO",text:"Ошибка работы",type:"error"})})}}},w=e("h3",null,"Настройка AMO",-1),M=e("p",{class:"mb-2 alert alert-light"},[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),f(" по шагам")],-1),C={class:"form-floating mb-2"},O=e("label",{id:"client_id"}," ID интеграции ",-1),U={class:"form-floating mb-2"},j=e("label",{id:"client_secret"}," Секретный ключ клиента ",-1),B={class:"form-floating mb-2"},q=e("label",{id:"auth_code"}," Полученный код авторизации ",-1),E={class:"form-floating mb-2"},J=e("label",{id:"subdomain2"}," Ваш поддомен в системе AMO CRM ",-1),S=["disabled"],D={class:"card mb-2"},N={class:"card-body"},R={class:"form-floating mb-2"},T=["onUpdate:modelValue"],L=["id"],G={class:"form-floating mb-2"},I=["onUpdate:modelValue"],K=["value"],W=["id"],z={class:"form-floating mb-2"},H=["onUpdate:modelValue"],P=["id"],Q=["onClick"],X=e("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),Y=e("nav",{class:"navbar navbar-expand-sm fixed-bottom p-3 bg-transparent border-0",style:{"border-radius":"10px 10px 0px 0px"}},[e("button",{type:"submit",class:"btn btn-primary w-100 p-3 rounded-3 shadow-lg d-flex justify-content-center align-items-center"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-2"}),f(" Сохранить настройку AMO ")])],-1),Z=e("hr",{class:"my-3 p-0"},null,-1),$=e("i",{class:"fa-solid fa-rotate mr-2"},null,-1);function ee(l,t,u,me,o,a){const F=k("Vue3JsonEditor");return d(),m(_,null,[w,e("form",{onSubmit:t[7]||(t[7]=A((...s)=>a.submitAmo&&a.submitAmo(...s),["prevent"]))},[M,e("div",C,[r(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=s=>o.amoForm.client_id=s),"aria-describedby":"client_id",required:""},null,512),[[c,o.amoForm.client_id]]),O]),e("div",U,[r(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=s=>o.amoForm.client_secret=s),"aria-describedby":"client_secret",required:""},null,512),[[c,o.amoForm.client_secret]]),j]),e("div",B,[r(e("textarea",{class:"form-control font-12",style:{"min-height":"250px"},placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=s=>o.amoForm.auth_code=s),"aria-describedby":"auth_code",required:""},`
                                    `,512),[[c,o.amoForm.auth_code]]),q]),e("div",E,[r(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=s=>o.amoForm.subdomain=s),"aria-describedby":"subdomain",required:""},null,512),[[c,o.amoForm.subdomain]]),J]),e("button",{type:"button",disabled:!o.amoForm.client_id||!o.amoForm.auth_code||!o.amoForm.client_secret||!o.amoForm.subdomain,onClick:t[4]||(t[4]=(...s)=>a.loadAmoFields&&a.loadAmoFields(...s)),class:"btn w-100 btn-outline-light text-primary p-3 mb-2"}," Загрузить справочную информацию ",8,S),!o.load&&o.custom_fields?(d(),y(F,{key:0,mode:"tree",modelValue:o.custom_fields,"onUpdate:modelValue":t[5]||(t[5]=s=>o.custom_fields=s),"show-btns":!1,expandedOnStart:!1},null,8,["modelValue"])):h("",!0),o.amoForm.fields?(d(!0),m(_,{key:1},b(o.amoForm.fields,(s,i)=>(d(),m("div",D,[e("div",N,[e("div",R,[r(e("input",{type:"number",class:"form-control",placeholder:"Ключ","aria-label":"Ключ","onUpdate:modelValue":n=>o.amoForm.fields[i].key=n,"aria-describedby":"Ключ",required:""},null,8,T),[[c,o.amoForm.fields[i].key]]),e("label",{id:"field-key-"+i}," Ключевое значение из справочника ",8,L)]),e("div",G,[r(e("select",{class:"form-control font-12","onUpdate:modelValue":n=>o.amoForm.fields[i].field=n},[(d(!0),m(_,null,b(o.fields,n=>(d(),m("option",{value:n.field},p(n.title||"Ошибка"),9,K))),256))],8,I),[[g,o.amoForm.fields[i].field]]),e("label",{id:"field-field-"+i}," Поле из списка для связи ",8,W)]),e("div",z,[r(e("input",{type:"text",class:"form-control",placeholder:"Перечисление","aria-label":"Перечисление","onUpdate:modelValue":n=>o.amoForm.fields[i].enum=n,"aria-describedby":"Перечисление"},null,8,H),[[c,o.amoForm.fields[i].enum]]),e("label",{class:"form-label d-flex justify-content-between mt-0 mb-0",id:"field-enum-"+i}," Перечисление (enum) из справочника ",8,P)]),e("button",{type:"button",onClick:n=>a.removeField(i),class:"btn btn-link p-3 w-100"},[X,f(" Удалить связь полей (#"+p(i+1)+") ",1)],8,Q)])]))),256)):h("",!0),e("button",{type:"button",onClick:t[6]||(t[6]=(...s)=>a.addField&&a.addField(...s)),class:"btn w-100 btn-outline-info p-3"}," Добавить связь полей "),Y],32),Z,e("a",{href:"javascript:void(0)",onClick:t[8]||(t[8]=(...s)=>a.syncAmo&&a.syncAmo(...s)),class:"btn btn-outline-primary w-100 p-3"},[$,f(" Синхронизировать ")])],64)}const te=V(x,[["render",ee]]),oe={class:"container my-3"},se={class:"row"},le={class:"col-12"},ie={key:1,class:"alert alert-light"},ae=e("p",{class:"text-center"},"Загружаем данные...",-1),ne=e("div",{class:"d-flex justify-content-center w-100"},[e("div",{class:"spinner-border color-orange-dark",role:"status"},[e("span",{class:"sr-only"},"Загрузка...")])],-1),de=[ae,ne],re={data(){return{load:!1,bot:null}},mounted(){this.loadBotAdminConfig()},methods:{loadBotAdminConfig(){this.$store.dispatch("loadBotAdminConfig").then(l=>{this.bot=l.data,this.amo=this.bot.amo||null})}}},_e=Object.assign(re,{__name:"Amo",setup(l){return(t,u)=>(d(),m("div",oe,[e("div",se,[e("div",le,[!t.load&&t.bot?(d(),y(te,{key:0,bot:t.bot,data:t.bot.amo},null,8,["bot","data"])):(d(),m("div",ie,de))])])]))}});export{_e as default};
