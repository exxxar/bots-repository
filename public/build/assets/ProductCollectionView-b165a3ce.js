import{_ as g}from"./ProductCard-cb69dc03.js";import{j as y,O as f,o,k as r,N as p,M as l,n as i,L as d,F as a,p as h,K as m,l as _,a0 as b}from"./index.es-c4852431.js";import{v as C}from"./v4-4a60fe23.js";const k={key:0,class:"card-img-top",alt:""},v={class:"card-title my-3 fw-bold"},P={class:"card-text"},w={class:"card-text fw-bold text-center p-3 border-primary border text-primary"},E={style:{"text-decoration":"line-through"}},I={key:2,class:"w-100 d-block text-center"},$=["id"],x={key:0,class:"alert alert-light mb-2"},T={class:"row row-cols-2 row-cols-sm-2 row-cols-md-3 g-2"},z={class:"col"},N={key:0,class:"col"},S=["onClick"],V={class:"img-container"},j={class:"rounded-3"},B=i("div",{class:"card-body px-0"},[i("p",{class:"text-center mb-2",style:{"font-size":"12px"}},"Данная категория не интересует"),i("div",{class:"d-flex justify-content-between align-items-center px-2"},[i("button",{type:"button",style:{"font-size":"12px"},class:"btn btn-md w-100 rounded-2 mb-2 btn-outline-light text-black"}," Выбрать ")])],-1),L={class:"navbar navbar-expand-sm fixed-bottom p-3 bg-transparent border-0",style:{"border-radius":"10px 10px 0px 0px"}},A={class:"d-flex w-100 flex-column"},D=["disabled"],F={style:{"text-decoration":"line-through"}},M={key:2,class:"badge bg-success ml-2"},O={props:["item"],data(){return{product:null,sending:!1,is_online:!0}},computed:{...y(["inCollectionCart","cartCollections"]),canProductAction(){return this.is_online&&!this.sending},uuid(){return C()},checkInCart(){return this.inCollectionCart(this.item.id,null)},bot(){return window.currentBot},discountPrice(){return Math.round(this.summaryPrice*(1-(this.product.discount===0?1:this.product.discount)/100))},summaryPrice(){let e=0;return this.product.products.forEach(t=>{t.is_checked&&(e+=t.current_price||0)}),e},preparedProducts(){let e=[],t=!1;return this.product.products.forEach(s=>{if((s.categories||[]).length>0){let c=e.findIndex(n=>n.title==s.categories[0].title);c===-1?e.push({id:s.categories[0].id,title:s.categories[0].title,products:[s]}):e[c].products.push(s),t=!0}}),t||(e.push({id:this.uuid,title:"Без категории",products:[]}),this.product.products.forEach(s=>{e[0].products.push(s)})),e.forEach(s=>{let c=0;s.products.forEach(n=>{let u=this.product.config?this.product.config:{choose_all_in_category:!1};n.is_checked=u.choose_all_in_category?!0:c===0,c++})}),e}},mounted(){this.$nextTick(()=>{this.product=this.item}),window.addEventListener("online",()=>{this.is_online=!0}),window.addEventListener("offline",()=>{this.is_online=!1})},methods:{incCollectionCart(){this.checkInCart===0?this.addCollectionToCart():this.$store.dispatch("incQuantity",this.product.id),this.$notify({title:"Добавление товара",text:"Товар успешно добавлен",type:"success"})},addCollectionToCart(){this.sending=!0,this.$store.dispatch("addCollectionToCart",this.product).then(()=>{this.sending=!1,this.$notify({title:"Добавление товара",text:"Товар успешно добавлен",type:"success"})}).catch(()=>{this.sending=!1,this.$notify({title:"Добавление товара",text:"Ошибка добавления товара",type:"error"})})},cancelCategory(e){let t=e.id;this.product.products.forEach(s=>{s.categories[0].id===t&&(s.is_checked=!1,this.$store.dispatch("removeProduct",s.id))}),this.$notify({title:"Подборки товара",text:"Вы успешно исключили категорию товара из подборки",type:"success"})},selectSubProduct(e){let t=this.product.products.findIndex(c=>c.id===e.id),s=e.categories[0].id;this.product.products.forEach(c=>{c.categories[0].id===s&&(c.is_checked=!1)}),this.product.products[t].is_checked=!0}}},H=Object.assign(O,{__name:"ProductCollectionView",setup(e){return(t,s)=>{const c=f("lazy");return t.product?(o(),r(a,{key:0},[e.item.image?p((o(),r("img",k,null,512)),[[c,"/images-by-company-id/"+t.bot.company.id+"/"+t.product.image]]):l("",!0),i("h5",v,d(t.product.title||"-"),1),i("p",P,d(t.product.description||"-"),1),i("p",w,[t.product.discount>0?(o(),r(a,{key:0},[h(d(t.discountPrice)+"₽ ",1),i("span",E,d(t.summaryPrice)+"₽",1)],64)):(o(),r(a,{key:1},[h(d(t.summaryPrice)+"₽ ",1)],64)),t.product.products.length>0?(o(),r("small",I,"За "+d(t.product.products.length)+" товаров",1)):l("",!0)]),t.preparedProducts.length>0?(o(!0),r(a,{key:1},m(t.preparedProducts,n=>(o(),r(a,null,[i("h5",{class:"my-4 divider",id:"collection-cat-"+n.id},d(n.title||"-"),9,$),n.products.length>1?(o(),r("p",x," В данной категории вы можете выбрать из доступных вариантов ")):l("",!0),i("div",T,[(o(!0),r(a,null,m(n.products,(u,G)=>(o(),r("div",z,[_(g,{"can-select":!(u.config||{choose_all_in_category:!1}).choose_all_in_category,"collection-selected":u.is_checked,"collection-mode":!0,item:u,onSelectInCollection:t.selectSubProduct},null,8,["can-select","collection-selected","item","onSelectInCollection"])]))),256)),(t.product.config||{can_skip_categories:!1}).can_skip_categories?(o(),r("div",N,[i("div",{onClick:u=>t.cancelCategory(n),class:"card border-0 product-card"},[i("div",V,[p(i("img",j,null,512),[[c,"/images/default-product-image.jpg"]])]),B],8,S)])):l("",!0)])],64))),256)):l("",!0),i("nav",L,[i("div",A,[i("button",{type:"button",disabled:t.summaryPrice===0||e.item.in_stop_list_at!=null||!t.canProductAction,class:b([{"btn-secondary":!t.canProductAction},"btn btn-sm btn-primary w-100 rounded-3 p-3"]),onClick:s[0]||(s[0]=(...n)=>t.addCollectionToCart&&t.addCollectionToCart(...n))},[h(" Добавить "),t.product.discount>0?(o(),r(a,{key:0},[h(d(t.discountPrice)+"₽ ",1),i("span",F,d(t.summaryPrice)+"₽",1)],64)):(o(),r(a,{key:1},[h(d(t.summaryPrice)+"₽ ",1)],64)),t.cartCollections.length>0?(o(),r("span",M,d(t.cartCollections.length),1)):l("",!0)],10,D)])])],64)):l("",!0)}}});export{H as _};
