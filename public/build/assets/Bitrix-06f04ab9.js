import{V as p}from"./vue3-json-editor.esm.prod-a2876a2f.js";import{o as r,k as l,n as i,N as m,Y as _,a3 as f,p as d,a0 as h,a1 as x,M as u,F as b,K as v,H as y,L as k}from"./index.es-c4852431.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";const B={props:["data","bot"],components:{Vue3JsonEditor:p},data(){return{load:!1,bitrixForm:{id:null,url:null,is_active:!1,bot_id:null,config:[]}}},mounted(){this.data&&this.$nextTick(()=>{this.bitrixForm.id=this.data.id||null,this.bitrixForm.url=this.data.url||null,this.bitrixForm.is_active=this.data.is_active||!1,this.bitrixForm.config=this.data.config||[],this.bitrixForm.bot_id=this.data.bot_id||this.bot.id||null})},methods:{checkConnection(){this.$notify({title:"Работа с Bitrix",text:"Отправили на этот url тестовый запрос!"});let e=new FormData;Object.keys(this.bitrixForm).forEach(t=>{const s=this.bitrixForm[t]||"";typeof s=="object"?e.append(t,JSON.stringify(s)):e.append(t,s)}),this.$store.dispatch("checkBitrixURL",{bitrixForm:e}).then(t=>{this.$notify({title:"Работа с Bitrix",text:"Данные CRM успешно сохранены",type:"success"})}).catch(t=>{this.$notify({title:"Работа с Bitrix",text:"Ошибка отправки",type:"error"})})},submit(){let e=new FormData;Object.keys(this.bitrixForm).forEach(t=>{const s=this.bitrixForm[t]||"";typeof s=="object"?e.append(t,JSON.stringify(s)):e.append(t,s)}),this.$store.dispatch("storeBitrix",{bitrixForm:e}).then(t=>{this.$notify({title:"Работа с Bitrix",text:"Данные CRM успешно сохранены",type:"success"}),this.$emit("callback")}).catch(t=>{})}}},g={class:"input-group mb-2"},w={class:"form-floating"},$=i("label",{for:"bitrixForm-url"},"URL для сбора данных",-1),C={class:"input-group-text",id:"basic-addon1"},j=["disabled"],M=i("i",{class:"fa-solid fa-link"},null,-1),V=[M],I={class:"form-check form-switch"},N={class:"form-check-label",for:"bitrixForm-is_active"},O=["disabled"];function R(e,t,s,a,o,c){return r(),l("form",{onSubmit:t[3]||(t[3]=x((...n)=>c.submit&&c.submit(...n),["prevent"]))},[i("div",g,[i("div",w,[m(i("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=n=>o.bitrixForm.url=n),class:"form-control",id:"bitrixForm-url",placeholder:"name@example.com"},null,512),[[_,o.bitrixForm.url]]),$]),i("span",C,[i("button",{type:"button",disabled:(o.bitrixForm.url||"").length===0,onClick:t[1]||(t[1]=(...n)=>c.checkConnection&&c.checkConnection(...n)),class:"btn text-primary p-1"},V,8,j)])]),i("div",I,[m(i("input",{class:"form-check-input","onUpdate:modelValue":t[2]||(t[2]=n=>o.bitrixForm.is_active=n),type:"checkbox",role:"switch",id:"bitrixForm-is_active"},null,512),[[f,o.bitrixForm.is_active]]),i("label",N,[d(" Сбор данных: "),i("span",{class:h({"fw-bold text-primary":o.bitrixForm.is_active})},"вкл",2),d(" / "),i("span",{class:h({"fw-bold text-primary":!o.bitrixForm.is_active})},"выкл",2)])]),i("button",{disabled:!o.bitrixForm.url,class:"w-100 btn btn-primary p-3 my-3"},"Сохранить ",8,O)],32)}const D=F(B,[["render",R]]),E={class:"container my-3"},L={class:"row"},S={class:"col-12"},T={class:"fw-bold d-flex justify-content-between align-items-center pb-2"},U=i("i",{class:"fa-solid fa-plus"},null,-1),J=[U],z={key:0,class:"list-group mb-2"},H=["onClick"],K=["onClick"],Y={key:1,class:"alert alert-light"},q=i("strong",{class:"fw-bold text-primary"},"Внимание!",-1),A={key:1,class:"alert-light alert"},G=i("p",null,"Загружаем данные...",-1),P=i("div",{class:"d-flex justify-content-center w-100"},[i("div",{class:"spinner-border color-orange-dark",role:"status"},[i("span",{class:"sr-only"},"Загрузка...")])],-1),Q=[G,P],W={class:"col-12"},X=i("h6",{class:"fw-bold d-flex justify-content-between align-items-center pb-2"},"Данные подключения",-1),Z={data(){return{bitrix:[],selected:null,load:!1}},computed:{currentBot(){return window.currentBot||null}},mounted(){this.loadBitrix()},methods:{loadBitrix(){this.load=!0,this.$store.dispatch("loadBitrix").then(e=>{this.bitrix=e.data||[],this.load=!1}).catch(()=>{this.load=!1})},removeItem(e){this.$store.dispatch("removeBitrixItem",{id:e.id}).then(t=>{this.loadBitrix(),this.$notify({title:"Битрикс24",text:"Подключение успешно удалено",type:"success"})}).catch(()=>{this.loadBitrix(),this.$notify({title:"Битрикс24",text:"Ошибка удаления подключения",type:"error"})})},selectItem(e){this.selected=e,this.load=!0,this.$nextTick(()=>{this.load=!1})}}},st=Object.assign(Z,{__name:"Bitrix",setup(e){return(t,s)=>(r(),l("div",E,[i("div",L,[i("div",S,[i("h6",T,[d("Доступные подключения "),t.selected!=null?(r(),l("a",{key:0,href:"javascript:void(0)",class:"text-decoration-none text-primary px-1",onClick:s[0]||(s[0]=a=>t.selectItem(null))},J)):u("",!0)]),t.load?(r(),l("div",A,Q)):(r(),l(b,{key:0},[(t.bitrix||[]).length>0?(r(),l("ul",z,[(r(!0),l(b,null,v(t.bitrix,a=>(r(),l("li",{class:h(["list-group-item",{"border-success":a.is_active,"border-error":!a.is_active,"bg-success text-white":(t.selected||{id:null}).id===a.id}]),style:{"word-wrap":"break-word"}},[i("p",{onClick:o=>t.selectItem(a)},k(a.url||"не указан"),9,H),i("a",{onClick:o=>t.removeItem(a),href:"javascript:void(0)"},"Удалить",8,K)],2))),256))])):(r(),l("div",Y,[q,d(" Еще нет добавленных данных по CRM ")]))],64))]),i("div",W,[X,!t.load&&t.currentBot?(r(),y(D,{key:0,bot:t.currentBot,data:t.selected,onCallback:t.loadBitrix},null,8,["bot","data","onCallback"])):u("",!0)])])]))}});export{st as default};
