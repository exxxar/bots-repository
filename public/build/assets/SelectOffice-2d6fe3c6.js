import{t as m,o,k as l,H as u,F as h,M as r,p as f,n as e,L as a,N as g,Y as p,K as y}from"./index.es-c4852431.js";import{_ as b}from"./_plugin-vue_export-helper-c27b6911.js";import{v as k}from"./v4-4a60fe23.js";const v={props:["config"],data(){return{officeModal:null,load_regions:!1,load_cities:!1,search_office:null,regions:[],cities:[],offices:[],region:null,city:null,office:null}},computed:{filteredOffices(){return this.search_office?this.offices.filter(i=>i.location.address_full.toLowerCase().indexOf(this.search_office.toLowerCase().trim())!==-1):this.offices},uuid(){return k()}},mounted(){this.config&&(this.region=this.config.region||null,this.city=this.config.city||null,this.office=this.config.office||null),this.officeModal=new bootstrap.Modal(document.getElementById("select-cdek-office"+this.uuid),{}),this.loadCdekRegions()},methods:{onInputCity(){this.offices=[]},openOfficeModal(){this.officeModal.show()},selectOffice(i){this.office=i,this.$emit("callback",{city:this.city,region:this.region,office:this.office}),this.officeModal.toggle()},selectCity(i){this.city=i,this.loadCdekOffices()},selectRegion(i){this.region=i,this.loadCdekCities()},loadCdekRegions(){this.load_regions=!1,this.$store.dispatch("loadCdekRegions").then(i=>{this.regions=i||[],this.region&&this.regions.findIndex(d=>d.region_code===this.region.region_code)===-1&&(this.region=null),this.load_regions=!0})},loadCdekOffices(){this.$store.dispatch("loadCdekOffices",{page:0,size:100,city_code:this.city.code}).then(i=>{this.offices=i,this.office&&this.offices.findIndex(d=>d.code===this.office.code)===-1&&(this.office=null)})},loadCdekCities(){this.region==null||!this.region.region_code||(this.load_cities=!1,this.$store.dispatch("loadCdekCities",{region_code:this.region.region_code}).then(i=>{this.cities=i,this.city&&this.cities.findIndex(d=>d.code===this.city.code)===-1&&(this.city=null),this.load_cities=!0}))}}},x={key:1,class:"alert alert-light"},C=e("p",{class:"text-center"},"Загружаем данные по регионам...",-1),I=e("div",{class:"d-flex justify-content-center w-100"},[e("div",{class:"spinner-border color-orange-dark",role:"status"},[e("span",{class:"sr-only"},"Загрузка...")])],-1),O=[C,I],w={key:1,class:"alert alert-light"},B=e("p",{class:"text-center"},"Загружаем данные по городам...",-1),M=e("div",{class:"d-flex justify-content-center w-100"},[e("div",{class:"spinner-border color-orange-dark",role:"status"},[e("span",{class:"sr-only"},"Загрузка...")])],-1),j=[B,M],L=["disabled"],S={key:0},R=e("i",{class:"fa-solid fa-city text-primary"},null,-1),z={class:"fw-bold"},D={key:1},N=e("i",{class:"fa-solid fa-building-circle-arrow-right"},null,-1),P=["id"],V={class:"modal-dialog modal-fullscreen"},E={class:"modal-content"},F=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Выбор офиса"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={key:0,class:"modal-body"},H={class:"input-group mb-2"},K={class:"form-floating"},U=e("label",{for:"search-product"},"Поиск по адресам",-1),Y=e("button",{class:"btn btn-outline-light",type:"button",id:"button-addon2"},[e("i",{class:"fa-solid fa-magnifying-glass-arrow-right"})],-1),q={class:"card w-100 mb-2 border-light"},A=["src"],G={class:"card-body"},J={class:"card-title"},Q={class:"card-text small fst-italic"},W={class:"card-text"},X=["href"],Z=e("i",{class:"fa-solid fa-map-location-dot"},null,-1),$=["onClick"],ee=e("i",{class:"fa-solid fa-building-circle-arrow-right"},null,-1);function te(i,c,d,ie,s,n){const _=m("vue3-simple-typeahead");return o(),l(h,null,[s.load_regions?(o(),u(_,{key:0,items:s.regions,defaultItem:s.region,class:"form-control w-100 p-3 mb-2",placeholder:"Выбор региона",onSelectItem:n.selectRegion,onOnInput:i.onInput,onOnBlur:i.onBlur,minInputLength:1,itemProjection:t=>t.region},null,8,["items","defaultItem","onSelectItem","onOnInput","onOnBlur","itemProjection"])):(o(),l("div",x,O)),s.region?(o(),l(h,{key:2},[s.load_cities?(o(),u(_,{key:0,items:s.cities,defaultItem:s.city,class:"form-control w-100 p-3 mb-2",placeholder:"Выбор города в регионе",onSelectItem:n.selectCity,onOnInput:n.onInputCity,onOnBlur:i.onBlur,minInputLength:1,itemProjection:t=>t.city},null,8,["items","defaultItem","onSelectItem","onOnInput","onOnBlur","itemProjection"])):(o(),l("div",w,j))],64)):r("",!0),s.city?(o(),l("button",{key:3,type:"button",disabled:s.offices.length===0,onClick:c[0]||(c[0]=(...t)=>n.openOfficeModal&&n.openOfficeModal(...t)),class:"btn btn-light w-100 p-3"},[s.office?(o(),l("span",D,[N,f(" "+a(s.office.location.address_full),1)])):(o(),l("span",S,[R,f(" Выбрать офис "),e("span",z,"("+a(s.offices.length)+")",1)]))],8,L)):r("",!0),e("div",{class:"modal fade",id:"select-cdek-office"+n.uuid,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",V,[e("div",E,[F,s.offices.length>0?(o(),l("div",T,[e("div",H,[e("div",K,[g(e("input",{type:"search","onUpdate:modelValue":c[1]||(c[1]=t=>s.search_office=t),class:"form-control border-light",id:"search-product",placeholder:"name@example.com"},null,512),[[p,s.search_office]]),U]),Y]),(o(!0),l(h,null,y(n.filteredOffices,t=>(o(),l("div",q,[(t.office_image_list||[]).length>0?(o(),l("img",{key:0,class:"card-img-top mb-2",style:{"max-height":"150px","object-fit":"cover"},src:t.office_image_list[0].url,alt:""},null,8,A)):r("",!0),e("div",G,[e("h5",J,a(t.name||"-"),1),e("div",Q,a(t.location.address_full||"-"),1),e("p",W,a(t.address_comment||"-"),1),e("a",{class:"btn btn-link text-center mb-3 w-100",href:"https://yandex.ru/maps/?ll="+t.location.longitude+"%2C"+t.location.latitude+"&z=15&mode=whatshere&whatshere%5Bpoint%5D="+t.location.longitude+"%2C"+t.location.latitude+"&whatshere%5Bzoom%5D=15&z=15",target:"_blank"},[Z,f(" На карте")],8,X),e("a",{onClick:se=>n.selectOffice(t),href:"javascript:void(0)",class:"btn btn-primary w-100"},[ee,f(" Выбрать")],8,$)])]))),256))])):r("",!0)])])],8,P)],64)}const ce=b(v,[["render",te]]);export{ce as S};
