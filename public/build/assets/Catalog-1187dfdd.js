import{_ as C}from"./ShopProductCatalog-7dee8db9.js";import{_ as w}from"./ProductCard-cb69dc03.js";import{T as x}from"./TableBookingPlanner-e7803cec.js";import{j as v,O as I,o,k as a,F as d,n as e,M as r,K as k,a0 as R,L as h,a8 as B,N as b,U as M,W as P,H as _,w as Q,l as g}from"./index.es-c4852431.js";import{s as S}from"./commonMethods-8bc36d87.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";import"./carousel.es-39a2ec14.js";import"./Rating-5dca4717.js";import"./ReviewCard-2760000f.js";import"./ProductCardSimple-fd2f756b.js";import"./v4-4a60fe23.js";import"./Pagination-b758f7ed.js";/* empty css                                                   */import"./ProductCollectionView-b165a3ce.js";import"./CollectionCardSimple-740109df.js";import"./PreloaderV1-8b039dbc.js";/* empty css                                                    */import"./StoryList-b1293370.js";/* empty css                                                                  */import"./BookingDropdown-f6c3c031.js";const E={name:"CoffeeProgress",data(){return{spent_time:0,intervalId:null,showRules:!1,showExchangeQR:!1,showMarkQR:!1,selectedCupIndex:null,coffee:null}},watch:{self:{handler:function(s){var t;this.coffee=((t=this.self.config)==null?void 0:t.coffee)||null},deep:!0}},computed:{...v(["getSelf"]),bot(){return window.currentBot},settings(){return this.bot.settings||null},self(){return this.getSelf},maxCups(){var s;return((s=this.settings.coffee)==null?void 0:s.max)||0},usedCups(){var s;return((s=this.coffee)==null?void 0:s.count)||0},cups(){return Array.from({length:this.maxCups},(s,t)=>({index:t,filled:t<this.usedCups}))},progressPercent(){return Math.min(this.usedCups/this.maxCups*100,100)},link(){return"https://t.me/"+this.bot.bot_domain+"?start="+btoa("077"+this.self.telegram_chat_id+"request")},markQR(){return this.selectedCupIndex===null?null:"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link}},mounted(){window.addEventListener("trigger-spent-timer",s=>{this.spent_time=s.detail})},methods:{refreshCoffee(){S(10),this.$notify({title:"Кофе",text:"Обновляем карточки"}),this.InitCoffee()},InitCoffee(){return this.$store.dispatch("initCoffee").then(s=>{this.coffee=s||{count:0}}).catch(()=>{this.coffee={count:0}})},clearWaitInterval(){clearInterval(this.intervalId)},waitForAccept(){let s=10;const t=this.coffee.count;this.intervalId=setInterval(()=>{this.InitCoffee().then(i=>{s--,(t!==this.coffee.count||s<=0)&&this.clearWaitInterval()})},5e3)},onCupClick(s){s.filled||(this.selectedCupIndex=s.index,this.showMarkQR=!0,this.waitForAccept())},toggleRules(){this.showRules=!this.showRules},toggleExchangeQR(){this.showExchangeQR=!this.showExchangeQR}}},u=s=>(M("data-v-8b11e966"),s=s(),P(),s),$={key:0,class:"coffee-wrapper"},q=u(()=>e("p",{class:"alert alert-light mb-2"}," Получите вкусный кофе совершенно бесплатно! Узнайте сколько у вас чашечек кофе прямо сейчас! ",-1)),F=u(()=>e("h5",{class:"fw-bold mb-3"},"Ваш прогресс кофе",-1)),z={class:"row row-cols-3"},D=["onClick"],L=u(()=>e("i",{style:{"font-size":"26px"},class:"fa-solid fa-mug-hot"},null,-1)),O=[L],V={class:"col mb-2"},j=["disabled"],A={key:0,style:{"font-size":"14px"}},N={key:1},W=u(()=>e("i",{class:"fas fa-sync-alt"},null,-1)),G=[W],H={class:"progress coffee-progress mb-3"},K={class:"text-muted small mb-3"},U={key:1,class:"qr-box text-center mb-3"},J={class:"qr-img",alt:"QR для обмена"},X=u(()=>e("p",{class:"small text-muted"},"Покажите бариста",-1)),Y={key:2,class:"qr-box text-center mb-3"},Z={class:"qr-img",alt:"QR для отметки"},tt=u(()=>e("p",{class:"small text-muted"},"Покажите администратору",-1)),et={key:2,class:"alert alert-light border"},st={class:"mb-0",style:{"white-space":"pre-line"}};function ot(s,t,i,f,l,n){var m;const p=I("lazy");return(m=n.settings.coffee)!=null&&m.enabled?(o(),a("div",$,[l.coffee?r("",!0):(o(),a(d,{key:0},[q,e("button",{type:"button",onClick:t[0]||(t[0]=(...c)=>n.InitCoffee&&n.InitCoffee(...c)),class:"btn btn-primary p-3 mb-2 w-100"},"Приступить ")],64)),l.coffee?(o(),a(d,{key:1},[F,e("div",z,[(o(!0),a(d,null,k(n.cups,(c,y)=>(o(),a("div",{class:"col mb-2",key:"coffee-cup-"+y,onClick:Ot=>n.onCupClick(c)},[e("a",{href:"javascript:void(0)",class:R([{filled:c.filled},"btn w-100 p-3 coffee-cup-btn"])},O,2)],8,D))),128)),e("div",V,[e("button",{type:"button",disabled:l.spent_time>0,onClick:t[1]||(t[1]=(...c)=>n.refreshCoffee&&n.refreshCoffee(...c)),class:"btn w-100 p-3 coffee-cup-btn bg-success text-white"},[l.spent_time>0?(o(),a("span",A,h(l.spent_time)+" сек.",1)):(o(),a("span",N,G))],8,j)])]),e("div",H,[e("div",{class:"progress-bar progress-bar-striped bg-warning",role:"progressbar",style:B({width:n.progressPercent+"%"})},null,4)]),e("p",K," Осталось "+h(n.maxCups-n.usedCups)+" чашек до бесплатной. ",1),n.usedCups>=n.maxCups&&n.maxCups>0?(o(),a("button",{key:0,class:"btn btn-success w-100 mb-3",onClick:t[2]||(t[2]=(...c)=>n.toggleExchangeQR&&n.toggleExchangeQR(...c))}," Обменять на бесплатный кофе ")):r("",!0),l.showExchangeQR?(o(),a("div",U,[b(e("img",J,null,512),[[p,n.markQR]]),X])):r("",!0),l.showMarkQR?(o(),a("div",Y,[b(e("img",Z,null,512),[[p,n.markQR]]),tt])):r("",!0)],64)):r("",!0),e("button",{class:"btn btn-outline-secondary w-100 mb-2 p-3",onClick:t[3]||(t[3]=(...c)=>n.toggleRules&&n.toggleRules(...c))}," Правила акции "),l.showRules?(o(),a("div",et,[e("p",st,h(n.settings.coffee.rules),1)])):r("",!0)])):r("",!0)}const at=T(E,[["render",ot],["__scopeId","data-v-8b11e966"]]),it={key:1,class:"container"},nt={class:"row"},lt={class:"col-12"},rt={class:"navbar navbar-expand-sm fixed-bottom p-2 bg-transparent border-0",style:{"border-radius":"10px 10px 0 0","z-index":"999!important"}},ct={class:"ios-nav-group w-100"},dt=e("button",{type:"button","data-bs-toggle":"offcanvas","data-bs-target":"#sidebar-menu","aria-controls":"sidebar-menu",class:"btn btn-primary ios-btn"},[e("i",{class:"fa-solid fa-bars"}),e("span",{class:"ios-label"},"Меню")],-1),ut=e("i",{class:"fa-solid fa-calendar-check"},null,-1),ht=e("span",{class:"ios-label"},"Бронь",-1),ft=[ut,ht],pt=e("i",{class:"fa-solid fa-shop"},null,-1),mt=e("span",{class:"ios-label"},"Магазин",-1),bt=[pt,mt],_t=e("i",{class:"fa-solid fa-cart-shopping"},null,-1),gt=e("span",{class:"ios-label"},"Корзина",-1),vt={key:0,class:"cart-marker"},kt=e("i",{class:"fa-solid fa-heart"},null,-1),yt=e("span",{class:"ios-label"},"Избранное",-1),Ct={key:0,class:"cart-marker"},wt=e("i",{class:"fa-solid fa-mug-hot"},null,-1),xt=e("span",{class:"ios-label"},"Кофе",-1),It=[wt,xt],Rt={class:"modal fade",id:"coffee-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Bt={class:"modal-dialog"},Mt={class:"modal-content"},Pt=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Кофе"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Qt={class:"modal-body"},St={class:"modal fade",id:"fav-product-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Tt={class:"modal-dialog"},Et={class:"modal-content"},$t=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Избранное"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),qt={class:"modal-body"},Ft={key:0,class:"row row-cols-2 row-cols-sm-2 row-cols-md-3 g-2"},zt={class:"col"},Dt={key:1,class:"alert alert-light"},Lt={data(){return{tab:"shop",coffee_load:!1,settings:null,favorites_products:[]}},computed:{...v(["inCart","cartProducts","cartTotalCount","getFavoriteProducts","cartTotalPrice","getSelf"]),bot(){return window.currentBot},favorites(){return this.getFavoriteProducts},self(){return window.self||null},favCount(){return this.favorites.length===0?0:this.favorites.length},canBay(){return window.isCorrectSchedule(this.bot.company.schedule)?(this.bot.company||{is_work:!0}).is_work||(this.settings?this.settings.can_buy_after_closing:!0):!0},tg(){return window.Telegram.WebApp}},mounted(){var s;if(this.tg.BackButton.show(),(s=this.bot.settings)!=null&&s.self_updated?this.settings=this.bot.settings:this.loadShopModuleData(),this.tg.BackButton.onClick(()=>{this.tg.close()}),this.loadBasketData(),!this.canBay){const t=document.querySelector("#schedule-list-display"),i=bootstrap.Modal.getOrCreateInstance(t);i&&i.show()}},methods:{showCoffee(){this.coffee_load=!0,this.$nextTick(()=>{this.coffee_load=!1;const s=document.getElementById("coffee-modal"),t=bootstrap.Modal.getOrCreateInstance(s);t&&t.show()})},goToBooking(){this.$router.push({name:"TableBookingV2"})},goToCart(){this.$router.push({name:"ShopCartV2"})},loadBasketData(){return this.$store.dispatch("loadProductsInBasket")},loadFavProducts(){const s=document.querySelector("#fav-product-modal"),t=bootstrap.Modal.getOrCreateInstance(s);t&&t.show(),this.$store.dispatch("getFavList").then(i=>{this.favorites_products=i.data||[]}).catch(()=>{})},loadShopModuleData(){return this.$store.dispatch("loadShopModuleData").then(s=>{this.$nextTick(()=>{this.settings||(this.settings={});let t=s.data;t&&Object.keys(t).forEach(i=>{i&&(this.settings[i]=t[i])})})})}}},le=Object.assign(Lt,{__name:"Catalog",setup(s){return(t,i)=>{var f;return o(),a(d,null,[t.tab==="shop"?(o(),a(d,{key:0},[t.settings?(o(),_(C,{key:0,settings:t.settings},{navigation:Q(()=>[]),_:1},8,["settings"])):r("",!0)],64)):r("",!0),t.tab==="booking"?(o(),a("div",it,[e("div",nt,[e("div",lt,[g(x)])])])):r("",!0),e("nav",rt,[e("div",ct,[dt,t.tab==="shop"?(o(),a("button",{key:0,onClick:i[0]||(i[0]=l=>t.tab="booking"),type:"button",class:"btn btn-primary ios-btn"},ft)):r("",!0),t.tab==="booking"?(o(),a("button",{key:1,onClick:i[1]||(i[1]=l=>t.tab="shop"),type:"button",class:"btn btn-primary ios-btn"},bt)):r("",!0),e("button",{onClick:i[2]||(i[2]=(...l)=>t.goToCart&&t.goToCart(...l)),type:"button",class:"btn btn-primary ios-btn position-relative"},[_t,gt,t.cartTotalCount>0?(o(),a("span",vt,h(t.cartTotalPrice||0)+"₽ ",1)):r("",!0)]),e("button",{onClick:i[3]||(i[3]=(...l)=>t.loadFavProducts&&t.loadFavProducts(...l)),type:"button",class:"btn btn-primary ios-btn position-relative"},[kt,yt,t.favCount>0?(o(),a("span",Ct,h(t.favCount),1)):r("",!0)]),t.settings?(o(),a(d,{key:2},[(f=t.settings.coffee)!=null&&f.enabled?(o(),a("button",{key:0,type:"button",onClick:i[4]||(i[4]=(...l)=>t.showCoffee&&t.showCoffee(...l)),class:"btn btn-success ios-btn"},It)):r("",!0)],64)):r("",!0)])]),e("div",Rt,[e("div",Bt,[e("div",Mt,[Pt,e("div",Qt,[t.coffee_load?r("",!0):(o(),_(at,{key:0}))])])])]),e("div",St,[e("div",Tt,[e("div",Et,[$t,e("div",qt,[t.favorites_products.length>0?(o(),a("div",Ft,[(o(!0),a(d,null,k(t.favorites_products,(l,n)=>(o(),a("div",zt,[g(w,{item:l},null,8,["item"])]))),256))])):(o(),a("p",Dt," Вы еще не добавили товары в избранное:( "))])])])])],64)}}});export{le as default};
