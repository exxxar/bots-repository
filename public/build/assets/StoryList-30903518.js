/* empty css                                                                  */import{_ as m}from"./_plugin-vue_export-helper-c27b6911.js";import{o as l,k as c,n as i,a0 as h,F as u,K as b,H as g,a1 as v,a8 as w,L as y,M as a,t as _}from"./index.es-c4852431.js";const f={name:"StoryItem",props:{story:{type:Object,required:!0},isViewed:{type:Boolean,default:!1}}},k=["src","alt"];function x(s,r,o,d,e,t){return l(),c("div",{class:h(["story-item flex-shrink-0 rounded-circle overflow-hidden cursor-pointer border",{"border-primary":!o.isViewed,"border-secondary":o.isViewed}]),style:{width:"80px",height:"80px"},onClick:r[0]||(r[0]=S=>s.$emit("open-story"))},[i("img",{src:o.story.thumbnail,class:h(["w-100 h-100 object-fit-cover",{"filter-grayscale":o.isViewed}]),alt:o.story.title},null,10,k)],2)}const V=m(f,[["render",x],["__scopeId","data-v-ee760bbe"]]),O={name:"StoryList",components:{StoryItem:V},props:{stories:{type:Array,required:!0}},data(){return{isTextOpen:!1,currentStory:null,progress:0,timer:null,viewedStories:JSON.parse(localStorage.getItem("viewedStories"))||[]}},computed:{sortedStories(){return[...this.stories].sort((s,r)=>{const o=this.viewedStories.includes(s.id),d=this.viewedStories.includes(r.id);return o&&!d?1:!o&&d?-1:0})}},methods:{goToProductLink(s){try{const o=new URL(s).searchParams.get("start"),e=atob(o).match(/^001slug(\d+)product(\d+)$/);e||this.$router.push({name:"CatalogV2"});const t=e[2];this.$router.push({name:"ProductV2",params:{productId:t}})}catch{this.$router.push({name:"CatalogV2"})}},openStory(s){this.currentStory=s,this.progress=0,this.startTimer(),this.markAsViewed(this.sortedStories[s].id)},closeStory(){this.currentStory=null,this.progress=0,clearInterval(this.timer)},startTimer(){clearInterval(this.timer),this.timer=setInterval(()=>{this.progress+=.5,this.progress>=100&&this.nextStory()},100)},nextStory(){this.currentStory<this.sortedStories.length-1?(this.currentStory++,this.progress=0,this.markAsViewed(this.sortedStories[this.currentStory].id),this.startTimer()):this.closeStory()},markAsViewed(s){this.viewedStories.includes(s)||(this.viewedStories.push(s),localStorage.setItem("viewedStories",JSON.stringify(this.viewedStories)))},isStoryViewed(s){return this.viewedStories.includes(s)}}},I={class:"story-list-container d-flex overflow-auto p-3"},T={class:"modal-dialog modal-dialog-centered w-100 mw-100 m-0 h-100 mh-100"},C={class:"modal-content bg-transparent border-0 h-100 position-relative",style:{"overflow-y":"auto"}},L={class:"progress position-absolute top-0 start-0 end-0",style:{height:"4px","z-index":"10"}},j=["src"],B={class:"mb-1"},P={key:0,class:"mb-2"},z={class:"text-center small opacity-75"},A=["href"];function N(s,r,o,d,e,t){const S=_("StoryItem");return l(),c(u,null,[i("div",I,[(l(!0),c(u,null,b(t.sortedStories,(n,p)=>(l(),g(S,{key:n.id,story:n,"is-viewed":t.isStoryViewed(n.id),onOpenStory:M=>t.openStory(p)},null,8,["story","is-viewed","onOpenStory"]))),128))]),e.currentStory!==null?(l(),c("div",{key:0,class:"modal fade show d-block",style:{"background-color":"rgba(0, 0, 0, 0.9)"},onClick:r[3]||(r[3]=v((...n)=>t.closeStory&&t.closeStory(...n),["self"]))},[i("div",T,[i("div",C,[i("div",L,[i("div",{class:"progress-bar bg-primary",role:"progressbar",style:w({width:`${e.progress}%`})},null,4)]),i("img",{src:t.sortedStories[e.currentStory].image,class:"w-100 h-100 object-fit-cover",alt:"Story"},null,8,j),i("div",{class:"text-white p-3 bg-black bg-opacity-50 position-absolute bottom-0 start-0 end-0",onClick:r[1]||(r[1]=n=>e.isTextOpen=!e.isTextOpen),style:{cursor:"pointer"}},[i("h5",B,y(t.sortedStories[e.currentStory].title),1),e.isTextOpen?(l(),c("p",P,y(t.sortedStories[e.currentStory].description),1)):a("",!0),i("div",z,y(e.isTextOpen?"Скрыть":"Показать подробнее"),1),e.isTextOpen&&t.sortedStories[e.currentStory].link?(l(),c(u,{key:1},[t.sortedStories[e.currentStory].link_type==="url"||t.sortedStories[e.currentStory].link_type==="bot"?(l(),c("a",{key:0,href:t.sortedStories[e.currentStory].link,target:"_blank",class:"btn btn-primary rounded-5 w-100 p-3"}," Перейти по ссылке ",8,A)):a("",!0),t.sortedStories[e.currentStory].link_type==="product"?(l(),c("a",{key:1,href:"javascript:void(0)",onClick:r[0]||(r[0]=n=>t.goToProductLink(t.sortedStories[e.currentStory].link)),class:"btn btn-primary rounded-5 w-100 p-3"}," Открыть товар ")):a("",!0)],64)):a("",!0)]),i("button",{type:"button",class:"btn-close btn-close-white position-absolute top-0 end-0 m-2",style:{"z-index":"10"},onClick:r[2]||(r[2]=(...n)=>t.closeStory&&t.closeStory(...n))})])])])):a("",!0)],64)}const D=m(O,[["render",N],["__scopeId","data-v-ba18db39"]]);export{D as S};
