import{R as A}from"./ReturnToBot-463a5d25.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";import{o as l,j as r,l as o,p as q,q as O,n as d,K as p,F as M,J as j,L as _,k as C,w as R}from"./index.es-db843bab.js";const V={props:["items"],mounted(){const t=this.items,e=document.querySelector(".deal-wheel"),s=e.querySelector(".spinner"),a=e.querySelector(".btn-spin"),c=e.querySelector(".ticker"),m=360/t.length,L=Math.floor(180/t.length),v="is-spinning",b="selected",S=window.getComputedStyle(s);let k,h=0,$=0,f;const D=()=>{t.forEach(({text:n,color:i,reaction:y},u)=>{const g=m*u*-1-L;s.insertAdjacentHTML("beforeend",`<li class="prize" data-reaction=${y} style="--rotate: ${g}deg">
        <span class="text">${n}</span>
      </li>`)})},P=()=>{s.setAttribute("style",`background: conic-gradient(
      from -90deg,
      ${t.map(({color:n},i)=>`${n} 0 ${100/t.length*(t.length-i)-.25}%,black 0 ${100/t.length*(t.length-i)}%`).reverse()}
    );`)},N=()=>{P(),D(),f=e.querySelectorAll(".prize")},E=(n,i)=>(n=Math.ceil(n),i=Math.floor(i),Math.floor(Math.random()*(i-n+1))+n),w=()=>{const n=S.transform.split("(")[1].split(")")[0].split(","),i=n[0],y=n[1];let u=Math.atan2(y,i);u<0&&(u+=2*Math.PI);const g=Math.round(u*(180/Math.PI)),F=Math.floor(g/m);$!==F&&(c.style.animation="none",setTimeout(()=>c.style.animation=null,10),$=F),k=requestAnimationFrame(w)},z=()=>{const n=Math.floor(h/m);if(n<0||n>=f.length){w();return}f[n].classList.add(b),this.$emit("callback",n)};a.addEventListener("click",()=>{a.disabled=!0,h=Math.floor(Math.random()*360+E(2e3,5e3)),f.forEach(n=>n.classList.remove(b)),e.classList.add(v),s.style.setProperty("--rotate",h),c.style.animation="none",w()}),s.addEventListener("transitionend",()=>{cancelAnimationFrame(k),h%=360,z(),e.classList.remove(v),s.style.setProperty("--rotate",h),a.disabled=!1}),N()}},W={class:"deal-container"},B={class:"deal-wheel"},H=O('<div class="outer-circle"></div><div class="deal-wheel-full"><div class="inner-circle"></div><div class="inner-circle-2"></div></div><ul class="spinner"></ul><div class="ticker"><div class="circle"></div><div class="arrow"></div></div>',4),U={class:"btn-spin"};function I(t,e,s,a,c,m){return l(),r("div",W,[o("div",B,[H,o("button",U,[q(t.$slots,"baseContent")])])])}const J=T(V,[["render",I]]);const K={key:0,class:"card card-style"},x={class:"content"},G=o("h4",null,"Правила данной игры",-1),Q=["innerHTML"],X={key:0,class:"mb-2"},Y=o("p",{style:{"font-weight":"900",color:"red"},class:"mb-2"},"Вы израсходовали все ваши попытки",-1),Z=[Y],ee={key:2,class:"m-0 p-0"},te={class:"d-flex flex-column mb-2"},se={key:1,class:"card card-style"},ne={class:"content d-flex justify-content-center flex-wrap"},ae={name:"App",data(){return{winResultMessage:"Наш менеджер свяжется с вами для дальнейших инструкций.",rules:null,rouletteKey:0,action:null,hasProfileData:!1,wheelDataLoaded:!1,winForm:{win:null},items:[]}},computed:{canPlay(){return this.action?this.action.current_attempts<this.action.max_attempts:!1}},mounted(){this.loadServiceData().then(()=>{this.prepareUserData()})},methods:{lose(){this.$botNotification.warning("Упс!","Вы израсходовали все попытки!")},prepareUserData(){return this.$store.dispatch("wheelOfFortuneCustomPrepare").then(t=>{this.action=t.action})},loadServiceData(){return this.wheelDataLoaded=!1,this.$store.dispatch("wheelOfFortuneCustomLoadData").then(t=>{let e=0;const s=["#645b00","#9a4000","#831814","#831131","#83118d","#7529eb","#0e2e75","#115965","#0f6b2b","#476c17","#756d21","#854a1c"];this.rules=t.rules,this.winResultMessage=t.callback_message;const a=t.wheels.sort(()=>Math.random()-.5);this.items=[],a.forEach(c=>{this.items.push({text:c.value,color:s[e]}),e=e<s.length?e+1:0}),this.wheelDataLoaded=!0})},submit(){let t=new FormData;Object.keys(this.winForm).forEach(s=>{const a=this.winForm[s]||"";typeof a=="object"?t.append(s,JSON.stringify(a)):t.append(s,a)});const e=this.winForm.win||null;t.append("description",this.items[e].text||"Без описания"),this.$store.dispatch("wheelOfFortuneCustomWin",{winForm:t}).then(s=>{this.winForm.win=null,this.winForm.name=null,this.winForm.phone=null,this.prepareUserData(),this.tg.close()}).catch(s=>{}),this.$botNotification.success("Вы выиграли!","Вы выиграли приз "+(e?this.items[e].text:"Что-то интересное..."))},callbackPlayerForm(t){this.winForm={...this.winForm,...t},this.hasProfileData=!0},wheelEndedCallback(t){this.wheelDataLoaded=!1,console.log("game event",t);const e=t;setTimeout(()=>{this.winForm.win=e,this.submit()},2e3)}}},re=Object.assign(ae,{setup(t){return(e,s)=>(l(),r(M,null,[e.rules?(l(),r("div",K,[o("div",x,[G,o("p",{innerHTML:e.rules},null,8,Q),e.canPlay&&e.action?(l(),r("p",X,[d("Ваши попытки: "),o("strong",null,p(e.action.current_attempts||0),1),d(" из "),o("strong",null,p(e.action.max_attempts||1),1)])):(l(),r("div",{key:1,onClick:s[0]||(s[0]=(...a)=>e.lose&&e.lose(...a))},Z)),e.action?(l(),r("ul",ee,[e.action.data?(l(!0),r(M,{key:0},j(e.action.data,a=>(l(),r("li",te,[o("span",null,[d("Название приза "),o("strong",null,p(a.description||"Отсутствует"),1)]),o("span",null,[d("Победитель "),o("strong",null,p(a.name||"Не указано"),1)]),o("span",null,[d("Телефон "),o("strong",null,p(a.phone||"Не указано"),1)])]))),256)):_("",!0)])):_("",!0),C(A,{class:"my-2"})])])):_("",!0),e.canPlay&&e.wheelDataLoaded?(l(),r("div",se,[o("div",ne,[C(J,{items:e.items,onCallback:e.wheelEndedCallback},{baseContent:R(()=>[d(" Испытай удачу ")]),_:1},8,["items","onCallback"])])])):_("",!0)],64))}});export{re as default};
