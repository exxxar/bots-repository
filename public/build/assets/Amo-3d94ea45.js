import{V as w}from"./vue3-json-editor.esm.prod-a2876a2f.js";import{o as _,k as h,n as e,a1 as A,l as d,w as l,p as u,N as m,Y as f,H as g,M as p,F,K as v,a9 as V,L as x,t as y}from"./index.es-c4852431.js";import{_ as C}from"./_plugin-vue_export-helper-c27b6911.js";const M={props:["data","bot"],components:{Vue3JsonEditor:w},data(){return{load:!1,custom_fields:null,fields:[{title:"Телефонный номер",field:"phone"},{title:"Ф.И.О.",field:"fio_from_telegram"},{title:"Почта",field:"email"},{title:"Дата рождения",field:"birthday"},{title:"Возраст",field:"age"},{title:"Страна",field:"country"},{title:"Адрес",field:"address"},{title:"Пол",field:"sex"},{title:"Идентификатор чата",field:"fio_from_telegram"}],hasConnect:!1,amoForm:{client_id:null,client_secret:null,auth_code:null,redirect_uri:null,subdomain:null,bot_id:null,fields:null}}},mounted(){this.data&&this.$nextTick(()=>{this.amoForm.client_id=this.data.client_id||null,this.amoForm.client_secret=this.data.client_secret||null,this.amoForm.auth_code=this.data.auth_code||null,this.amoForm.redirect_uri=this.data.redirect_uri||null,this.amoForm.subdomain=this.data.subdomain||null,this.amoForm.bot_id=this.data.bot_id||this.bot.id||null,this.amoForm.fields=this.data.fields||null})},methods:{loadAmoFields(){this.load=!0,this.custom_fields=null,this.$store.dispatch("loadAmoFields").then(i=>{this.custom_fields=i._embedded.custom_fields.contacts||null,this.$nextTick(()=>{this.load=!1}),this.$botNotification.success("Работа с AMO","Справочная информация успешно загружена")}).catch(i=>{this.$botNotification.warning("Работа с AMO","Ошибка работы со справочной информацией")})},removeField(i){this.amoForm.fields&&this.amoForm.fields.splice(i,1)},addField(){this.amoForm.fields||(this.amoForm.fields=[]),this.amoForm.fields.push({key:null,field:null,enum:null})},syncAmo(){this.$store.dispatch("syncAmo").then(i=>{this.$botNotification.success("Работа с AMO","Данные CRM успешно сохранены")}).catch(i=>{this.$botNotification.warning("Работа с AMO","Ошибка работы")})},submitAmo(){let i=new FormData;Object.keys(this.amoForm).forEach(t=>{const b=this.amoForm[t]||"";typeof b=="object"?i.append(t,JSON.stringify(b)):i.append(t,b)}),this.$store.dispatch("saveAmoCRM",{amoForm:i}).then(t=>{this.$botNotification.success("Работа с AMO","Данные CRM успешно сохранены")}).catch(t=>{})}}},O={class:"card card-style"},j={class:"content mb-0"},q=e("h3",null,"Настройка AMO",-1),N=e("p",{class:"mb-2"},[e("a",{target:"_blank",href:"https://www.amocrm.ru/developers/content/oauth/step-by-step"},"Документация для разработчика "),u(" по шагам")],-1),U={class:"mb-2"},B={class:"form-label d-flex justify-content-between mt-2",id:"client_id"},E=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),S=e("div",null,"ID интеграции",-1),D=e("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),J=e("div",null,"Нужно ",-1),R={class:"mb-2"},T={class:"form-label d-flex justify-content-between mt-2",id:"client_secret"},L=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),P=e("div",null,"Секрет интеграции",-1),H=e("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),I=e("div",null,"Нужно ",-1),K={class:"mb-2"},Y={class:"form-label d-flex justify-content-between mt-2",id:"auth_code"},z=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),G=e("div",null,"Полученный код авторизации",-1),Q=e("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),W=e("div",null,"Нужно ",-1),X={class:"mb-2"},Z={class:"form-label d-flex justify-content-between mt-2",id:"subdomain2"},$=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ee=e("div",null,"Ваш поддомен в системе AMO CRM",-1),te=e("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),oe=e("div",null,"Нужно ",-1),le=["disabled"],se={class:"mb-2"},ie=["id"],ne=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),de=e("div",null,"Ключевое значение из справочника",-1),ae=e("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),re=e("div",null,"Нужно ",-1),ce=["onUpdate:modelValue"],ue={class:"mb-2"},me=["id"],_e=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),fe=e("div",null,"Поле из списка для связи",-1),be=e("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),he=e("div",null,"Нужно ",-1),pe=["onUpdate:modelValue"],Fe=["value"],ve={class:"mb-2"},ye=["id"],ge=["onUpdate:modelValue"],ke=["onClick"],we=e("div",{class:"divider divider-small my-3 bg-highlight"},null,-1),Ae=e("button",{type:"submit",class:"btn btn-m btn-full mt-3 mb-3 rounded-s text-uppercase font-900 shadow-s bg-red1-light w-100"},[e("i",{class:"fa-solid fa-cloud-arrow-down mr-1"}),u(" Сохранить настройку AMO ")],-1),Ve=e("div",{class:"divider divider-small my-3 bg-highlight"},null,-1);function xe(i,t,b,Oe,o,r){const n=y("Popper"),k=y("Vue3JsonEditor");return _(),h("div",O,[e("div",j,[q,e("form",{onSubmit:t[7]||(t[7]=A((...s)=>r.submitAmo&&r.submitAmo(...s),["prevent"]))},[N,e("div",U,[e("label",B,[e("div",null,[d(n,null,{content:l(()=>[S]),default:l(()=>[E]),_:1}),u(" client_id ")]),d(n,null,{content:l(()=>[J]),default:l(()=>[D]),_:1})]),m(e("input",{type:"text",class:"form-control",placeholder:"client_id","aria-label":"client_id","onUpdate:modelValue":t[0]||(t[0]=s=>o.amoForm.client_id=s),"aria-describedby":"client_id",required:""},null,512),[[f,o.amoForm.client_id]])]),e("div",R,[e("label",T,[e("div",null,[d(n,null,{content:l(()=>[P]),default:l(()=>[L]),_:1}),u(" client_secret ")]),d(n,null,{content:l(()=>[I]),default:l(()=>[H]),_:1})]),m(e("input",{type:"text",class:"form-control",placeholder:"client_secret","aria-label":"client_secret","onUpdate:modelValue":t[1]||(t[1]=s=>o.amoForm.client_secret=s),"aria-describedby":"client_secret",required:""},null,512),[[f,o.amoForm.client_secret]])]),e("div",K,[e("label",Y,[e("div",null,[d(n,null,{content:l(()=>[G]),default:l(()=>[z]),_:1}),u(" auth_code ")]),d(n,null,{content:l(()=>[W]),default:l(()=>[Q]),_:1})]),m(e("textarea",{class:"form-control font-12",style:{"min-height":"250px"},placeholder:"auth_code","aria-label":"auth_code","onUpdate:modelValue":t[2]||(t[2]=s=>o.amoForm.auth_code=s),"aria-describedby":"auth_code",required:""},`
                                    `,512),[[f,o.amoForm.auth_code]])]),e("div",X,[e("label",Z,[e("div",null,[d(n,null,{content:l(()=>[ee]),default:l(()=>[$]),_:1}),u(" subdomain ")]),d(n,null,{content:l(()=>[oe]),default:l(()=>[te]),_:1})]),m(e("input",{type:"text",class:"form-control",placeholder:"subdomain","aria-label":"subdomain","onUpdate:modelValue":t[3]||(t[3]=s=>o.amoForm.subdomain=s),"aria-describedby":"subdomain",required:""},null,512),[[f,o.amoForm.subdomain]])]),e("button",{type:"button",disabled:!o.amoForm.client_id||!o.amoForm.auth_code||!o.amoForm.client_secret||!o.amoForm.subdomain,onClick:t[4]||(t[4]=(...s)=>r.loadAmoFields&&r.loadAmoFields(...s)),class:"btn w-100 btn-m btn-full rounded-s mb-1 rounded-0 text-uppercase font-900 shadow-s bg-green2-dark"}," Загрузить справочную информацию ",8,le),!o.load&&o.custom_fields?(_(),g(k,{key:0,mode:"tree",modelValue:o.custom_fields,"onUpdate:modelValue":t[5]||(t[5]=s=>o.custom_fields=s),"show-btns":!1,expandedOnStart:!1},null,8,["modelValue"])):p("",!0),o.amoForm.fields?(_(!0),h(F,{key:1},v(o.amoForm.fields,(s,a)=>(_(),h("div",null,[e("div",se,[e("label",{class:"form-label d-flex justify-content-between mt-0 mb-0",id:"field-key-"+a},[e("div",null,[d(n,null,{content:l(()=>[de]),default:l(()=>[ne]),_:1}),u(" Ключевое значение из справочника ")]),d(n,null,{content:l(()=>[re]),default:l(()=>[ae]),_:1})],8,ie),m(e("input",{type:"number",class:"form-control",placeholder:"Ключ","aria-label":"Ключ","onUpdate:modelValue":c=>o.amoForm.fields[a].key=c,"aria-describedby":"Ключ",required:""},null,8,ce),[[f,o.amoForm.fields[a].key]])]),e("div",ue,[e("label",{class:"form-label d-flex justify-content-between mt-0 mb-0",id:"field-field-"+a},[e("div",null,[d(n,null,{content:l(()=>[fe]),default:l(()=>[_e]),_:1}),u(" Поле из списка для связи ")]),d(n,null,{content:l(()=>[he]),default:l(()=>[be]),_:1})],8,me),m(e("select",{class:"form-control font-12","onUpdate:modelValue":c=>o.amoForm.fields[a].field=c},[(_(!0),h(F,null,v(o.fields,c=>(_(),h("option",{value:c.field},x(c.title||"Ошибка"),9,Fe))),256))],8,pe),[[V,o.amoForm.fields[a].field]])]),e("div",ve,[e("label",{class:"form-label d-flex justify-content-between mt-0 mb-0",id:"field-enum-"+a}," Перечисление (enum) из справочника ",8,ye),m(e("input",{type:"text",class:"form-control",placeholder:"Перечисление","aria-label":"Перечисление","onUpdate:modelValue":c=>o.amoForm.fields[a].enum=c,"aria-describedby":"Перечисление"},null,8,ge),[[f,o.amoForm.fields[a].enum]])]),e("button",{type:"button",onClick:c=>r.removeField(a),class:"btn btn-border btn-m btn-full mb-3 rounded-sm text-uppercase font-900 border-red1-dark color-red1-dark bg-theme w-100"}," Удалитьс связь полей ",8,ke),we]))),256)):p("",!0),e("button",{type:"button",onClick:t[6]||(t[6]=(...s)=>r.addField&&r.addField(...s)),class:"btn btn-border btn-m btn-full mb-3 rounded-sm text-uppercase font-900 border-green1-dark color-green1-dark bg-theme w-100"}," Добавить связь полей "),Ae],32),Ve,e("a",{href:"javascript:void(0)",onClick:t[8]||(t[8]=(...s)=>r.syncAmo&&r.syncAmo(...s)),class:"btn btn-m btn-full rounded-s mb-3 rounded-0 text-uppercase font-900 shadow-s bg-green2-dark"}," Синохрозировать ")])])}const Ce=C(M,[["render",xe]]),Me={data(){return{load:!1,bot:null}},mounted(){this.loadBotAdminConfig()},methods:{loadBotAdminConfig(){this.$store.dispatch("loadBotAdminConfig").then(i=>{this.bot=i.data,this.amo=this.bot.amo})}}},Ue=Object.assign(Me,{__name:"Amo",setup(i){return(t,b)=>!t.load&&t.bot?(_(),g(Ce,{key:0,bot:t.bot,data:t.bot.amo},null,8,["bot","data"])):p("",!0)}});export{Ue as default};
