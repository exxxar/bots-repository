/* empty css                                                   */import{j as F,O as C,o as i,k as a,n as o,L as m,p as g,M as n,N as d,Y as _,a3 as p,a9 as k,F as r,K as c,l as b,a0 as D,a1 as w,H as f}from"./index.es-c4852431.js";import{_ as v}from"./KeyboardConstructor-df98a2e0.js";import"./vue3-json-editor.esm.prod-a2876a2f.js";/* empty css                                                            */import"./v4-4a60fe23.js";const x={key:0,class:"mb-2"},V={class:"badge bg-success text-white"},U=o("span",{class:"ml-1 mr-1"},[o("i",{class:"fa-solid fa-arrow-right"})],-1),j={key:0,class:"badge bg-primary text-white"},O={key:1},z={class:"form-floating mb-2"},P=["id"],M=["for"],L={class:"mb-2"},B={class:"form-check"},G=o("label",{class:"form-check-label font-12",for:"need-empty-dialog"}," Диалог без ожидания ответа ",-1),S={key:1,class:"form-floating mb-2"},I=["id"],N=["for"],T={key:2,class:"form-floating mb-2"},q=["id"],K=["for"],Y={key:3,class:"mb-2"},E={class:"form-floating mb-2"},R=["value"],A=["for"],H={class:"form-floating"},J=["id"],Q=["for"],W={key:4,class:"form-floating mb-2"},X=["id"],Z=o("option",{value:null,selected:""},"Не указан",-1),ee=["value"],oe=["for"],te={class:"mb-2"},se={class:"d-flex justify-content-between"},le=["for"],ie=o("i",{class:"fa-brands fa-telegram ml-2 color-blue2-dark"},null,-1),ae=[ie],ne=["id"],de={class:"mb-2"},re={class:"form-check"},me=o("label",{class:"form-check-label font-12",for:"need-dialog-image"}," В диалоге нужно изображение ",-1),ce={class:"form-check"},ue=o("label",{class:"form-check-label font-12",for:"need-dialog-menu-inline"}," В диалоге нужно меню к тексту ",-1),he={class:"form-check"},_e=o("label",{class:"form-check-label font-12",for:"need-dialog-menu-reply"}," В диалоге нужно нижнее меню ",-1),pe={key:5,class:"mb-2"},ge=o("h6",null,"Фотографии к диалогу",-1),be={class:"photo-preview d-flex justify-content-center flex-wrap w-100"},fe={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},ye=o("span",null,"+",-1),ke={class:"mb-2 img-preview",style:{"margin-right":"10px"}},ve={class:"remove"},Fe=["onClick"],$e={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ce={class:"remove"},De=["onClick"],we={key:6,class:"mb-2"},xe=o("h6",null,"Кнопки к вопросу",-1),Ve={key:7,class:"mb-2"},Ue=o("h6",null,"Кнопки нижнего меню к вопросу",-1),je={class:"mb-2"},Oe=o("label",{class:"form-check-label font-12",for:"need-empty-dialog"}," Сохранить в переменную ",-1),ze=o("option",{selected:""},"Не выбрано",-1),Pe=["value"],Me={class:"form-check mb-2"},Le=o("label",{class:"form-check-label font-12",for:"need-set-flags"}," Установить флаги в соответствующее значение ",-1),Be={key:8,class:"mb-2"},Ge=o("h6",{class:"my-3"},"Выберите необходимые флаги",-1),Se=["onClick"],Ie={style:{"z-index":"100",bottom:"10px"},type:"submit",class:"btn btn-primary w-100 p-3 my-3 position-sticky"},Ne={key:0},Te={key:1},qe={key:9,class:"divider divider-small my-3 bg-highlight"},Ke=o("i",{class:"fa-solid fa-trash-can mr-1"},null,-1),Ye={props:["item","bot"],data(){return{need_images:!1,need_inline_keyboard:!1,need_reply_keyboard:!1,need_set_flags:!1,commands:[],flags_variants:[{title:"Является VIP",key:"is_vip",value:null},{title:"Является Админом",key:"is_admin",value:null},{title:"За работой",key:"is_work",value:null},{title:"Является менеджером",key:"is_manager",value:null}],store_variants:[{title:"Имя",key:"name"},{title:"Почта",key:"email"},{title:"Возраст",key:"age"},{title:"Город",key:"city"},{title:"Страна",key:"country"},{title:"Адрес",key:"address"},{title:"Телефон",key:"phone"},{title:"День рождение",key:"birthday"}],expressions:[{expression:null,description:"Нет проверки"},{expression:"/([a-z0-9]+)/i",description:"Проверка набора из латинских букв и цифр"},{expression:"/([а-яё0-9]+)/iu",description:"Проверка на кириллицу и цифры"},{expression:"/(?P<digit>\\d+)/",description:"Проверка на число"},{expression:"/^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$/",description:"Проверка Email"},{expression:"/^((8|+7)[- ]?)?((?d{3})?[- ]?)?[d- ]{7,10}$/",description:"Проверка номера телефона"},{expression:"/^(0[1-9]|[12][0-9]|3[01])[.](0[1-9]|1[012])[.](19|20)dd$/",description:"Проверка даты по формату"},{expression:"/^[0-9]{4}-(0[1-9]|1[012])-(0[1-9]|1[0-9]|2[0-9]|3[01])$/",description:"Проверка даты по формату YYYY-MM-DD"},{expression:"/^(https?://)?([da-z.-]+).([a-z.]{2,6})([/w .-]*)*/?$/",description:"Проверка доменного имени"}],commandForm:{id:null,slug:null,pre_text:null,post_text:null,error_text:null,bot_id:null,input_pattern:null,inline_keyboard_id:null,reply_keyboard_id:null,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,reply_keyboard:null,is_empty:!1,result_flags:[],store_to:null},photos:[]}},computed:{...F(["getDialogs"])},mounted(){window.addEventListener("select-telegram-channel-id",s=>{this.commandForm[s.detail.param]=s.detail.channel}),this.item&&this.$nextTick(()=>{this.commandForm={id:this.item.id||null,slug:this.item.slug||null,pre_text:this.item.pre_text||null,post_text:this.item.post_text||null,error_text:this.item.error_text||null,is_empty:this.item.is_empty||!1,input_pattern:this.item.input_pattern||null,inline_keyboard_id:this.item.inline_keyboard_id||null,reply_keyboard_id:this.item.reply_keyboard_id||null,images:this.item.images||[],next_bot_dialog_command_id:this.item.next_bot_dialog_command_id||null,bot_dialog_group_id:this.item.bot_dialog_group_id||null,result_channel:this.item.result_channel||null,inline_keyboard:this.item.inline_keyboard||null,reply_keyboard:this.item.reply_keyboard||null,result_flags:this.item.result_flags||[],store_to:this.item.store_to||null},this.bot&&(this.commandForm.bot_id=this.bot.id||null),this.commandForm.inline_keyboard_id!=null&&(this.need_inline_keyboard=!0),this.commandForm.reply_keyboard_id!=null&&(this.need_reply_keyboard=!0),this.commandForm.images.length>0&&(this.need_images=!0),this.commandForm.result_flags.length>0&&(this.need_set_flags=!0)}),this.bot&&this.$nextTick(()=>{this.commandForm.bot_id=this.bot.id}),this.loadGroups()},methods:{unlinkCommand(){this.loading=!0,this.$store.dispatch("unlinkDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Команды",text:"Диалоговая команда успешно продублирована!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},removeCommand(){this.loading=!0,this.$store.dispatch("removeDialogCommand",{dataObject:{dialogCommandId:this.item.id}}).then(s=>{this.loading=!1,this.$notify({title:"Команды",text:"Диалоговая команда успешно удалена!",type:"success"}),this.$emit("callback")}).catch(s=>{this.loading=!1})},loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogs",{dataObject:{simple:!0},page:s,size:100}).then(e=>{this.loading=!1,this.commands=this.getDialogs}).catch(()=>{this.loading=!1})},requestChannelId(s){this.$botPages.telegramChannelHelper(s)},submit(){this.loading=!0;let s=new FormData;if(Object.keys(this.commandForm).forEach(e=>{const l=this.commandForm[e]||"";typeof l=="object"?s.append(e,JSON.stringify(l)):s.append(e,l)}),this.photos){for(let e=0;e<this.photos.length;e++)s.append("files[]",this.photos[e]);s.delete("photos")}this.$store.dispatch(this.commandForm.id?"updateDialogCommand":"createDialogCommand",{dialogCommandForm:s}).then(e=>{this.loading=!1,this.$notify({title:"Команды",text:"Успешная обработка диалоговой команды!",type:"success"}),this.commandForm.id==null&&(this.commandForm={id:null,slug:null,pre_text:null,post_text:null,error_text:null,input_pattern:null,inline_keyboard_id:null,is_empty:!1,images:null,next_bot_dialog_command_id:null,bot_dialog_group_id:null,result_channel:null,inline_keyboard:null,result_flags:[],store_to:null},this.photos=[]),this.$emit("callback")}).catch(e=>{this.loading=!1})},getPhoto(s){return{imageUrl:URL.createObjectURL(s)}},removePhoto(s,e){this[s].splice(e,1)},onChangePhotos(s){const e=s.target.files;for(let l=0;l<e.length;l++)this.photos.push(e[l])},saveInlineKeyboard(s){this.commandForm.inline_keyboard=s},saveReplyKeyboard(s){this.commandForm.reply_keyboard=s},addTextTo(s={param:null,text:null}){this.commandForm[s.param]=s.text},selectFlag(s){this.commandForm.result_flags||(this.commandForm.result_flags=[]);let e=this.commandForm.result_flags.indexOf(s.key);e===-1?this.commandForm.result_flags.push(s.key):this.commandForm.result_flags.splice(e,1)}}},$=Object.assign(Ye,{__name:"BotDialogCommandForm",setup(s){return(e,l)=>{const h=C("lazy");return i(),a("form",{onSubmit:l[18]||(l[18]=w((...t)=>e.submit&&e.submit(...t),["prevent"]))},[e.commandForm.id?(i(),a("p",x,[o("span",V,"#"+m(e.commandForm.id),1),U,e.commandForm.next_bot_dialog_command_id?(i(),a("span",j,[g("#"+m(e.commandForm.next_bot_dialog_command_id||"-")+" ",1),o("i",{class:"ml-2 fa-solid fa-link-slash",onClick:l[0]||(l[0]=(...t)=>e.unlinkCommand&&e.unlinkCommand(...t))})])):(i(),a("span",O,"не связан"))])):n("",!0),o("div",z,[d(o("textarea",{style:{"min-height":"200px"},class:"form-control font-12",id:"commandForm-pre-text-"+e.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":l[1]||(l[1]=t=>e.commandForm.pre_text=t),required:""},`

            `,8,P),[[_,e.commandForm.pre_text]]),o("label",{for:"commandForm-pre-text-"+e.commandForm.id,class:"font-12"},"Текст диалога",8,M)]),o("div",L,[o("div",B,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=t=>e.commandForm.is_empty=t),id:"need-empty-dialog",checked:""},null,512),[[p,e.commandForm.is_empty]]),G])]),e.commandForm.is_empty?n("",!0):(i(),a("div",S,[d(o("textarea",{style:{"min-height":"200px"},class:"form-control font-12",id:"commandForm-post-text-"+e.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":l[3]||(l[3]=t=>e.commandForm.post_text=t),required:""},`
            `,8,I),[[_,e.commandForm.post_text]]),o("label",{for:"commandForm-post-text-"+e.commandForm.id,class:"font-12"},"Текст после успешного завершения диалога",8,N)])),e.commandForm.is_empty?n("",!0):(i(),a("div",T,[d(o("textarea",{style:{"min-height":"200px"},class:"form-control font-12",id:"commandForm-error-text-"+e.commandForm.id,placeholder:"Начни с малого...","onUpdate:modelValue":l[4]||(l[4]=t=>e.commandForm.error_text=t),required:""},`
            `,8,q),[[_,e.commandForm.error_text]]),o("label",{for:"commandForm-error-text-"+e.commandForm.id,class:"font-12"},"Текст на случай ошибки корректности данных",8,K)])),e.commandForm.is_empty?n("",!0):(i(),a("div",Y,[o("div",E,[d(o("select",{id:"next-dialog-select",class:"form-select form-control font-12","onUpdate:modelValue":l[5]||(l[5]=t=>e.commandForm.input_pattern=t)},[(i(!0),a(r,null,c(e.expressions,t=>(i(),a("option",{value:t.expression},m(t.description||"-"),9,R))),256))],512),[[k,e.commandForm.input_pattern]]),o("label",{class:"form-label font-12",for:"commandForm-result-channel-"+e.commandForm.id},"Регулярное выражение для автоматической проверки данных ",8,A)]),o("div",H,[d(o("input",{id:"custom-regular-expression"+e.commandForm.id,type:"text",class:"form-control",placeholder:"Регулярное выражение","aria-label":"Регулярное выражение","onUpdate:modelValue":l[6]||(l[6]=t=>e.commandForm.input_pattern=t),maxlength:"255","aria-describedby":"commandForm-input-pattern"},null,8,J),[[_,e.commandForm.input_pattern]]),o("label",{for:"custom-regular-expression"+e.commandForm.id,class:"font-12"},"или впишите своё",8,Q)])])),e.commandForm.is_empty?n("",!0):(i(),a("div",W,[o("select",{id:"next-dialog-select"+e.commandForm.id,class:"form-select form-control font-12","aria-label":"Default select example"},[Z,(i(!0),a(r,null,c(e.commands,(t,u)=>(i(),a("option",{value:t.id},"#"+m(t.id)+" "+m(t.pre_text||"Без текста"),9,ee))),256))],8,X),o("label",{for:"next-dialog-select"+e.commandForm.id,class:"font-12"},"Следующий диалог",8,oe)])),o("div",te,[o("div",se,[o("label",{class:"form-label",for:"commandForm-result-channel-"+e.commandForm.id},"Канал для отправки данных ",8,le),o("span",{onClick:l[7]||(l[7]=t=>e.requestChannelId("result_channel"))},ae)]),d(o("input",{type:"number",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":l[8]||(l[8]=t=>e.commandForm.result_channel=t),id:"commandForm-result-channel-"+e.commandForm.id,"aria-describedby":"bot-order-channel"},null,8,ne),[[_,e.commandForm.result_channel]])]),o("div",de,[o("div",re,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=t=>e.need_images=t),id:"need-dialog-image",checked:""},null,512),[[p,e.need_images]]),me]),o("div",ce,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[10]||(l[10]=t=>e.need_inline_keyboard=t),id:"need-dialog-menu-inline",checked:""},null,512),[[p,e.need_inline_keyboard]]),ue]),o("div",he,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[11]||(l[11]=t=>e.need_reply_keyboard=t),id:"need-dialog-menu-reply",checked:""},null,512),[[p,e.need_reply_keyboard]]),_e])]),e.need_images?(i(),a("div",pe,[ge,o("div",be,[o("label",fe,[ye,o("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:l[12]||(l[12]=(...t)=>e.onChangePhotos&&e.onChangePhotos(...t)),style:{display:"none"}},null,32)]),e.photos.length>0?(i(!0),a(r,{key:0},c(e.photos,(t,u)=>(i(),a("div",ke,[d(o("img",null,null,512),[[h,e.getPhoto(t).imageUrl]]),o("div",ve,[o("a",{onClick:y=>e.removePhoto("photos",u)},"Удалить",8,Fe)])]))),256)):n("",!0),e.commandForm.images&&s.bot?(i(!0),a(r,{key:1},c(e.commandForm.images,(t,u)=>(i(),a("div",$e,[d(o("img",null,null,512),[[h,"/images-by-bot-id/"+s.bot.id+"/"+t]]),o("div",Ce,[o("a",{onClick:y=>e.removePhoto("images",u)},"Удалить",8,De)])]))),256)):n("",!0)])])):n("",!0),e.need_inline_keyboard?(i(),a("div",we,[xe,b(v,{onSave:e.saveInlineKeyboard,modelValue:e.commandForm.inline_keyboard,"onUpdate:modelValue":l[13]||(l[13]=t=>e.commandForm.inline_keyboard=t)},null,8,["onSave","modelValue"])])):n("",!0),e.need_reply_keyboard?(i(),a("div",Ve,[Ue,b(v,{onSave:e.saveReplyKeyboard,modelValue:e.commandForm.reply_keyboard,"onUpdate:modelValue":l[14]||(l[14]=t=>e.commandForm.reply_keyboard=t)},null,8,["onSave","modelValue"])])):n("",!0),o("div",je,[Oe,d(o("select",{class:"form-control font-12","onUpdate:modelValue":l[15]||(l[15]=t=>e.commandForm.store_to=t)},[ze,(i(!0),a(r,null,c(e.store_variants,t=>(i(),a("option",{value:t.key},m(t.title||"Не указано"),9,Pe))),256))],512),[[k,e.commandForm.store_to]])]),o("div",Me,[d(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[16]||(l[16]=t=>e.need_set_flags=t),id:"need-set-flags",checked:""},null,512),[[p,e.need_set_flags]]),Le]),e.need_set_flags?(i(),a("div",Be,[Ge,(i(!0),a(r,null,c(e.flags_variants,t=>(i(),a("span",{class:D(["badge mr-2",{"bg-info text-white":e.commandForm.result_flags.indexOf(t.key)!=-1}]),onClick:u=>e.selectFlag(t)},m(t.title),11,Se))),256))])):n("",!0),o("button",Ie,[e.commandForm.id?(i(),a("span",Ne,"Обновить диалог")):(i(),a("span",Te,"Добавить диалог"))]),e.commandForm.id?(i(),a("div",qe)):n("",!0),e.commandForm.id?(i(),a("a",{key:10,onClick:l[17]||(l[17]=(...t)=>e.removeCommand&&e.removeCommand(...t)),title:"Удаление команды",class:"btn btn-m btn-full mb-2 rounded-xs text-uppercase font-900 shadow-s bg-red2-dark"},[Ke,g(" Удалить диалог ")])):n("",!0)],32)}}});const Ee=["data-bs-target"],Re={class:"badge bg-primary mr-2"},Ae={class:"mb-0",style:{"line-height":"100%","font-size":"10px","text-align":"left"}},He=["id"],Je={class:"modal-dialog modal-fullscreen"},Qe={class:"modal-content"},We=o("div",{class:"modal-header"},[o("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Редактор"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Xe={class:"modal-body"},Ze={props:["item","bot"],data(){return{showMenu:!1}},methods:{selectDialog(){this.$emit("select",this.item)}}},eo=Object.assign(Ze,{__name:"DialogCommandCard",setup(s){return(e,l)=>(i(),a(r,null,[o("div",{"data-bs-toggle":"modal","data-bs-target":"#open-dialog-editor-"+s.item.id,class:"btn d-flex justify-content-start align-items-start",type:"button"},[o("span",Re,"#"+m(s.item.id),1),o("p",Ae,m(s.item.pre_text||"Нет команды"),1)],8,Ee),o("div",{class:"modal fade",id:"open-dialog-editor-"+s.item.id,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[o("div",Je,[o("div",Qe,[We,o("div",Xe,[b($,{bot:s.bot,item:s.item},null,8,["bot","item"])])])])],8,He)],64))}}),oo={key:0,class:"list-group"},to={class:"list-group-item p-2"},so={key:1},lo={key:1,class:"row"},io=o("div",{class:"col-12"},[o("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет созданных диалоговых групп ")],-1),ao=[io],no={class:"modal fade",id:"create-bot-dialog",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ro={class:"modal-dialog modal-fullscreen"},mo={class:"modal-content"},co=o("div",{class:"modal-header"},[o("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Редактор"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),uo={class:"modal-body"},ho=o("button",{style:{"z-index":"100",bottom:"10px"},type:"button","data-bs-toggle":"modal","data-bs-target":"#create-bot-dialog",class:"btn btn-primary p-3 w-100 my-2 position-sticky"},[o("i",{class:"fa-regular fa-comment-dots mr-2"}),g("Создать новый диалог ")],-1),_o={props:["bot"],data(){return{needCreate:!1,loading:!0,dialog_groups:[],search:null,link:null,group:null}},computed:{...F(["getDialogs","getDialogsPaginateObject"]),filteredCommands(){return this.link?this.dialog_groups.find(e=>e.id===this.link.group_id).bot_dialog_commands.filter(e=>e.id!=this.link.id):[]}},mounted(){this.loadGroups()},methods:{loadGroups(s=0){this.loading=!0,this.$store.dispatch("loadDialogs",{dataObject:{search:this.search},page:s}).then(e=>{this.loading=!1,this.dialog_groups=this.getDialogs,this.dialog_groups_paginate_object=this.getDialogsPaginateObject}).catch(()=>{this.loading=!1})}}},po=Object.assign(_o,{__name:"BotDialogGroupList",setup(s){return(e,l)=>(i(),a(r,null,[e.dialog_groups.length>0?(i(!0),a(r,{key:0},c(e.dialog_groups,(h,t)=>(i(),a("div",null,[h.bot_dialog_commands.length>0?(i(),a("ul",oo,[(i(!0),a(r,null,c(h.bot_dialog_commands,(u,y)=>(i(),a("li",to,[s.bot?(i(),f(eo,{key:0,bot:s.bot,onCallback:e.loadGroups,item:u},null,8,["bot","onCallback","item"])):n("",!0)]))),256))])):(i(),a("p",so,"Диалоговых скриптов не найдено"))]))),256)):(i(),a("div",lo,ao)),o("div",no,[o("div",ro,[o("div",mo,[co,o("div",uo,[s.bot?(i(),f($,{key:0,onCallback:e.loadGroups,bot:s.bot},null,8,["onCallback","bot"])):n("",!0)])])])]),ho],64))}}),go={class:"container py-3"},bo={class:"row"},fo={class:"col-12"},yo={data(){return{load:!1,bot:null}},mounted(){this.loadBotAdminConfig()},methods:{loadBotAdminConfig(){this.$store.dispatch("loadBotAdminConfig").then(s=>{this.bot=s.data})}}},wo=Object.assign(yo,{__name:"Dialogs",setup(s){return(e,l)=>(i(),a("div",go,[o("div",bo,[o("div",fo,[e.load?n("",!0):(i(),f(po,{key:0,bot:e.bot},null,8,["bot"]))])])]))}});export{wo as default};
