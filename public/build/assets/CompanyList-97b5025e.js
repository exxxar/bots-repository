import{L as F,q as l,t as n,v as e,P as L,y as _,H as h,T as V,J as b,D as p,A as r,F as y,C as g,R as I,x as C,B as f,O as v,Y as w,K as U,G as j}from"./index.es-560b785d.js";import{P as q}from"./Pagination-87b6f08b.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";const M={props:["company"],data(){return{locations:[],deletedLocations:[],locationForm:{id:null,lat:null,lon:null,address:null,description:null,location_channel:null,can_booking:!1,photos:[],company_id:null}}},mounted(){this.loadLocationsByCompany()},methods:{loadLocationsByCompany(){this.$store.dispatch("loadLocationsByCompany",{companyId:this.company.id}).then(o=>{this.locations=o||[]}).catch(()=>{})},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.locationForm.photos.splice(o,1)},removeItem(o){this.locations[o].id!=null&&this.deletedLocations.push(this.locations[o].id),this.locations.splice(o,1)},submitLocations(){this.locations.forEach(o=>{let s=new FormData;if(Object.keys(o).forEach(t=>{const d=o[t]||"";typeof d=="object"?s.append(t,JSON.stringify(d)):s.append(t,d)}),o.photos){for(let t=0;t<o.photos.length;t++)s.append("files[]",o.photos[t]);s.delete("photos")}this.deletedLocations.length>0&&s.append("deleted_locations",JSON.stringify(this.deletedLocations)),this.$store.dispatch("createLocation",{locationForm:s}).then(t=>{this.$emit("callback"),this.$notify("Локация успешно созадана и сохранена")}).catch(t=>{})})},selectLocation(o){this.locationForm=o},submitLocation(){this.locationForm.company_id=this.company.id,this.locations.push(this.locationForm),this.$notify("Локация успешно добавлена в список. Не забудьте сохранить"),this.locationForm={id:null,lat:null,lon:null,address:null,description:null,location_channel:null,can_booking:!1,photos:[]}},onChangePhotos(o){const s=o.target.files;for(let t=0;t<s.length;t++)this.locationForm.photos.push(s[t])}}},B={class:"card"},z={class:"card-body"},S={class:"row"},D={class:"col-md-8"},E={class:"row"},A={class:"col-12"},N={class:"form-check"},T=e("label",{class:"form-check-label",for:"flexCheckDefault"}," Можно бронировать столик ",-1),x={class:"col-12"},R={class:"mb-3"},J=e("label",{class:"form-label",id:"location-address"},[p(" Адрес заведения "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),G={class:"row"},Z={class:"col-md-6 col-12"},H={class:"mb-3"},K=e("label",{class:"form-label",id:"location-lat"},[p(" Широта "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),Y={class:"col-md-6 col-12"},Q={class:"mb-3"},W=e("label",{class:"form-label",id:"location-lon"},[p(" Долгота "),e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно")],-1),X={class:"row"},ee={class:"col-12"},se={class:"mb-3"},te={class:"form-label",id:"location-description"},oe=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),le={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},ne={class:"row"},ie={class:"col-12 mb-3"},ae=e("h6",null,"Фотографии локаций",-1),de={class:"photo-preview d-flex justify-content-start flex-wrap w-100"},ce={for:"location-photos",style:{"margin-right":"10px"},class:"photo-loader ml-2 text-primary"},re=e("span",null,"+",-1),me={class:"mb-2 img-preview",style:{"margin-right":"10px"}},he={class:"remove"},pe=["onClick"],ue={class:"row"},_e={class:"col-12"},be={class:"btn btn-outline-success w-100",type:"submit"},ye={key:0},ge={key:1},ve={class:"col-md-4 mt-3"},fe=["onClick"],ke={class:"card-header d-flex justify-content-between"},Ce={key:0,class:"badge bg-success"},Fe=["onClick"],$e={class:"card-body"},we={key:0},Le={key:1},Ue={key:2,class:"w-100 d-flex"},Pe={class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ve={key:3,class:"w-100 d-flex"},Ie={class:"mb-2 img-preview",style:{"margin-right":"10px"}},je={class:"row mt-2"},qe={class:"col-12"},Oe=["disabled"];function Me(o,s,t,d,c,u){const i=F("mask"),m=F("lazy");return l(),n("div",B,[e("div",z,[e("div",S,[e("div",D,[e("form",{onSubmit:s[6]||(s[6]=L((...a)=>u.submitLocation&&u.submitLocation(...a),["prevent"]))},[e("h6",null,"Локации к компании #"+_(t.company.title||"Не установлен"),1),e("div",E,[e("div",A,[e("div",N,[h(e("input",{class:"form-check-input","onUpdate:modelValue":s[0]||(s[0]=a=>c.locationForm.can_booking=a),type:"checkbox",value:"false",id:"flexCheckDefault"},null,512),[[V,c.locationForm.can_booking]]),T])]),e("div",x,[e("div",R,[J,h(e("input",{type:"text",class:"form-control",placeholder:"Адрес","aria-label":"Адрес",maxlength:"255","onUpdate:modelValue":s[1]||(s[1]=a=>c.locationForm.address=a),"aria-describedby":"location-address",required:""},null,512),[[b,c.locationForm.address]])])])]),e("div",G,[e("div",Z,[e("div",H,[K,h(e("input",{type:"text",class:"form-control",placeholder:"##.######","aria-label":"Широта",maxlength:"255","onUpdate:modelValue":s[2]||(s[2]=a=>c.locationForm.lat=a),"aria-describedby":"location-lat",required:""},null,512),[[i,"##.######"],[b,c.locationForm.lat]])])]),e("div",Y,[e("div",Q,[W,h(e("input",{type:"text",class:"form-control",placeholder:"##.######","aria-label":"Долгота",maxlength:"255","onUpdate:modelValue":s[3]||(s[3]=a=>c.locationForm.lon=a),"aria-describedby":"location-lon",required:""},null,512),[[i,"##.######"],[b,c.locationForm.lon]])])])]),e("div",X,[e("div",ee,[e("div",se,[e("label",te,[p(" Описание локации "),oe,c.locationForm.description?(l(),n("small",le," Длина текста "+_(c.locationForm.description.length),1)):r("",!0)]),h(e("textarea",{type:"text",class:"form-control",placeholder:"Описание локации","aria-label":"Описание локации",maxlength:"255","onUpdate:modelValue":s[4]||(s[4]=a=>c.locationForm.description=a),"aria-describedby":"location-description",required:""},`
                    `,512),[[b,c.locationForm.description]])])])]),e("div",ne,[e("div",ie,[ae,e("div",de,[e("label",ce,[re,e("input",{type:"file",id:"location-photos",multiple:"",accept:"image/*",onChange:s[5]||(s[5]=(...a)=>u.onChangePhotos&&u.onChangePhotos(...a)),style:{display:"none"}},null,32)]),c.locationForm.photos?(l(!0),n(y,{key:0},g(c.locationForm.photos,(a,$)=>(l(),n("div",me,[h(e("img",null,null,512),[[m,u.getPhoto(a).imageUrl]]),e("div",he,[e("a",{onClick:k=>u.removePhoto($)},"Удалить",8,pe)])]))),256)):r("",!0)])])]),e("div",ue,[e("div",_e,[e("button",be,[c.locationForm.id?(l(),n("span",ye,"Обновить расположение")):(l(),n("span",ge,"Добавить расположение"))])])])],32)]),c.locations?(l(!0),n(y,{key:0},g(c.locations,(a,$)=>(l(),n("div",ve,[e("div",{class:"card",onClick:k=>u.selectLocation(a)},[e("div",ke,[e("h6",null,[p("Адрес локации "),e("strong",null,_(a.address||"Не указано"),1),p(" (ш:"+_(a.lat)+",д:"+_(a.lon)+") ",1),a.can_booking?(l(),n("span",Ce,"Можно забронировать столик")):r("",!0)]),e("a",{class:"cursor-pointer",onClick:k=>u.removeItem($)},"Удалить",8,Fe)]),e("div",$e,[a.location_channel?(l(),n("p",we,[p("Канал заведения "),e("strong",null,_(a.location_channel),1)])):r("",!0),e("p",null,_(a.description||"Не указано"),1),a.photos?(l(),n("h6",Le,"Фотографии локаций")):r("",!0),a.photos?(l(),n("div",Ue,[a.photos.length>0?(l(!0),n(y,{key:0},g(a.photos,(k,P)=>(l(),n("div",Pe,[h(e("img",null,null,512),[[m,u.getPhoto(k).imageUrl]])]))),256)):r("",!0)])):r("",!0),a.images?(l(),n("div",Ve,[a.images.length>0?(l(!0),n(y,{key:0},g(a.images,(k,P)=>(l(),n("div",Ie,[h(e("img",null,null,512),[[m,"/images-by-company-id/"+t.company.id+"/"+k]])]))),256)):r("",!0)])):r("",!0)])],8,fe)]))),256)):r("",!0)]),e("div",je,[e("div",qe,[e("button",{onClick:s[7]||(s[7]=(...a)=>u.submitLocations&&u.submitLocations(...a)),disabled:c.locations.length===0&&c.deletedLocations.length===0,class:"btn btn-success p-3 w-100"}," Сохранить локации клиента ",8,Oe)])])])])}const Be=O(M,[["render",Me]]);const ze={key:0,class:"row mb-2"},Se={class:"col-12"},De={key:1,class:"row mb-2"},Ee={class:"col-12"},Ae={class:"btn-group w-100",role:"group","aria-label":"Basic outlined example"},Ne={class:"row"},Te=e("div",{class:"col-12"},[e("h4",null,"Системное")],-1),xe={class:"col-12 mb-3"},Re={class:"form-label",id:"company-title"},Je=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ge=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Ze={class:"col-12 mb-3"},He={class:"form-label",id:"company-title"},Ke=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),Ye=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),Qe=["value"],We={class:"col-12 mb-3"},Xe={class:"form-label",id:"company-title"},es=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ss=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),ts=["value"],os={class:"col-12"},ls={class:"mb-3"},ns={class:"form-label",id:"company-slug"},is=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),as=e("div",null,[p("Название компании на АНГЛИЙСКОМ"),e("br"),p(" без пробелов! можно использовать _"),e("br"),p(" Должно быть уникальным! Не отображается пользователю. ")],-1),ds=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),cs={class:"col-12"},rs={class:"mb-3"},ms={class:"form-label",id:"company-description"},hs=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),ps=e("div",null,'Добавится в раздел "О Нас"',-1),us=e("span",{class:"badge rounded-pill text-bg-danger m-0"},"Нужно",-1),_s={key:0,class:"text-gray-400 ml-3",style:{"font-size":"10px"}},bs={class:"col-12"},ys={class:"mb-3"},gs={class:"form-label",id:"company-address"},vs=e("i",{class:"fa-regular fa-circle-question mr-1"},null,-1),fs=e("div",null,[p("Где находится главное заведение компании!"),e("br"),p('Можно не указывать, т.к. есть еще "Локации" ')],-1),ks={class:"col-12"},Cs={class:"mb-3"},Fs=e("label",{class:"form-label",id:"company-email"},"Основная почта компании",-1),$s={class:"col-12"},ws={class:"mb-3"},Ls=e("label",{class:"form-label",id:"company-manager"},"Менеджер компании",-1),Us={class:"col-12"},Ps={class:"card mb-3"},Vs=e("div",{class:"card-header"},[e("h6",null,[p("Логотип компании "),e("span",{class:"badge rounded-pill text-bg-warning m-0"},"Желательно")])],-1),Is={class:"card-body d-flex justify-content-start"},js={for:"photos",style:{"margin-right":"10px"},class:"photo-loader text-primary ml-2"},qs={key:0,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Os={class:"remove"},Ms=e("i",{class:"fa-regular fa-trash-can"},null,-1),Bs=[Ms],zs={key:1,class:"mb-2 img-preview",style:{"margin-right":"10px"}},Ss={class:"remove"},Ds=e("i",{class:"fa-regular fa-trash-can"},null,-1),Es=[Ds],As={class:"col-12"},Ns={class:"card mb-3"},Ts=e("div",{class:"card-header"},[e("h6",null,"Телефонные номера")],-1),xs={class:"card-body"},Rs=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Телефонный номер")])],-1),Js={class:"col-10"},Gs={class:"mb-3"},Zs=["onUpdate:modelValue","aria-describedby"],Hs={class:"col-2"},Ks=["onClick"],Ys=e("i",{class:"fa-regular fa-trash-can"},null,-1),Qs=[Ys],Ws={class:"row"},Xs={class:"col-12"},et={class:"col-12"},st={class:"card mb-3"},tt=e("div",{class:"card-header"},[e("h6",null,"Ссылки на соц. сети")],-1),ot={class:"card-body"},lt=e("div",{class:"row"},[e("div",{class:"col-12"},[e("h6",null,"Ссылка")])],-1),nt={class:"col-10"},it={class:"mb-3"},at=["onUpdate:modelValue","aria-describedby"],dt={class:"col-2"},ct=["onClick"],rt=e("i",{class:"fa-regular fa-trash-can"},null,-1),mt=[rt],ht={class:"row"},pt={class:"col-12"},ut={class:"col-12"},_t={class:"card mb-3"},bt=e("div",{class:"card-header"},[e("h6",null,"График работы")],-1),yt={class:"card-body"},gt={class:"row"},vt={class:"col-12 d-flex justify-content-between align-items-center"},ft=e("h6",null,"День недели ",-1),kt={class:"col-10"},Ct={class:"mb-3"},Ft=["onUpdate:modelValue","aria-describedby"],$t={class:"col-2"},wt=["onClick"],Lt=e("i",{class:"fa-regular fa-trash-can"},null,-1),Ut=[Lt],Pt={class:"row"},Vt={class:"col-12"},It=["disabled"],jt={class:"row"},qt={class:"col-12"},Ot={type:"submit",class:"btn btn-outline-success w-100 p-3"},Mt={key:0},Bt={key:1},zt={key:3},St={props:["company","editor"],data(){return{step:0,load:!1,photo:null,removedImage:null,need_reset:!1,vat_codes:[{id:1,title:"Общая система налогообложения"},{id:2,title:"Упрощенная (УСН, доходы)"},{id:3,title:"Упрощенная (УСН, доходы минус расходы)"},{id:4,title:"Единый налог на вмененный доход (ЕНВД)"},{id:5,title:"Единый сельскохозяйственный налог (ЕСН)"},{id:6,title:"Патентная система налогообложения"}],business_form_categories:[{id:0,title:"Физическое-лицо"},{id:1,title:"Самозанятый"},{id:2,title:"Индивидуальный предприниматель (ИП)"},{id:3,title:"Общество с ограниченной ответственностью (ООО)"},{id:4,title:"Акционерное общество (АО)"},{id:5,title:"Полное товарищество (ПТ)"},{id:6,title:"Товарищество на вере (ТНВ)"},{id:7,title:"Производственный кооператив (ПК)"},{id:8,title:"Государственное унитарное предприятие (ГУП)"},{id:9,title:"Муниципальное унитарное предприятие (МУП)"}],companyForm:{id:null,title:null,slug:null,description:null,address:null,business_form:null,phones:[""],links:[""],law_params:{},email:null,vat_code:1,schedule:[],manager:null}}},watch:{companyForm:{handler(o){this.need_reset=!0},deep:!0}},mounted(){this.companyForm.law_params.bank_card="1234",this.companyForm.law_params.phisical_adress="1234",this.company&&this.$nextTick(()=>{this.companyForm={id:this.company.id||null,title:this.company.title||null,slug:this.company.slug||null,image:this.company.image||null,description:this.company.description||null,address:this.company.address||null,phones:this.company.phones||[""],links:this.company.links||[""],email:this.company.email||null,vat_code:this.company.vat_code||1,schedule:this.company.schedule||[],manager:this.company.manager||null}})},methods:{resetForm(){this.photo=null,this.removedImage=null,this.companyForm={id:null,title:null,slug:null,description:null,address:null,phones:[""],links:[""],email:null,schedule:[],manager:null,vat_code:1},this.$nextTick(()=>{this.need_reset=!1})},getPhoto(){return{imageUrl:URL.createObjectURL(this.photo)}},onChangePhotos(o){const s=o.target.files;this.photo=s[0],this.companyForm.image=null},schedulePlaceholder(){this.companyForm.schedule.length>0?this.companyForm.schedule=[]:this.companyForm.schedule=["Понедельник - с 8:00 до 20:00","Вторник - с 8:00 до 20:00","Среда - с 8:00 до 20:00","Четверг - с 8:00 до 20:00","Пятница - с 8:00 до 20:00","Суббота - с 8:00 до 20:00","Воскресенье - выходной"]},removeCompanyImage(){this.removedImage=this.companyForm.image,this.companyForm.image=null},addItem(o){this.companyForm[o].push("")},removeItem(o,s){this.companyForm[o].splice(s,1)},submitForm(){let o=new FormData;Object.keys(this.companyForm).forEach(s=>{const t=this.companyForm[s]||"";typeof t=="object"?o.append(s,JSON.stringify(t)):o.append(s,t)}),o.append("company_logo",this.photo),this.removedImage!=null&&o.append("removed_image",this.removedImage),this.$store.dispatch(this.companyForm.id===null?"createCompany":"updateCompany",{companyForm:o}).then(s=>{this.$emit("callback",s.data),this.$notify("Компания успешно создана")}).catch(s=>{})}}},Dt=Object.assign(St,{__name:"CompanyForm",setup(o){return(s,t)=>{const d=I("Popper"),c=F("lazy"),u=F("mask");return l(),n(y,null,[s.need_reset&&!o.editor?(l(),n("div",ze,[e("div",Se,[e("button",{type:"button",onClick:t[0]||(t[0]=(...i)=>s.resetForm&&s.resetForm(...i)),class:"btn btn-outline-danger"},"Новый клиент \\ очистка формы ")])])):r("",!0),o.editor?(l(),n("div",De,[e("div",Ee,[e("div",Ae,[e("button",{type:"button",class:C([{"btn-primary border-white text-white":s.step===0},"btn btn-outline-primary"]),onClick:t[1]||(t[1]=i=>s.step=0)},"Информация о компании ",2),e("button",{type:"button",class:C([{"btn-primary border-white text-white":s.step===1},"btn btn-outline-primary"]),onClick:t[2]||(t[2]=i=>s.step=1)},"Информация о расположении ",2)])])])):r("",!0),s.step===0?(l(),n("form",{key:2,onSubmit:t[18]||(t[18]=L((...i)=>s.submitForm&&s.submitForm(...i),["prevent"]))},[e("div",Ne,[Te,e("div",xe,[e("label",Re,[f(d,{content:"Название вашей компании"},{default:v(()=>[Je]),_:1}),p(" Название компании "),Ge]),h(e("input",{type:"text",class:"form-control",placeholder:"Название","aria-label":"Название","onUpdate:modelValue":t[3]||(t[3]=i=>s.companyForm.title=i),maxlength:"255","aria-describedby":"company-title",required:""},null,512),[[b,s.companyForm.title]])]),e("div",Ze,[e("label",He,[f(d,{content:"Тип налогообложения вашей компании"},{default:v(()=>[Ke]),_:1}),p(" Тип налогообложения "),Ye]),h(e("select",{type:"text",class:"form-control","aria-label":"Выберите налогообложения","onUpdate:modelValue":t[4]||(t[4]=i=>s.companyForm.vat_code=i),"aria-describedby":"company-vat-code",required:""},[(l(!0),n(y,null,g(s.vat_codes,(i,m)=>(l(),n("option",{value:i.id},_(i.title||"Не указано"),9,Qe))),256))],512),[[w,s.companyForm.vat_code]])]),e("div",We,[e("label",Xe,[f(d,{content:"Тип налогообложения вашей компании"},{default:v(()=>[es]),_:1}),p(" Вид организационно-правовой формы предприятия "),ss]),h(e("select",{type:"text",class:"form-control","aria-label":"Выберите тип организационно-правовой формы предприятия","onUpdate:modelValue":t[5]||(t[5]=i=>s.companyForm.business_form=i),"aria-describedby":"company-business-form-categories",required:""},[(l(!0),n(y,null,g(s.business_form_categories,(i,m)=>(l(),n("option",{value:i.id},_(i.title||"Не указано"),9,ts))),256))],512),[[w,s.companyForm.business_form]])]),e("div",os,[e("div",ls,[e("label",ns,[f(d,null,{content:v(()=>[as]),default:v(()=>[is]),_:1}),p(" Название компании латиницей (домен компании) "),ds]),h(e("input",{type:"text",class:"form-control",placeholder:"Мнемоническое имя","aria-label":"Мнемоническое имя",pattern:"^[a-zA-Z][a-zA-Z0-9-_]{1,40}$","onUpdate:modelValue":t[6]||(t[6]=i=>s.companyForm.slug=i),maxlength:"255","aria-describedby":"company-slug",required:""},null,512),[[b,s.companyForm.slug]])])]),e("div",cs,[e("div",rs,[e("label",ms,[f(d,null,{content:v(()=>[ps]),default:v(()=>[hs]),_:1}),p(" Описание компании "),us,s.companyForm.description?(l(),n("small",_s," Длина текста "+_(s.companyForm.description.length),1)):r("",!0)]),h(e("textarea",{type:"text",class:"form-control",placeholder:"Описание компании","aria-label":"Описание компании","onUpdate:modelValue":t[7]||(t[7]=i=>s.companyForm.description=i),"aria-describedby":"company-description",required:""},`
                                    `,512),[[b,s.companyForm.description]])])]),e("div",bs,[e("div",ys,[e("label",gs,[f(d,null,{content:v(()=>[fs]),default:v(()=>[vs]),_:1}),p(" Основной адрес компании")]),h(e("input",{type:"text",class:"form-control",placeholder:"Адрес","aria-label":"Адрес",maxlength:"255","onUpdate:modelValue":t[8]||(t[8]=i=>s.companyForm.address=i),"aria-describedby":"company-address"},null,512),[[b,s.companyForm.address]])])]),e("div",ks,[e("div",Cs,[Fs,h(e("input",{type:"email",class:"form-control",placeholder:"Почтовый адрес","aria-label":"Почтовый адрес",maxlength:"255","onUpdate:modelValue":t[9]||(t[9]=i=>s.companyForm.email=i),"aria-describedby":"company-email"},null,512),[[b,s.companyForm.email]])])]),e("div",$s,[e("div",ws,[Ls,h(e("input",{type:"text",class:"form-control",placeholder:"Имя менеджера","aria-label":"Имя менеджера","onUpdate:modelValue":t[10]||(t[10]=i=>s.companyForm.manager=i),maxlength:"255","aria-describedby":"company-manager"},null,512),[[b,s.companyForm.manager]])])]),e("div",Us,[e("div",Ps,[Vs,e("div",Is,[e("label",js,[p(" + "),e("input",{type:"file",id:"photos",accept:"image/*",onChange:t[11]||(t[11]=(...i)=>s.onChangePhotos&&s.onChangePhotos(...i)),style:{display:"none"}},null,32)]),s.photo?(l(),n("div",qs,[h(e("img",null,null,512),[[c,s.getPhoto().imageUrl]]),e("div",Os,[e("a",{onClick:t[12]||(t[12]=i=>s.photo=null)},Bs)])])):r("",!0),s.companyForm.image?(l(),n("div",zs,[h(e("img",null,null,512),[[c,"/images/"+s.companyForm.slug+"/"+s.companyForm.image]]),e("div",Ss,[e("a",{onClick:t[13]||(t[13]=(...i)=>s.removeCompanyImage&&s.removeCompanyImage(...i))},Es)])])):r("",!0)])])]),e("div",As,[e("div",Ns,[Ts,e("div",xs,[Rs,(l(!0),n(y,null,g(s.companyForm.phones,(i,m)=>(l(),n("div",{class:"row",key:"phone"+m},[e("div",Js,[e("div",Gs,[h(e("input",{type:"text",class:"form-control",placeholder:"+7(000)000-00-00","aria-label":"Номер телефона",maxlength:"255","onUpdate:modelValue":a=>s.companyForm.phones[m]=a,"aria-describedby":"company-phone-"+m},null,8,Zs),[[u,"+7(###)###-##-##"],[b,s.companyForm.phones[m]]])])]),e("div",Hs,[e("button",{type:"button",onClick:a=>s.removeItem("phones",m),class:"btn btn-outline-danger w-100"},Qs,8,Ks)])]))),128)),e("div",Ws,[e("div",Xs,[e("button",{type:"button",onClick:t[14]||(t[14]=i=>s.addItem("phones")),class:"btn btn-outline-success w-100"},"Добавить еще номер ")])])])])]),e("div",et,[e("div",st,[tt,e("div",ot,[lt,(l(!0),n(y,null,g(s.companyForm.links,(i,m)=>(l(),n("div",{class:"row",key:"link"+m},[e("div",nt,[e("div",it,[h(e("input",{type:"text",class:"form-control",placeholder:"Ссылка на соц.сеть","aria-label":"Ссылка на соц.сеть",maxlength:"255","onUpdate:modelValue":a=>s.companyForm.links[m]=a,"aria-describedby":"company-link-"+m},null,8,at),[[b,s.companyForm.links[m]]])])]),e("div",dt,[e("button",{type:"button",onClick:a=>s.removeItem("links",m),class:"btn btn-outline-danger w-100"},mt,8,ct)])]))),128)),e("div",ht,[e("div",pt,[e("button",{type:"button",onClick:t[15]||(t[15]=i=>s.addItem("links")),class:"btn btn-outline-success w-100"},"Добавить еще ссылку ")])])])])]),e("div",ut,[e("div",_t,[bt,e("div",yt,[e("div",gt,[e("div",vt,[ft,e("a",{class:"btn btn-link",onClick:t[16]||(t[16]=(...i)=>s.schedulePlaceholder&&s.schedulePlaceholder(...i))},"Заполнить\\очистить")])]),(l(!0),n(y,null,g(s.companyForm.schedule,(i,m)=>(l(),n("div",{class:"row",key:"link"+m},[e("div",kt,[e("div",Ct,[h(e("input",{type:"text",class:"form-control",placeholder:"День недели и время работы","aria-label":"День недели и время работы",maxlength:"255","onUpdate:modelValue":a=>s.companyForm.schedule[m]=a,"aria-describedby":"company-schedule-"+m},null,8,Ft),[[b,s.companyForm.schedule[m]]])])]),e("div",$t,[e("button",{type:"button",onClick:a=>s.removeItem("schedule",m),class:"btn btn-outline-danger w-100"},Ut,8,wt)])]))),128)),e("div",Pt,[e("div",Vt,[e("button",{type:"button",disabled:s.companyForm.schedule.length===7,onClick:t[17]||(t[17]=i=>s.addItem("schedule")),class:"btn btn-outline-success w-100"},"Добавить еще время работы ",8,It)])])])])])]),e("div",jt,[e("div",qt,[e("button",Ot,[s.companyForm.id===null?(l(),n("span",Mt,"Создать компанию")):(l(),n("span",Bt,"Обновить компанию"))])])])],32)):r("",!0),s.step===1?(l(),n("div",zt,[o.company&&!s.load?(l(),U(Be,{key:0,company:o.company},null,8,["company"])):r("",!0)])):r("",!0)],64)}}}),Et={key:0},At={class:"row"},Nt={class:"d-flex"},Tt={class:"dropdown mr-2"},xt=e("button",{class:"btn btn-outline-primary dropdown-toggle",type:"button",id:"dropdownMenuButton1","data-bs-toggle":"dropdown","aria-expanded":"false"}," Фильтры ",-1),Rt={class:"dropdown-menu","aria-labelledby":"dropdownMenuButton1"},Jt=["onClick"],Gt={class:"input-group mb-3"},Zt={key:0,class:"mt-2"},Ht={class:"badge bg-info mr-1"},Kt=["onClick"],Yt=e("i",{class:"fa-solid fa-xmark"},null,-1),Qt=[Yt],Wt={key:0,class:"row"},Xt={class:"col-12 mb-3"},eo={class:"list-group w-100"},so=["onClick"],to=["onClick"],oo=e("i",{class:"fa-solid fa-pen-to-square"},null,-1),lo=[oo],no=["onClick"],io=e("i",{class:"fa-solid fa-boxes-packing"},null,-1),ao=[io],co=["onClick"],ro=e("i",{class:"fa-solid fa-box-open"},null,-1),mo=[ro],ho={class:"col-12"},po={class:"modal fade",id:"edit-company-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},uo={class:"modal-dialog modal-lg"},_o={class:"modal-content"},bo=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Сохранение клиента"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),yo={class:"modal-body"},go={key:0,class:"row"},vo={class:"col-12 mb-2"},fo=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Не сохранять")],-1),ko={props:["selected"],data(){return{show:!0,loading:!0,companies:[],search:null,editCompanyModal:null,filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],companies_paginate_object:null,selectedCompany:null}},computed:{...j(["getCompanies","getCompaniesPaginateObject"]),filteredCompanies(){if(!this.companies)return[];if(this.selectedFilters.length===0&&this.search==null)return this.companies;if(this.selectedFilters.length===0&&this.search!=null)return this.companies.filter(s=>(s.title||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let o=[];return this.selectedFilters.forEach(s=>{switch(s.slug){case"active":this.companies.filter(t=>t.deleted_at==null).forEach(t=>{o.push(t)});break;case"archive":this.companies.filter(t=>t.deleted_at!=null).forEach(t=>{o.push(t)});break}}),this.search==null?o:o.filter(s=>(s.title||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadCompanies(),this.selectFilter("active"),this.editCompanyModal=new bootstrap.Modal(document.getElementById("edit-company-modal"),{})},methods:{companyCallback(o){this.selectedCompany=null,this.editCompanyModal.hide()},editClient(o){this.selectedCompany=o,this.editCompanyModal.show()},addToArchive(o){this.$store.dispatch("removeCompany",{companyId:o}).then(s=>{let t=this.companies_paginate_object.meta.current_page||0;this.loadCompanies(t),this.$notify("Указанный клиент успешно перемещен в архив")})},extractFromArchive(o){this.$store.dispatch("restoreCompany",{companyId:o}).then(s=>{let t=this.companies_paginate_object.meta.current_page||0;this.loadCompanies(t),this.$notify("Указанный клиент успешно перемещен из архива")})},selectFilter(o){let s=this.filters.find(t=>t.slug===o);s&&this.selectedFilters.filter(t=>t.slug===o).length===0&&this.selectedFilters.push(s)},removeSelectedFilter(o){let s=this.selectedFilters.findIndex(t=>t.slug===o);this.selectedFilters.splice(s,1)},selectCompany(o){this.$store.dispatch("updateCurrentCompany",{company:o}),this.$emit("callback",o),this.show=!1,this.$notify("Вы выбрали клиента из списка! Все остальные действия будут производится для этой компании.")},nextCompanies(o){this.loadCompanies(o)},loadCompanies(o=0){this.loading=!0,this.$store.dispatch("loadCompanies",{dataObject:{search:this.search},page:o}).then(s=>{this.loading=!1,this.companies=this.getCompanies,this.companies_paginate_object=this.getCompaniesPaginateObject}).catch(()=>{this.loading=!1})}}},wo=Object.assign(ko,{__name:"CompanyList",setup(o){return(s,t)=>(l(),n(y,null,[s.show?(l(),n("div",Et,[e("div",At,[e("div",Nt,[e("div",Tt,[xt,e("ul",Rt,[(l(!0),n(y,null,g(s.filters,d=>(l(),n("li",null,[e("a",{class:"dropdown-item",onClick:c=>s.selectFilter(d.slug),href:"#filter"},[e("i",{class:C([d.icon,"mr-2"])},null,2),p(" "+_(d.name||"Не указано"),1)],8,Jt)]))),256))])]),e("div",Gt,[h(e("input",{type:"search",class:"form-control",placeholder:"Поиск компании","aria-label":"Поиск компании","onUpdate:modelValue":t[0]||(t[0]=d=>s.search=d),"aria-describedby":"button-addon2"},null,512),[[b,s.search]]),e("button",{class:"btn btn-outline-secondary",onClick:t[1]||(t[1]=(...d)=>s.loadCompanies&&s.loadCompanies(...d)),type:"button",id:"button-addon2"},"Найти ")])]),s.selectedFilters.length>0?(l(),n("p",Zt,[(l(!0),n(y,null,g(s.selectedFilters,d=>(l(),n("span",Ht,[p(_(d.name||"не указан")+" ",1),e("a",{onClick:c=>s.removeSelectedFilter(d.slug),class:"ml-1 text-white",href:"#filter"},Qt,8,Kt)]))),256))])):r("",!0)]),s.companies.length>0?(l(),n("div",Wt,[e("div",Xt,[e("ul",eo,[(l(!0),n(y,null,g(s.filteredCompanies,(d,c)=>(l(),n("li",{class:C(["list-group-item btn mb-1 d-flex justify-between",{"btn-outline-info":d.deleted_at==null,"btn-outline-danger border-danger":d.deleted_at!=null,"bg-success":o.selected==d.id}])},[e("span",{onClick:u=>s.selectCompany(d),class:C({"text-danger":d.deleted_at!=null})}," #"+_(d.id||"-")+" "+_(d.title||"Не указано")+" ("+_(d.slug||"Не указано")+") ",11,so),e("div",null,[e("button",{class:"btn btn-info mr-1",type:"button",onClick:u=>s.editClient(d),title:"В архив"},lo,8,to),d.deleted_at==null?(l(),n("button",{key:0,class:"btn btn-outline-info",type:"button",onClick:u=>s.addToArchive(d.id),title:"В архив"},ao,8,no)):r("",!0),d.deleted_at!=null?(l(),n("button",{key:1,class:"btn btn-outline-info",type:"button",onClick:u=>s.extractFromArchive(d.id),title:"Из архива"},mo,8,co)):r("",!0)])],2))),256))])]),e("div",ho,[s.companies_paginate_object?(l(),U(q,{key:0,onPagination_page:s.nextCompanies,pagination:s.companies_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])])):r("",!0)])):r("",!0),e("div",po,[e("div",uo,[e("div",_o,[bo,e("div",yo,[s.selectedCompany?(l(),n("div",go,[e("div",vo,[f(Dt,{company:s.selectedCompany,editor:!1,onCallback:s.companyCallback},null,8,["company","onCallback"])])])):r("",!0)]),fo])])])],64))}});export{Be as L,Dt as _,wo as a};
