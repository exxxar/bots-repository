import{g as c,o as d,j as m,k as p,M as l,l as t,n as a,a0 as g,W as r,$ as n,L as b,N as h}from"./index.es-db843bab.js";import{P as y}from"./ProfileCard-5d81c033.js";import"./_plugin-vue_export-helper-c27b6911.js";const U={key:0,class:"container py-3"},_=t("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#edit-profile",class:"btn btn-link w-100 py-3"},[t("i",{class:"fa-solid fa-pen-to-square mr-1"}),a(" Редактировать")],-1),F=t("h6",{class:"opacity-75 my-3"},"Ваш QR-код",-1),v={class:"img-thumbnail",alt:"..."},S=t("i",{class:"fa-solid fa-link mr-2"},null,-1),k={class:"modal fade",id:"edit-profile",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},w={class:"modal-dialog modal-fullscreen"},$=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Редактирование профиля"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),C={class:"modal-body"},V={class:"form-floating mb-2"},B=t("label",{for:""},"Ф.И.О пользователя",-1),P={class:"form-floating mb-2"},T=t("label",{for:""},"Телефон",-1),q={class:"form-floating mb-2"},X=t("label",{for:""},"Почта",-1),N={class:"form-floating mb-2"},M=t("label",{for:""},"Адрес",-1),z={class:"form-floating mb-2"},L=t("label",{for:""},"Дата рождения",-1),O={class:"form-floating mb-2"},x=t("label",{for:""},"Страна",-1),D={class:"form-floating mb-2"},j=t("label",{for:""},"Город",-1),A={class:"row mb-0"},E=t("p",{class:"col-12 my-2"},"Пол",-1),R={class:"col-6"},W=t("i",{class:"fa-solid fa-mars mr-1"},null,-1),G={class:"col-6"},J=t("i",{class:"fa-solid fa-venus mr-1"},null,-1),Q={class:"row mb-0"},H=t("p",{class:"col-12 my-2"},"Получать рассылки от бота?",-1),I={class:"col-6"},K={class:"col-6"},Y=t("div",{class:"modal-footer p-2"},[t("button",{type:"submit",class:"btn btn-primary w-100"},"Сохранить изменения")],-1),Z={data(){return{photos:null,load_self:!0,botUserForm:{id:null,name:null,phone:null,email:null,birthday:null,age:null,city:null,country:null,address:null,sex:null,config:{need_bot_mailing:!0}}}},computed:{...c(["getSelf"]),logo(){return`/images-by-bot-id/${this.currentBot.id}/${this.currentBot.image}`},self(){return this.getSelf},tg(){return window.Telegram.WebApp},tgUser(){const i=new URLSearchParams(this.tg.initData);return JSON.parse(i.get("user"))},currentBot(){return window.currentBot},qr(){return"https://api.qrserver.com/v1/create-qr-code/?size=450x450&qzone=2&data="+this.link},link(){return"https://t.me/"+this.currentBot.bot_domain+"?start="+btoa("001"+this.self.telegram_chat_id)}},watch:{getSelf:function(){var i;this.botUserForm.id=this.getSelf.id,this.botUserForm.name=this.getSelf.name||this.getSelf.username||this.getSelf.id,this.botUserForm.phone=this.getSelf.phone,this.botUserForm.email=this.getSelf.email,this.botUserForm.birthday=this.getSelf.birthday||null,this.botUserForm.city=this.getSelf.city||null,this.botUserForm.country=this.getSelf.country||null,this.botUserForm.address=this.getSelf.address||null,this.botUserForm.sex=this.getSelf.sex||!1,this.botUserForm.config.need_bot_mailing=((i=this.getSelf.config)==null?void 0:i.need_bot_mailing)||!0}},mounted(){this.tg.BackButton.show(),this.tg.BackButton.onClick(()=>{document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(i=>i.click()),this.$router.back()}),this.$nextTick(()=>{var i;this.loadUserPhotos(),this.getSelf&&(this.botUserForm.id=this.getSelf.id,this.botUserForm.name=this.getSelf.name||this.getSelf.username||this.getSelf.id,this.botUserForm.phone=this.getSelf.phone,this.botUserForm.email=this.getSelf.email,this.botUserForm.birthday=this.getSelf.birthday||null,this.botUserForm.city=this.getSelf.city||null,this.botUserForm.country=this.getSelf.country||null,this.botUserForm.address=this.getSelf.address||null,this.botUserForm.sex=this.getSelf.sex||!1,this.botUserForm.config.need_bot_mailing=((i=this.getSelf.config)==null?void 0:i.need_bot_mailing)||!0)})},methods:{copyToClipboard(){navigator.clipboard.writeText(this.link),this.$notify({title:"Реферальная ссылка",text:"Ваша ссылка успешно скопирована в буфер!"})},submitProfile(){this.$store.dispatch("updateProfile",{botUserForm:this.botUserForm}).then(()=>{this.$notify({title:"Редактирование данных",text:"Данные успешно обновлены!",type:"success"}),window.location.reload()}).catch(()=>{this.$notify({title:"Редактирование данных",text:"Ошибка обновления данных",type:"error"})})},goToFriends(){this.$router.push({name:"FriendsV2"})},goToCashback(){this.$router.push({name:"CashBackV2"})},goToOrders(){this.$router.push({name:"OrdersV2"})},loadUserPhotos(){this.$store.dispatch("getUserProfilePhotos").then(i=>{this.photos=i.photos.result.photos||null})},sendMyNumber(){this.tg.requestContact(i=>{this.$notify({title:"Профиль",text:i?"Ваш контакт успешно отправлен!":"Вы отменили отправку контакта",type:i?"success":"error"}),this.$store.dispatch("loadSelf").then(()=>{this.load_self=!1,this.$nextTick(()=>{this.load_self=!0})})})}}},st=Object.assign(Z,{__name:"Profile",setup(i){return(e,o)=>{const u=h("lazy"),f=h("mask");return e.self?(d(),m("div",U,[p(y,{data:e.self},null,8,["data"]),_,F,l(t("img",v,null,512),[[u,e.qr]]),t("button",{type:"button",onClick:o[0]||(o[0]=(...s)=>e.copyToClipboard&&e.copyToClipboard(...s)),class:"btn btn-outline-primary mt-2 w-100"},[S,a("Ваша реферальная ссылка ")]),t("div",k,[t("div",w,[e.getSelf?(d(),m("form",{key:0,class:"modal-content",onSubmit:o[12]||(o[12]=g((...s)=>e.submitProfile&&e.submitProfile(...s),["prevent"]))},[$,t("div",C,[t("div",V,[l(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>e.botUserForm.name=s),placeholder:"Иванов Иван Иванович",required:""},null,512),[[r,e.botUserForm.name]]),B]),t("div",P,[l(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>e.botUserForm.phone=s),placeholder:"+7(XXX) XXX-XX-XX",required:""},null,512),[[r,e.botUserForm.phone],[f,"+7(###)###-##-##"]]),T]),t("div",q,[l(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>e.botUserForm.email=s),placeholder:"example@gmail.com"},null,512),[[r,e.botUserForm.email]]),X]),t("div",N,[l(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[4]||(o[4]=s=>e.botUserForm.address=s),placeholder:"ул. Петрова, 123, кв 45"},null,512),[[r,e.botUserForm.address]]),M]),t("div",z,[l(t("input",{type:"date",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=s=>e.botUserForm.birthday=s),placeholder:"12/01/2023"},null,512),[[r,e.botUserForm.birthday]]),L]),t("div",O,[l(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[6]||(o[6]=s=>e.botUserForm.country=s),placeholder:"Россия"},null,512),[[r,e.botUserForm.country]]),x]),t("div",D,[l(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[7]||(o[7]=s=>e.botUserForm.city=s),placeholder:"Краснодар"},null,512),[[r,e.botUserForm.city]]),j]),t("div",A,[E,t("div",R,[t("button",{type:"button",onClick:o[8]||(o[8]=s=>e.botUserForm.sex=!0),class:n([{"btn-info text-white":e.botUserForm.sex,"btn-outline-secondary":!e.botUserForm.sex},"w-100 btn"])},[W,a(" Муж ")],2)]),t("div",G,[t("button",{type:"button",onClick:o[9]||(o[9]=s=>e.botUserForm.sex=!1),class:n([{"btn-info text-white":!e.botUserForm.sex,"btn-outline-secondary":e.botUserForm.sex},"w-100 btn"])},[J,a(" Жен ")],2)])]),t("div",Q,[H,t("div",I,[t("button",{type:"button",onClick:o[10]||(o[10]=s=>e.botUserForm.config.need_bot_mailing=!0),class:n([{"btn-info text-white":e.botUserForm.config.need_bot_mailing,"btn-outline-secondary":!e.botUserForm.config.need_bot_mailing},"w-100 btn"])}," Да ",2)]),t("div",K,[t("button",{type:"button",onClick:o[11]||(o[11]=s=>e.botUserForm.config.need_bot_mailing=!1),class:n([{"btn-info text-white":!e.botUserForm.config.need_bot_mailing,"btn-outline-secondary":e.botUserForm.config.need_bot_mailing},"w-100 btn"])}," Нет ",2)])])]),Y],32)):b("",!0)])])])):b("",!0)}}});export{st as default};
