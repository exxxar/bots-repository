import{R as F,L as v,q as s,t as n,v as t,A as r,K as x,O as k,F as h,C as p,x as C,y,H as b,J as g,a2 as T,P as S,B as M}from"./index.es-c683997f.js";import{_ as j}from"./_plugin-vue_export-helper-c27b6911.js";import{v as V}from"./v4-4a60fe23.js";const q={props:["domain"],watch:{messages:function(i){this.$nextTick(function(){var o=this.$el.querySelector("#scroll-area");o.scrollTop=o.scrollHeight+120})}},data(){return{selected_url:null,loaded:!0,canEnter:!1,messages:[],buttons:[],dataForm:{message:null,query:null,user:{id:null,first_name:null,last_name:null,username:null}}}},methods:{login(){this.canEnter=!0,this.dataForm.user.id=V(),this.send("/start")},send(i=null,o=0){this.loaded=!1,console.log(i);let f=i||this.dataForm.message;i&&(this.dataForm.message=null,this.dataForm.query=i),o===0&&this.messages.push({text:f,direction:"outgoing",created_at:(()=>{let d=new Date,l=String(d.getDate()).padStart(2,"0"),a=String(d.getMonth()+1).padStart(2,"0"),c=d.getFullYear(),_=d.getMinutes(),w=d.getHours(),e=d.getSeconds();return c+"-"+a+"-"+l+" "+w+":"+_+":"+e})()}),axios.post("/web/"+this.domain,this.dataForm).then(d=>{if(d.data.length==0){this.$nextTick(()=>{this.loaded=!0,this.$refs.scroll.$el.scrollTop=1e5});return}console.log("resp",d),this.dataForm.message=null,this.dataForm.query=null,d.data.forEach(a=>{let c=null;if(a.reply_markup){let _=JSON.parse(a.reply_markup);_.keyboard&&(this.buttons=_.keyboard,this.is_keyboard=!0),c=_.inline_keyboard||null}this.messages.push({text:a.text||null,direction:"incoming",keyboard:c,photo:a.photo||null,created_at:a.created_at||null}),this.$nextTick(()=>{this.loaded=!0,this.$refs.scroll.$el.scrollTop=1e5})}).catch(()=>{this.$nextTick(()=>{this.loaded=!0})})})}}},L={class:"modal fade",id:"web-form-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},U={class:"modal-dialog modal-fullscreen"},E={class:"modal-content"},H={class:"modal-body p-0"},O=["src"],D=t("div",{class:"modal-footer p-2"},[t("button",{type:"button",class:"btn btn-outline-info w-100","data-bs-dismiss":"modal"},"Закрыть")],-1),I={class:"chat-window d-flex justify-content-between align-items-center flex-column"},B={class:"message-card-body"},N=["innerHTML"],z=["innerHTML"],K={key:2},J={key:3,class:"w-100 mb-1 mt-1",alt:""},P={key:4,class:"inline-keyboard w-100"},A={class:"d-flex justify-content-between flex-wrap"},R={class:"d-flex justify-content-between align-items-center w-100"},W={style:{height:"100%"},class:"chat-inline-btn w-100"},Y=["onClick"],G=["href"],Q=["href"],X={key:1,class:"footer"},Z={class:"menu"},$={class:"dropdown dropup w-100"},tt=t("button",{class:"chat-menu-btn w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[t("i",{class:"fa-solid fa-ellipsis"})],-1),et={class:"dropdown-menu w-100 chat-custom-dropdown-menu",style:{padding:"10px"}},st={class:"d-flex justify-content-between flex-wrap"},nt={class:"d-flex justify-content-between w-100"},ot={class:"chat-reply-btn w-100"},lt=["onClick"],at={class:"message",style:{position:"relative"}},rt=["disabled"],it=["disabled"],dt=t("i",{class:"fa-regular fa-paper-plane"},null,-1),ut=[dt],ct={key:2,class:"w-100"},_t={class:"form-floating mb-3"},mt=t("label",{for:"floatingInput"},"Ваше имя",-1),ht={class:"form-floating mb-3"},pt=t("label",{for:"floatingInput"},"Ваша фамилия",-1),bt={class:"form-floating mb-3"},ft=t("label",{for:"floatingInput"},"Ваш номер телефона",-1),yt=t("button",{class:"btn btn-outline-primary p-3 w-100"},"Войти",-1);function gt(i,o,f,d,l,a){const c=F("perfect-scrollbar"),_=v("lazy"),w=v("mask");return s(),n(h,null,[t("div",L,[t("div",U,[t("div",E,[t("div",H,[l.selected_url?(s(),n("iframe",{key:0,class:"zoomed",style:{width:"100%",border:"none","min-height":"500px"},src:l.selected_url,frameborder:"0"},`

                    `,8,O)):r("",!0)]),D])])]),t("div",I,[l.canEnter?(s(),x(c,{key:0,ref:"scroll",class:"ps-container w-100"},{default:k(()=>[(s(!0),n(h,null,p(l.messages,e=>(s(),n("div",{class:C(["message-card",{incoming:e.direction==="incoming",outgoing:e.direction==="outgoing"}])},[t("div",B,[e.text?(s(),n("p",{key:0,innerHTML:e.text},null,8,N)):r("",!0),e.caption?(s(),n("p",{key:1,innerHTML:e.caption},null,8,z)):r("",!0),e.created_at?(s(),n("p",K,y(e.created_at),1)):r("",!0),e.photo?b((s(),n("img",J,null,512)),[[_,e.photo]]):r("",!0),e.keyboard?(s(),n("div",P,[(s(!0),n(h,null,p(e.keyboard,m=>(s(),n("div",A,[t("div",R,[(s(!0),n(h,null,p(m,u=>(s(),n("div",W,[u.callback_data?(s(),n("button",{key:0,style:{height:"100%"},onClick:kt=>a.send(u.callback_data||u.text,1),class:"btn btn-outline-light w-100"},y(u.text||u||"-"),9,Y)):r("",!0),u.web_app?(s(),n("a",{key:1,class:"btn btn-outline-light w-100",href:"https://t.me/"+f.domain,target:"_blank"},"Только в Telegram",8,G)):r("",!0),u.url?(s(),n("a",{key:2,class:"btn btn-outline-light w-100",href:u.url,target:"_blank"},y(u.text||u||"-"),9,Q)):r("",!0)]))),256))])]))),256))])):r("",!0)])],2))),256))]),_:1},512)):r("",!0),l.canEnter?(s(),n("div",X,[t("div",Z,[t("div",$,[tt,t("div",et,[l.buttons.length===0?(s(),n("button",{key:0,onClick:o[0]||(o[0]=e=>a.send("/start")),class:"btn btn-light w-100 text-center"},"Начать ")):r("",!0),l.buttons.length>0?(s(),x(c,{key:1,class:"ps-keyboard-container buttons"},{default:k(()=>[(s(!0),n(h,null,p(l.buttons,e=>(s(),n("div",st,[t("div",nt,[(s(!0),n(h,null,p(e,m=>(s(),n("div",ot,[t("button",{onClick:u=>a.send(m.text||m),class:"btn btn-outline-light w-100"},y(m.text||m||"-"),9,lt)]))),256))])]))),256))]),_:1})):r("",!0)])])]),t("div",at,[b(t("input",{type:"text",disabled:!l.loaded,class:"form-control w-100",placeholder:"text",onKeydown:o[1]||(o[1]=T(e=>a.send(null),["enter"])),"onUpdate:modelValue":o[2]||(o[2]=e=>l.dataForm.message=e)},null,40,rt),[[g,l.dataForm.message]]),t("button",{type:"button",disabled:!l.loaded,onClick:o[3]||(o[3]=e=>a.send(null)),class:"btn btn-send"},ut,8,it)])])):r("",!0),l.canEnter?r("",!0):(s(),n("div",ct,[t("form",{onSubmit:o[7]||(o[7]=S((...e)=>a.login&&a.login(...e),["prevent"])),class:"p-2"},[t("div",_t,[b(t("input",{type:"text","onUpdate:modelValue":o[4]||(o[4]=e=>l.dataForm.user.first_name=e),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[g,l.dataForm.user.first_name]]),mt]),t("div",ht,[b(t("input",{type:"text","onUpdate:modelValue":o[5]||(o[5]=e=>l.dataForm.user.last_name=e),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[g,l.dataForm.user.last_name]]),pt]),t("div",bt,[b(t("input",{type:"text","onUpdate:modelValue":o[6]||(o[6]=e=>l.dataForm.user.username=e),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[w,"+7(###)###-##-##"],[g,l.dataForm.user.username]]),ft]),yt],32)]))])],64)}const wt=j(q,[["render",gt]]),vt={key:0},xt={data(){return{load:!1,confirm:!1,vipForm:{name:null,phone:null,email:null,birthday:null,city:null,country:null,address:null,sex:!0}}},computed:{tg(){return window.Telegram.WebApp},tgUser(){const i=new URLSearchParams(this.tg.initData);return JSON.parse(i.get("user"))}},methods:{submit(){this.loading=!0,this.$store.dispatch("saveVip",{dataObject:{bot_id:this.bot.id,tg:this.tgUser,form:this.vipForm}}).then(i=>{this.loading=!1,window.location.reload()}).catch(()=>{this.loading=!1})}}},St=Object.assign(xt,{__name:"ChatWindow",props:{bot:{type:Object},botUser:{type:Object}},setup(i){return(o,f)=>i.bot?(s(),n("div",vt,[M(wt,{domain:i.bot.bot_domain},null,8,["domain"])])):r("",!0)}});export{St as default};
