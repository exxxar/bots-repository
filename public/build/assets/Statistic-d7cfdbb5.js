import{j,o as e,k as o,n as t,l as n,u as c,M as r,N as C,a3 as S,L as l,p as h,a0 as g,H as w,w as u,F as _,K as v,t as B}from"./index.es-c4852431.js";import{T as V}from"./TrafficStatistic-7de42901.js";import{K as D}from"./vue-datepicker-ff2ff697.js";/* empty css             */import{c as k,s as f,f as A,a as b,b as y,d as z,e as $}from"./vue3-charts.esm-31920dfb.js";import"./_plugin-vue_export-helper-c27b6911.js";const F={class:"container"},K={class:"row my-3",style:{position:"sticky",top:"10px","z-index":"100"}},E={key:0,class:"col-md-4"},M={class:"row"},L={class:"col-12"},N={class:"form-check form-switch"},T=t("label",{class:"form-check-label",for:"flexSwitchCheckDefault"}," Использовать временной период ",-1),U={class:"row"},W={class:"col-12"},P=t("h6",{class:"my-3 fw-bold"},"Основная статистика",-1),G=t("p",{class:"fst-italic"}," Сводка всех показателей эффективности работы системы ",-1),H={key:0,class:"table"},R=t("thead",null,[t("tr",{class:"bg-light"},[t("th",{scope:"col",style:{width:"200px"}},"Ключ"),t("th",{scope:"col"},"Значение")])],-1),q=t("th",{scope:"row"},"Всего пользователей в БД",-1),I={class:"font-weight-bold"},O=t("th",{scope:"row"},"Всего VIP",-1),J={class:"font-weight-bold"},Q=t("th",{scope:"row"},"Администраторы в БД",-1),X={class:"font-weight-bold"},Y=t("th",{scope:"row"},"Администраторы за работой",-1),Z={class:"font-weight-bold"},x=t("th",{scope:"row"},"Всего кэшбэка на счету у пользователей, руб",-1),tt={class:"font-weight-bold"},st={key:0},et=t("th",{scope:"row"},"Всего кэшбэка начислено пользователям, руб",-1),ot={class:"font-weight-bold"},at={key:0},it=t("th",{scope:"row"},"Всего кэшбэка списано у пользователей, руб",-1),lt={class:"font-weight-bold"},rt={key:0},nt=t("th",{scope:"row"},"Всего начислено кэшбэка первого уровня, руб",-1),ct={class:"font-weight-bold"},dt={key:0},ht=t("th",{scope:"row"},"Всего начислено кэшбэка второго уровня, руб",-1),ut={class:"font-weight-bold"},pt={key:0},_t=t("th",{scope:"row"},"Всего начислено кэшбэка третьего уровня, руб",-1),mt={class:"font-weight-bold"},kt={key:0},yt=t("i",{class:"fa-regular fa-file-excel mr-2"},null,-1),ft={class:"col-12"},bt={class:"form-check form-switch my-3"},gt=t("label",{class:"form-check-label",for:"flexSwitchCheckDefault"},"Отобразить графики",-1),wt={class:"row my-3 sticky-charts"},vt={class:"col-12"},Ct={class:"nav nav-tabs"},St={class:"nav-item"},Dt={class:"nav-item"},$t={class:"nav-item"},jt={class:"nav-item"},Bt={key:0,class:"col-12"},Vt={key:0,class:"d-flex justify-content-center mb-3"},At={key:1,class:"text-danger my-2"},zt={key:1,class:"w-100 overflow-x-scroll"},Ft={class:"table"},Kt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"#"),t("th",{scope:"col"},"Год"),t("th",{scope:"col"},"Месяц"),t("th",{scope:"col"},"Число пользователей")])],-1),Et={scope:"row"},Mt={key:1,class:"col-12"},Lt=t("h6",{class:"my-2"},"Начисления",-1),Nt={class:"d-flex justify-content-center mb-3"},Tt={key:1,class:"text-danger my-3"},Ut=t("h6",{class:"my-2"},"Списания",-1),Wt={class:"d-flex justify-content-center mb-3"},Pt={key:1,class:"text-danger my-3"},Gt={key:1,class:"w-100 overflow-x-scroll"},Ht={class:"table"},Rt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"#"),t("th",{scope:"col"},"Год"),t("th",{scope:"col"},"Месяц"),t("th",{scope:"col"},"Начислено"),t("th",{scope:"col"},"Списано")])],-1),qt={scope:"row"},It={key:2,class:"col-12"},Ot={key:0,class:"d-flex justify-content-center mb-3"},Jt={key:1,class:"text-danger my-3"},Qt={key:1,class:"d-flex"},Xt={class:"w-100 overflow-x-scroll"},Yt={class:"w-100 overflow-x-scroll"},Zt={key:0,class:"table"},xt=t("th",{scope:"col"},"#",-1),ts={scope:"col"},ss={key:0,class:"fa-solid fa-arrow-up-wide-short"},es={key:1,class:"fa-solid fa-arrow-up-short-wide"},os={scope:"col"},as={key:0,class:"fa-solid fa-arrow-up-wide-short"},is={key:1,class:"fa-solid fa-arrow-up-short-wide"},ls={scope:"col"},rs={key:0,class:"fa-solid fa-arrow-up-wide-short"},ns={key:1,class:"fa-solid fa-arrow-up-short-wide"},cs={scope:"col"},ds={key:0,class:"fa-solid fa-arrow-up-wide-short"},hs={key:1,class:"fa-solid fa-arrow-up-short-wide"},us={scope:"col"},ps={key:0,class:"fa-solid fa-arrow-up-wide-short"},_s={key:1,class:"fa-solid fa-arrow-up-short-wide"},ms={scope:"row"},ks={key:1,class:"text-danger my-3"},ys={key:3,class:"col-12"},fs={class:"w-100 overflow-x-scroll"},bs={components:{Chart:k,Grid:f,Line:A,Bar:b,Tooltip:y,Responsive:z,Pie:$,VueDatePicker:D},data(){return{sort:{key:"price",direction:"asc"},need_charts:!1,need_date_range:!1,date:null,tab:0,botUser:null,loadedChart:!1,statistic:null,loading:!1,tooltipConfig:{sump:{label:"Сумма продаж",color:"#5d1010"},sum:{label:"Сумма",color:"#5d1010"},count:{label:"Кол-во",color:"#5d1010"},m:{label:"Месяц",color:"#54a375"},y:{label:"Год",color:"#0ea9cb"}},products:[{title:"1",count:1,price:2020},{title:"2",count:2,price:2020},{title:"3",count:3,price:2020},{title:"4",count:4,price:2020},{title:"5",count:5,price:2020}],orders:[{sump:0,m:1,y:2020},{sump:111,m:2,y:2020},{sump:222,m:3,y:2020},{sump:333,m:4,y:2020},{sump:444,m:5,y:2020}],users:[{count:0,m:1,y:2020},{count:111,m:2,y:2020},{count:222,m:3,y:2020},{count:333,m:4,y:2020},{count:444,m:5,y:2020}],cashback_up:[{sum:0,m:1,y:2020},{sum:111,m:2,y:2020},{sum:222,m:3,y:2020},{sum:333,m:4,y:2020},{sum:444,m:5,y:2020}],cashback_down:[{sum:0,m:1,y:2020},{sum:111,m:2,y:2020},{sum:222,m:3,y:2020},{sum:333,m:4,y:2020},{sum:444,m:5,y:2020}],direction:"horizontal",margin:{left:0,top:20,right:20,bottom:0},axis:{primary:{type:"band"},secondary:{domain:["dataMin","dataMax + 100"],type:"linear",ticks:11}}}},computed:{...j(["getSelf"]),tg(){return window.Telegram.WebApp},preparedCashback(){if(this.cashback_up.length===0&&this.cashback_down.length===0)return[];let d=[];for(let s=0;s<this.cashback_up.length;s++){let i=null;for(let p=0;p<this.cashback_down.length;p++){let a=this.cashback_down[p],m=this.cashback_up[s];if(m.m===a.m&&m.y===a.y){i=this.cashback_down[p];break}}d.push({y:this.cashback_up[s].y||0,m:this.cashback_up[s].m||0,up:this.cashback_up[s].sum||0,down:i===null?0:i.sum})}return d}},watch:{sort:{handler:function(d){this.prepareStatistic()},deep:!0},need_date_range:function(){this.prepareStatistic()},date:function(){this.prepareStatistic()}},mounted(){const d=new Date,s=new Date(new Date().setDate(d.getDate()+7));this.date=[d,s],this.getSelf&&(this.botUser=this.getSelf,this.prepareStatistic()),this.tg.BackButton.show(),this.tg.BackButton.onClick(()=>{document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(i=>i.click()),this.$router.back()})},methods:{changeSort(d){this.sort.key=d,this.sort.direction=this.sort.direction==="asc"?"desc":"asc"},prepareStatistic(){return this.loadedChart=!1,this.$store.dispatch("statisticLoad",{date:this.date,need_all:!this.need_date_range,sort:this.sort}).then(d=>{this.statistic=d.statistic,this.orders=this.statistic.orders.sum,this.products=this.statistic.orders.products,this.users=this.statistic.users.sum,this.cashback_up=this.statistic.cashback_up.sum,this.cashback_down=this.statistic.cashback_down.sum,this.loadedChart=!0})},downloadBotStatistic(){this.$notify({title:"Внимание!",text:"Начался формироваться документ статистики!"}),this.$store.dispatch("downloadBotStatistic").then(d=>{this.$notify({title:"Отлично!",text:"Документ успешно сформирован",type:"success"})}).catch(()=>{this.$notify({title:"Упс!",text:"Что-то пошло не так...",type:"error"})})}}},$s=Object.assign(bs,{__name:"Statistic",setup(d){return(s,i)=>{const p=B("Marker");return e(),o("div",F,[t("div",K,[s.need_date_range?(e(),o("div",E,[n(c(D),{modelValue:s.date,"onUpdate:modelValue":i[0]||(i[0]=a=>s.date=a),locale:"ru",range:""},null,8,["modelValue"])])):r("",!0)]),t("div",M,[t("div",L,[t("div",N,[C(t("input",{class:"form-check-input","onUpdate:modelValue":i[1]||(i[1]=a=>s.need_date_range=a),type:"checkbox",role:"switch",id:"flexSwitchCheckDefault"},null,512),[[S,s.need_date_range]]),T])])]),t("div",U,[t("div",W,[P,G,s.statistic?(e(),o("table",H,[R,t("tbody",null,[t("tr",null,[q,t("td",I,l(s.statistic.users_in_bd||0),1)]),t("tr",null,[O,t("td",J,l(s.statistic.vip_in_bd||0),1)]),t("tr",null,[Q,t("td",X,l(s.statistic.admin_in_bd||0),1)]),t("tr",null,[Y,t("td",Z,l(s.statistic.work_admin_in_bd||0),1)]),t("tr",null,[x,t("td",tt,[h(l((s.statistic.summary_cashback||0).toFixed(2))+" ",1),s.statistic.summary_cashback_people_count?(e(),o("strong",st,"("+l(s.statistic.summary_cashback_people_count)+" чел)",1)):r("",!0)])]),t("tr",null,[et,t("td",ot,[h(l((s.statistic.cashback_summary_up||0).toFixed(2))+" ",1),s.statistic.cashback_summary_up_people_count?(e(),o("strong",at,"("+l(s.statistic.cashback_summary_up_people_count)+" чел)",1)):r("",!0)])]),t("tr",null,[it,t("td",lt,[h(l((s.statistic.cashback_summary_down||0).toFixed(2))+" ",1),s.statistic.cashback_summary_down_people_count?(e(),o("strong",rt,"("+l(s.statistic.cashback_summary_down_people_count)+" чел)",1)):r("",!0)])]),t("tr",null,[nt,t("td",ct,[h(l((s.statistic.cashback_up_level_1||0).toFixed(2))+" ",1),s.statistic.cashback_up_level_1_people_count?(e(),o("strong",dt,"("+l(s.statistic.cashback_up_level_1_people_count)+" чел)",1)):r("",!0)])]),t("tr",null,[ht,t("td",ut,[h(l((s.statistic.cashback_up_level_2||0).toFixed(2))+" ",1),s.statistic.cashback_up_level_2_people_count?(e(),o("strong",pt,"("+l(s.statistic.cashback_up_level_2_people_count)+" чел)",1)):r("",!0)])]),t("tr",null,[_t,t("td",mt,[h(l((s.statistic.cashback_up_level_3||0).toFixed(2))+" ",1),s.statistic.cashback_up_level_3_people_count?(e(),o("strong",kt,"("+l(s.statistic.cashback_up_level_3_people_count)+" чел)",1)):r("",!0)])])])])):r("",!0),t("a",{href:"javascript:void(0)",onClick:i[2]||(i[2]=(...a)=>s.downloadBotStatistic&&s.downloadBotStatistic(...a)),class:"btn w-100 btn-outline-info p-3"},[yt,h(" Скачать статистику ")])]),t("div",ft,[t("div",bt,[C(t("input",{class:"form-check-input","onUpdate:modelValue":i[3]||(i[3]=a=>s.need_charts=a),type:"checkbox",role:"switch",id:"flexSwitchCheckDefault"},null,512),[[S,s.need_charts]]),gt]),t("div",wt,[t("div",vt,[t("ul",Ct,[t("li",St,[t("a",{class:g(["nav-link",{active:s.tab===0}]),onClick:i[4]||(i[4]=a=>s.tab=0),"aria-current":"page",href:"javascript:void(0)"},"Пользователи",2)]),t("li",Dt,[t("a",{class:g(["nav-link",{active:s.tab===1}]),onClick:i[5]||(i[5]=a=>s.tab=1),"aria-current":"page",href:"javascript:void(0)"},"Бонусы",2)]),t("li",$t,[t("a",{class:g(["nav-link",{active:s.tab===2}]),onClick:i[6]||(i[6]=a=>s.tab=2),"aria-current":"page",href:"javascript:void(0)"},"Продажи",2)]),t("li",jt,[t("a",{class:g(["nav-link",{active:s.tab===3}]),onClick:i[7]||(i[7]=a=>s.tab=3),"aria-current":"page",href:"javascript:void(0)"},"Переходы",2)])])]),s.tab===0?(e(),o("div",Bt,[s.need_charts?(e(),o("div",Vt,[s.loadedChart&&(s.users||[]).length>0?(e(),w(c(k),{key:0,size:{width:300,height:320},data:s.users,margin:s.margin,direction:s.direction,axis:s.axis},{layers:u(()=>[n(c(f),{strokeDasharray:"2,2"}),n(c(b),{dataKeys:["m","count"],barStyle:{fill:"#ffe775"}}),n(p,{value:1e3,label:"Avg.",color:"#e76f51",strokeWidth:"2",strokeDasharray:"6 6"})]),widgets:u(()=>[n(c(y),{borderColor:"#48CAE4",config:s.tooltipConfig},null,8,["config"])]),_:1},8,["data","margin","direction","axis"])):(e(),o("p",At,"Статистика еще не загружена или её нет"))])):r("",!0),(s.users||[]).length>0?(e(),o("div",zt,[t("table",Ft,[Kt,t("tbody",null,[(e(!0),o(_,null,v(s.users,(a,m)=>(e(),o("tr",null,[t("th",Et,l(m+1),1),t("td",null,l(a.y),1),t("td",null,l(a.m),1),t("td",null,l(a.count),1)]))),256))])])])):r("",!0)])):r("",!0),s.tab===1?(e(),o("div",Mt,[s.need_charts?(e(),o(_,{key:0},[Lt,t("div",Nt,[s.loadedChart&&(s.cashback_up||[]).length>0?(e(),w(c(k),{key:0,size:{width:300,height:320},data:s.cashback_up,margin:s.margin,direction:s.direction,axis:s.axis},{layers:u(()=>[n(c(f),{strokeDasharray:"2,2"}),n(c(b),{dataKeys:["m","sum"],barStyle:{fill:"#ffe775"}}),n(p,{value:1e3,label:"Avg.",color:"#e76f51",strokeWidth:"2",strokeDasharray:"6 6"})]),widgets:u(()=>[n(c(y),{borderColor:"#48CAE4",config:s.tooltipConfig},null,8,["config"])]),_:1},8,["data","margin","direction","axis"])):(e(),o("p",Tt,"Статистика еще не загружена или её нет"))]),Ut,t("div",Wt,[s.loadedChart&&(s.cashback_down||[]).length>0?(e(),w(c(k),{key:0,size:{width:300,height:320},data:s.cashback_down,margin:s.margin,direction:s.direction,axis:s.axis},{layers:u(()=>[n(c(f),{strokeDasharray:"2,2"}),n(c(b),{dataKeys:["m","sum"],barStyle:{fill:"#ffe775"}}),n(p,{value:1e3,label:"Avg.",color:"#e76f51",strokeWidth:"2",strokeDasharray:"6 6"})]),widgets:u(()=>[n(c(y),{borderColor:"#48CAE4",config:s.tooltipConfig},null,8,["config"])]),_:1},8,["data","margin","direction","axis"])):(e(),o("p",Pt,"Статистика еще не загружена или её нет"))])],64)):r("",!0),(s.preparedCashback||[]).length>0?(e(),o("div",Gt,[t("table",Ht,[Rt,t("tbody",null,[(e(!0),o(_,null,v(s.preparedCashback,(a,m)=>(e(),o("tr",null,[t("th",qt,l(m+1),1),t("td",null,l(a.y),1),t("td",null,l(a.m),1),t("td",null,l(a.up),1),t("td",null,l(a.down),1)]))),256))])])])):r("",!0)])):r("",!0),s.tab===2?(e(),o("div",It,[s.need_charts?(e(),o("div",Ot,[s.loadedChart&&(s.orders||[]).length>0?(e(),w(c(k),{key:0,size:{width:300,height:320},data:s.orders,margin:s.margin,direction:s.direction,axis:s.axis},{layers:u(()=>[n(c(f),{strokeDasharray:"2,2"}),n(c(b),{dataKeys:["m","sump"],barStyle:{fill:"#ffe775"}}),n(p,{value:1e3,label:"Avg.",color:"#e76f51",strokeWidth:"2",strokeDasharray:"6 6"})]),widgets:u(()=>[n(c(y),{borderColor:"#48CAE4",config:s.tooltipConfig},null,8,["config"])]),_:1},8,["data","margin","direction","axis"])):(e(),o("p",Jt,"Статистика еще не загружена или её нет"))])):r("",!0),s.need_charts?(e(),o("div",Qt,[t("div",Xt,[n(c(k),{direction:"circular",size:{width:600,height:400},data:s.products,margin:{left:0,top:50,right:0,bottom:0},axis:s.axis,config:{controlHover:!1}},{layers:u(()=>[n(c($),{dataKeys:["title","count","price"],"pie-style":{innerRadius:10,padAngle:.05}},null,8,["pie-style"])]),widgets:u(()=>[n(c(y),{config:{title:{label:"Название"},price:{label:"Выручено средств"},count:{label:"Кол-во"},volume_count_ratio:{hide:!0},volume_price_ratio:{hide:!0}},hideLine:""})]),_:1},8,["data","axis"])])])):r("",!0),t("div",Yt,[(s.products||[]).length>0?(e(),o("table",Zt,[t("thead",null,[t("tr",null,[xt,t("th",ts,[t("a",{href:"javascript:void(0)",onClick:i[8]||(i[8]=a=>s.changeSort("title"))},[s.sort.key==="title"?(e(),o(_,{key:0},[s.sort.direction==="asc"?(e(),o("i",ss)):(e(),o("i",es))],64)):r("",!0),h(" Название ")])]),t("th",os,[t("a",{href:"javascript:void(0)",onClick:i[9]||(i[9]=a=>s.changeSort("price"))},[s.sort.key==="price"?(e(),o(_,{key:0},[s.sort.direction==="asc"?(e(),o("i",as)):(e(),o("i",is))],64)):r("",!0),h(" Объем продаж ")])]),t("th",ls,[t("a",{href:"javascript:void(0)",onClick:i[10]||(i[10]=a=>s.changeSort("count"))},[s.sort.key==="count"?(e(),o(_,{key:0},[s.sort.direction==="asc"?(e(),o("i",rs)):(e(),o("i",ns))],64)):r("",!0),h(" Продано ед. ")])]),t("th",cs,[t("a",{href:"javascript:void(0)",onClick:i[11]||(i[11]=a=>s.changeSort("volume_count_ratio"))},[s.sort.key==="volume_count_ratio"?(e(),o(_,{key:0},[s.sort.direction==="asc"?(e(),o("i",ds)):(e(),o("i",hs))],64)):r("",!0),h(" % от объема ")])]),t("th",us,[t("a",{href:"javascript:void(0)",onClick:i[12]||(i[12]=a=>s.changeSort("volume_price_ratio"))},[s.sort.key==="volume_price_ratio"?(e(),o(_,{key:0},[s.sort.direction==="asc"?(e(),o("i",ps)):(e(),o("i",_s))],64)):r("",!0),h(" % от числа ")])])])]),t("tbody",null,[(e(!0),o(_,null,v(s.products,(a,m)=>(e(),o("tr",null,[t("th",ms,l(m+1),1),t("td",null,l(a.title),1),t("td",null,l(a.price),1),t("td",null,l(a.count),1),t("td",null,l(a.volume_count_ratio),1),t("td",null,l(a.volume_price_ratio),1)]))),256))])])):(e(),o("p",ks,"Нет данных по продажам за выбранный период:("))])])):r("",!0),s.tab===3?(e(),o("div",ys,[t("div",fs,[n(V,{date:s.date},null,8,["date"])])])):r("",!0)])])])])}}});export{$s as default};
