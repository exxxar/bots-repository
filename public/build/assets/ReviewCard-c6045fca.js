import{o,k as r,q as v,n as t,N as c,bB as m,Y as p,a1 as w,H as b,M as a,l as f,L as u,p as _,a3 as y,w as g}from"./index.es-c4852431.js";import{R as k}from"./Rating-5dca4717.js";import{_ as R}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as $}from"./ProductCardSimple-2492c86f.js";const U={props:["review"],data(){return{form:{id:null,text:null,rating:5,image:null,order_id:null,product_id:null}}},mounted(){this.$nextTick(()=>{this.form.id=this.review.id||null,this.form.order_id=this.review.order_id||null,this.form.product_id=this.review.product_id||null})},methods:{onChangePhotos(i){const e=i.target.files[0];this.form.image=e},getPhoto(i){return{imageUrl:URL.createObjectURL(i)}},removePhoto(){this.form.image=null},submitReview(){let i=new FormData;this.sending=!0,Object.keys(this.form).forEach(e=>{const s=this.form[e]||"";typeof s=="object"?i.append(e,JSON.stringify(s)):i.append(e,s)}),typeof this.form.image!="string"&&(i.append("photo",this.form.image),i.delete("image")),this.$store.dispatch("storeReview",{reviewForm:i}).then(e=>{this.$notify({title:"Обратная связь",text:"Спасибо за отзыв"}),document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(s=>s.click()),this.$emit("callback",e.data)}).catch(e=>{})}}},V={class:"form-check mb-2"},C=t("label",{class:"form-check-label",for:"ratingReview1"}," Очень хорошо ",-1),M={class:"form-check mb-2"},F=t("label",{class:"form-check-label",for:"ratingReview2"}," Хорошо ",-1),T={class:"form-check mb-2"},S=t("label",{class:"form-check-label",for:"ratingReview3"}," Средне ",-1),I={class:"form-check mb-2"},A=t("label",{class:"form-check-label",for:"ratingReview4"}," Плохо ",-1),B={class:"form-check mb-2"},L=t("label",{class:"form-check-label",for:"ratingReview5"}," Очень плохо ",-1),N=t("p",{class:"text-center"},[t("strong",null,"Напишите ваш отзыв")],-1),j={class:"form-floating"},q=t("label",{for:"floatingTextarea"},"Текст отзыва",-1),P=t("button",{type:"submit",class:"btn btn-primary my-2 w-100 p-3"},"Оставить отзыв",-1),E=t("button",{type:"button",class:"btn btn-link my-3 w-100 text-center","data-bs-dismiss":"modal","aria-label":"Close"}," Закрыть ",-1);function O(i,e,s,d,l,h){return o(),r("form",{class:"p-2",onSubmit:e[6]||(e[6]=w((...n)=>h.submitReview&&h.submitReview(...n),["prevent"]))},[v(i.$slots,"title"),t("div",V,[c(t("input",{class:"form-check-input","onUpdate:modelValue":e[0]||(e[0]=n=>l.form.rating=n),value:"5",type:"radio",name:"rating",id:"ratingReview1"},null,512),[[m,l.form.rating]]),C]),t("div",M,[c(t("input",{class:"form-check-input","onUpdate:modelValue":e[1]||(e[1]=n=>l.form.rating=n),value:"4",type:"radio",name:"rating",id:"ratingReview2"},null,512),[[m,l.form.rating]]),F]),t("div",T,[c(t("input",{class:"form-check-input",value:"3","onUpdate:modelValue":e[2]||(e[2]=n=>l.form.rating=n),type:"radio",name:"rating",id:"ratingReview3"},null,512),[[m,l.form.rating]]),S]),t("div",I,[c(t("input",{class:"form-check-input","onUpdate:modelValue":e[3]||(e[3]=n=>l.form.rating=n),value:"2",type:"radio",name:"rating",id:"ratingReview4"},null,512),[[m,l.form.rating]]),A]),t("div",B,[c(t("input",{class:"form-check-input","onUpdate:modelValue":e[4]||(e[4]=n=>l.form.rating=n),value:"1",type:"radio",name:"rating",id:"ratingReview5"},null,512),[[m,l.form.rating]]),L]),N,t("div",j,[c(t("textarea",{class:"form-control",style:{"min-height":"250px"},"onUpdate:modelValue":e[5]||(e[5]=n=>l.form.text=n),placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,512),[[p,l.form.text]]),q]),P,E],32)}const x=R(U,[["render",O]]),D={key:0,class:"w-100"},H={class:"card rounded-0 border-0 w-100"},J={key:0,class:"card-body"},Y={key:1,class:"card-body p-0"},z={class:"fst-italic my-2",style:{"word-break":"break-word"}},G={key:0,class:"mb-0"},K={class:"text-primary fw-bold"},Q={class:"d-flex justify-content-center"},W={class:"form-check my-2"},X=["id"],Z=["for"],ee={key:2,class:"card-body p-0"},te=t("i",{class:"fa-solid fa-comment-medical mr-1"},null,-1),ie={key:1},se=["disabled"],oe={key:0,class:"color-white"},re={key:1,class:"color-white"},ne=["id"],le={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen"},ae={class:"modal-content"},de=t("div",{class:"modal-header"},[t("h1",{class:"modal-title fs-5",id:"exampleModalLabel"}),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ce={class:"modal-body"},me={key:0,class:"text-center"},ue=t("strong",null,"Отзыв к товару",-1),he=[ue],fe={key:1,class:"text-center"},_e=t("strong",null,"Отзыв к заказу",-1),ve=[_e],pe={props:["modelValue","needProduct","isAdmin"],data(){return{need_user_notify:!1,load:!0,review:null,spent_time_counter:0}},mounted(){this.review=this.modelValue,localStorage.getItem("cashman_review_card_notify_counter")!=null&&(this.is_requested=!0,this.startTimer(localStorage.getItem("cashman_review_card_notify_counter")||0))},methods:{removeReview(){this.review.send_review_at=null,this.review.text=null,this.review.rating=5,this.review.need_user_notify=this.need_user_notify||!1,this.$store.dispatch("storeReview",{reviewForm:this.review}).then(()=>{this.$notify({title:"Отзывы",text:"Вы успешно удалили отзыв",type:"success"})}).catch(()=>{this.$notify({title:"Отзывы",text:"Ошибка удаления отзыва",type:"error"})})},callback(i){this.load=!1,this.review=i,this.$nextTick(()=>{this.load=!0,this.$emit("update:modelValue",i)})},showReviewsForm(){new bootstrap.Modal(document.getElementById("review-modal-info"+this.review.id),{}).show()},notifyUser(){this.$store.dispatch("notifyUserForReview",{reviewForm:this.review}).then(()=>{this.$notify({title:"Отзывы",text:"Вы успешно отправили пользователю напоминание",type:"success"})}).catch(()=>{this.$notify({title:"Отзывы",text:"Ошибка напоминания",type:"error"})}),this.startTimer()},startTimer(i){this.spent_time_counter=i!=null?Math.min(i,10):10;let e=setInterval(()=>{this.spent_time_counter>0?this.spent_time_counter--:(clearInterval(e),this.is_requested=!1,this.spent_time_counter=null),localStorage.setItem("cashman_review_card_notify_counter",this.spent_time_counter)},1e3)}}},ke=Object.assign(pe,{__name:"ReviewCard",setup(i){return(e,s)=>e.review&&e.load?(o(),r("div",D,[t("div",H,[i.needProduct?(o(),r("div",J,[e.review.product?(o(),b($,{key:0,item:e.review.product},null,8,["item"])):a("",!0)])):a("",!0),e.review.send_review_at?(o(),r("div",Y,[f(k,{rating:e.review.rating},null,8,["rating"]),t("p",z,u(e.review.text||"не указан"),1),e.review.send_review_at?(o(),r("p",G,[_(" Отзыва оставлен "),t("span",K,u(e.$filters.currentFull(e.review.send_review_at)),1)])):a("",!0),t("div",Q,[t("div",W,[c(t("input",{class:"form-check-input","onUpdate:modelValue":s[0]||(s[0]=d=>e.need_user_notify=d),type:"checkbox",id:"notify-user-for-review-"+e.review.id},null,8,X),[[y,e.need_user_notify]]),t("label",{class:"form-check-label",for:"notify-user-for-review-"+e.review.id}," Оповестить пользователя ",8,Z)])]),i.isAdmin?(o(),r("button",{key:1,onClick:s[1]||(s[1]=(...d)=>e.removeReview&&e.removeReview(...d)),type:"button",class:"btn btn-primary w-100"},"Сбросить отзыв ")):a("",!0)])):(o(),r("div",ee,[i.isAdmin?a("",!0):(o(),r("button",{key:0,type:"button",onClick:s[2]||(s[2]=(...d)=>e.showReviewsForm&&e.showReviewsForm(...d)),class:"btn btn-link w-100"},[te,_(" Вы можете оставить отзыв ")])),i.isAdmin?(o(),r("p",ie," Пользователь еще не оставил отзыв! ")):a("",!0),i.isAdmin?(o(),r("button",{key:2,onClick:s[3]||(s[3]=(...d)=>e.notifyUser&&e.notifyUser(...d)),disabled:e.spent_time_counter>0,type:"button",class:"btn btn-primary w-100"},[e.spent_time_counter<=0?(o(),r("span",oe,"Напомнить")):(o(),r("span",re,"Осталось ждать "+u(e.spent_time_counter||0)+" сек.",1))],8,se)):a("",!0)]))]),t("div",{class:"modal fade",id:"review-modal-info"+e.review.id,tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[t("div",le,[t("div",ae,[de,t("div",ce,[f(x,{onCallback:e.callback,review:e.review},{title:g(()=>[e.review.order_id!=null&&e.review.product_id!=null?(o(),r("p",me,he)):a("",!0),e.review.order_id!=null&&e.review.product_id==null?(o(),r("p",fe,ve)):a("",!0)]),_:1},8,["onCallback","review"])])])])],8,ne)])):a("",!0)}});export{ke as _};
