import{o as i,k as l,n as e,p as u,L as a,M as m,a0 as y,N as d,a7 as k,a1 as I,Y as p,F as c,K as w,U as $,W as T,H as S,O as C}from"./index.es-c4852431.js";import{_ as x}from"./_plugin-vue_export-helper-c27b6911.js";const L={props:["tableInfo"],data(){return{tab:"form",show_persons_input:!1,reservation:{date:"",time:"",name:"",phone:"",persons:1,description:"",table:null},bookings:[]}},computed:{self(){return window.self||null}},watch:{"reservation.date":{handler:function(o){this.bookingList()},deep:!0},tab:{handler:function(o){this.tab==="list"&&this.bookingList()},deep:!0}},methods:{bookingList(){return this.$store.dispatch("bookingList",{number:this.reservation.table.number,date:this.reservation.date}).then(o=>{this.bookings=o.data||[]})},validateForm(){return!this.reservation.date||!this.reservation.time||!this.reservation.persons?(this.$notify({title:"Бронирование",text:"Пожалуйста, заполните все обязательные поля (Дата, Время, Число персон)",type:"error"}),!1):this.reservation.persons<1?(this.$notify({title:"Бронирование",text:"Число персон должно быть не менее 1.",type:"error"}),!1):new Date(`${this.reservation.date}T${this.reservation.time}`)<new Date?(this.$notify({title:"Бронирование",text:"Дата и время бронирования не могут быть в прошлом.",type:"error"}),!1):!0},submitReservation(){if(!this.validateForm()){this.$notify({title:"Бронирование",text:"Не все поля заполнены корректно",type:"error"});return}let o=new FormData;Object.keys(this.reservation).forEach(t=>{const r=this.reservation[t]||"";typeof r=="object"?o.append(t,JSON.stringify(r)):o.append(t,r)}),this.$store.dispatch("bookATable",{dataObject:o}).then(t=>{this.$notify({title:"Бронирование",text:"Ваш столик успешно забронирован!",type:"success"}),this.reservation={date:"",time:"",name:"",phone:"",persons:1,description:"",table:null},localStorage.setItem("cashman_current_active_table",JSON.stringify(t.data)),this.$emit("success")}).catch(t=>{this.$notify({title:"Бронирование",text:"Ошибка бронирования столика!",type:"error"}),this.$emit("failure")})}},mounted(){this.tableInfo&&this.$nextTick(()=>{this.reservation.table=this.tableInfo,this.reservation.persons=this.tableInfo.seats||1,this.reservation.description="Хочу забронировать этот столик",this.reservation.name=this.self.name||null,this.reservation.phone=this.self.phone||null});const o=new Date,t=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),h=String(o.getDate()).padStart(2,"0");document.getElementById("reservationDate").setAttribute("min",`${t}-${r}-${h}`)}},_=o=>($("data-v-53ada5d1"),o=o(),T(),o),U={key:0,class:"alert alert-light mb-2"},V={class:"mb-0"},j={class:"fw-bold"},N={class:"nav nav-tabs justify-content-center mb-2"},E={class:"nav-item"},F={class:"nav-item"},q={class:"form-floating mb-2"},O=_(()=>e("label",{for:"reservationDate"},"Дата бронирования",-1)),R={class:"form-floating mb-2"},P=_(()=>e("label",{for:"reservationTime"},"Время бронирования",-1)),z=_(()=>e("p",{class:"mb-0"},"Число персон",-1)),A={class:"btn-group w-100 mb-2",role:"group","aria-label":"Простой пример"},Y={key:0,class:"form-floating mb-2"},J=_(()=>e("label",{for:"numberOfPersons"},"Число персон",-1)),H={class:"form-floating mb-2"},K=_(()=>e("label",{for:"userName"},"На чьё имя бронировать",-1)),W={class:"form-floating mb-2"},G=_(()=>e("label",{for:"userPhone"},"Номер телефона",-1)),Q={class:"form-floating mb-2"},X=_(()=>e("label",{for:"reservationDescription"},"Описание к брони (пожелания):",-1)),Z=_(()=>e("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Забронировать",-1)),ee={class:"form-floating mb-2"},te=_(()=>e("label",{for:"reservationDate"},"Дата бронирования",-1)),se={key:0,class:"list-group"},oe={class:"list-group-item"},ne={class:"mb-0"},ie={key:1,class:"alert alert-light"};function le(o,t,r,h,s,b){return i(),l(c,null,[s.reservation.table?(i(),l("div",U,[e("p",V,[u("Вы бронируете столик "),e("strong",j,"#"+a(s.reservation.table.number),1),u(" - "+a(s.reservation.table.description),1)])])):m("",!0),e("ul",N,[e("li",E,[e("a",{class:y(["nav-link",{active:s.tab==="form"}]),onClick:t[0]||(t[0]=n=>s.tab="form"),"aria-current":"page",href:"javascript:void(0)"},"Форма",2)]),e("li",F,[e("a",{class:y([{active:s.tab==="list"},"nav-link"]),onClick:t[1]||(t[1]=n=>s.tab="list"),href:"javascript:void(0)"},"Список броней",2)])]),d(e("div",null,[e("form",{onSubmit:t[11]||(t[11]=I((...n)=>b.submitReservation&&b.submitReservation(...n),["prevent"]))},[e("div",q,[d(e("input",{type:"date",id:"reservationDate","onUpdate:modelValue":t[2]||(t[2]=n=>s.reservation.date=n),required:"",class:"form-control"},null,512),[[p,s.reservation.date]]),O]),e("div",R,[d(e("input",{type:"time",id:"reservationTime","onUpdate:modelValue":t[3]||(t[3]=n=>s.reservation.time=n),required:"",class:"form-control"},null,512),[[p,s.reservation.time]]),P]),z,e("div",A,[e("button",{onClick:t[4]||(t[4]=n=>s.reservation.persons++),type:"button",class:"btn btn-primary"},"+"),e("button",{type:"button",onClick:t[5]||(t[5]=n=>s.show_persons_input=!s.show_persons_input),class:"btn btn-primary"},a(s.reservation.persons),1),e("button",{onClick:t[6]||(t[6]=n=>s.reservation.persons>1?s.reservation.persons--:""),type:"button",class:"btn btn-primary"},"-")]),s.show_persons_input?(i(),l("div",Y,[d(e("input",{type:"number",id:"numberOfPersons","onUpdate:modelValue":t[7]||(t[7]=n=>s.reservation.persons=n),min:"1",required:"",class:"form-control"},null,512),[[p,s.reservation.persons,void 0,{number:!0}]]),J])):m("",!0),e("div",H,[d(e("input",{type:"text",id:"userName","onUpdate:modelValue":t[8]||(t[8]=n=>s.reservation.name=n),min:"1",required:"",class:"form-control"},null,512),[[p,s.reservation.name,void 0,{number:!0}]]),K]),e("div",W,[d(e("input",{type:"text",id:"userPhone","onUpdate:modelValue":t[9]||(t[9]=n=>s.reservation.phone=n),min:"1",required:"",class:"form-control"},null,512),[[p,s.reservation.phone,void 0,{number:!0}]]),G]),e("div",Q,[d(e("textarea",{id:"reservationDescription","onUpdate:modelValue":t[10]||(t[10]=n=>s.reservation.description=n),rows:"4",class:"form-control"},null,512),[[p,s.reservation.description]]),X]),Z],32)],512),[[k,s.tab==="form"]]),d(e("div",null,[e("div",ee,[d(e("input",{type:"date",id:"reservationDate","onUpdate:modelValue":t[12]||(t[12]=n=>s.reservation.date=n),required:"",class:"form-control"},null,512),[[p,s.reservation.date]]),te]),s.bookings.length>0?(i(),l("ul",se,[(i(!0),l(c,null,w(s.bookings,n=>{var f;return i(),l("li",oe,[e("p",ne,a(n.booked_date_at||"-")+" в "+a(n.booked_time_at||"-")+" на "+a(((f=n.booked_info)==null?void 0:f.persons)||1)+" чел.",1)])}),256))])):(i(),l("p",ie," Для данного столика нет активный броней "))],512),[[k,s.tab==="list"]])],64)}const ae=x(L,[["render",le],["__scopeId","data-v-53ada5d1"]]);const re={data(){return{tab:"export",startDate:this.getTodayDate(),endDate:this.getTodayDate(),loading:!1,counts:[],bookings:[]}},computed:{},methods:{getTodayDate(){const o=new Date,t=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),h=String(o.getDate()).padStart(2,"0");return`${t}-${r}-${h}`},exportNearestBookings(){return this.$store.dispatch("exportNearestBookings",{start_date:this.startDate,end_date:this.endDate}).then(o=>{this.$notify({title:"Выгрузка броней",text:"Список броней успешно выгружен",type:"success"})}).catch(()=>{this.$notify({title:"Выгрузка броней",text:"Ошибка выгрузки броней",type:"error"})})},nearestBookingList(){return this.$store.dispatch("nearestBookingList",{start_date:null,end_date:null}).then(o=>{console.log(o),this.counts=o.counts||[],this.bookings=o.bookings.data||[]}).catch(()=>{this.$notify({title:"Список броней",text:"Ошибка загрузки списка броней",type:"error"})})}},mounted(){this.nearestBookingList()}},g=o=>($("data-v-4d7b7857"),o=o(),T(),o),de=g(()=>e("button",{type:"button",class:"btn-info btn w-100 p-3 my-2","data-bs-toggle":"modal","data-bs-target":"#admin-booking-modal"},[e("i",{class:"fa-solid fa-calendar"}),u(" Выгрузить брони ")],-1)),ce={class:"modal fade",id:"admin-booking-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},be={class:"modal-dialog modal-fullscreen"},me={class:"modal-content"},ue=g(()=>e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Заголовок модального окна"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть"})],-1)),pe={class:"modal-body"},_e={class:"nav nav-tabs"},he={class:"nav-item"},ge={class:"nav-item"},ve={class:"nav-item"},fe=g(()=>e("h6",{class:"mb-2 mt-3 fw-bold"},"Выгрузить брони по дате",-1)),ye={class:"form-floating mb-2"},ke=g(()=>e("label",{for:"startDate",class:"form-label"},"С даты:",-1)),we={class:"form-floating mb-2"},$e=g(()=>e("label",{for:"endDate",class:"form-label"},"По дату:",-1)),Te=["disabled"],xe={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},De={key:1},Me={class:"mb-2 mt-3 fw-bold"},Be={key:0},Se={key:0,class:"table-responsive"},Ie={class:"table table-striped table-hover"},Ce=g(()=>e("thead",null,[e("tr",null,[e("th",null,"Дата"),e("th",null,"Время"),e("th",null,"Персон"),e("th",null,"Номер столика"),e("th",null,"Описание"),e("th",null,"На кого бронь"),e("th",null,"Номер телефона")])],-1)),Le={key:1,class:"alert alert-info mb-2 mt-3"},Ue=g(()=>e("h6",{class:"mb-2 mt-3 fw-bold"},"Ближайшие бронирования (по дате)",-1)),Ve={key:0,class:"list-group"},je={class:"list-group-item d-flex justify-content-between align-items-center"},Ne={class:"badge bg-primary rounded-pill"},Ee={key:1,class:"alert alert-info mb-2 mt-3"};function Fe(o,t,r,h,s,b){return i(),l(c,null,[de,e("div",ce,[e("div",be,[e("div",me,[ue,e("div",pe,[e("ul",_e,[e("li",he,[e("a",{onClick:t[0]||(t[0]=n=>s.tab="export"),class:y([{active:s.tab==="export"},"nav-link"]),"aria-current":"page",href:"javascript:void(0)"},"Экспорт",2)]),e("li",ge,[e("a",{onClick:t[1]||(t[1]=n=>s.tab="bookings"),class:y([{active:s.tab==="bookings"},"nav-link"]),"aria-current":"page",href:"javascript:void(0)"},"Список броней",2)]),e("li",ve,[e("a",{onClick:t[2]||(t[2]=n=>s.tab="counts"),class:y([{active:s.tab==="counts"},"nav-link"]),"aria-current":"page",href:"javascript:void(0)"},"Сводка",2)])]),d(e("div",null,[fe,e("form",{onSubmit:t[5]||(t[5]=I((...n)=>b.exportNearestBookings&&b.exportNearestBookings(...n),["prevent"]))},[e("div",ye,[d(e("input",{type:"date",id:"startDate","onUpdate:modelValue":t[3]||(t[3]=n=>s.startDate=n),class:"form-control"},null,512),[[p,s.startDate]]),ke]),e("div",we,[d(e("input",{type:"date",id:"endDate","onUpdate:modelValue":t[4]||(t[4]=n=>s.endDate=n),class:"form-control"},null,512),[[p,s.endDate]]),$e]),e("button",{type:"submit",class:"btn btn-primary w-100",disabled:s.loading},[s.loading?(i(),l("span",xe)):(i(),l("span",De,"Выгрузить"))],8,Te)],32)],512),[[k,s.tab==="export"]]),d(e("div",null,[e("h6",Me,[u("Бронирования на ближайшую неделю "),s.bookings.length>0?(i(),l("span",Be,"("+a(s.bookings.length)+" ед.)",1)):m("",!0)]),s.bookings.length>0?(i(),l("div",Se,[e("table",Ie,[Ce,e("tbody",null,[(i(!0),l(c,null,w(s.bookings,n=>{var f,D,M,B;return i(),l("tr",{key:n.id},[e("td",null,a(n.booked_date_at),1),e("td",null,a(n.booked_time_at),1),e("td",null,a((f=n.booked_info)==null?void 0:f.persons),1),e("td",null,a(n.number||"-"),1),e("td",null,a(((D=n.booked_info)==null?void 0:D.description)||"-"),1),e("td",null,a(((M=n.booked_info)==null?void 0:M.name)||"-"),1),e("td",null,a(((B=n.booked_info)==null?void 0:B.phone)||"-"),1)])}),128))])])])):(i(),l("div",Le," Бронирований за выбранный период не найдено. "))],512),[[k,s.tab==="bookings"]]),d(e("div",null,[Ue,s.counts.length>0?(i(),l("ul",Ve,[(i(!0),l(c,null,w(s.counts,n=>(i(),l("li",je,[u(a(n.date)+" ",1),e("span",Ne,a(n.total),1)]))),256))])):(i(),l("div",Ee," Пока нет ближайших бронирований. "))],512),[[k,s.tab==="counts"]])])])])])],64)}const qe=x(re,[["render",Fe],["__scopeId","data-v-4d7b7857"]]);const v=o=>($("data-v-2296ae45"),o=o(),T(),o),Oe={key:0},Re={key:0},Pe=v(()=>e("i",{class:"fa-solid fa-plus-square"},null,-1)),ze={key:1},Ae=v(()=>e("i",{class:"fa-solid fa-minus-square"},null,-1)),Ye={key:0,class:"list-group list-group-numbered mb-2"},Je={class:"list-group-item d-flex justify-content-between align-items-start"},He={class:"ms-2 me-auto"},Ke={class:"fw-bold mb-0"},We={class:"mb-0"},Ge={class:"mb-2 fst-italic"},Qe=["onClick"],Xe={class:"badge bg-primary rounded-pill"},Ze={key:1,class:"alert alert-light"},et=v(()=>e("h6",{class:"fw-bold"},"Столики на выбор",-1)),tt={class:"row row-cols-2"},st=["onClick"],ot={class:"border d-flex flex-column",style:{"font-size":"12px"}},nt={alt:"table",class:"table-img-small"},it={class:"fw-bold mb-0 px-2"},lt={class:"mb-2 px-2"},at={key:1,class:"alert alert-light"},rt={key:1,class:"navbar navbar-expand-sm fixed-bottom p-3 bg-transparent border-0",style:{"border-radius":"10px 10px 0px 0px"}},dt={class:"modal fade",id:"remove-booking-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ct={class:"modal-dialog modal-dialog-centered"},bt={class:"modal-content"},mt=v(()=>e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Удаление брони"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),ut={class:"modal-body"},pt={class:"mb-2"},_t={class:"fw-bold text-primary"},ht={class:"fw-bold text-primary"},gt={class:"w-100 d-flex justify-content-center"},vt=v(()=>e("button",{"data-bs-dismiss":"modal",class:"btn btn-secondary",type:"button"},"Нет, отменить ",-1)),ft={class:"modal fade",id:"booking-modal",tabindex:"-1","aria-labelledby":"mySimpleModalLabel","aria-hidden":"true"},yt={class:"modal-dialog modal-dialog-centered"},kt={class:"modal-content"},wt=v(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"mySimpleModalLabel"},"Бронирование столика"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Закрыть"})],-1)),$t={class:"modal-body"},Tt={name:"Booking",data(){return{show_my_bookings:!1,my_bookings:[],selectedTable:null}},computed:{self(){return window.self||null},bot(){return window.currentBot},sortedSelectedTables(){let o=this.bot.settings;return o.tables_variants?o.tables_variants.sort((t,r)=>t.seats-r.seats):[]}},mounted(){this.myUpcomingBookings()},methods:{goToTableMenu(){this.$router.push({name:"TableMenuV2"})},openRemoveModal(o){this.selectedTable=null,this.$nextTick(()=>{this.selectedTable=o;const t=document.getElementById("remove-booking-modal");new bootstrap.Modal(t).show()})},closeModal(){this.selectedTable=null,this.$nextTick(()=>{const o=document.getElementById("booking-modal");bootstrap.Modal.getInstance(o).hide(),this.myUpcomingBookings()})},openModal(o){this.selectedTable=null,this.$nextTick(()=>{this.selectedTable=o;const t=document.getElementById("booking-modal");new bootstrap.Modal(t).show()})},myUpcomingBookings(){return this.$store.dispatch("myUpcomingBookings").then(o=>{this.my_bookings=o.data||[]})},cancelBookingTable(){if(this.selectedTable)return this.$store.dispatch("cancelBookingTable",{bookingId:this.selectedTable.id}).then(o=>{this.$notify({title:"Бронирование",text:"Бронь столика успешно убрана!",type:"success"}),this.myUpcomingBookings();const t=document.getElementById("remove-booking-modal");bootstrap.Modal.getInstance(t).hide().hide()})}}},xt=Object.assign(Tt,{setup(o){return(t,r)=>{const h=C("lazy");return i(),l(c,null,[t.bot?(i(),l(c,{key:0},[t.sortedSelectedTables.length>0?(i(),l("div",Oe,[t.self.is_admin?(i(),S(qe,{key:0})):m("",!0),t.my_bookings.length>0?(i(),l(c,{key:1},[e("button",{onClick:r[0]||(r[0]=s=>t.show_my_bookings=!t.show_my_bookings),type:"button",class:"btn-primary btn w-100 p-3 mb-2"},[t.show_my_bookings?(i(),l("span",ze,[Ae,u(" Скрыть мои брони ")])):(i(),l("span",Re,[Pe,u(" Показать мои брони ")]))]),t.show_my_bookings?(i(),l(c,{key:0},[t.my_bookings.length>0?(i(),l("ol",Ye,[(i(!0),l(c,null,w(t.my_bookings,s=>{var b;return i(),l("li",Je,[e("div",He,[e("div",Ke," Бронь столика №"+a(s.number),1),e("p",We,"Дата "+a(s.booked_date_at)+" в "+a(s.booked_time_at),1),e("p",Ge,a(((b=s.booked_info)==null?void 0:b.description)||"-"),1),e("button",{onClick:n=>t.openRemoveModal(s),type:"button",class:"btn btn-danger w-100"},"Отменить ",8,Qe)]),e("span",Xe,a(s.booked_info.persons||1)+" чел.",1)])}),256))])):(i(),l("p",Ze," У вас нет актуальных забронированных столиков "))],64)):m("",!0)],64)):m("",!0),et,e("div",tt,[(i(!0),l(c,null,w(t.sortedSelectedTables,(s,b)=>(i(),l("div",{class:"col mb-2",onClick:n=>t.openModal(s),key:b},[e("div",ot,[d(e("img",nt,null,512),[[h,"/images/tables/"+s.image]]),e("p",it,"Столик №"+a(s.number),1),e("p",lt,a(s.description),1)])],8,st))),128))])])):(i(),l("p",at," Нет столиков для бронирования "))],64)):m("",!0),t.my_bookings.length>0?(i(),l("nav",rt,[e("button",{onClick:r[1]||(r[1]=(...s)=>t.goToTableMenu&&t.goToTableMenu(...s)),style:{"box-shadow":"1px 1px 6px 0px #0000004a"},class:"btn btn-primary w-100 p-3 rounded-3 shadow-lg d-flex justify-content-center align-items-center"}," Перейти к предзаказу ")])):m("",!0),e("div",dt,[e("div",ct,[e("div",bt,[mt,e("div",ut,[t.selectedTable?(i(),l(c,{key:0},[e("p",pt,[u("Вы точно хотите удалить бронь на "),e("strong",_t,a(t.selectedTable.booked_date_at||"-"),1),u(" для столика "),e("strong",ht,a(t.selectedTable.number||"-"),1),u("?")]),e("div",gt,[e("button",{onClick:r[2]||(r[2]=(...s)=>t.cancelBookingTable&&t.cancelBookingTable(...s)),style:{"margin-right":"10px"},class:"btn btn-danger",type:"button"},"Да, удалить "),vt])],64)):m("",!0)])])])]),e("div",ft,[e("div",yt,[e("div",kt,[wt,e("div",$t,[t.selectedTable?(i(),S(ae,{key:0,onSuccess:t.closeModal,onFailure:t.closeModal,"table-info":t.selectedTable},null,8,["onSuccess","onFailure","table-info"])):m("",!0)])])])])],64)}}}),Bt=x(xt,[["__scopeId","data-v-2296ae45"]]);export{Bt as T};
