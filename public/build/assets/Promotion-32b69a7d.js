import{R as w}from"./ReturnToBot-97343ef5.js";import{t as _,O as S,o as s,k as l,n as t,M as a,p as h,a0 as u,l as b,w as c,N as m,Y as f,L as k,a3 as g,F as I,K as T,H as p,a1 as y,j as C}from"./index.es-c4852431.js";import{K as v}from"./KeyboardConstructor-8a23a78e.js";import{_ as F}from"./KeyboardList-d27b148e.js";import{_ as U}from"./BotMediaList-9b4db56f.js";import{K as B}from"./vue-datepicker-ff2ff697.js";/* empty css             */import"./_plugin-vue_export-helper-c27b6911.js";import"./vue3-json-editor.esm.prod-a2876a2f.js";/* empty css                                                            */import"./v4-4a60fe23.js";import"./KeyboardCard-9a26d223.js";/* empty css                                                     */import"./Pagination-b758f7ed.js";/* empty css                                                   */const j={class:"mb-3"},P=t("i",{class:"fa-solid fa-xmark"},null,-1),N=[P],O={class:"mb-3"},q={class:"d-flex justify-content-between flex-wrap align-items-center mb-2"},K=t("label",{class:"form-label",id:"bot-main-channel"},"Канал для постов",-1),V=t("i",{class:"fa-brands fa-telegram mr-2 color-blue2-dark"},null,-1),M=[V],L=t("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),R=t("div",null,"Нужно ",-1),D={class:"mb-2"},E={class:"form-label d-flex justify-content-between align-items-center mb-2",id:"bot-domain"},z=t("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),H=t("div",null,"Нужно ",-1),J={class:"form-floating"},G={for:"floatingTextarea2"},Q={key:0},Y={class:"mb-2"},A={class:"form-check"},W=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения на странице (максимум 10) ",-1),X={key:0,class:"mb-2"},Z=t("h6",null,"Изображения на странице",-1),x={class:"d-flex justify-content-center flex-wrap"},ee={for:"photos",style:{"margin-right":"10px"},class:"photo-loader ml-2"},te={class:"row"},ne={key:0,class:"col-12 d-flex flex-wrap"},oe={class:"mb-2 img-preview",style:{"margin-right":"10px"}},se={class:"remove"},ie=["onClick"],le={class:"mb-2"},ae={class:"form-check"},re=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),me={key:1,class:"mb-2"},de={key:0},he={key:1},ce=t("button",{type:"submit",class:"btn btn-m btn-full mb-1 rounded-s text-uppercase font-900 shadow-s bg-green2-dark w-100"}," Отправить сообщение в канал ",-1),ue={data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,mailForm:{text:"",inline_keyboard:null,channel:null}}},computed:{currentBot(){return window.currentBot}},mounted(){window.addEventListener("select-telegram-channel-id",o=>{this.mailForm[o.detail.param]=o.detail.channel})},methods:{addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},submitMail(){let o=new FormData;if(Object.keys(this.mailForm).forEach(e=>{const n=this.mailForm[e]||"";typeof n=="object"?o.append(e,JSON.stringify(n)):o.append(e,n)}),this.photos.length>0)for(let e=0;e<this.photos.length;e++)o.append("photos[]",this.photos[e]);this.$store.dispatch("sendToChannel",{mailForm:o}).then(e=>{this.load=!0,this.photos=[],this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={text:"",channel:null,inline_keyboard:null},this.$botNotification.success("Отлично!","Сообщение успешно отправлено в канал!")}).catch(e=>{this.$botNotification.warning("Упс...","Ошибка отправки сообщения в канал")})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const e=o.target.files;for(let n=0;n<e.length;n++)this.photos.push(e[n])},requestChannelId(o){this.$botPages.telegramChannelHelper(o)},requestTelegramChannelId(){new RegExp("^d+$").test(this.mailForm.channel)||(this.mailForm.channel.indexOf("https://")!==-1&&(this.mailForm.channel="@"+this.mailForm.channel.split("https://t.me/")[1]),this.$store.dispatch("requestTelegramChannelId",{dataObject:{channel:this.mailForm.channel}}).then(e=>{e.ok&&(this.mailForm.channel=e.result.chat.id),e.ok&&this.$botNotification.success("Отлично","Канал успешно найден!"),e.ok||(this.$botNotification.warning("Ошибочка!","Неверно указанный канал"),this.mailForm.channel=null)}).catch(()=>{}))}}},pe=Object.assign(ue,{__name:"MailToChannel",setup(o){return(e,n)=>{const d=_("Popper"),r=S("lazy");return e.currentBot?(s(),l("form",{key:0,onSubmit:n[11]||(n[11]=y((...i)=>e.submitMail&&e.submitMail(...i),["prevent"]))},[t("div",j,[e.mailForm.channel!=null?(s(),l("button",{key:0,type:"button",class:"btn btn-outline-info",onClick:n[0]||(n[0]=i=>e.mailForm.channel=null)},N)):a("",!0),h(" , "),t("button",{type:"button",class:u(["btn",{"btn-info":e.mailForm.channel===e.currentBot.main_channel,"btn-outline-info":e.mailForm.channel!==e.currentBot.main_channel}]),onClick:n[1]||(n[1]=i=>e.mailForm.channel=e.currentBot.main_channel)},"Главный канал ",2),h(" , "),t("button",{type:"button",class:u(["btn",{"btn-info":e.mailForm.channel===e.currentBot.order_channel,"btn-outline-info":e.mailForm.channel!==e.currentBot.order_channel}]),onClick:n[2]||(n[2]=i=>e.mailForm.channel=e.currentBot.order_channel)},"Канал заказов ",2)]),t("div",O,[t("div",q,[K,t("span",{onClick:n[3]||(n[3]=i=>e.requestChannelId("channel"))},M),b(d,null,{content:c(()=>[R]),default:c(()=>[L]),_:1})]),m(t("input",{type:"text",class:"form-control",placeholder:"id канала","aria-label":"id канала","onUpdate:modelValue":n[4]||(n[4]=i=>e.mailForm.channel=i),maxlength:"255",onBlur:n[5]||(n[5]=(...i)=>e.requestTelegramChannelId&&e.requestTelegramChannelId(...i)),"aria-describedby":"bot-main-channel",required:""},null,544),[[f,e.mailForm.channel]])]),t("div",D,[t("label",E,[h(" Текстовое содержимое страницы "),b(d,null,{content:c(()=>[H]),default:c(()=>[z]),_:1})]),t("div",J,[m(t("textarea",{class:"form-control","onUpdate:modelValue":n[6]||(n[6]=i=>e.mailForm.text=i),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[f,e.mailForm.text]]),t("label",G,[h("Содержимое страницы "),e.mailForm.text?(s(),l("span",Q,k(e.mailForm.text.length)+"/4096 ",1)):a("",!0)])])]),t("div",Y,[t("div",A,[m(t("input",{class:"form-check-input","onUpdate:modelValue":n[7]||(n[7]=i=>e.need_page_images=i),type:"checkbox",id:"need-page-images"},null,512),[[g,e.need_page_images]]),W])]),e.need_page_images?(s(),l("div",X,[Z,t("div",x,[t("label",ee,[h(" + "),t("input",{type:"file",id:"photos",multiple:"",accept:"image/*",onChange:n[8]||(n[8]=(...i)=>e.onChangePhotos&&e.onChangePhotos(...i)),style:{display:"none"}},null,32)]),t("div",te,[e.photos.length>0?(s(),l("div",ne,[(s(!0),l(I,null,T(e.photos,(i,$)=>(s(),l("div",oe,[m(t("img",null,null,512),[[r,e.getPhoto(i).imageUrl]]),t("div",se,[t("a",{onClick:Je=>e.removePhoto($)},"Удалить",8,ie)])]))),256))])):a("",!0)])])])):a("",!0),t("div",le,[t("div",ae,[m(t("input",{class:"form-check-input","onUpdate:modelValue":n[9]||(n[9]=i=>e.need_inline_menu=i),type:"checkbox",id:"need-inline-menu"},null,512),[[g,e.need_inline_menu]]),re])]),e.need_inline_menu?(s(),l("div",me,[t("button",{class:u(["btn mb-2 w-100",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:n[10]||(n[10]=i=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(s(),l("span",he," Скрыть шаблоны меню")):(s(),l("span",de," Открыть шаблоны меню"))],2),e.showInlineTemplateSelector?(s(),p(F,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(s(),p(v,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])):a("",!0),ce],32)):a("",!0)}}}),be={class:"mb-2"},fe={class:"form-label d-flex justify-content-between align-items-center mb-1"},ge=t("i",{class:"fa-solid font-10 fa-star color-red2-dark"},null,-1),_e=t("div",null,"Нужно ",-1),ke={class:"mb-1 text-center"},ye={key:0},ve={class:"form-floating"},Fe={class:"mb-2"},$e={class:"mb-2"},we={class:"form-check"},Se=t("label",{class:"form-check-label",for:"need-page-images"}," Изображения в рассылке (максимум 10) ",-1),Ie={key:0,class:"mb-2"},Te={class:"mb-2"},Ce={class:"form-check"},Ue=t("label",{class:"form-check-label",for:"need-inline-menu"}," Меню под текстом страницы ",-1),Be={key:1,class:"mb-2"},je={key:0},Pe={key:1},Ne=t("button",{type:"submit",class:"btn btn-m btn-full my-3 rounded-xl text-uppercase font-900 shadow-s bg-green2-dark w-100"}," Поставить сообщение в очередь ",-1),Oe={components:{VueDatePicker:B},data(){return{load:!1,photos:[],showInlineTemplateSelector:!1,need_page_images:!1,need_inline_menu:!1,mailForm:{message:"",inline_keyboard:null,cron_time:null,images:[]}}},computed:{currentBot(){return window.currentBot}},mounted(){},methods:{selectImages(o){this.mailForm.images||(this.mailForm.images=[]);let e=this.mailForm.images.indexOf(o.file_id);e!==-1?this.mailForm.images.splice(e,1):this.mailForm.images.push(o.file_id)},addTextTo(o={param:null,text:null}){this.mailForm.channel=o.text},submitMail(){let o=new FormData;Object.keys(this.mailForm).forEach(e=>{const n=this.mailForm[e]||"";typeof n=="object"?o.append(e,JSON.stringify(n)):o.append(e,n)}),this.bot&&o.append("bot_id",this.bot.id),this.$store.dispatch("sendToQueue",{mailForm:o}).then(e=>{this.load=!0,this.need_inline_menu=!1,this.need_page_images=!1,this.mailForm={message:"",images:null,inline_keyboard:null},this.$botNotification.success("Отлично!","Сообщение успешно отправлено в очередь рассылки!"),this.$emit("callback")}).catch(e=>{this.$botNotification.warning("Упс...","Ошибка отправки сообщения в очередь")})},saveInlineKeyboard(o){this.mailForm.inline_keyboard=o},selectInlineKeyboard(o){this.mailForm.inline_keyboard=o,this.showInlineTemplateSelector=!1},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},removePhoto(o){this.photos.splice(o,1)},removeImage(o){this.mailForm.images.splice(o,1)},onChangePhotos(o){const e=o.target.files;for(let n=0;n<e.length;n++)this.photos.push(e[n])},requestChannelId(o){this.$botPages.telegramChannelHelper(o)},requestTelegramChannelId(){new RegExp("^d+$").test(this.mailForm.channel)||(this.mailForm.channel.indexOf("https://")!==-1&&(this.mailForm.channel="@"+this.mailForm.channel.split("https://t.me/")[1]),this.$store.dispatch("requestTelegramChannelId",{dataObject:{channel:this.mailForm.channel}}).then(e=>{e.ok&&(this.mailForm.channel=e.result.chat.id),e.ok&&this.$botNotification.success("Отлично","Канал успешно найден!"),e.ok||(this.$botNotification.warning("Ошибочка!","Неверно указанный канал"),this.mailForm.channel=null)}).catch(()=>{}))}}},qe=Object.assign(Oe,{__name:"MailToBot",setup(o){return(e,n)=>{const d=_("Popper");return e.currentBot?(s(),l("form",{key:0,onSubmit:n[5]||(n[5]=y((...r)=>e.submitMail&&e.submitMail(...r),["prevent"]))},[t("div",be,[t("label",fe,[h(" Текстовое содержимое рассылки "),b(d,null,{content:c(()=>[_e]),default:c(()=>[ge]),_:1})]),t("p",ke,[e.mailForm.message?(s(),l("span",ye,k(e.mailForm.message.length)+"/4096 ",1)):a("",!0)]),t("div",ve,[m(t("textarea",{class:"form-control","onUpdate:modelValue":n[0]||(n[0]=r=>e.mailForm.message=r),maxlength:"4096",placeholder:"Введите текст",id:"floatingTextarea2",style:{"min-height":"100px"},required:""},null,512),[[f,e.mailForm.message]])])]),t("div",Fe,[m(t("input",{type:"datetime-local",class:"form-control w-100","onUpdate:modelValue":n[1]||(n[1]=r=>e.mailForm.cron_time=r),required:""},null,512),[[f,e.mailForm.cron_time]])]),t("div",$e,[t("div",we,[m(t("input",{class:"form-check-input","onUpdate:modelValue":n[2]||(n[2]=r=>e.need_page_images=r),type:"checkbox",id:"need-page-images"},null,512),[[g,e.need_page_images]]),Se])]),e.need_page_images?(s(),l("div",Ie,[b(U,{"need-photo":!0,selected:e.mailForm.images,onSelect:e.selectImages},null,8,["selected","onSelect"])])):a("",!0),t("div",Te,[t("div",Ce,[m(t("input",{class:"form-check-input","onUpdate:modelValue":n[3]||(n[3]=r=>e.need_inline_menu=r),type:"checkbox",id:"need-inline-menu"},null,512),[[g,e.need_inline_menu]]),Ue])]),e.need_inline_menu?(s(),l("div",Be,[t("button",{class:u(["btn mb-2 w-100",{"btn-outline-primary":!e.showInlineTemplateSelector,"btn-primary":e.showInlineTemplateSelector}]),type:"button",onClick:n[4]||(n[4]=r=>e.showInlineTemplateSelector=!e.showInlineTemplateSelector)},[e.showInlineTemplateSelector?(s(),l("span",Pe," Скрыть шаблоны меню")):(s(),l("span",je," Открыть шаблоны меню"))],2),e.showInlineTemplateSelector?(s(),p(F,{key:0,class:"mb-2",type:"inline",onSelect:e.selectInlineKeyboard,"select-mode":!0},null,8,["onSelect"])):(s(),p(v,{key:1,type:"inline",onSave:e.saveInlineKeyboard,"edited-keyboard":e.mailForm.inline_keyboard},null,8,["onSave","edited-keyboard"]))])):a("",!0),Ne],32)):a("",!0)}}}),Ke={key:0},Ve={key:0,class:"card card-style"},Me={class:"content mb-2"},Le=t("p",{class:"mb-2"},"Выберите куда вы хотите отправить сообщение",-1),Re=t("div",{class:"divider divider-small my-3 bg-highlight"},null,-1),De={key:1,class:"card card-style bg-red2-dark"},Ee=t("div",{class:"content"},[t("h4",{class:"color-white"},"Внимание!"),t("p",{class:"color-white"}," Данная страница доступа только администраторам заведения! ")],-1),ze=[Ee],He={data(){return{tab:0,botUser:null,statistic:null,loading:!1}},computed:{...C(["getSelf"])},watch:{getSelf:function(){this.botUser=this.getSelf,this.prepareStatistic()}},mounted(){this.getSelf&&(this.botUser=this.getSelf,this.prepareStatistic())},methods:{prepareStatistic(){return this.$store.dispatch("statisticLoad").then(o=>{this.statistic=o.statistic})}}},at=Object.assign(He,{__name:"Promotion",setup(o){return(e,n)=>e.botUser?(s(),l("div",Ke,[e.botUser.is_admin?(s(),l("div",Ve,[t("div",Me,[Le,t("a",{href:"javascript:void(0)",onClick:n[0]||(n[0]=d=>e.tab=1),class:u([{"border-green2-dark color-green2-dark":e.tab===1,"border-teal-dark color-gray2-dark":e.tab!==1},"btn btn-border btn-m btn-full mb-2 rounded-0 text-uppercase font-900 bg-theme"])}," Рассылка в канал ",2),t("a",{href:"javascript:void(0)",onClick:n[1]||(n[1]=d=>e.tab=0),class:u([{"border-green2-dark color-green2-dark":e.tab===0,"border-teal-dark color-gray2-dark":e.tab!==0},"btn btn-border btn-m btn-full mb-2 rounded-0 text-uppercase font-900 bg-theme"])}," Рассылка в бота ",2),e.tab===1?(s(),p(pe,{key:0})):a("",!0),e.tab===0?(s(),p(qe,{key:1})):a("",!0),Re,b(w,{class:"mb-2"})])])):(s(),l("div",De,ze))])):a("",!0)}});export{at as default};
