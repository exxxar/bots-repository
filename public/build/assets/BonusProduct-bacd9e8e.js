import{g as b,o as s,j as i,l as e,G as p,L as r,k as c,K as l,n as d,F as g,J as k,a0 as h,M as u,W as m,N as w,$ as v,a7 as y}from"./index.es-db843bab.js";import{U}from"./UserInfo-2cba8465.js";/* empty css                                                   */import{R as _}from"./ReturnToBot-463a5d25.js";import"./UserSearchForm-ac77e6c7.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Pagination-ccc8cfc8.js";const C={key:0,id:"user-profile-info"},N={class:"card card-style bg-theme pb-0"},$={class:"content mb-0"},q={key:0,class:"card card-style"},B={class:"content"},F={class:"text-center"},S={class:"mb-0 text-center font-weight-bold"},D={class:"mb-0 text-center font-weight-bold"},j={key:0},O=e("i",{class:"fa-solid fa-rotate mr-1 color-green2-light"},null,-1),P={key:1},V=e("i",{class:"fa-solid fa-triangle-exclamation mr-1 color-red1-light"},null,-1),A={class:"mb-0"},L={class:"d-flex justify-content-around flex-wrap save-up"},M=["onClick"],T=["innerHTML"],R={key:1},z=e("i",{class:"fa-solid fa-question"},null,-1),E=[z],G=["disabled"],H={class:"mb-3"},J=e("label",{for:"user-name",class:"form-label"},"Запросите имя пользователя",-1),I={class:"mb-3"},K=e("label",{for:"user-phone",class:"form-label"},"Запросите телефон пользователя",-1),W=e("div",{class:"mb-1"},[e("button",{type:"submit",class:"btn btn-m btn-full rounded-s text-uppercase font-900 shadow-s bg-red1-light w-100"}," Обменять бонусы ")],-1),Q={data(){return{action:null,botUser:null,loading:!1,icon:null,icon_color:null,reloadable:!1,request_telegram_chat_id:null,need_show_form:!1,userForm:{name:null,phone:null}}},computed:{...b(["getSelf","getCashBack","getCashBackPaginateObject"]),currentBot(){return window.currentBot}},watch:{getSelf:function(){this.botUser=this.getSelf}},mounted(){this.getSelf&&(this.botUser=this.getSelf);const o=new URLSearchParams(window.location.search),t=JSON.parse(o.get("user"));t&&(this.request_telegram_chat_id=t,this.loadActionData())},methods:{requestClick(){if(this.loading){this.$botNotification.warning("Упс!","Вы уже выполняете это действие");return}this.loading=!0,this.$store.dispatch("bonusProductCheck",{dataObject:{user_telegram_chat_id:this.request_telegram_chat_id}}).then(o=>{this.loading=!1,this.loadActionData(),this.$botNotification.success("Отлично!","Вы успешно отметили бонус пользователю")}).catch(()=>{this.loading=!1,this.$botNotification.warning("Упс!","Что-то пошло не так!")})},exchange(){this.loading=!0,this.$store.dispatch("bonusProductExchange",{dataObject:{user_telegram_chat_id:this.request_telegram_chat_id,...this.userForm}}).then(o=>{this.loading=!1,this.need_show_form=!1,this.loadActionData(),this.$botNotification.success("Отлично!","Вы успешно обменяли бонусы пользователя на приз!")}).catch(()=>{this.loading=!1,this.need_show_form=!1,this.$botNotification.warning("Упс!","Что-то пошло не так!")})},completeClick(){this.$botNotification.success("Отлично!","В этой ячейке уже есть отметка о бонусе:)")},loadActionData(){this.loading=!0,this.$store.dispatch("loadActionData",{dataObject:{user_telegram_chat_id:this.request_telegram_chat_id}}).then(o=>{this.action=o.action,this.icon=o.icon,this.icon_color=o.icon_color,this.reloadable=o.reloadable,this.botUser=o.action.bot_user,this.userForm.name=this.botUser.name||this.botUser.fio_from_telegram||null,this.userForm.phone=this.botUser.phone||null,this.loading=!1}).catch(()=>{this.loading=!1})}}},at=Object.assign(Q,{__name:"BonusProduct",setup(o){return(t,n)=>{const f=w("mask");return t.request_telegram_chat_id?(s(),i("div",C,[e("div",N,[e("div",$,[t.botUser?(s(),p(U,{key:0,"bot-user":t.botUser},null,8,["bot-user"])):r("",!0),c(_,{class:"mb-3"})])]),t.action?(s(),i("div",q,[e("div",B,[e("h6",F,"Личная накопительная карта пользвателя #"+l(t.action.slug_id),1),e("p",S,l(t.action.slug.command||"Не указана"),1),e("p",D,[t.reloadable?(s(),i("span",j,[O,d("После обмена перезагружается по новой")])):(s(),i("span",P,[V,d("Единоразовая акция")]))]),e("p",A,l(t.action.slug.comment||"Не указан"),1),e("ul",L,[(s(!0),i(g,null,k(t.action.max_attempts||10,a=>(s(),i("li",{class:v({active:a<=t.action.current_attempts}),onClick:X=>a<=t.action.current_attempts?t.completeClick():t.requestClick()},[a<=t.action.current_attempts?(s(),i("span",{key:0,innerHTML:t.icon,style:y({color:t.icon_color})},null,12,T)):(s(),i("span",R,E))],10,M))),256))]),t.need_show_form?r("",!0):(s(),i("button",{key:0,type:"button",onClick:n[0]||(n[0]=h(a=>t.need_show_form=!0,["prevent"])),disabled:t.action.current_attempts!==t.action.max_attempts,class:"btn btn-m btn-full rounded-s text-uppercase font-900 shadow-s bg-green2-light w-100 mb-1"}," Обменять бонусы ",8,G)),t.need_show_form?(s(),i("form",{key:1,onSubmit:n[3]||(n[3]=h((...a)=>t.exchange&&t.exchange(...a),["prevent"]))},[e("div",H,[J,u(e("input",{type:"text",class:"form-control",id:"user-name","onUpdate:modelValue":n[1]||(n[1]=a=>t.userForm.name=a),placeholder:"Имя пользователя",required:""},null,512),[[m,t.userForm.name]])]),e("div",I,[K,u(e("input",{type:"text",class:"form-control",id:"user-phone","onUpdate:modelValue":n[2]||(n[2]=a=>t.userForm.phone=a),placeholder:"Номер телефона пользователя",required:""},null,512),[[f,"+7(###)###-##-##"],[m,t.userForm.phone]])]),W],32)):r("",!0),c(_)])])):r("",!0)])):r("",!0)}}});export{at as default};
