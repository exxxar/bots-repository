import{o as l,j as r,l as e,a0 as U,M as p,W as g,F as h,T as C,U as P,N as T,a2 as x,L as _,J as $,$ as w,K as b,a6 as F,n as v,g as j,a8 as B,G as L,q as E,k as D}from"./index.es-db843bab.js";import{_ as S}from"./_plugin-vue_export-helper-c27b6911.js";import{P as R}from"./Pagination-ccc8cfc8.js";/* empty css                                                   */const z={data(){return{telegramInput:"",modal:null}},mounted(){this.modal=new bootstrap.Modal(document.getElementById("add-partner-modal"))},methods:{openModal(){this.modal.show()},handleSubmit(){const s=this.processTelegramLink(this.telegramInput);let t=new FormData;t.append("telegram_domain",s),this.$store.dispatch("storePartner",{form:t}).then(a=>{this.load=!0,this.telegramInput="",this.$notify({title:"Добавление партнера",text:"Партнер успешно добавлен",type:"success"}),this.modal.hide(),this.$emit("callback")}).catch(a=>{this.$notify({title:"Добавление партнера",text:a.response.data.message||"Ошибка добавления партнера",type:"error"})})},processTelegramLink(s){let t=s.trim();return t.startsWith("https://t.me/")?t=t.replace("https://t.me/",""):t.startsWith("@")&&(t=t.replace("@","")),t}}},V=s=>(C("data-v-4139fdee"),s=s(),P(),s),A={class:"navbar navbar-expand-sm fixed-bottom p-3 bg-transparent border-0",style:{"border-radius":"10px 10px 0px 0px","z-index":"999!important"}},N={class:"container text-center"},W={class:"modal fade",id:"add-partner-modal",tabindex:"-1","aria-labelledby":"add-partner-modal-label","aria-hidden":"true"},J={class:"modal-dialog"},q={class:"modal-content"},G=V(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"add-partner-modal-label"},"Добавление партнера"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),K={class:"modal-body"},Q=V(()=>e("p",{class:"alert alert-light border-secondary mb-2"}," Настройка партнера происходит после его добавления ",-1)),H={class:"mb-3 form-floating"},X=V(()=>e("label",{for:"telegram",class:"form-label"},"Ссылка на Telegram-бота",-1)),Y=V(()=>e("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Добавить",-1));function Z(s,t,a,n,o,c){return l(),r(h,null,[e("nav",A,[e("div",N,[e("button",{class:"btn text-center btn-primary w-100 p-3 rounded-3 shadow-lg",onClick:t[0]||(t[0]=(...d)=>c.openModal&&c.openModal(...d))}," Добавить партнера ")])]),e("div",W,[e("div",J,[e("div",q,[G,e("div",K,[Q,e("form",{onSubmit:t[2]||(t[2]=U((...d)=>c.handleSubmit&&c.handleSubmit(...d),["prevent"]))},[e("div",H,[p(e("input",{type:"text",class:"form-control",id:"telegram","onUpdate:modelValue":t[1]||(t[1]=d=>o.telegramInput=d),placeholder:"Введите ссылку на Telegram-бота"},null,512),[[g,o.telegramInput]]),X]),Y],32)])])])])],64)}const ee=S(z,[["render",Z],["__scopeId","data-v-4139fdee"]]);const te={props:["initialData"],data(){return{file:null,preview:null,activeTab:"partner",labels:{partner:{organization_name:"Название организации",inn:"ИНН",ogrn:"ОГРН",kpp:"КПП",legal_address:"Юридический адрес",actual_address:"Фактический адрес",email:"E-mail",phone:"Телефон",status:"Статус"},contract:{contract_number:"Номер договора",contract_name:"Название",start_date:"Дата начала",end_date:"Дата окончания",contract_status:"Статус",total_amount:"Сумма"},contact:{full_name:"ФИО",position:"Должность",email:"E-mail",phone:"Телефон"},document:{file_name:"Файл",document_type:"Тип документа"}},tabs:[{key:"partner",label:"Партнёр"},{key:"contract",label:"Договор"},{key:"contacts",label:"Контакты"},{key:"documents",label:"Документы"}],form:{id:null,title:"",description:"",image:"",is_active:!0,extra_charge:0,demo_mode:!0,config:{excludes:[],bg_color:"transparent"},legal_info:{partner:{organization_name:"ООО «Альфа-Партнер»",legal_form:"ООО",inn:"7701234567",ogrn:"1027700132195",kpp:"770101001",registration_date:"2015-04-10",legal_address:"г. Москва, ул. Центральная, д. 12",actual_address:"г. Москва, ул. Центральная, д. 14",bank_name:"ПАО Сбербанк",bik:"044525225",checking_account:"40702810900000012345",correspondent_account:"30101810400000000225",email:"info@alfapartner.ru",phone:"+7 (495) 123-45-67",status:"Активен",notes:"Надёжный партнёр, сотрудничество с 2018 года"},contacts:[{full_name:"Иванов Сергей Петрович",position:"Генеральный директор",email:"ivanov@alfapartner.ru",phone:"+7 (495) 555-12-34"},{full_name:"Кузнецова Анна Дмитриевна",position:"Юрист",email:"kuznetsova@alfapartner.ru",phone:"+7 (495) 555-12-35"}],contracts:{contract_number:"ДГ-2025/14",contract_name:"Договор на оказание консультационных услуг",contract_type:"Услуги",start_date:"2025-02-01",end_date:"2026-02-01",contract_status:"Подписан",total_amount:12e5,currency:"RUB",payment_terms:"Оплата в течение 10 рабочих дней после выставления счёта",responsible_person:"Петров И.А.",signed_by:"Иванов С.П.",signature_date:"2025-01-28",auto_renewal:!1,termination_reason:null},documents:[{file_name:"Договор_ДГ-2025-14.pdf",file_path:"/docs/contracts/ДГ-2025-14.pdf",document_type:"Договор",uploaded_at:"2025-01-28T14:12:00",verified:!0,comment:"Подписан обеими сторонами"}]}}}},computed:{bot(){return window.currentBot||null}},mounted(){this.initialData&&(this.form={...this.initialData})},methods:{addContract(){this.form.legal_info.contracts.value.push({id:Date.now(),partner_id:1})},addContact(){this.form.legal_info.contacts.value.push({id:Date.now(),partner_id:1})},addDocument(){this.form.legal_info.documents.value.push({id:Date.now(),contract_id:10})},onFileChange(s){const t=s.target.files[0];this.file=t,t&&(this.preview=URL.createObjectURL(t)),this.$emit("select",t)},handleSubmit(){let s=new FormData;Object.keys(this.form).forEach(t=>{const a=this.form[t]||"";typeof a=="object"?s.append(t,JSON.stringify(a)):s.append(t,a)}),this.file&&s.append("file",this.file),this.$store.dispatch("updatePartner",{form:s}).then(t=>{this.$notify({title:"Отлично!",text:"Параметры успешно сохранены",type:"success"})}).catch(t=>{this.$notify({title:"Упс!",text:"Ошибка сохранения параметров",type:"error"})})}}},y=s=>(C("data-v-e64183e7"),s=s(),P(),s),se={class:"form-check form-switch mb-2"},oe=y(()=>e("label",{class:"form-check-label",for:"flexSwitchCheck"}," Активен ",-1)),ae={class:"mb-2 form-floating"},ne=y(()=>e("label",{for:"title"},"Заголовок",-1)),le={class:"mb-2 form-floating"},ie=y(()=>e("label",{for:"description"},"Описание",-1)),re={class:"form-floating mb-2 file-floating"},de=y(()=>e("label",{for:"imageInput"},"Загрузить изображение",-1)),ce={key:0,class:"mb-2"},me={class:"card"},pe={class:"card-body"},_e=["src"],ue={key:1,class:"mb-2"},he={class:"card"},fe={class:"card-body"},be={class:"img-fluid rounded border img-preview"},ge={class:"mb-2 form-floating"},ve=y(()=>e("label",{for:"extra_charge"},"Дополнительная плата",-1)),ye={class:"form-check form-switch mb-2"},we=y(()=>e("label",{class:"form-check-label",for:"flexSwitchCheck"}," Режим тестирования ",-1)),$e={class:"nav nav-tabs mb-2"},ke=["onClick"],xe=y(()=>e("h4",null,"Данные партнёра",-1)),Ce={class:"row row-cols-1"},Pe={class:"form-floating"},Se=["onUpdate:modelValue","id"],Fe=["for"],Ue=y(()=>e("h4",null,"Контракт",-1)),Ve={class:"row row-cols-1"},Ie={class:"form-floating"},Me=["onUpdate:modelValue","id"],Le=["for"],De=y(()=>e("h4",null,"Контактные лица",-1)),Te=y(()=>e("div",{class:"divider my-3"},"Контакт",-1)),je={class:"row row-cols-1"},Oe={class:"form-floating"},Be=["onUpdate:modelValue","id"],Ee=["for"],Re=["onClick"],ze=y(()=>e("h4",null,"Документы",-1)),Ae=["onClick"],Ne={class:"row row-cols-1"},We={class:"form-floating"},Je=["onUpdate:modelValue","id"],qe=["for"],Ge=y(()=>e("nav",{class:"navbar navbar-expand-sm fixed-bottom p-3 bg-transparent border-0",style:{"border-radius":"10px 10px 0px 0px"}},[e("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Отправить")],-1));function Ke(s,t,a,n,o,c){const d=T("lazy");return l(),r("form",{onSubmit:t[8]||(t[8]=U((...i)=>c.handleSubmit&&c.handleSubmit(...i),["prevent"]))},[e("div",se,[p(e("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheck","onUpdate:modelValue":t[0]||(t[0]=i=>o.form.is_active=i)},null,512),[[x,o.form.is_active]]),oe]),e("div",ae,[p(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[1]||(t[1]=i=>o.form.title=i),placeholder:"Введите заголовок"},null,512),[[g,o.form.title]]),ne]),e("div",le,[p(e("textarea",{class:"form-control",id:"description",style:{"min-height":"200px"},"onUpdate:modelValue":t[2]||(t[2]=i=>o.form.description=i),placeholder:"Введите описание"},null,512),[[g,o.form.description]]),ie]),e("div",re,[e("input",{type:"file",class:"form-control",id:"imageInput",accept:"image/*",onChange:t[3]||(t[3]=(...i)=>c.onFileChange&&c.onFileChange(...i))},null,32),de]),o.preview?(l(),r("div",ce,[e("div",me,[e("div",pe,[e("img",{src:o.preview,class:"img-fluid rounded border img-preview"},null,8,_e)])])])):_("",!0),o.form.image?(l(),r("div",ue,[e("div",he,[e("div",fe,[p(e("img",be,null,512),[[d,"/images-by-bot-id/"+c.bot.id+"/"+o.form.image]])])])])):_("",!0),e("div",ge,[p(e("input",{type:"number",class:"form-control",id:"extra_charge","onUpdate:modelValue":t[4]||(t[4]=i=>o.form.extra_charge=i),placeholder:"Введите дополнительную плату"},null,512),[[g,o.form.extra_charge]]),ve]),e("div",ye,[p(e("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCheck","onUpdate:modelValue":t[5]||(t[5]=i=>o.form.demo_mode=i)},null,512),[[x,o.form.demo_mode]]),we]),o.form.demo_mode?_("",!0):(l(),r(h,{key:2},[e("ul",$e,[(l(!0),r(h,null,$(o.tabs,i=>(l(),r("li",{class:"nav-item",key:i.key},[e("button",{type:"button",class:w(["nav-link",{active:o.activeTab===i.key}]),onClick:m=>o.activeTab=i.key},b(i.label),11,ke)]))),128))]),p(e("template",null,[xe,e("div",Ce,[(l(!0),r(h,null,$(o.form.legal_info.partner,(i,m)=>(l(),r("div",{class:"col mb-2",key:m},[e("div",Pe,[p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":k=>s.partner[m]=k,id:"partner_"+m,placeholder:" "},null,8,Se),[[g,s.partner[m]]]),e("label",{for:"partner_"+m},b(o.labels.partner[m]||m),9,Fe)])]))),128))])],512),[[F,o.activeTab==="partner"]]),p(e("template",null,[Ue,e("div",Ve,[(l(!0),r(h,null,$(o.form.legal_info.contract,(i,m)=>(l(),r("div",{class:"col mb-2",key:m},[e("div",Ie,[p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":k=>o.form.legal_info.contract[m]=k,id:"contract_"+m,placeholder:" "},null,8,Me),[[g,o.form.legal_info.contract[m]]]),e("label",{for:"contract_"+m},b(o.labels.contract[m]||m),9,Le)])]))),128))])],512),[[F,o.activeTab==="contract"]]),p(e("template",null,[De,(l(!0),r(h,null,$(o.form.legal_info.contacts,(i,m)=>(l(),r("div",{key:"contact-"+m,class:"rounded mb-2 position-relative"},[Te,e("div",je,[(l(!0),r(h,null,$(i,(k,f)=>(l(),r("div",{class:"col mb-2",key:f},[e("div",Oe,[p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":M=>i[f]=M,id:"contact_"+f+m,placeholder:" "},null,8,Be),[[g,i[f]]]),e("label",{for:"contact_"+f+m},b(o.labels.contact[f]||f),9,Ee)])]))),128))]),e("button",{class:"btn btn-sm btn-danger w-100",onClick:k=>o.form.legal_info.contacts.splice(m,1)}," Удалить контакт ",8,Re)]))),128)),e("button",{class:"btn btn-outline-primary",onClick:t[6]||(t[6]=(...i)=>c.addContact&&c.addContact(...i))},"+ Добавить контакт")],512),[[F,o.activeTab==="contacts"]]),p(e("template",null,[ze,(l(!0),r(h,null,$(o.form.legal_info.documents,(i,m)=>(l(),r("div",{key:"doc"+m,class:"border rounded p-3 mb-2 position-relative"},[e("button",{class:"btn btn-sm btn-danger position-absolute top-0 end-0 m-2",onClick:k=>o.form.legal_info.documents.splice(m,1)}," Удалить документ ",8,Ae),e("div",Ne,[(l(!0),r(h,null,$(i,(k,f)=>(l(),r("div",{class:"col mb-2",key:f},[e("div",We,[p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":M=>i[f]=M,id:"doc_"+f+m,placeholder:" "},null,8,Je),[[g,i[f]]]),e("label",{for:"doc_"+f+m},b(o.labels.document[f]||f),9,qe)])]))),128))])]))),128)),e("button",{class:"btn btn-outline-primary",onClick:t[7]||(t[7]=(...i)=>c.addDocument&&c.addDocument(...i))},"+ Добавить документ")],512),[[F,o.activeTab==="documents"]])],64)),Ge],32)}const Qe=S(te,[["render",Ke],["__scopeId","data-v-e64183e7"]]);const He={props:["partner"],data(){return{extra_charge:0,need_product_config:!1}},computed:{excludes(){var s;return((s=this.partner.config)==null?void 0:s.excludes)||[]}},mounted(){this.extra_charge=this.partner.extra_charge||0},methods:{changeStatus(s,t){var o;let a=((o=this.partner.config)==null?void 0:o.excludes)||[],n=a.indexOf(s);n===-1?a.push(s):a.splice(n,1),this.partner.config.excludes=a,this.$store.dispatch("changePartnerProductStatus",{product_id:s,partner_id:this.partner.id,status:t}).then(c=>{}).catch(()=>{})}}},O=s=>(C("data-v-9b93497d"),s=s(),P(),s),Xe={class:"form-floating mb-2"},Ye=O(()=>e("label",{for:""},"Наценка, %",-1)),Ze={class:"form-check form-switch mb-2"},et=O(()=>e("label",{class:"form-check-label",for:"need_product_config"},"Режим настройки отображения товаров",-1)),tt={key:0,class:"list-group"},st={class:"mb-0 d-flex justify-content-between align-items-center"},ot={key:0,class:"badge bg-primary"},at={key:1,class:"badge bg-info"},nt={key:0,class:"row row-cols-1"},lt={class:"col"},it={class:"d-flex mt-2 mb-2 justify-content-center"},rt={class:"btn-group",role:"group","aria-label":"Basic radio toggle button group"},dt=["onChange","checked","name","id"],ct=["for"],mt=["onChange","checked","name","id"],pt=["for"];function _t(s,t,a,n,o,c){return l(),r(h,null,[e("div",Xe,[p(e("input",{type:"number","onUpdate:modelValue":t[0]||(t[0]=d=>o.extra_charge=d),class:"form-control",placeholder:"Поиск страницы"},null,512),[[g,o.extra_charge]]),Ye]),e("div",Ze,[p(e("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=d=>o.need_product_config=d),type:"checkbox",role:"switch",id:"need_product_config"},null,512),[[x,o.need_product_config]]),et]),a.partner?(l(),r("ul",tt,[(l(!0),r(h,null,$(a.partner.products,(d,i)=>(l(),r("li",{class:w([{"bg-exclude":c.excludes.indexOf(d.id)!==-1},"list-group-item"])},[e("p",st,[v(b(d.title)+" ",1),o.extra_charge===0?(l(),r("span",ot,b(d.current_price||0)+"₽",1)):(l(),r("span",at,b(parseFloat(d.current_price)+parseFloat((d.current_price*o.extra_charge/100).toFixed(2)))+"₽",1))]),o.need_product_config?(l(),r("div",nt,[e("div",lt,[e("div",it,[e("div",rt,[e("input",{type:"radio",onChange:m=>c.changeStatus(d.id,0),checked:c.excludes.indexOf(d.id)===-1,class:"btn-check",name:"config-partner-product-"+d.id,id:"config-partner-product1-"+d.id,autocomplete:"off"},null,40,dt),e("label",{class:"btn btn-outline-primary",for:"config-partner-product1-"+d.id},"Отображать",8,ct),e("input",{type:"radio",onChange:m=>c.changeStatus(d.id,1),checked:c.excludes.indexOf(d.id)!==-1,class:"btn-check",name:"config-partner-product-"+d.id,id:"config-partner-product2-"+d.id,autocomplete:"off"},null,40,mt),e("label",{class:"btn btn-outline-primary",for:"config-partner-product2-"+d.id},"Не отображать",8,pt)])])])])):_("",!0)],2))),256))])):_("",!0)],64)}const ut=S(He,[["render",_t],["__scopeId","data-v-9b93497d"]]);const u=s=>(C("data-v-09dd2fae"),s=s(),P(),s),ht={class:"input-group mb-2"},ft={class:"form-floating"},bt=u(()=>e("label",{for:"floatingInput"},"Критерии поиска",-1)),gt=u(()=>e("button",{class:"btn btn-outline-secondary text-primary",type:"submit",id:"button-addon2"}," Найти ",-1)),vt={class:"form-floating my-2"},yt=E('<option value="title" data-v-09dd2fae>По названию</option><option value="is_active" data-v-09dd2fae>Активные</option><option value="product_count" data-v-09dd2fae>По числу товаров</option><option value="updated_at" data-v-09dd2fae>По дате добавления</option><option value="updated_at" data-v-09dd2fae>По дате договора</option>',5),wt=[yt],$t=u(()=>e("label",{for:"floatingSelect"},"Сортировать заказы по",-1)),kt={key:0},xt=u(()=>e("i",{class:"fa-solid fa-caret-up"},null,-1)),Ct=u(()=>e("i",{class:"fa-solid fa-caret-down"},null,-1)),Pt={class:"row row-cols-1 mb-5"},St={class:"card-body"},Ft={class:"card-title fw-bold"},Ut={class:"card-text"},Vt=u(()=>e("strong",null,"Число товаров: ",-1)),It=u(()=>e("br",null,null,-1)),Mt=u(()=>e("strong",null,"Договор работает до: ",-1)),Lt=u(()=>e("br",null,null,-1)),Dt=u(()=>e("strong",null,"Статус: ",-1)),Tt={class:"card-footer d-flex justify-content-between align-items-center"},jt={class:"btn-group"},Ot=["onClick"],Bt=u(()=>e("i",{class:"fa-solid fa-pen-to-square"},null,-1)),Et=[Bt],Rt=["onClick"],zt=u(()=>e("i",{class:"fa-solid fa-store"},null,-1)),At=[zt],Nt={class:"form-switch form-check"},Wt=["id","onUpdate:modelValue"],Jt=["for"],qt=["onClick"],Gt=u(()=>e("i",{class:"fa-solid fa-trash"},null,-1)),Kt=[Gt],Qt={class:"modal fade",id:"config-partner-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Ht={class:"modal-dialog modal-fullscreen"},Xt={class:"modal-content"},Yt=u(()=>e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Настройка партнера"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Zt={class:"modal-body"},es={class:"modal fade",id:"products-partner-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ts={class:"modal-dialog modal-fullscreen"},ss={class:"modal-content"},os=u(()=>e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Настройка товаров"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),as={class:"modal-body"},ns={class:"modal fade",id:"remove-partner-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ls={class:"modal-dialog modal-dialog-centered"},is={class:"modal-content"},rs=u(()=>e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Удаление партнера"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),ds={class:"modal-body"},cs={class:"mb-2"},ms={class:"fw-bold text-primary"},ps={class:"w-100 d-flex justify-content-center"},_s=u(()=>e("button",{"data-bs-dismiss":"modal",class:"btn btn-secondary",type:"button"},"Нет, отменить ",-1)),us={data(){return{sort:{param:"id",direction:"desc"},loading:!1,selected:null,search:null,config_modal:null,remove_modal:null,partners:[],partners_paginate_object:null}},computed:{...j(["getPartners","getPartnersPaginateObject"]),filteredPartners(){return this.search?(this.partners||[]).filter(s=>{const t=s.title.toLowerCase().includes((this.search||"").toLowerCase()),a=this.sort.param?s.status===this.sort.param:!0;return t&&a}):this.partners||[]}},mounted(){this.config_modal=new bootstrap.Modal(document.getElementById("config-partner-modal")),this.remove_modal=new bootstrap.Modal(document.getElementById("remove-partner-modal")),this.products_modal=new bootstrap.Modal(document.getElementById("products-partner-modal")),this.loadPartners()},methods:{changeDirection(s){this.sort.direction=s,this.loadPartners(0)},nextPartners(s){this.loadPartners(s)},selectPartnerForProductObserve(s){this.selected=null,this.$nextTick(()=>{this.selected=s,this.products_modal.show()})},selectPartnerForRemove(s){this.selected=null,this.$nextTick(()=>{this.selected=s,this.remove_modal.show()})},selectPartner(s){this.selected=null,this.$nextTick(()=>{this.selected=s,this.config_modal.show()})},loadPartners(s=0){this.loading=!0,this.$store.dispatch("loadPartners",{dataObject:{...this.search?{search:this.search}:{},...this.sort.param?{order_by:this.sort.param}:{},direction:this.sort.direction||"asc"},page:s}).then(t=>{this.partners=(this.getPartners||[]).map(a=>({...a,products:Array.isArray(a.products)?a.products:[],contract_expiration:a.contract_expiration||"-"})),this.partners_paginate_object=this.getPartnersPaginateObject||null,this.loading=!1}).catch(t=>{this.loading=!1,console.error("LOAD PARTNERS ERROR:",t)})},removePartner(){if(!this.selected)return;let s=this.partners.findIndex(t=>t.id===this.selected.id);s!==-1&&(this.partners[s].before_deleted=!0),this.$store.dispatch("removePartner",{partnerId:this.selected.id}).then(t=>{this.$notify({title:"Управление партнерами",text:"Партнер успешно удален!",type:"success"}),this.remove_modal.hide(),this.loadPartners()}).catch(()=>{this.$notify({title:"Управление партнерами",text:"Ошибка удаления партнера!",type:"error"}),this.remove_modal.hide()})},applyFilters(){this.loadPartners()}}},hs=Object.assign(us,{__name:"PartnerList",setup(s){return(t,a)=>(l(),r(h,null,[e("form",{onSubmit:a[3]||(a[3]=U((...n)=>t.applyFilters&&t.applyFilters(...n),["prevent"])),class:"mt-2 mb-2"},[e("div",ht,[e("div",ft,[p(e("input",{type:"text",class:"form-control",placeholder:"Поиск партнера","aria-label":"Поиск партнера","onUpdate:modelValue":a[0]||(a[0]=n=>t.search=n),"aria-describedby":"button-addon2"},null,512),[[g,t.search]]),bt]),gt]),e("div",vt,[p(e("select",{onChange:a[1]||(a[1]=(...n)=>t.applyFilters&&t.applyFilters(...n)),"onUpdate:modelValue":a[2]||(a[2]=n=>t.sort.param=n),class:"form-select",id:"floatingSelect","aria-label":"Floating label select example"},wt,544),[[B,t.sort.param]]),$t])],32),t.sort.param!=null?(l(),r("p",kt,[v("Направление сортировки: "),t.sort.direction==="asc"?(l(),r("span",{key:0,class:"fw-bold",onClick:a[4]||(a[4]=n=>t.changeDirection("desc"))},[v("по возрастанию "),xt])):_("",!0),t.sort.direction==="desc"?(l(),r("span",{key:1,class:"fw-bold",onClick:a[5]||(a[5]=n=>t.changeDirection("asc"))},[v("по убыванию "),Ct])):_("",!0)])):_("",!0),!t.loading&&(t.partners||[]).length>0?(l(),r(h,{key:1},[e("div",Pt,[(l(!0),r(h,null,$(t.partners,(n,o)=>{var c;return l(),r("div",{class:"col",key:n.id},[e("div",{class:w(["card mb-2",{"border-danger":n.before_deleted}])},[e("div",St,[e("h5",Ft,b(n.title),1),e("p",Ut,[Vt,v(" "+b(((c=n.products)==null?void 0:c.length)||0),1),It,Mt,v(" "+b(n.contract_expiration||"-"),1),Lt,Dt,e("span",{class:w({"text-success":n.is_active,"text-danger":!n.is_active})},b(n.is_active?"Активен":"Не активен"),3)])]),e("div",Tt,[e("div",jt,[e("button",{type:"button",onClick:d=>t.selectPartner(n),class:"btn btn-primary"},Et,8,Ot),e("button",{type:"button",onClick:d=>t.selectPartnerForProductObserve(n),class:"btn btn-primary"},At,8,Rt)]),e("div",Nt,[p(e("input",{type:"checkbox",class:"form-check-input",id:"is_active-partner-"+n.id,"onUpdate:modelValue":d=>n.is_active=d},null,8,Wt),[[x,n.is_active]]),e("label",{class:"form-check-label",for:"is_active-partner-"+n.id},b(n.is_active?"Активен":"Не активен"),9,Jt)]),e("button",{type:"button",onClick:d=>t.selectPartnerForRemove(n),class:"btn btn-danger"},Kt,8,qt)])],2)])}),128))]),t.partners_paginate_object?(l(),L(R,{key:0,simple:!0,onPagination_page:t.nextPartners,pagination:t.partners_paginate_object},null,8,["onPagination_page","pagination"])):_("",!0)],64)):_("",!0),e("div",Qt,[e("div",Ht,[e("div",Xt,[Yt,e("div",Zt,[t.selected?(l(),L(Qe,{key:0,"initial-data":t.selected},null,8,["initial-data"])):_("",!0)])])])]),e("div",es,[e("div",ts,[e("div",ss,[os,e("div",as,[t.selected?(l(),L(ut,{key:0,partner:t.selected},null,8,["partner"])):_("",!0)])])])]),e("div",ns,[e("div",ls,[e("div",is,[rs,e("div",ds,[t.selected?(l(),r(h,{key:0},[e("p",cs,[v("Вы точно хотите удалить "),e("strong",ms,b(t.selected.title||"этого партнера"),1),v("?")]),e("div",ps,[e("button",{onClick:a[6]||(a[6]=(...n)=>t.removePartner&&t.removePartner(...n)),style:{"margin-right":"10px"},class:"btn btn-danger",type:"button"},"Да, удалить "),_s])],64)):_("",!0)])])])])],64))}}),fs=S(hs,[["__scopeId","data-v-09dd2fae"]]);const bs={props:["modelValue"],data(){return{file:null,preview:null,form:{title:"",description:"",image:"",config:{excludes:[],bg_color:"transparent"}}}},computed:{bot(){return window.currentBot||null}},mounted(){var s,t;(s=this.bot.settings)!=null&&s.partners&&(this.form={...(t=this.bot.settings)==null?void 0:t.partners})},methods:{addContract(){this.form.legal_info.contracts.value.push({id:Date.now(),partner_id:1})},addContact(){this.form.legal_info.contacts.value.push({id:Date.now(),partner_id:1})},addDocument(){this.form.legal_info.documents.value.push({id:Date.now(),contract_id:10})},onFileChange(s){const t=s.target.files[0];this.file=t,t&&(this.preview=URL.createObjectURL(t)),this.$emit("select",t)},handleSubmit(){let s=new FormData;Object.keys(this.form).forEach(t=>{const a=this.form[t]||"";typeof a=="object"?s.append(t,JSON.stringify(a)):s.append(t,a)}),this.file&&s.append("file",this.file),this.$store.dispatch("updateSelfPartner",{form:s}).then(t=>{this.$notify({title:"Отлично!",text:"Параметры успешно сохранены",type:"success"}),this.$emit("success")}).catch(t=>{this.$notify({title:"Упс!",text:"Ошибка сохранения параметров",type:"error"})})}}},I=s=>(C("data-v-d0dd1e30"),s=s(),P(),s),gs={class:"mb-2 form-floating"},vs=I(()=>e("label",{for:"title"},"Заголовок",-1)),ys={class:"mb-2 form-floating"},ws=I(()=>e("label",{for:"description"},"Описание",-1)),$s={class:"form-floating mb-2 file-floating"},ks=I(()=>e("label",{for:"imageInput"},"Загрузить изображение",-1)),xs={key:0,class:"mb-2"},Cs={class:"card"},Ps={class:"card-body"},Ss=["src"],Fs={key:1,class:"mb-2"},Us={class:"card"},Vs={class:"card-body"},Is={class:"img-fluid rounded border img-preview"},Ms=I(()=>e("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Отправить",-1));function Ls(s,t,a,n,o,c){const d=T("lazy");return l(),r("form",{onSubmit:t[3]||(t[3]=U((...i)=>c.handleSubmit&&c.handleSubmit(...i),["prevent"]))},[e("div",gs,[p(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=i=>o.form.title=i),placeholder:"Введите заголовок"},null,512),[[g,o.form.title]]),vs]),e("div",ys,[p(e("textarea",{class:"form-control",id:"description",style:{"min-height":"200px"},"onUpdate:modelValue":t[1]||(t[1]=i=>o.form.description=i),placeholder:"Введите описание"},null,512),[[g,o.form.description]]),ws]),e("div",$s,[e("input",{type:"file",class:"form-control",id:"imageInput",accept:"image/*",onChange:t[2]||(t[2]=(...i)=>c.onFileChange&&c.onFileChange(...i))},null,32),ks]),o.preview?(l(),r("div",xs,[e("div",Cs,[e("div",Ps,[e("img",{src:o.preview,class:"img-fluid rounded border img-preview"},null,8,Ss)])])])):_("",!0),o.form.image?(l(),r("div",Fs,[e("div",Us,[e("div",Vs,[p(e("img",Is,null,512),[[d,"/images-by-bot-id/"+c.bot.id+"/"+o.form.image]])])])])):_("",!0),Ms],32)}const Ds=S(bs,[["render",Ls],["__scopeId","data-v-d0dd1e30"]]),Ts={class:"container py-3"},js={class:"row"},Os={class:"col-12"},Bs={class:"form-check form-switch mb-2"},Es={class:"form-check-label",for:"partners-is_active"},Rs={class:"form-check form-switch mb-2"},zs={class:"form-check-label",for:"partners-display_self"},As={class:"col-12"},Ns={class:"col-12"},Ws={class:"nav nav-tabs justify-content-center catalog-tabs"},Js={class:"nav-item"},qs={class:"nav-item"},Gs={key:0,class:"col-12"},Ks={class:"modal fade",id:"self-config-partner-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Qs={class:"modal-dialog modal-fullscreen"},Hs={class:"modal-content"},Xs=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Настройка партнера"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ys={class:"modal-body"},Zs={data(){return{config_modal:null,loading:!1,tab:0,form:{is_active:!1,display_self:!1}}},computed:{...j(["getSelf"]),currentBot(){return window.currentBot},tg(){return window.Telegram.WebApp}},mounted(){var s,t,a,n,o,c;this.config_modal=new bootstrap.Modal(document.getElementById("self-config-partner-modal")),this.form.is_active=((a=(t=(s=this.currentBot)==null?void 0:s.settings)==null?void 0:t.partners)==null?void 0:a.is_active)??!1,this.form.display_self=((c=(o=(n=this.currentBot)==null?void 0:n.settings)==null?void 0:o.partners)==null?void 0:c.display_self)??!1},methods:{callbackAddPartner(){this.loading=!0,this.$nextTick(()=>{this.loading=!1})},openSelfConfigModal(){this.config_modal.show()},closeSelfConfigModal(){this.config_modal.hide()},updatePartnersSettings(){this.$store.dispatch("updatePartnersSettings",this.form).then(s=>{}).catch(()=>{})},loadPartners(){this.$store.dispatch("loadPartners",{}).then(s=>{}).catch(()=>{})}}},ao=Object.assign(Zs,{__name:"Partners",setup(s){return(t,a)=>(l(),r(h,null,[e("div",Ts,[e("div",js,[e("div",Os,[e("div",Bs,[p(e("input",{class:"form-check-input",type:"checkbox",onChange:a[0]||(a[0]=(...n)=>t.updatePartnersSettings&&t.updatePartnersSettings(...n)),"onUpdate:modelValue":a[1]||(a[1]=n=>t.form.is_active=n),role:"switch",id:"partners-is_active"},null,544),[[x,t.form.is_active]]),e("label",Es,[v("Режим работы с партнерами "),e("span",{class:w({"text-primary fw-bold":t.form.is_active})},"вкл",2),v(" \\ "),e("span",{class:w({"text-primary fw-bold":!t.form.is_active})},"выкл",2)])]),e("div",Rs,[p(e("input",{class:"form-check-input",type:"checkbox",onChange:a[2]||(a[2]=(...n)=>t.updatePartnersSettings&&t.updatePartnersSettings(...n)),"onUpdate:modelValue":a[3]||(a[3]=n=>t.form.display_self=n),role:"switch",id:"partners-display_self"},null,544),[[x,t.form.display_self]]),e("label",zs,[v("Отображать себя в списке "),e("span",{class:w({"text-primary fw-bold":t.form.display_self})},"вкл",2),v(" \\ "),e("span",{class:w({"text-primary fw-bold":!t.form.display_self})},"выкл",2)])])]),e("div",As,[t.form.display_self?(l(),r("button",{key:0,onClick:a[4]||(a[4]=(...n)=>t.openSelfConfigModal&&t.openSelfConfigModal(...n)),type:"button",class:"btn btn-outline-primary p-3 w-100 mb-2"},"Свои параметры отображения ")):_("",!0)]),e("div",Ns,[e("ul",Ws,[e("li",Js,[e("button",{type:"button",class:w(["nav-link",{active:t.tab===0}]),onClick:a[5]||(a[5]=n=>t.tab=0),style:{"font-weight":"bold"},"aria-current":"page"},"Партнеры ",2)]),e("li",qs,[e("button",{type:"button",disabled:!0,class:w(["nav-link",{active:t.tab===1}]),style:{"font-weight":"bold"}},"Статистика продаж ",2)])])]),t.loading?_("",!0):(l(),r("div",Gs,[D(fs),D(ee,{onCallback:t.callbackAddPartner},null,8,["onCallback"])]))])]),e("div",Ks,[e("div",Qs,[e("div",Hs,[Xs,e("div",Ys,[D(Ds,{onSuccess:t.closeSelfConfigModal},null,8,["onSuccess"])])])])])],64))}});export{ao as default};
