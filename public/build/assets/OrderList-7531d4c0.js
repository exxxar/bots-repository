import{o as i,k as o,n as t,L as d,p as l,F as c,K as h,M as r,H as u,j as v,N as _,Y as k,a0 as p,a9 as y,l as w}from"./index.es-c4852431.js";import{P as g}from"./Pagination-b758f7ed.js";import{_ as b}from"./ReviewCard-d61947e0.js";const $={class:"mb-2 d-flex justify-content-between w-100 align-items-center"},O={class:"badge bg-primary"},j={key:0,style:{"font-size":"12px"}},C=t("i",{class:"fa-solid fa-check mr-2 text-success"},null,-1),B={key:1,style:{"font-size":"12px"}},V=t("i",{class:"fa-solid fa-xmark mr-1 text-danger"},null,-1),P=t("i",{class:"fa-solid fa-stopwatch mr-1 text-primary"},null,-1),I={key:0},U={class:"mb-2"},S={class:"fw-bold"},R=["disabled"],T={key:0,class:"color-white"},z={key:1,class:"color-white"},D={props:["item"],data(){return{spent_time_counter:0}},mounted(){localStorage.getItem("cashman_order_cashback_add_counter")!=null&&(this.is_requested=!0,this.startTimer(localStorage.getItem("cashman_order_cashback_add_counter")||0))},methods:{addCashBack(){this.startTimer(),this.$store.dispatch("addCashBackToOrder",{order_id:this.item.id}).then(()=>{this.item.is_cashback_crediting=!0,this.$notify({title:"Отзывы",text:"Вы успешно начислили CashBack пользователю",type:"success"})}).catch(()=>{this.item.is_cashback_crediting=!1,this.$notify({title:"Отзывы",text:"Ошибка начисления CashBack",type:"error"})})},select(s){return this.$emit("select",s)},startTimer(s){this.spent_time_counter=s!=null?Math.min(s,10):10;let e=setInterval(()=>{this.spent_time_counter>0?this.spent_time_counter--:(clearInterval(e),this.is_requested=!1,this.spent_time_counter=null),localStorage.setItem("cashman_order_cashback_add_counter",this.spent_time_counter)},1e3)}}},M=Object.assign(D,{__name:"OrderItem",setup(s){return(e,a)=>(i(),o("div",{onClick:a[2]||(a[2]=n=>e.select(s.item)),style:{"font-weight":"bold"},class:"list-group-item d-flex justify-content-between p-3 align-items-start flex-column","aria-current":"true"},[t("p",$,[t("span",O,"Заказ #"+d(s.item.id),1),s.item.is_cashback_crediting?(i(),o("span",j,[C,l(" Баллы начислены")])):(i(),o("span",B,[V,l(" Баллы не начислены")]))]),t("p",null,[P,l(" Время заказа "+d(s.item.created_at),1)]),(s.item.product_details||[]).length>0?(i(),o("ul",I,[(i(!0),o(c,null,h(s.item.product_details[0].products,n=>(i(),o("li",null,d(n.title),1))),256))])):r("",!0),t("p",U,[l("Цена заказа: "),t("strong",S,d(s.item.summary_price)+" руб.",1)]),s.item.review?(i(),u(b,{key:1,"is-admin":!0,modelValue:s.item.review,"onUpdate:modelValue":a[0]||(a[0]=n=>s.item.review=n)},null,8,["modelValue"])):r("",!0),s.item.is_cashback_crediting?r("",!0):(i(),o("button",{key:2,type:"button",disabled:e.spent_time_counter>0,onClick:a[1]||(a[1]=(...n)=>e.addCashBack&&e.addCashBack(...n)),class:"btn btn-outline-success w-100 mt-2"},[e.spent_time_counter<=0?(i(),o("span",T,"Начислить баллы")):(i(),o("span",z,"Осталось ждать "+d(e.spent_time_counter||0)+" сек.",1))],8,R))]))}}),N={class:"row"},q={class:"col-12"},A=t("h5",{class:"my-3"},[t("i",{class:"fa-solid fa-list-check mr-1 text-primary"}),l(" Список заказов")],-1),F={class:"form-floating mb-2"},L=t("label",{for:"floatingInput"},"Поиск по заказам",-1),E={class:"col-12"},G={class:"nav nav-tabs justify-content-center"},H={class:"nav-item"},K={class:"nav-item"},W={key:0,class:"col-12"},Y={class:"form-floating my-2"},J=t("option",{value:"id"},"По номеру заказа",-1),Q=t("option",{value:"is_cashback_crediting"},"По начислению CashBack",-1),X=t("option",{value:"summary_price"},"По цене заказа",-1),Z=t("option",{value:"product_count"},"По числу товара в заказе",-1),x=t("option",{value:"updated_at"},"По дате добавления",-1),ee=t("label",{for:"floatingSelect"},"Сортировать заказы по",-1),te={key:0},se=t("i",{class:"fa-solid fa-caret-up"},null,-1),ie=t("i",{class:"fa-solid fa-caret-down"},null,-1),ae={key:1,class:"list-group my-2"},oe={key:2,class:"d-flex flex-column justify-content-center align-items-center",style:{height:"100vh"}},ne=t("div",{class:"d-flex justify-content-center flex-column align-items-center"},[t("i",{class:"fa-brands fa-shopify mb-3",style:{"font-size":"36px"}}),t("p",null,"Заказов еще нет:(")],-1),re=[ne],le={key:1,class:"col-12"},de=t("hr",null,null,-1),ce={props:["botUser"],data(){return{search:null,tab:0,sort:{param:"id",direction:"desc"},orders:null,orders_paginate_object:null,reviews:[],reviews_paginate_object:null}},computed:{...v(["getOrders","getOrdersPaginateObject","inCart","getReviews","getReviewsPaginateObject"]),tg(){return window.Telegram.WebApp}},mounted(){this.loadOrders(),this.tg.BackButton.show(),this.tg.BackButton.onClick(()=>{document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(s=>s.click()),this.$router.push({name:"MenuV2"})})},methods:{changeDirection(s){this.sort.direction=s,this.loadOrders(0)},loadProductInOrders(s=0){return this.tab=1,this.$store.dispatch("loadReviews",{dataObject:{bot_user_id:this.botUser?this.botUser.id:null},page:s||0,size:20}).then(()=>{this.reviews=this.getReviews,this.reviews_paginate_object=this.getReviewsPaginateObject})},nextOrders(s){this.loadOrders(s)},nextReviews(s){this.loadProductInOrders(s)},loadOrders(s=0){return this.$store.dispatch("loadAllOrders",{dataObject:{search:this.search||null,order_by:this.sort.param||null,direction:this.sort.direction||"asc",bot_user_id:this.botUser?this.botUser.id:null},page:s,size:20}).then(()=>{this.orders=this.getOrders,this.orders_paginate_object=this.getOrdersPaginateObject})}}},_e=Object.assign(ce,{__name:"OrderList",setup(s){return(e,a)=>(i(),o("div",N,[t("div",q,[A,t("div",F,[_(t("input",{type:"search","onUpdate:modelValue":a[0]||(a[0]=n=>e.search=n),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[k,e.search]]),L])]),t("div",E,[t("ul",G,[t("li",H,[t("a",{class:p(["nav-link",{active:e.tab===0}]),onClick:a[1]||(a[1]=n=>e.tab=0),"aria-current":"page",href:"javascript:void(0)"},"Заказы",2)]),t("li",K,[t("a",{class:p(["nav-link",{active:e.tab===1}]),onClick:a[2]||(a[2]=n=>e.loadProductInOrders(0)),href:"javascript:void(0)"},"Товары",2)])])]),e.tab===0?(i(),o("div",W,[t("div",Y,[_(t("select",{onChange:a[3]||(a[3]=n=>e.loadOrders(0)),"onUpdate:modelValue":a[4]||(a[4]=n=>e.sort.param=n),class:"form-select",id:"floatingSelect","aria-label":"Floating label select example"},[J,Q,l(" > "),X,Z,x],544),[[y,e.sort.param]]),ee]),e.sort.param!=null?(i(),o("p",te,[l("Направление сортировки: "),e.sort.direction==="asc"?(i(),o("span",{key:0,class:"fw-bold",onClick:a[5]||(a[5]=n=>e.changeDirection("desc"))},[l("по возрастанию "),se])):r("",!0),e.sort.direction==="desc"?(i(),o("span",{key:1,class:"fw-bold",onClick:a[6]||(a[6]=n=>e.changeDirection("asc"))},[l("по убыванию "),ie])):r("",!0)])):r("",!0),(e.orders||[]).length>0?(i(),o("div",ae,[(i(!0),o(c,null,h(e.orders,n=>(i(),u(M,{item:n},null,8,["item"]))),256))])):(i(),o("div",oe,re)),e.orders_paginate_object?(i(),u(g,{key:3,simple:!0,onPagination_page:e.nextOrders,pagination:e.orders_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):r("",!0),e.tab===1?(i(),o("div",le,[(i(!0),o(c,null,h(e.reviews,(n,m)=>(i(),o(c,null,[w(b,{"is-admin":!0,modelValue:e.reviews[m],"onUpdate:modelValue":f=>e.reviews[m]=f,"need-product":!0},null,8,["modelValue","onUpdate:modelValue"]),de],64))),256)),e.reviews_paginate_object?(i(),u(g,{key:0,simple:!0,onPagination_page:e.nextReviews,pagination:e.reviews_paginate_object},null,8,["onPagination_page","pagination"])):r("",!0)])):r("",!0)]))}});export{M as _,_e as a};
