import{g,o as a,j as l,l as o,M as r,W as p,a2 as u,n as c,$ as v,L as d,a0 as k,F as h,J as y,K as m,G as _,N as F,q as $}from"./index.es-db843bab.js";import"./GlobalSlugList-fd77aef1.js";import{P as w}from"./Pagination-4f4ca1a4.js";import"./_plugin-vue_export-helper-c27b6911.js";const P={class:"form-floating mb-2"},j=o("label",{for:"floatingInput"},"Текст промокода",-1),I={class:"form-floating mb-2"},V=o("label",{for:"floatingTextarea"}," Назначение промокода",-1),M={class:"form-check form-switch mb-2"},T=o("label",{class:"form-check-label",for:"is_active"},"Доступен для активации",-1),x={class:"form-floating mb-2"},B=o("label",{for:"floatingInput"}," Максимальное число активаций кода",-1),S={class:"alert alert-light mb-2"},U={class:"form-check form-switch mb-2"},O=o("label",{class:"form-check-label",for:"discount_in_percent"},"Скидка в процентах",-1),q={key:0,class:"form-floating mb-2"},D=o("label",{for:"floatingInput"}," Величина скидки \\ баллов, руб",-1),L={key:1,class:"form-floating mb-2"},E=o("label",{for:"floatingInput"}," Величина скидки \\ баллов, %",-1),N={class:"form-floating mb-2"},z=o("label",{for:"floatingInput"}," Сумма активации от... руб",-1),A={class:"form-floating mb-2"},G=o("label",{for:"floatingInput"},"Доступен до...",-1),J={class:"form-check form-switch mb-2"},R=o("label",{class:"form-check-label",for:"is_active"},"Сгенерировать красивый сертификат",-1),W={type:"submit",class:"btn btn-primary w-100 p-3"},K={key:0},H={key:1},Q={props:["code"],data(){return{step:0,load:!1,need_reset:!1,promoCodeForm:{id:null,code:null,description:null,cashback_amount:0,max_activation_count:1,is_active:!0,available_to:null,activate_price:0,need_certificate:!0,config:{discount_in_percent:!1}}}},computed:{...g(["getSelf"]),bot(){return window.currentBot}},watch:{promoCodeForm:{handler(s){this.need_reset=!0},deep:!0},"promoCodeForm.config.discount_in_percent":{handler(s){this.promoCodeForm.config.discount_in_percent&&this.promoCodeForm.cashback_amount>100&&(this.promoCodeForm.cashback_amount=50)},deep:!0}},mounted(){this.code&&this.$nextTick(()=>{this.promoCodeForm={id:this.code.id||null,description:this.code.description||null,code:this.code.code||null,cashback_amount:this.code.cashback_amount||0,max_activation_count:this.code.max_activation_count||1,is_active:this.code.is_active||!1,available_to:this.code.available_to?this.$filters.local(this.code.available_to):null},this.code.config&&(this.promoCodeForm.config={discount_in_percent:this.code.config.discount_in_percent||!1})})},methods:{submitForm(){let s=new FormData;Object.keys(this.promoCodeForm).forEach(e=>{const t=this.promoCodeForm[e]||"";typeof t=="object"?s.append(e,JSON.stringify(t)):s.append(e,t)}),s.append("bot_id",this.bot.id),this.$store.dispatch("storePromoCodes",{promoCodeForm:s}).then(e=>{this.promoCodeForm={id:null,code:null,description:null,cashback_amount:0,max_activation_count:1,is_active:!0,need_certificate:!0,config:{discount_in_percent:!1}},this.$emit("callback",e.data),this.$notify("Промокод успешно создан")}).catch(e=>{this.$notify("Ошибка создания промокода")})}}},X=Object.assign(Q,{__name:"PromoCodesForm",setup(s){return(e,t)=>(a(),l("form",{onSubmit:t[10]||(t[10]=k((...i)=>e.submitForm&&e.submitForm(...i),["prevent"]))},[o("div",P,[r(o("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>e.promoCodeForm.code=i),maxlength:"255",class:"form-control",required:"",id:"floatingInput",placeholder:"name@example.com"},null,512),[[p,e.promoCodeForm.code]]),j]),o("div",I,[r(o("textarea",{class:"form-control",maxlength:"255","onUpdate:modelValue":t[1]||(t[1]=i=>e.promoCodeForm.description=i),placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,512),[[p,e.promoCodeForm.description]]),V]),o("div",M,[r(o("input",{class:"form-check-input","onUpdate:modelValue":t[2]||(t[2]=i=>e.promoCodeForm.is_active=i),type:"checkbox",role:"switch",id:"is_active"},null,512),[[u,e.promoCodeForm.is_active]]),T]),o("div",x,[r(o("input",{type:"number",step:"1",min:"1","onUpdate:modelValue":t[3]||(t[3]=i=>e.promoCodeForm.max_activation_count=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[p,e.promoCodeForm.max_activation_count]]),B]),o("div",S,[c(" Данный параметр позволяет настроить скидку при покупке товаров в магазине в "),o("span",{class:v(["text-primary",{"fw-bold":e.promoCodeForm.config.discount_in_percent}])},"%",2),c(" или в "),o("span",{class:v(["text-primary",{"fw-bold":!e.promoCodeForm.config.discount_in_percent}])},"рублях",2)]),o("div",U,[r(o("input",{class:"form-check-input","onUpdate:modelValue":t[4]||(t[4]=i=>e.promoCodeForm.config.discount_in_percent=i),type:"checkbox",role:"switch",id:"discount_in_percent"},null,512),[[u,e.promoCodeForm.config.discount_in_percent]]),O]),e.promoCodeForm.config.discount_in_percent?d("",!0):(a(),l("div",q,[r(o("input",{type:"number",step:"1",min:"1","onUpdate:modelValue":t[5]||(t[5]=i=>e.promoCodeForm.cashback_amount=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[p,e.promoCodeForm.cashback_amount]]),D])),e.promoCodeForm.config.discount_in_percent?(a(),l("div",L,[r(o("input",{type:"number",step:"1",min:"1",max:"100","onUpdate:modelValue":t[6]||(t[6]=i=>e.promoCodeForm.cashback_amount=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[p,e.promoCodeForm.cashback_amount]]),E])):d("",!0),o("div",N,[r(o("input",{type:"number",step:"1",min:"0","onUpdate:modelValue":t[7]||(t[7]=i=>e.promoCodeForm.activate_price=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[p,e.promoCodeForm.activate_price]]),z]),o("div",A,[r(o("input",{type:"datetime-local","onUpdate:modelValue":t[8]||(t[8]=i=>e.promoCodeForm.available_to=i),class:"form-control",id:"floatingInput",placeholder:"name@example.com"},null,512),[[p,e.promoCodeForm.available_to]]),G]),o("div",J,[r(o("input",{class:"form-check-input","onUpdate:modelValue":t[9]||(t[9]=i=>e.promoCodeForm.need_certificate=i),type:"checkbox",role:"switch",id:"need_certificate"},null,512),[[u,e.promoCodeForm.need_certificate]]),R]),o("button",W,[e.promoCodeForm.id==null?(a(),l("span",K,"Создать промокод")):(a(),l("span",H,"Обновить промокод"))])],32))}}),Y={class:"row"},Z={class:"col-12"},oo={class:"input-group mb-2"},eo={class:"form-floating"},to=o("label",{for:"floatingInput"},"Поиск промокода",-1),so={class:"row"},io={class:"col-12"},ao={class:"form-floating"},no=$('<option value="id">По номеру</option><option value="code">Код</option><option value="description">Описание</option><option value="cashback_amount">Сумма скидки</option><option value="is_active">Активные</option><option value="max_activation_count">Максимальное число активаций </option><option value="updated_at">По дате обновления</option>',7),lo=[no],ro=o("label",{for:"floatingSelect"},"Тип сортировки",-1),co={key:0,class:"mb-2"},mo=o("i",{class:"fa-solid fa-caret-up"},null,-1),po=o("i",{class:"fa-solid fa-caret-down"},null,-1),uo={key:0,class:"row row-cols-1"},ho={class:"col mb-2"},_o={class:"card"},fo={class:"card-header d-flex justify-content-between align-items-center bg-transparent"},bo={key:0,class:"fa-solid fa-chevron-down text-success"},vo={key:1,class:"fa-solid fa-xmark text-danger"},go=["onClick"],Co={class:"card-body"},ko=["onClick"],yo={class:"card-text mb-2 fst-italic"},Fo={class:"card-text mb-0 d-flex justify-content-between"},$o={class:"fw-bold"},wo={key:0},Po={key:1},jo={class:"fw-bold"},Io={key:1},Vo=o("div",{class:"alert alert-warning alert-dismissible fade show mb-2",role:"alert"},[o("strong",null,"Внимание!"),c(" Вы еще не добавили ни одного промокода! "),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close"})],-1),Mo={class:"position-relative p-5 text-center text-muted bg-body border border-dashed rounded-2"},To={class:"d-flex justify-content-center mb-3"},xo={alt:"",width:"100",height:"100"},Bo=o("h1",{class:"text-body-emphasis"},"Создание промокода",-1),So=o("p",{class:"col-lg-8 mx-auto fs-6 text-muted"}," Промокод - это инструмент мотивации пользователей пользоваться вашим сервисом. Он позволяет клиентам получать некоторые бонусы за активацию кода, а вы в свою очередь будете видеть статистику активация прмокода. ",-1),Uo={class:"row"},Oo={class:"col-12"},qo={class:"modal fade",id:"remove-promo-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Do={class:"modal-dialog modal-dialog-centered"},Lo={key:0,class:"modal-content"},Eo={class:"modal-body"},No={class:"d-flex justify-content-center w-100 flex-row-reverse"},zo=o("button",{type:"button",class:"btn btn-secondary ml-2",style:{"margin-left":"10px"},"data-bs-dismiss":"modal"},"Нет, отменить ",-1),Ao={data(){return{direction:"desc",order:"updated_at",selected:null,remove_promocode_modal:null,show:!0,loading:!0,codes:[],search:null,paginate_object:null}},computed:{...g(["getSelf","getPromoCodes","getPromoCodesPaginateObject"]),bot(){return window.currentBot}},mounted(){this.remove_promocode_modal=new bootstrap.Modal(document.getElementById("remove-promo-modal"),{}),this.loadPromoCodes()},methods:{changeDirection(s){this.direction=s,this.loadPromoCodes(0)},prepareForRemove(s){this.selected=null,this.$nextTick(()=>{this.selected=s,this.remove_promocode_modal.show()})},removeCode(){this.selected&&(this.loading=!0,this.$store.dispatch("removePromoCodes",{promoCodeId:this.selected.id}).then(s=>{this.loading=!1,this.loadPromoCodes(0),this.$notify({type:"success",text:"Промокод успешно удален"}),this.remove_promocode_modal.hide()}).catch(()=>{this.loading=!1,this.$notify({type:"error",text:"Ошибка удаления промокода"}),this.remove_promocode_modal.hide()}))},createPromoCode(){this.$emit("create")},nextPromoCodes(s){this.loadPromoCodes(s)},selectEvent(s){this.$emit("select",s)},loadPromoCodes(s=0){this.loading=!0,this.$store.dispatch("loadPromoCodes",{dataObject:{bot_id:this.bot.id||null,search:this.search,order:this.order,direction:this.direction},page:s,size:20}).then(e=>{this.loading=!1,this.codes=this.getPromoCodes,this.paginate_object=this.getPromoCodesPaginateObject}).catch(()=>{this.loading=!1})}}},Go=Object.assign(Ao,{__name:"PromoCodesList",setup(s){return(e,t)=>{const i=F("lazy");return a(),l(h,null,[o("div",Y,[o("div",Z,[o("div",oo,[o("div",eo,[r(o("input",{type:"search","onUpdate:modelValue":t[0]||(t[0]=n=>e.search=n),class:"form-control border-light",id:"floatingInput",placeholder:"name@example.com"},null,512),[[p,e.search]]),to]),o("button",{class:"btn btn-outline-light text-secondary",onClick:t[1]||(t[1]=n=>e.loadPromoCodes(0)),type:"button",id:"promocode-search-and-filter"},"Найти ")])])]),o("div",so,[o("div",io,[o("div",ao,[e.order?(a(),l("select",{key:0,class:"form-select",onChange:t[2]||(t[2]=n=>e.loadPromoCodes(0)),id:"floatingSelect","aria-label":"Floating label select example"},lo,32)):d("",!0),ro]),e.order!=null?(a(),l("p",co,[c("Направление сортировки: "),e.direction==="asc"?(a(),l("span",{key:0,class:"fw-bold",onClick:t[3]||(t[3]=n=>e.changeDirection("desc"))},[c("по возрастанию "),mo])):d("",!0),e.direction==="desc"?(a(),l("span",{key:1,class:"fw-bold",onClick:t[4]||(t[4]=n=>e.changeDirection("asc"))},[c("по убыванию "),po])):d("",!0)])):d("",!0)])]),e.codes.length>0?(a(),l("div",uo,[(a(!0),l(h,null,y(e.codes,(n,oe)=>{var f,b;return a(),l("div",ho,[o("div",_o,[o("div",fo,[o("span",null,[n.is_active?(a(),l("i",bo)):(a(),l("i",vo)),c(" #"+m(n.id),1)]),n.deleted_at==null?(a(),l("a",{key:0,href:"javascript:void(0)",onClick:C=>e.prepareForRemove(n),style:{"font-size":"12px"},class:"btn btn-link"}," Удалить ",8,go)):d("",!0),o("span",null,m(n.current_activation_count||0)+" / "+m(n.max_activation_count),1)]),o("div",Co,[o("h5",{onClick:C=>e.selectEvent(n),class:"card-title fw-bold"},m(n.code||"Не указано"),9,ko),o("p",yo,m(n.description||"Не указано"),1),o("p",Fo,[o("span",null,[c(" Скидка:"),o("strong",$o,[c("-"+m(n.cashback_amount||0)+" ",1),(f=n.config)!=null&&f.discount_in_percent?d("",!0):(a(),l("span",wo,"руб")),(b=n.config)!=null&&b.discount_in_percent?(a(),l("span",Po,"%")):d("",!0)])]),o("span",null,[c("Активация от: "),o("strong",jo,m(n.activate_price||0)+" руб",1)])])])])])}),256))])):(a(),l("div",Io,[Vo,o("div",Mo,[o("div",To,[r(o("img",xo,null,512),[[i,"/images/icon.png"]])]),Bo,So])])),o("div",Uo,[o("div",Oo,[e.paginate_object&&e.codes.length>0?(a(),_(w,{key:0,onPagination_page:e.nextPromoCodes,pagination:e.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])]),o("div",qo,[o("div",Do,[e.selected?(a(),l("div",Lo,[o("div",Eo,[o("p",null,"Вы действительно хотите удалить "+m(e.selected.code||e.selected.id||"этот промокод")+"?",1),o("div",No,[zo,o("button",{type:"button",onClick:t[5]||(t[5]=(...n)=>e.removeCode&&e.removeCode(...n)),class:"btn btn-primary"},"Да, удалить ")])])])):d("",!0)])])],64)}}}),Jo={class:"container py-2"},Ro={class:"modal fade",id:"promocode-form",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Wo={class:"modal-dialog modal-fullscreen"},Ko={class:"modal-content"},Ho=o("div",{class:"modal-header"},[o("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Редактор"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Qo={class:"modal-body"},Xo={class:"col-12"},Yo={class:"fixed-footer p-3"},Zo={props:["bot"],data(){return{part:0,tab:0,promocodeFormModal:null,selectedPromoCode:null,loadForm:!1,loadTable:!1}},computed:{tg(){return window.Telegram.WebApp}},mounted(){this.promocodeFormModal=new bootstrap.Modal("#promocode-form",{}),this.tg.BackButton.show(),this.tg.BackButton.onClick(()=>{document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(s=>s.click()),this.$router.back()})},methods:{callbackForm(){this.loadTable=!0,this.selectedPromoCode=null,this.promocodeFormModal.hide(),this.$nextTick(()=>{this.loadTable=!1})},createPromoCode(){this.selectedPromoCode=null,this.loadForm=!0,this.$nextTick(()=>{this.loadForm=!1,this.promocodeFormModal.show()})},selectPromoCode(s){this.loadForm=!0,this.$nextTick(()=>{this.loadForm=!1,this.selectedPromoCode=s,this.promocodeFormModal.show()})}}},ae=Object.assign(Zo,{__name:"Promocodes",setup(s){return(e,t)=>(a(),l(h,null,[o("div",Jo,[e.loadTable?d("",!0):(a(),_(Go,{key:0,onCreate:e.createPromoCode,onSelect:e.selectPromoCode,bot:s.bot},null,8,["onCreate","onSelect","bot"]))]),o("div",Ro,[o("div",Wo,[o("div",Ko,[Ho,o("div",Qo,[o("div",Xo,[e.loadForm?d("",!0):(a(),_(X,{key:0,onCallback:e.callbackForm,code:e.selectedPromoCode},null,8,["onCallback","code"]))])])])])]),o("div",Yo,[o("button",{type:"button",onClick:t[0]||(t[0]=(...i)=>e.createPromoCode&&e.createPromoCode(...i)),class:"btn btn-primary w-100 p-3"}," Создать новый промокод ")])],64))}});export{ae as default};
