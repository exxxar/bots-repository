import{j as _,O as C,o as i,k as n,N as h,Y as v,n as o,p as k,F as u,K as m,a0 as d,L as c,M as l,H as b}from"./index.es-c4852431.js";import{P as g}from"./Pagination-b758f7ed.js";const y={key:0},F=o("i",{class:"fa-solid fa-magnifying-glass mr-1"},null,-1),j={key:0},w=["onClick"],x=["onClick"],$=o("i",{class:"fa-solid fa-boxes-packing"},null,-1),P=[$],I=["onClick"],L=o("i",{class:"fa-solid fa-box-open"},null,-1),M=[L],O={key:1,class:"row text-center row-cols-3 mb-n4"},z=["onClick","title"],A=["alt"],B={key:0,class:"company-bot-count-badge rounded-circle bg-highlight text-white"},E={key:0,class:"col-12 mb-2"},N={class:"col-12 mb-3"},T={key:2,class:"alert alert-warning",role:"alert"},V={props:["visualMode"],data(){return{selectedCompanyId:null,show:!0,loading:!0,companies:[],search:null,filters:[{name:"Активные",icon:"fa-brands fa-telegram",slug:"active"},{name:"Архивные",icon:"fa-solid fa-box-archive",slug:"archive"}],selectedFilters:[],companies_paginate_object:null}},computed:{..._(["getCompanies","getCompaniesPaginateObject"]),filteredCompanies(){if(!this.companies)return[];if(this.selectedFilters.length===0&&this.search==null)return this.companies;if(this.selectedFilters.length===0&&this.search!=null)return this.companies.filter(e=>(e.title||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1);let t=[];return this.selectedFilters.forEach(e=>{switch(e.slug){case"active":this.companies.filter(s=>s.deleted_at==null).forEach(s=>{t.push(s)});break;case"archive":this.companies.filter(s=>s.deleted_at!=null).forEach(s=>{t.push(s)});break}}),this.search==null?t:t.filter(e=>(e.title||"").trim().toLowerCase().indexOf(this.search.trim().toLowerCase())!==-1)}},mounted(){this.loadCompanies(),this.selectFilter("active")},methods:{addToArchive(t){this.$store.dispatch("removeManagerCompany",{companyId:t}).then(e=>{let s=this.companies_paginate_object.meta.current_page||0;this.loadCompanies(s),this.$notify("Указанный клиент успешно перемещен в архив")})},extractFromArchive(t){this.$store.dispatch("restoreCompany",{companyId:t}).then(e=>{let s=this.companies_paginate_object.meta.current_page||0;this.loadCompanies(s),this.$notify("Указанный клиент успешно перемещен из архива")})},selectFilter(t){let e=this.filters.find(r=>r.slug===t),s=this.selectedFilters.findIndex(r=>r.slug===t);e&&s===-1?this.selectedFilters.push(e):this.selectedFilters.splice(s,1)},removeSelectedFilter(t){let e=this.selectedFilters.findIndex(s=>s.slug===t);this.selectedFilters.splice(e,1)},selectCompany(t){this.selectedCompanyId=t?t.id:null,this.$emit("callback",t)},nextCompanies(t){this.loadCompanies(t)},loadCompanies(t=0){this.loading=!0,this.$store.dispatch("loadManagersCompanies",{dataObject:{search:this.search},page:t,size:12}).then(e=>{this.loading=!1,this.companies=this.getCompanies,this.companies_paginate_object=this.getCompaniesPaginateObject}).catch(()=>{this.loading=!1})}}},G=Object.assign(V,{__name:"CompanyList",setup(t){return(e,s)=>{const r=C("lazy");return e.show?(i(),n("div",y,[h(o("input",{type:"search",class:"form-control w-100 mb-2",placeholder:"Поиск компании","aria-label":"Поиск компании","onUpdate:modelValue":s[0]||(s[0]=a=>e.search=a),"aria-describedby":"button-addon2"},null,512),[[v,e.search]]),o("button",{class:"w-100 btn btn-m btn-full mb-3 rounded-xs text-uppercase font-900 shadow-s bg-blue2-dark",onClick:s[1]||(s[1]=a=>e.loadCompanies(0)),type:"button",id:"button-addon2"},[F,k(" Найти ")]),e.companies.length>0&&!t.visualMode?(i(),n("div",j,[(i(!0),n(u,null,m(e.filteredCompanies,(a,f)=>(i(),n("a",{href:"javascript:void(0)",class:d(["btn btn-border btn-xs btn-full mb-2 rounded-sm text-uppercase font-900 border-blue2-dark color-blue2-dark bg-theme mb-1 d-flex justify-content-between align-items-center",{"btn-outline-info":a.deleted_at==null,"btn-outline-danger border-danger":a.deleted_at!=null}])},[o("span",{class:d(["mb-0",{"text-danger":a.deleted_at!=null}]),onClick:p=>e.selectCompany(a)},c(a.title||"Не указано"),11,w),a.deleted_at==null?(i(),n("button",{key:0,class:"btn btn-border btn-xs btn-full rounded-xl text-uppercase font-900 border-red2-dark color-red2-dark bg-theme",type:"button",onClick:p=>e.addToArchive(a.id),title:"В архив"},P,8,x)):l("",!0),a.deleted_at!=null?(i(),n("button",{key:1,class:"btn btn-border btn-xs btn-full rounded-xl text-uppercase font-900 border-green2-dark color-green2-dark bg-theme",type:"button",onClick:p=>e.extractFromArchive(a.id),title:"Из архива"},M,8,I)):l("",!0)],2))),256)),e.companies_paginate_object?(i(),b(g,{key:0,onPagination_page:e.nextCompanies,pagination:e.companies_paginate_object},null,8,["onPagination_page","pagination"])):l("",!0)])):l("",!0),e.companies.length>0&&t.visualMode?(i(),n("div",O,[(i(!0),n(u,null,m(e.companies,a=>(i(),n("a",{class:"col mb-4 default-link",href:"javascript:void(0)",onClick:f=>e.selectCompany(a),title:a.title||"Без названия"},[h(o("img",{class:"img-fluid rounded-xs preload-img",alt:a.title||"Не указано"},null,8,A),[[r,"/images-by-company-id/"+a.id+"/"+a.image]]),o("span",{class:d([{"company-border-select":e.selectedCompanyId==a.id},"company-image-badge"])},c(a.title||"Без названия"),3),a.bot_count>0?(i(),n("span",B,c(a.bot_count||0),1)):l("",!0)],8,z))),256)),e.selectedCompanyId?(i(),n("div",E,[o("a",{class:"col mb-4 default-link",href:"javascript:void(0)",onClick:s[2]||(s[2]=a=>e.selectCompany(null))}," Сброс ")])):l("",!0),o("div",N,[e.companies_paginate_object?(i(),b(g,{key:0,onPagination_page:e.nextCompanies,pagination:e.companies_paginate_object},null,8,["onPagination_page","pagination"])):l("",!0)])])):(i(),n("div",T," Вы еще не завели ни одного клиента! "))])):l("",!0)}}});export{G as _};
