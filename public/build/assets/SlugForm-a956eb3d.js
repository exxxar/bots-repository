import{g as _,o as l,k as i,l as o,w as u,v as m,p as d,F as h,q as g,C as y,t as c,n as p,s as b,j as k,N as C,u as F,K as $,y as V,B as w}from"./index.es-00b6813f.js";import{P as U}from"./vue3-simple-typeahead-3fbd52b3.js";import{V as v}from"./vue3-json-editor.esm.prod-f4f06f6a.js";const j={class:"mb-2"},M={class:"form-floating"},O=o("label",{for:"floatingInput"},"Поиск файла",-1),S={key:0,class:"mb-2"},P=["onClick"],N={class:"card-body p-2"},I={class:"d-flex"},B={key:0,class:"fa-solid p-2 fa-video"},q={key:1,class:"fa-solid p-2 fa-camera r"},D={key:2,class:"fa-solid p-2 fa-circle-play"},T={key:3,class:"fa-solid p-2 fa-microphone-lines"},E={key:4,class:"fa-solid p-2 fa-file-word"},J={key:5,class:"fa-solid p-2 fa-note-sticky"},L={class:"d-flex justify-content-between p-1 w-100 mb-0"},A={class:"mb-1"},z={class:"d-flex justify-content-between"},G=["onClick"],K=o("i",{class:"fa-solid fa-eye"},null,-1),Q=["onClick"],R=o("i",{class:"fa-solid fa-trash"},null,-1),H=[R],W={key:1,class:"mb-2"},X=o("div",{class:"alert alert-warning",role:"alert"}," У выбранного бота нет медиа-файлов ",-1),Y=[X],Z={props:["selected","needVideo","needVideoNote","needPhoto","needDocument","needAudio","needSticker"],data(){return{bot:null,loading:!0,media:[],search:null,media_paginate_object:null}},computed:{..._(["getMedia","getMediaPaginateObject"])},mounted(){this.loadMedia()},methods:{selectMedia(s){this.$emit("select",s)},nextMedia(s){this.loadMedia(s)},remove(s){this.$store.dispatch("removeMedia",{dataObject:{mediaId:s}}).then(e=>{this.loadMedia(),this.$botNotification.notification("Удаление медиа-контента","Медиа контент удален")}).catch(()=>{})},showPreview(s){this.$store.dispatch("showMediaPreview",{dataObject:{mediaId:s}}).then(e=>{this.$botNotification.notification("Превью медиа-контента","Отправлено в бота")}).catch(()=>{})},loadMedia(s=0){this.loading=!0,this.$store.dispatch("loadMedia",{dataObject:{search:this.search,needVideo:this.needVideo||!1,needVideoNote:this.needVideoNote||!1,needPhoto:this.needPhoto||!1,needAudio:this.needAudio||!1,needDocument:this.needDocument||!1,needSticker:this.needSticker||!1},page:s}).then(e=>{this.loading=!1,this.media=this.getMedia,this.media_paginate_object=this.getMediaPaginateObject}).catch(()=>{this.loading=!1})}}},x=Object.assign(Z,{__name:"BotMediaList",setup(s){return(e,r)=>(l(),i(h,null,[o("div",j,[o("div",M,[u(o("input",{type:"search","onUpdate:modelValue":r[0]||(r[0]=n=>e.search=n),class:"form-control",id:"floatingInput",placeholder:"Поиск файла"},null,512),[[m,e.search]]),O]),e.search?(l(),i("button",{key:0,class:"btn btn-outline-secondary w-100",onClick:r[1]||(r[1]=n=>e.loadMedia(0)),type:"button",id:"button-addon2"},"Найти ")):d("",!0)]),e.media.length>0?(l(),i("div",S,[(l(!0),i(h,null,g(e.media,(n,f)=>(l(),i("div",{class:y(["card border rounded-2 p-0 mb-2",{"border-success":(s.selected||[]).indexOf(n.file_id)!=-1,"border-light":(s.selected||[]).indexOf(n.file_id)==-1}]),onClick:t=>e.selectMedia(n)},[o("div",N,[o("div",I,[n.type==="video"||n.type==="video_note"?(l(),i("i",B)):d("",!0),n.type==="photo"?(l(),i("i",q)):d("",!0),n.type==="audio"?(l(),i("i",D)):d("",!0),n.type==="voice"?(l(),i("i",T)):d("",!0),n.type==="document"?(l(),i("i",E)):d("",!0),n.type==="sticker"?(l(),i("i",J)):d("",!0),o("p",L,[o("strong",null,"#"+c(n.id),1),p(),o("small",null,"тип: "+c(n.type??"Без подписи"),1)])]),o("p",A,c(n.caption??"Без подписи"),1),o("div",z,[o("a",{href:"javascript:void(0)",class:"btn btn-outline-primary px-2",style:{"min-width":"40px"},onClick:t=>e.showPreview(n.id)},[K,p(" посмотреть")],8,G),o("a",{href:"javascript:void(0)",style:{"min-width":"40px"},class:"btn btn-outline-danger px-2 text-danger",onClick:t=>e.remove(n.id)},H,8,Q)])])],10,P))),256)),e.media_paginate_object?(l(),b(U,{key:0,onPagination_page:e.nextMedia,pagination:e.media_paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])):(l(),i("div",W,Y))],64))}}),ee={class:"form-floating mb-2"},te=o("label",{for:"floatingInput"},"Команда",-1),oe={class:"form-floating mb-2"},se=o("label",{for:"floatingInput"},"Описание скрипта",-1),le=o("h6",null," Параметры скрипта ",-1),ie={key:0,class:"mb-0"},ne=["onClick"],ae={key:1},re={class:"mb-1 alert alert-light py-2 px-2"},de={key:0},fe={class:"dropdown d-inline-flex"},ce=o("button",{class:"btn btn-link p-0",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[o("i",{class:"fa-solid fa-bars"})],-1),ue={class:"dropdown-menu"},pe=["onClick"],me={key:1,class:"form-floating mb-1"},he=["id","onUpdate:modelValue"],ge=["for"],_e={key:2,class:"form-check mb-1 form-switch"},ye=["onUpdate:modelValue","id"],be=["for"],ve={key:3,class:"form-floating mb-1"},ke=["onUpdate:modelValue","id"],Ce=["for"],Fe={key:4,class:"form-floating mb-1"},$e=["onUpdate:modelValue","id"],Ve=["for"],we={key:5,class:"mb-1"},Ue=o("label",{class:"form-label",id:"bot-domain"},"JSON-код",-1),je={key:6,class:"form-check mb-1"},Me=["for"],Oe=["onUpdate:modelValue","id"],Se={key:7,class:"form-floating mb-1"},Pe=["id","onUpdate:modelValue"],Ne=["for"],Ie={key:8,class:"form-floating mb-1"},Be=["id","onUpdate:modelValue"],qe=["for"],De={class:"form-floating mb-3"},Te=["id","onUpdate:modelValue"],Ee=["for"],Je=["onClick"],Le=o("i",{class:"fa-regular fa-images mr-2"},null,-1),Ae={key:0},ze={key:1},Ge={class:"fw-bold mb-0 d-flex justify-content-between"},Ke=["onClick"],Qe=o("i",{class:"fa-regular fa-pen-to-square"},null,-1),Re=[Qe],He={key:10,class:"fst-italic mb-0"},We={key:11,class:"form-floating"},Xe=["id","onUpdate:modelValue"],Ye=["for"],Ze={key:2,class:"mb-2"},xe=o("p",{class:"mb-0"},"Параметры скрипта еще не добавлены",-1),et=[xe],tt={class:"navbar navbar-expand-sm fixed-bottom p-3 bg-transparent border-0",style:{"border-radius":"10px 10px 0px 0px"}},ot={class:"btn btn-primary w-100 p-3 rounded-3 shadow-lg text-center"},st={key:0},lt={key:1},it={components:{Vue3JsonEditor:v},props:["item"],data(){return{filters:[],simple:!0,templates:[{key:"{{name}}",title:"Имя пользователя"},{key:"{{phone}}",title:"Телефон пользователя"},{key:"{{qr}}",title:"QR-код"},{key:"{{qrLink}}",title:"Реферальная ссылка"},{key:"{{friendsCount}}",title:"Число друзей"},{key:"{{username}}",title:"Название аккаунта"},{key:"{{cashBack}}",title:"Сумма кэшбэка на аккаунте"}],configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"},{title:"JSON",type:"json"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{..._(["getCurrentBot"]),filteredConfigs(){return this.filters.length===0?this.slugForm.config:this.slugForm.config.filter(s=>this.filters.indexOf(s.type)>=0)}},mounted(){this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{insert(s,e){let r=document.querySelector("#field-input-"+s).selectionStart||0,n=this.filteredConfigs[s].value;this.filteredConfigs[s].value=n.slice(0,r)+"<b>"+e.key+"</b>"+n.slice(r)},move(s,e=0){let r=this.slugForm.config[s],n=this.slugForm.config.length||0,f=e===0?s-1>=0?s-1:n-1:s<n-1?s+1:0;this.slugForm.config[s]=this.slugForm.config[f],this.slugForm.config[f]=r},toggleFilter(s){let e=this.filters.indexOf(s);e>=0?this.filters.splice(e,1):this.filters.push(s)},addTextTo(s,e={text:null}){this.slugForm.config[s].value=e.text},submit(){let s=new FormData;Object.keys(this.slugForm).forEach(e=>{const r=this.slugForm[e]||"";typeof r=="object"?s.append(e,JSON.stringify(r)):s.append(e,r)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:s}).then(e=>{this.$notify({title:"Редактор",text:"Данные успешно сохранены",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{this.$notify({title:"Редактор",text:"Ошибка сохранения данных",type:"error"})})},addConfig(s){this.slugForm.config.splice(0,0,{key:null,value:null,type:s||"text"})},removeConfigItem(s){try{this.slugForm.config.splice(s,1)}catch{this.slugForm.config=[]}},selectPhoto(s,e){this.filteredConfigs[e].value=s.file_id}}},ft=Object.assign(it,{__name:"SlugForm",setup(s){return(e,r)=>{const n=k("mask");return l(),i("form",{id:"slugForm",style:{"padding-bottom":"100px"},onSubmit:r[2]||(r[2]=w((...f)=>e.submit&&e.submit(...f),["prevent"]))},[o("div",ee,[u(o("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=f=>e.slugForm.command=f),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[m,e.slugForm.command]]),te]),o("div",oe,[u(o("textarea",{"onUpdate:modelValue":r[1]||(r[1]=f=>e.slugForm.comment=f),style:{"min-height":"100px"},class:"form-control font-12",id:"floatingInput",placeholder:"name@example.com",required:""},`
            `,512),[[m,e.slugForm.comment]]),se]),le,(e.configTypes||[]).length>0?(l(),i("p",ie,[p("Фильтры: "),(l(!0),i(h,null,g(e.configTypes,(f,t)=>(l(),i("span",{class:y(["badge mb-1 cursor-pointer mx-1",{"bg-primary text-white":e.filters.indexOf(f.type)>=0,"bg-secondary":e.filters.indexOf(f.type)===-1}]),onClick:a=>e.toggleFilter(f.type)},c(f.type),11,ne))),256))])):d("",!0),e.filteredConfigs.length>0?(l(),i("div",ae,[(l(!0),i(h,null,g(e.filteredConfigs,(f,t)=>(l(),i("div",re,[e.filteredConfigs[t].type==="large-text"||e.filteredConfigs[t].type==="text"?(l(),i("div",de,[p(" Вы можете выбрать параметры для подстановки значений "),o("div",fe,[ce,o("ul",ue,[(l(!0),i(h,null,g(e.templates,a=>(l(),i("li",null,[o("a",{class:"dropdown-item",onClick:nt=>e.insert(t,a),href:"javascript:void(0)"},c(a.title),9,pe)]))),256))])])])):d("",!0),e.filteredConfigs[t].type==="channel"?(l(),i("div",me,[u(o("input",{type:"text",class:"form-control",id:"field-input-"+t,"onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,placeholder:"name@example.com"},null,8,he),[[m,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},[p("Значение для "),o("strong",null,c(e.filteredConfigs[t].key),1)],8,ge)])):d("",!0),e.filteredConfigs[t].type==="boolean"?(l(),i("div",_e,[u(o("input",{class:"form-check-input","onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,type:"checkbox",value:"false",id:"filtered-config-"+t+"-checkbox"},null,8,ye),[[C,e.filteredConfigs[t].value]]),o("label",{class:"form-check-label",for:"filtered-config-"+t+"-checkbox"},[p(c(e.filteredConfigs[t].value?"Истина":"Ложь")+" для ",1),o("strong",null,c(e.filteredConfigs[t].key),1)],8,be)])):d("",!0),e.filteredConfigs[t].type==="geo"?(l(),i("div",ve,[u(o("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,type:"text",id:"filtered-config-"+t+"-geo"},null,8,ke),[[n,"##.######,##.######"],[m,e.filteredConfigs[t].value]]),o("label",{for:"filtered-config-"+t+"-geo"},[p("Значение для "),o("strong",null,c(e.filteredConfigs[t].key),1)],8,Ce)])):d("",!0),e.filteredConfigs[t].type==="phone"?(l(),i("div",Fe,[u(o("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,type:"text",id:"filtered-config-"+t+"-phone"},null,8,$e),[[n,"+7(###)###-##-##"],[m,e.filteredConfigs[t].value]]),o("label",{for:"filtered-config-"+t+"-phone"},[p("Значение для "),o("strong",null,c(e.filteredConfigs[t].key),1)],8,Ve)])):d("",!0),e.filteredConfigs[t].type==="json"?(l(),i("div",we,[Ue,F($(v),{mode:"code",modelValue:e.filteredConfigs[t].value,"onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,"show-btns":!1,expandedOnStart:!0},null,8,["modelValue","onUpdate:modelValue"])])):d("",!0),e.filteredConfigs[t].type==="color"?(l(),i("div",je,[o("label",{for:"filtered-config-"+t+"-color"},[o("p",{style:V({color:e.filteredConfigs[t].value})},[p("Цвет: "+c(e.filteredConfigs[t].value)+" для ",1),o("strong",null,c(e.filteredConfigs[t].key),1)],4)],8,Me),u(o("input",{class:"form-control","onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,type:"color",id:"filtered-config-"+t+"-color"},null,8,Oe),[[m,e.filteredConfigs[t].value]])])):d("",!0),e.filteredConfigs[t].type==="text"?(l(),i("div",Se,[u(o("input",{type:"text",class:"form-control font-12",id:"field-input-"+t,"onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,placeholder:"name@example.com"},null,8,Pe),[[m,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},[p("Значение для "),o("strong",null,c(e.filteredConfigs[t].key),1)],8,Ne)])):d("",!0),e.filteredConfigs[t].type==="large-text"?(l(),i("div",Ie,[u(o("textarea",{class:"form-control font-12",id:"field-input-"+t,"onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,style:{"min-height":"200px"},placeholder:"name@example.com"},`
                            `,8,Be),[[m,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},[p("Значение для "),o("strong",null,c(e.filteredConfigs[t].key),1)],8,qe)])):d("",!0),e.filteredConfigs[t].type==="image"?(l(),i(h,{key:9},[o("div",De,[u(o("input",{class:"form-control mb-2",id:"field-input-"+t,type:"text",disabled:"true","onUpdate:modelValue":a=>e.filteredConfigs[t].value=a,placeholder:"name@example.com"},null,8,Te),[[m,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},"FileId ссылка на изображение",8,Ee)]),o("button",{type:"button",onClick:a=>e.filteredConfigs[t].gallery_visible=!e.filteredConfigs[t].gallery_visible,class:"btn btn-primary w-100 mb-2"},[Le,e.filteredConfigs[t].gallery_visible?(l(),i("span",ze,"Закрыть галерею")):(l(),i("span",Ae,"Открыть галерею"))],8,Je),e.filteredConfigs[t].gallery_visible?(l(),b(x,{key:0,"need-video":!1,"need-photo":!0,selected:[e.filteredConfigs[t].value],onSelect:a=>e.selectPhoto(a,t)},null,8,["selected","onSelect"])):d("",!0)],64)):d("",!0),o("p",Ge,[p("Описание скрипта "),o("span",{class:"text-primary",onClick:a=>f.can_edit_description=!f.can_edit_description},Re,8,Ke)]),f.can_edit_description?(l(),i("div",We,[u(o("textarea",{class:"form-control",id:"description-input-"+t,"onUpdate:modelValue":a=>e.filteredConfigs[t].description=a,placeholder:"Leave a comment here"},null,8,Xe),[[m,e.filteredConfigs[t].description]]),o("label",{for:"description-input-"+t},"Описание",8,Ye)])):(l(),i("p",He,c(e.filteredConfigs[t].description||"Описания нет"),1))]))),256))])):(l(),i("div",Ze,et)),o("nav",tt,[o("button",ot,[e.slugForm.id==null?(l(),i("span",st," Сохранить ")):(l(),i("span",lt," Обновить "))])])],32)}}});export{x as _,ft as a};
