import{g as b,N as _,o as i,j as n,l as o,M as u,W as m,n as c,F as p,J as h,$ as v,K as f,L as d,a2 as C,k,u as F,a7 as V,G as U,a0 as w}from"./index.es-db843bab.js";import{_ as S}from"./BotMediaList-e761023c.js";import{V as y}from"./vue3-json-editor.esm.prod-a76b57fc.js";const O={class:"form-floating mb-2"},$=o("label",{for:"floatingInput"},"Команда",-1),j={class:"form-floating mb-2"},N=o("label",{for:"floatingInput"},"Описание скрипта",-1),I=o("h6",null," Параметры скрипта ",-1),T={key:0,class:"mb-0"},q=["onClick"],B={key:1},J={class:"mb-1 alert alert-light py-2 px-2"},D={key:0},E={class:"dropdown d-inline-flex"},L=o("button",{class:"btn btn-link p-0",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[o("i",{class:"fa-solid fa-bars"})],-1),M={class:"dropdown-menu"},G=["onClick"],P={key:1,class:"form-floating mb-1"},z=["id","onUpdate:modelValue"],K=["for"],Q={key:2,class:"form-check mb-1 form-switch"},R=["onUpdate:modelValue","id"],W=["for"],A={key:3,class:"form-floating mb-1"},H=["onUpdate:modelValue","id"],X=["for"],Y={key:4,class:"form-floating mb-1"},Z=["onUpdate:modelValue","id"],x=["for"],ee={key:5,class:"mb-1"},te=o("label",{class:"form-label",id:"bot-domain"},"JSON-код",-1),oe={key:6,class:"form-check mb-1"},le=["for"],se=["onUpdate:modelValue","id"],ie={key:7,class:"form-floating mb-1"},ne=["id","onUpdate:modelValue"],re=["for"],ae={key:8,class:"form-floating mb-1"},fe=["id","onUpdate:modelValue"],de=["for"],ue={class:"form-floating mb-3"},me=["id","onUpdate:modelValue"],ce=["for"],ge=["onClick"],pe=o("i",{class:"fa-regular fa-images mr-2"},null,-1),he={key:0},ye={key:1},be={class:"fw-bold mb-0 d-flex justify-content-between"},_e=["onClick"],ve=o("i",{class:"fa-regular fa-pen-to-square"},null,-1),Ce=[ve],ke={key:10,class:"fst-italic mb-0"},Fe={key:11,class:"form-floating"},Ve=["id","onUpdate:modelValue"],Ue=["for"],we={key:2,class:"mb-2"},Se=o("p",{class:"mb-0"},"Параметры скрипта еще не добавлены",-1),Oe=[Se],$e={class:"navbar navbar-expand-sm fixed-bottom p-3 bg-transparent border-0",style:{"border-radius":"10px 10px 0px 0px"}},je={class:"btn btn-primary w-100 p-3 rounded-3 shadow-lg text-center"},Ne={key:0},Ie={key:1},Te={components:{Vue3JsonEditor:y},props:["item"],data(){return{filters:[],simple:!0,templates:[{key:"{{name}}",title:"Имя пользователя"},{key:"{{phone}}",title:"Телефон пользователя"},{key:"{{qr}}",title:"QR-код"},{key:"{{qrLink}}",title:"Реферальная ссылка"},{key:"{{friendsCount}}",title:"Число друзей"},{key:"{{username}}",title:"Название аккаунта"},{key:"{{cashBack}}",title:"Сумма кэшбэка на аккаунте"}],configTypes:[{title:"Текстовый или числовой параметр",type:"text"},{title:"Большое текстовое поле",type:"large-text"},{title:"Канал обратной связи",type:"channel"},{title:"Логический оператор",type:"boolean"},{title:"Ссылка на изображение",type:"image"},{title:"Цвет",type:"color"},{title:"Geo",type:"geo"},{title:"Номер телефона",type:"phone"},{title:"JSON",type:"json"}],bot:null,photos:[],slugForm:{bot_id:null,id:null,command:null,comment:null,slug:null,config:[],is_global:!0}}},computed:{...b(["getCurrentBot"]),filteredConfigs(){return this.filters.length===0?this.slugForm.config:this.slugForm.config.filter(l=>this.filters.indexOf(l.type)>=0)}},mounted(){this.item&&(this.slugForm.id=this.item.id||null,this.slugForm.command=this.item.command,this.slugForm.comment=this.item.comment,this.slugForm.bot_id=this.item.bot_id,this.slugForm.slug=this.item.slug,this.slugForm.config=this.item.config||[],this.slugForm.is_global=this.item.is_global||!1)},methods:{insert(l,e){let a=document.querySelector("#field-input-"+l).selectionStart||0,g=this.filteredConfigs[l].value;this.filteredConfigs[l].value=g.slice(0,a)+"<b>"+e.key+"</b>"+g.slice(a)},move(l,e=0){let a=this.slugForm.config[l],g=this.slugForm.config.length||0,r=e===0?l-1>=0?l-1:g-1:l<g-1?l+1:0;this.slugForm.config[l]=this.slugForm.config[r],this.slugForm.config[r]=a},toggleFilter(l){let e=this.filters.indexOf(l);e>=0?this.filters.splice(e,1):this.filters.push(l)},addTextTo(l,e={text:null}){this.slugForm.config[l].value=e.text},submit(){let l=new FormData;Object.keys(this.slugForm).forEach(e=>{const a=this.slugForm[e]||"";typeof a=="object"?l.append(e,JSON.stringify(a)):l.append(e,a)}),this.$store.dispatch(this.slugForm.id===null?"createSlug":"updateSlug",{slugForm:l}).then(e=>{this.$notify({title:"Редактор",text:"Данные успешно сохранены",type:"success"}),this.slugForm.id===null&&(this.slugForm.id=null,this.slugForm.command=null,this.slugForm.comment=null,this.slugForm.bot_id=null,this.slugForm.slug=null,this.slugForm.config=[],this.slugForm.is_global=!0),this.$emit("callback")}).catch(e=>{this.$notify({title:"Редактор",text:"Ошибка сохранения данных",type:"error"})})},addConfig(l){this.slugForm.config.splice(0,0,{key:null,value:null,type:l||"text"})},removeConfigItem(l){try{this.slugForm.config.splice(l,1)}catch{this.slugForm.config=[]}},selectPhoto(l,e){this.filteredConfigs[e].value=l.file_id}}},Ee=Object.assign(Te,{__name:"SlugForm",setup(l){return(e,a)=>{const g=_("mask");return i(),n("form",{id:"slugForm",style:{"padding-bottom":"100px"},onSubmit:a[2]||(a[2]=w((...r)=>e.submit&&e.submit(...r),["prevent"]))},[o("div",O,[u(o("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=r=>e.slugForm.command=r),class:"form-control",id:"floatingInput",placeholder:"name@example.com",required:""},null,512),[[m,e.slugForm.command]]),$]),o("div",j,[u(o("textarea",{"onUpdate:modelValue":a[1]||(a[1]=r=>e.slugForm.comment=r),style:{"min-height":"100px"},class:"form-control font-12",id:"floatingInput",placeholder:"name@example.com",required:""},`
            `,512),[[m,e.slugForm.comment]]),N]),I,(e.configTypes||[]).length>0?(i(),n("p",T,[c("Фильтры: "),(i(!0),n(p,null,h(e.configTypes,(r,t)=>(i(),n("span",{class:v(["badge mb-1 cursor-pointer mx-1",{"bg-primary text-white":e.filters.indexOf(r.type)>=0,"bg-secondary":e.filters.indexOf(r.type)===-1}]),onClick:s=>e.toggleFilter(r.type)},f(r.type),11,q))),256))])):d("",!0),e.filteredConfigs.length>0?(i(),n("div",B,[(i(!0),n(p,null,h(e.filteredConfigs,(r,t)=>(i(),n("div",J,[e.filteredConfigs[t].type==="large-text"||e.filteredConfigs[t].type==="text"?(i(),n("div",D,[c(" Вы можете выбрать параметры для подстановки значений "),o("div",E,[L,o("ul",M,[(i(!0),n(p,null,h(e.templates,s=>(i(),n("li",null,[o("a",{class:"dropdown-item",onClick:qe=>e.insert(t,s),href:"javascript:void(0)"},f(s.title),9,G)]))),256))])])])):d("",!0),e.filteredConfigs[t].type==="channel"?(i(),n("div",P,[u(o("input",{type:"text",class:"form-control",id:"field-input-"+t,"onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,placeholder:"name@example.com"},null,8,z),[[m,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},[c("Значение для "),o("strong",null,f(e.filteredConfigs[t].key),1)],8,K)])):d("",!0),e.filteredConfigs[t].type==="boolean"?(i(),n("div",Q,[u(o("input",{class:"form-check-input","onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,type:"checkbox",value:"false",id:"filtered-config-"+t+"-checkbox"},null,8,R),[[C,e.filteredConfigs[t].value]]),o("label",{class:"form-check-label",for:"filtered-config-"+t+"-checkbox"},[c(f(e.filteredConfigs[t].value?"Истина":"Ложь")+" для ",1),o("strong",null,f(e.filteredConfigs[t].key),1)],8,W)])):d("",!0),e.filteredConfigs[t].type==="geo"?(i(),n("div",A,[u(o("input",{class:"form-control",placeholder:"##.######,##.######","onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,type:"text",id:"filtered-config-"+t+"-geo"},null,8,H),[[g,"##.######,##.######"],[m,e.filteredConfigs[t].value]]),o("label",{for:"filtered-config-"+t+"-geo"},[c("Значение для "),o("strong",null,f(e.filteredConfigs[t].key),1)],8,X)])):d("",!0),e.filteredConfigs[t].type==="phone"?(i(),n("div",Y,[u(o("input",{class:"form-control",placeholder:"+7(###)###-##-##","onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,type:"text",id:"filtered-config-"+t+"-phone"},null,8,Z),[[g,"+7(###)###-##-##"],[m,e.filteredConfigs[t].value]]),o("label",{for:"filtered-config-"+t+"-phone"},[c("Значение для "),o("strong",null,f(e.filteredConfigs[t].key),1)],8,x)])):d("",!0),e.filteredConfigs[t].type==="json"?(i(),n("div",ee,[te,k(F(y),{mode:"code",modelValue:e.filteredConfigs[t].value,"onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,"show-btns":!1,expandedOnStart:!0},null,8,["modelValue","onUpdate:modelValue"])])):d("",!0),e.filteredConfigs[t].type==="color"?(i(),n("div",oe,[o("label",{for:"filtered-config-"+t+"-color"},[o("p",{style:V({color:e.filteredConfigs[t].value})},[c("Цвет: "+f(e.filteredConfigs[t].value)+" для ",1),o("strong",null,f(e.filteredConfigs[t].key),1)],4)],8,le),u(o("input",{class:"form-control","onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,type:"color",id:"filtered-config-"+t+"-color"},null,8,se),[[m,e.filteredConfigs[t].value]])])):d("",!0),e.filteredConfigs[t].type==="text"?(i(),n("div",ie,[u(o("input",{type:"text",class:"form-control font-12",id:"field-input-"+t,"onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,placeholder:"name@example.com"},null,8,ne),[[m,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},[c("Значение для "),o("strong",null,f(e.filteredConfigs[t].key),1)],8,re)])):d("",!0),e.filteredConfigs[t].type==="large-text"?(i(),n("div",ae,[u(o("textarea",{class:"form-control font-12",id:"field-input-"+t,"onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,style:{"min-height":"200px"},placeholder:"name@example.com"},`
                            `,8,fe),[[m,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},[c("Значение для "),o("strong",null,f(e.filteredConfigs[t].key),1)],8,de)])):d("",!0),e.filteredConfigs[t].type==="image"?(i(),n(p,{key:9},[o("div",ue,[u(o("input",{class:"form-control mb-2",id:"field-input-"+t,type:"text",disabled:"true","onUpdate:modelValue":s=>e.filteredConfigs[t].value=s,placeholder:"name@example.com"},null,8,me),[[m,e.filteredConfigs[t].value]]),o("label",{for:"field-input-"+t},"FileId ссылка на изображение",8,ce)]),o("button",{type:"button",onClick:s=>e.filteredConfigs[t].gallery_visible=!e.filteredConfigs[t].gallery_visible,class:"btn btn-primary w-100 mb-2"},[pe,e.filteredConfigs[t].gallery_visible?(i(),n("span",ye,"Закрыть галерею")):(i(),n("span",he,"Открыть галерею"))],8,ge),e.filteredConfigs[t].gallery_visible?(i(),U(S,{key:0,"need-video":!1,"need-photo":!0,selected:[e.filteredConfigs[t].value],onSelect:s=>e.selectPhoto(s,t)},null,8,["selected","onSelect"])):d("",!0)],64)):d("",!0),o("p",be,[c("Описание скрипта "),o("span",{class:"text-primary",onClick:s=>r.can_edit_description=!r.can_edit_description},Ce,8,_e)]),r.can_edit_description?(i(),n("div",Fe,[u(o("textarea",{class:"form-control",id:"description-input-"+t,"onUpdate:modelValue":s=>e.filteredConfigs[t].description=s,placeholder:"Leave a comment here"},null,8,Ve),[[m,e.filteredConfigs[t].description]]),o("label",{for:"description-input-"+t},"Описание",8,Ue)])):(i(),n("p",ke,f(e.filteredConfigs[t].description||"Описания нет"),1))]))),256))])):(i(),n("div",we,Oe)),o("nav",$e,[o("button",je,[e.slugForm.id==null?(i(),n("span",Ne," Сохранить ")):(i(),n("span",Ie," Обновить "))])])],32)}}});export{Ee as _};
