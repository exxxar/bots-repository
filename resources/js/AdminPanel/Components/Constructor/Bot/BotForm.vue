<script setup>
import CompanyList from "@/AdminPanel/Components/Constructor/Company/CompanyList.vue";
/*import TextHelper from "@/AdminPanel/Components/Constructor/Helpers/TextHelper.vue";*/
import TelegramChannelHelper from "@/AdminPanel/Components/Constructor/Helpers/TelegramChannelHelper.vue";
import BotSearchModal from "@/AdminPanel/Components/Constructor/Bot/BotSearchModal.vue";
import BotSlugList from "@/AdminPanel/Components/Constructor/Slugs/BotSlugSimpleTableList.vue";

</script>
<template>
    <form
        class=" mb-5"
        :ref="'botForm'"
        v-on:submit.prevent="addBot">
        <section class="h-100 gradient-form" v-if="!isValidTelegramToken">
            <div class="container py-5 h-100">
                <div class="row d-flex justify-content-center align-items-center h-100">
                    <div class="col-xl-10">
                        <div class="card rounded-3 text-black">
                            <div class="row g-0">
                                <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º -->
                                <div class="col-lg-6 d-flex align-items-center bg-primary">
                                    <div class="text-white px-3 py-4 p-md-5 mx-md-4">

                                        <div class="d-flex justify-content-center mb-3">
                                            <img v-lazy="'../images/icon.png'" alt="" width="100" height="100">
                                        </div>

                                        <h4 class="mb-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–¥–µ–ª —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞!</h4>
                                        <p class="small mb-2">
                                            –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ Telegram-–±–æ—Ç–∞–º–∏: —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã—Ö,
                                            –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –í–æ–π–¥–∏—Ç–µ –≤
                                            —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –ï—Å–ª–∏ —É –≤–∞—Å
                                            –µ—â—ë –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å ‚Äî —ç—Ç–æ –∑–∞–π–º—ë—Ç –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.
                                        </p>

                                        <p class="small mb-2 fw-bold">
                                            –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è —Å –æ–±—É—á–µ–Ω–∏–µ–º!
                                        </p>
                                        <a href="https://telegra.ph/Sozdanie-telegram-bota-02-02" target="_blank"
                                           class="btn w-100 btn-outline-light text-center p-3 mb-2"
                                        >
                                            <i class="fas fa-graduation-cap"></i> –û–±—É—á–µ–Ω–∏–µ
                                        </a>

                                        <p class="small mb-2">
                                            –ù–∞—á–Ω–∏—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ–∏—Ö –±–æ—Ç–æ–≤ –µ—â—ë —É–º–Ω–µ–µ –∏ –ø–æ–ª–µ–∑–Ω–µ–µ! üöÄ
                                        </p>
                                        <a
                                            href="https://t.me/botfather" target="_blank"
                                            class=" btn w-100 btn-outline-light text-center p-3 mb-2">
                                            <i class="fab fa-telegram"></i> –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –≤ –¢–µ–ª–µ–≥—Ä–∞–º
                                        </a>


                                    </div>

                                </div>

                                <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å —Å —Ñ–æ—Ä–º–æ–π –≤—Ö–æ–¥–∞ -->
                                <div class="col-lg-6">


                                    <div class="card-body p-md-5 mx-md-4">
                                        <div class="text-center">
                                            <h1 class="text-primary">NextIT</h1>
                                            <h4 class="mt-1 mb-2 pb-1">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –±–∏–∑–Ω–µ—Å–∞</h4>
                                        </div>

                                        <div class="alert alert-warning"
                                             v-if="!isValidTelegramToken && botForm.bot_token?.length>0">
                                            –¢–æ–∫–µ–Ω –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π!
                                        </div>
                                        <p class="mb-2">–ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞ –≤—ã–±–µ—Ä–∏—Ç–µ <span
                                            class="fw-bold text-primary">—Ç–∏–ø –±–æ—Ç–∞</span>
                                        </p>

                                        <div class="row">
                                            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 1: –ß–∏—Å—Ç—ã–π –±–æ—Ç -->
                                            <div class="col-md-6 mb-2">
                                                <div
                                                    @click="botForm.bot_type=0"
                                                    v-bind:class="{'border-primary':botForm.bot_type === 0}"
                                                    class="card cursor-pointer" style="height:120px;">
                                                    <div
                                                        v-bind:class="{'text-primary':botForm.bot_type === 0}"
                                                        class="card-body d-flex flex-column justify-content-center align-items-center  p-3 ">
                                                        <i class="fas fa-robot mb-3" style="font-size:20px;"></i>
                                                        <h6 style="font-size:14px;text-align:center;">–ß–∏—Å—Ç—ã–π –±–æ—Ç<br>(–±–µ–∑
                                                            —à–∞–±–ª–æ–Ω–∞)</h6>
                                                    </div>

                                                </div>
                                            </div>


                                            <div class="col-md-6 mb-2" v-for="(item, index) in bot_types">
                                                <div class="card cursor-pointer"
                                                     @click="botForm.bot_type=item.id"
                                                     v-bind:class="{'border-primary':botForm.bot_type === item.id}"
                                                     style="height:120px;">
                                                    <div
                                                        v-bind:class="{'text-primary':botForm.bot_type === item.id}"
                                                        class="card-body d-flex flex-column justify-content-center align-items-center  p-3">
                                                        <template v-if="item.icon"><span v-html="item.icon"></span>
                                                        </template>
                                                        <h6 style="font-size:14px;text-align:center;">
                                                            {{ item.title }}</h6>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>


                                        <p class="mb-2"><em><small>–î–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω —Ç–µ–ª–µ–≥—Ä–∞–º
                                            –±–æ—Ç–∞</small></em></p>

                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control"
                                                   placeholder="–¢–æ–∫–µ–Ω"
                                                   aria-label="–¢–æ–∫–µ–Ω"
                                                   v-model="botForm.bot_token"
                                                   maxlength="255"
                                                   minlength="40"
                                                   @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞!')"
                                                   aria-describedby="bot-token" required>
                                            <label class="form-label"
                                                   id="bot-token">
                                                –¢–æ–∫–µ–Ω –±–æ—Ç–∞
                                            </label>
                                        </div>

                                        <p class="mb-2"><em><small>–ò–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–æ—Ç–∞ –¥–ª—è
                                            —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</small></em></p>
                                        <BotSearchModal
                                            :custom-class="'btn btn-primary p-3 w-100 dropdown-toggle'"
                                            v-if="!load"
                                            v-on:select-bot="selectBot"
                                            :bot="bot"></BotSearchModal>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <template v-if="isValidTelegramToken">
            <div class="row">
                <div class="col-md-8 order-2 mb-2 order-md-1 col-12">
                    <div class="row">
                        <div class="col-12">
                            <ul class="nav nav-tabs justify-content-center">
                                <li class="nav-item" @click="tab=0">
                                    <a class="nav-link"
                                       v-bind:class="{'active':tab===0}"
                                       href="javascript:void(0)">–ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                                </li>
                                <li class="nav-item" @click="tab=1">
                                    <a class="nav-link"
                                       v-bind:class="{'active':tab===1}"
                                       href="javascript:void(0)">–ö—ç—à–±—ç–∫&–§–∏–Ω–∞–Ω—Å—ã</a>
                                </li>
                                <li class="nav-item" v-if="botForm.id!=null" @click="tab=2">
                                    <a class="nav-link"
                                       v-bind:class="{'active':tab===2}"
                                       href="javascript:void(0)">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a>
                                </li>
                                <li class="nav-item" v-if="botForm.id==null">
                                    <a class="nav-link text-secondary"
                                       href="javascript:void(0)"><i class="fa-solid fa-triangle-exclamation mr-1"></i>
                                        –û–±—Ä–∞—Ç–Ω–∞—è
                                        —Å–≤—è–∑—å</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="row py-3" v-show="tab===0">

                        <div class="col-md-12 col-12">

                            <div class="input-group mb-3">
                                <div class="form-floating">
                                    <input type="text" class="form-control"
                                           placeholder="–ò–º—è –±–æ—Ç–∞"
                                           aria-label="–ò–º—è –±–æ—Ç–∞"
                                           :disabled="true"
                                           name='bot_domain'
                                           @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –±–æ—Ç–∞!', 0)"
                                           v-model="botForm.bot_domain"
                                           maxlength="255"
                                           aria-describedby="bot-domain" required>
                                    <label class="form-label" id="bot-domain">
                                        <span class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span> –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è
                                        –±–æ—Ç–∞
                                        (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
                                    </label>
                                </div>
                                <span class="input-group-text">
                                    <img
                                        v-if="load_photo"
                                        style="width:40px;"
                                        class="object-fit-cover"
                                        v-lazy="'/images/companies/'+botForm.bot_domain+'/logo.jpg'" alt="">
                                    <img
                                        v-else
                                        style="width:40px;"
                                        class="object-fit-cover"
                                        v-lazy="'/images/icon.png'" alt="">
                                </span>
                            </div>


                        </div>


                        <div class="col-md-12 col-12" v-if="profile.is_admin||false">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox"
                                       :value="botForm.is_template||false"
                                       v-model="botForm.is_template" id="bot-is-template">
                                <label class="form-check-label" for="bot-is-template">
                                    –°–¥–µ–ª–∞—Ç—å —à–∞–±–ª–æ–Ω–æ–º
                                </label>
                            </div>

                        </div>

                        <div class="col-md-12 col-12"
                             v-if="botForm.is_template">
                            <div class="form-floating mb-3">

                                <input type="text" class="form-control"
                                       placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ \ –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞"
                                       aria-label="–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞"
                                       v-model="botForm.template_description"
                                       maxlength="255"
                                       @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞!')"
                                       aria-describedby="bot-template-description" required>

                                <label class="form-label" id="bot-template-description">
                                    <span class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span> –ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
                                    –±–æ—Ç–∞
                                </label>
                            </div>
                        </div>

                        <div class="col-md-12 col-12">
                            <div class="card">
                                <div class="card-body">
                                    <h6>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–æ—Ç–∞ –≤ BotFather</h6>


                                    <div class="form-floating mb-3">

                                        <input type="text" class="form-control"
                                               placeholder="–¢–µ–∫—Å—Ç –Ω–∞–∑–≤–∞–Ω–∏—è"
                                               aria-label="–¢–µ–∫—Å—Ç –Ω–∞–∑–≤–∞–Ω–∏—è"
                                               v-model="botForm.title"
                                               maxlength="64"
                                               aria-describedby="bot-title">

                                        <label class="form-label d-flex justify-content-between align-items-center"
                                               id="bot-title">
                                              <span v-if="botForm.title">
                                                  –ù–∞–∑–≤–∞–Ω–∏–µ –±–æ—Ç–∞
                                                  <small class="text-secondary" v-if="botForm.title.length>0">–î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ {{
                                                          botForm.title.length
                                                      }}/64</small>
                                              </span>

                                            <!--                                    <span class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span>-->
                                        </label>

                                    </div>


                                    <div class="alert alert-info" role="alert">
                                        –î–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–Ω–æ –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∏—Ç—Å—è —Å—Å—ã–ª–∫–æ–π –Ω–∞ –±–æ—Ç–∞, –∞
                                        —Ç–∞–∫–∂–µ
                                        –ø—Ä–∏
                                        –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∏–∫–æ–Ω–∫—É –±–æ—Ç–∞.
                                    </div>

                                    <div class="form-floating mb-3">
                                        <textarea class="form-control"
                                                  placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≤ —à–∞–ø–∫–µ –±–æ—Ç–∞"
                                                  aria-label="–û–ø–∏—Å–∞–Ω–∏–µ –≤ —à–∞–ø–∫–µ –±–æ—Ç–∞"
                                                  v-model="botForm.short_description"
                                                  maxlength="105"
                                                  style="min-height:100px;"
                                                  aria-describedby="bot-short-description">
                                        </textarea>

                                        <label class="form-label"
                                               id="bot-short-description">
                                              <span>
                                                  –û–ø–∏—Å–∞–Ω–∏–µ –≤ —à–∞–ø–∫–µ –±–æ—Ç–∞
                                                  <small class="text-secondary"
                                                         v-if="botForm.short_description.length>0">–î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ {{
                                                          botForm.short_description.length
                                                      }}/105</small>
                                              </span>
                                        </label>
                                    </div>

                                    <div class="alert alert-info" role="alert">
                                        –î–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞, –æ–Ω–æ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ
                                        –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –±–æ—Ç–∞:
                                        <ul class="m-0 pl-2">
                                            <li>- —Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</li>
                                            <li>- –∫–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</li>
                                            <li>- –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω</li>
                                            <li>- —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</li>
                                        </ul>
                                        –∏ —Ç.–¥.
                                    </div>

                                    <div class="mb-3 form-floating">

                                        <textarea class="form-control"
                                                  placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –±–æ—Ç–∞"
                                                  aria-label="–û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –±–æ—Ç–∞"
                                                  v-model="botForm.long_description"
                                                  maxlength="505"
                                                  style="min-height:200px;"
                                                  aria-describedby="bot-long-description"></textarea>

                                        <label class="form-label"
                                               id="bot-long-description">
                                              <span>
                                                 –û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –±–æ—Ç–∞
                                                  <small class="text-secondary"
                                                         v-if="botForm.long_description.length>0">–î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ {{
                                                          botForm.long_description.length
                                                      }}/505</small>
                                              </span>
                                        </label>
                                    </div>

                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       v-model="needMenuBtn" id="needMenuBtn">
                                                <label class="form-check-label" for="needMenuBtn">
                                                    –ù—É–∂–Ω–∞ –∫–Ω–æ–ø–∫–∞ –º–µ–Ω—é
                                                </label>
                                            </div>
                                        </div>


                                        <template v-if="needMenuBtn">

                                            <div class="col-12">

                                                <div class="input-group mb-3">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control"
                                                               placeholder="–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é"
                                                               aria-label="–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é"
                                                               maxlength="255"
                                                               @invalid="alert('–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é!', 0)"
                                                               v-model="botForm.menu.text"
                                                               required>
                                                        <label for="">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é</label>
                                                    </div>
                                                    <div class="form-floating">
                                                        <input type="url" class="form-control"
                                                               placeholder="–ê–¥—Ä–µ—Å –ø–µ—Ä–µ—Ö–æ–¥–∞ URL"
                                                               aria-label="–ê–¥—Ä–µ—Å –ø–µ—Ä–µ—Ö–æ–¥–∞ URL"
                                                               maxlength="255"
                                                               @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ –∞–¥—Ä–µ—Å –º–µ–Ω—é!', 0)"
                                                               v-model="botForm.menu.url"
                                                               required>
                                                        <label for="">URL-–∞–¥—Ä–µ—Å –ø–µ—Ä–µ—Ö–æ–¥–∞</label>
                                                    </div>
                                                    <button
                                                        type="button"
                                                        @click="openSelectScriptModal"
                                                        class="input-group-text px-2 text-primary" id="basic-addon1">
                                                        <i class="fa-solid fa-link"></i>
                                                    </button>
                                                </div>


                                            </div>


                                        </template>

                                    </div>

                                    <h6 class="fw-bold mb-2">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã </h6>
                                    <div class="row"
                                         :key="'commands-'+index"
                                         v-for="(item, index) in botForm.commands">
                                        <div class="col-12" v-if="botForm.commands[index].command==='/adminmenu'">
                                            <div class="alert alert-primary" role="alert">
                                                <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–æ–º–∞–Ω–¥—É <strong
                                                class="text-danger">/adminmenu</strong> –ø–ª–æ—Ö–∞—è –∏–¥–µ—è. –ö–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
                                                —Ç–æ–ª—å–∫–æ
                                                –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º —Å–∏—Å—Ç–µ–º—ã, –∞ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –≤–∏–¥–µ—Ç—å –æ—à–∏–±–∫—É. –≠—Ç–æ
                                                —Å–æ–∑–¥–∞—Å—Ç
                                                –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–µ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –æ—Ç —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞.
                                            </div>
                                        </div>
                                        <div class="col-12">

                                            <div class="input-group mb-3">

                                                <div class="form-floating">
                                                    <input type="text" class="form-control"
                                                           placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"
                                                           aria-label="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"
                                                           maxlength="255"
                                                           @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã',0)"
                                                           v-model="botForm.commands[index].command"
                                                           :aria-describedby="'bot-command-'+index" required>
                                                    <label for="">–ö–æ–º–∞–Ω–¥–∞</label>
                                                </div>

                                                <div class="form-floating">
                                                    <input type="text" class="form-control"
                                                           placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"
                                                           aria-label="–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"
                                                           maxlength="255"
                                                           @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã!', 0)"
                                                           v-model="botForm.commands[index].description"
                                                           :aria-describedby="'bot-command-description-'+index"
                                                           required>
                                                    <label for="">–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã</label>
                                                </div>
                                                <button class="input-group-text text-danger"
                                                        @click="removeCommands(index)"><i
                                                    class="fa-regular fa-trash-can"></i>
                                                </button>
                                            </div>


                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <button
                                                type="button"
                                                @click="addCommands()"
                                                class="btn btn-link  text-primary text-decoration-none p-0">
                                                <i class="fa-regular fa-square-plus"></i>
                                                –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ –∫–æ–º–∞–Ω–¥—É
                                            </button>
                                        </div>
                                        <div class="col-6 d-flex justify-content-end">
                                            <div class="form-check">
                                                <input class="form-check-input"
                                                       type="checkbox"
                                                       v-model="showCode" id="showCode">
                                                <label class="form-check-label" for="showCode">
                                                    –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–æ–¥
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12 mb-3" v-if="showCode">
                                            <label class="form-label" id="bot-domain">JSON-–∫–æ–¥ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</label>
                                            <Vue3JsonEditor
                                                v-if="loadCommandEditor"
                                                :mode="'code'"
                                                v-model="botForm.commands"
                                                :show-btns="false"
                                                :expandedOnStart="true"
                                                @json-change="onJsonChange"
                                            />
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>


                    </div>
                    <div class="row py-3" v-show="tab===1">

                        <div class="col-md-4 col-12">
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control"
                                       placeholder="%"
                                       aria-label="—É—Ä–æ–≤–µ–Ω—å CashBack"
                                       v-model="botForm.level_1"
                                       min="0"
                                       @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∫—ç—à–±—ç–∫–∞ 1 —É—Ä–æ–≤–Ω—è –±–æ—Ç–∞!', 1)"
                                       aria-describedby="bot-level-1" required>
                                <label class="form-label" id="bot-level-1">
                                    <span class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span> –£—Ä–æ–≤–µ–Ω—å 1 CashBack,
                                    %
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4 col-12">
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control"
                                       placeholder="%"
                                       aria-label="—É—Ä–æ–≤–µ–Ω—å CashBack"
                                       v-model="botForm.level_2"
                                       min="0"
                                       aria-describedby="bot-level-2">
                                <label class="form-label" id="bot-level-2">–£—Ä–æ–≤–µ–Ω—å 2 CashBack, %</label>
                            </div>
                        </div>
                        <div class="col-md-4 col-12">
                            <div class="form-floating mb-3">

                                <input type="number" class="form-control"
                                       placeholder="%"
                                       aria-label="—É—Ä–æ–≤–µ–Ω—å CashBack"
                                       v-model="botForm.level_3"
                                       min="0"
                                       aria-describedby="bot-level-3">
                                <label class="form-label" id="bot-level-3">–£—Ä–æ–≤–µ–Ω—å 3 CashBack, %</label>
                            </div>
                        </div>


                        <div class="mb-2">
                            <div class="form-check">
                                <input class="form-check-input"
                                       v-model="need_cashback_fired"
                                       type="checkbox"
                                       id="need-cashback-fired">
                                <label class="form-check-label" for="need-cashback-fired">
                                    –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–∏–æ–¥ —Å–≥–æ—Ä–∞–Ω–∏—è CashBack
                                </label>
                            </div>

                        </div>
                        <div class="col-md-12 col-12" v-if="need_cashback_fired">
                            <div class="form-floating mb-3">

                                <select class="form-control" v-model="botForm.cashback_fire_period"
                                        id="cashback-fired-period">
                                    <option :value="item.value" v-for="item in cashback_fire_periods">
                                        {{ item.title || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}
                                    </option>
                                </select>
                                <label class="form-label" id="cashback-fired-period">–ü–µ—Ä–∏–æ–¥ —Å–≥–æ—Ä–∞–Ω–∏—è CashBack</label>
                            </div>
                            <div class="mb-3" v-if="botForm.cashback_fire_period>0">
                                <label class="form-label" id="cashback-fired-level">–£—Ä–æ–≤–µ–Ω—å —Å–≥–æ—Ä–∞–Ω–∏—è CashBack, %</label>
                                <input type="number" class="form-control"
                                       placeholder="%"
                                       aria-label="—É—Ä–æ–≤–µ–Ω—å —Å–≥–æ—Ä–∞–Ω–∏—è CashBack"
                                       v-model="botForm.cashback_fire_percent"
                                       min="0"
                                       max="100"
                                       aria-describedby="cashback-fired-level">
                            </div>
                        </div>

                        <div class="col-md-12 col-12">
                            <div class="form-floating mb-3">
                                <input type="number" class="form-control"
                                       placeholder="%"
                                       aria-label="–ø—Ä–æ—Ü–µ–Ω—Ç –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è CashBack –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ"
                                       v-model="botForm.max_cashback_use_percent"
                                       min="0"
                                       max="100"
                                       aria-describedby="cashback-max_cashback_use_percent">
                                <label class="form-label" id="cashback-max_cashback_use_percent">
                                    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ CashBack –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ, % –æ—Ç —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞</label>
                            </div>
                        </div>

                        <div class="col-12 mb-2">
                            <div class="form-check">
                                <input class="form-check-input"
                                       v-model="need_payments"
                                       type="checkbox"
                                       id="need-payments">
                                <label class="form-check-label" for="need-payments">
                                    –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É
                                </label>
                            </div>

                        </div>
                        <div class="col-md-12 col-12" v-if="need_payments">
                            <div class="form-check mb-3 ml-3">
                                <input class="form-check-input" type="checkbox"
                                       :value="botForm.auto_cashback_on_payments"
                                       v-model="botForm.auto_cashback_on_payments"
                                       id="bot-auto-cashback-on-payments">
                                <label class="form-check-label" for="bot-auto-cashback-on-payments">
                                    –ù–∞—á–∏—Å–ª—è—Ç—å CashBack –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
                                </label>
                            </div>

                            <div class="input-group mb-3">
                                <div class="form-floating">

                                    <input type="text" class="form-control"
                                           id="payment_provider_token-input"
                                           placeholder="–¢–æ–∫–µ–Ω"
                                           aria-label="–¢–æ–∫–µ–Ω"
                                           v-model="botForm.payment_provider_token"
                                           aria-describedby="payment_provider_token">
                                    <label class="form-label" id="payment_provider_token">–¢–æ–∫–µ–Ω –ø–ª–∞—Ç–µ–∂–Ω–æ–π
                                        —Å–∏—Å—Ç–µ–º—ã</label>

                                </div>
                                <a class="input-group-text" href="https://t.me/botfather" target="_blank">–ü–æ–¥–∫–ª—é—á–∏—Ç—å</a>
                            </div>


                        </div>
                        <div class="col-12 mb-2">
                            <div class="form-check">
                                <input class="form-check-input"
                                       v-model="need_shop"
                                       type="checkbox"
                                       id="need-shop">
                                <label class="form-check-label" for="need-shop">
                                    –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω –≤ –±–æ—Ç–∞
                                </label>
                            </div>

                        </div>
                        <div class="col-md-12 col-12" v-if="need_shop">

                            <div class="input-group mb-3">
                                <div class="form-floating">
                                    <input type="url" class="form-control"
                                           placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –≥—Ä—É–ø–ø—É –í–ö"
                                           aria-label="—Å—Å—ã–ª–∫–∞ –Ω–∞ –≥—Ä—É–ø–ø—É –í–ö"
                                           v-model="botForm.vk_shop_link"
                                           aria-describedby="vk_shop_link">
                                    <label class="form-label" id="bot-vk_shop_link">–°—Å—ã–ª–∫–∞ –Ω–∞ –≥—Ä—É–ø–ø—É –í–ö —Å
                                        —Ç–æ–≤–∞—Ä–∞–º–∏</label>

                                </div>
                                <a class="input-group-text" href="https://vk.com/groups?w=groups_create"
                                   target="_blank">–°–æ–∑–¥–∞—Ç—å</a>
                            </div>

                        </div>

                        <div class="mb-2">
                            <div class="form-check">
                                <input class="form-check-input"
                                       v-model="need_cashback_config"
                                       type="checkbox"
                                       id="need-cashback-config">
                                <label class="form-check-label" for="need-cashback-config">
                                    –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CashBack –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                                </label>
                            </div>

                        </div>
                        <div class="mb-2" v-if="need_cashback_config">
                            <h6>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π CashBack-–∞</h6>
                            <div class="alert alert-light" role="alert">
                                –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ CashBack - —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∏ —Ç—Ä–∞—Ç—ã CashBack
                                –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –±–æ—Ç–∞
                                –Ω–∞
                                —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ü–µ–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ—Ñ–µ–π–Ω—è –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –Ω–∞ –∫–æ—Ñ–µ, –Ω–∞ –¥–µ—Å–µ—Ä—Ç—ã - –∏
                                –Ω–∞—á–∏—Å–ª—è—Ç—å
                                –±–∞–ª–ª—ã
                                –∑–∞ –∫—É–ø–ª–µ–Ω–Ω—ã–π –∫–æ—Ñ–µ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –±–∞–ª–ª–æ–≤ –∑–∞ –∫—É–ø–ª–µ–Ω–Ω—ã–π –¥–µ—Å–µ—Ä—Ç
                            </div>

                            <div class="d-flex justify-content-between mb-2 flex-wrap"
                                 :key="'social-link'+index"
                                 v-for="(item, index) in botForm.cashback_config">


                                <div class="input-group mb-2 w-100">
                                    <div class="form-floating ">
                                        <input type="text" class="form-control "
                                               placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                                               aria-label="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                                               maxlength="255"
                                               @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!', 1)"
                                               v-model="botForm.cashback_config[index].title"
                                               :aria-describedby="'bot-cashback-config-'+index" required>
                                        <label for="">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
                                    </div>
                                    <button
                                        type="button"
                                        @click="removeCashBackConfig(index)"
                                        class="input-group-text text-danger"
                                    ><i class="fa-regular fa-trash-can"></i>
                                    </button>
                                </div>


                            </div>

                            <button
                                type="button"
                                @click="addCashBackConfig()"
                                class="btn mb-2 rounded-sm btn-outline-primary p-3 w-100">
                                –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                            </button>
                            <div class="divider divider-small my-3 bg-highlight "></div>
                        </div>
                        <div class="mb-2">
                            <div class="form-check">
                                <input class="form-check-input"
                                       v-model="need_cashback_rules"
                                       type="checkbox"
                                       id="need-cashback-rules">
                                <label class="form-check-label" for="need-cashback-rules">
                                    –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –ø–æ–¥ CashBack
                                </label>
                            </div>

                        </div>
                        <div class="col-md-12 col-12 mb-2" v-if="need_cashback_rules">
                            <div class="form-floating mb-2">

                                <select class="form-control"
                                        v-model="selected_warning"
                                        @change="addWarning"
                                        id="warning-rules">
                                    <option :value="null">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                                    <option :value="item" v-for="item in filteredWarnings">
                                        {{ item.title }}
                                    </option>
                                </select>
                                <label class="form-check-label" for="warning-rules">
                                    <i class="fa-solid fa-triangle-exclamation text-danger"></i> –ü—Ä–∞–≤–∏–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö
                                    –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
                                </label>
                            </div>

                            <template v-for="(warn, index) in botForm.warnings">


                                <div class="input-group mb-2">
                                    <div class="input-group-text">
                                        <div class="form-check">
                                            <input class="form-check-input"
                                                   v-model="botForm.warnings[index].is_active"
                                                   type="checkbox"
                                                   :id="'warning-is-active-'+index">
                                            <label class="form-check-label"
                                                   style="font-size:12px;"
                                                   :for="'warning-is-active-'+index">
                                                <span v-if="botForm.warnings[index].is_active">–í–∫–ª—é—á–µ–Ω–æ</span>
                                                <span v-else>–í—ã–∫–ª—é—á–µ–Ω–æ</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-floating">
                                        <input type="number" class="form-control"
                                               placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ"
                                               v-model="botForm.warnings[index].rule_value"
                                               min="0"
                                               aria-describedby="bot-level-3">
                                        <label for="">{{ getWarning(warn.rule_key).title || '–ù–µ –Ω–∞–π–¥–µ–Ω–æ' }}</label>
                                    </div>
                                    <button
                                        @click="removeWarning(index)"
                                        type="button"
                                        class="input-group-text text-danger">
                                        <i class="fa-solid fa-trash-can"></i>
                                    </button>
                                </div>

                            </template>
                        </div>
                    </div>
                    <div class="row py-3" v-show="tab===2">
                        <div class="col-12">
                            <div class="alert alert-light" role="alert">
                                <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –ü—Ä–æ–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ú–æ–π id" –≤ –≥—Ä—É–ø–ø–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —É–∫–∞–∑–∞–Ω–∏—è
                                –±–æ—Ç–∞
                            </div>
                        </div>
                        <div class="col-md-6 col-12">
                            <div class="form-floating mb-3">

                                <input type="text" class="form-control"
                                       placeholder="id –∫–∞–Ω–∞–ª–∞"
                                       aria-label="id –∫–∞–Ω–∞–ª–∞"
                                       disabled="true"
                                       v-model="botForm.order_channel"
                                       maxlength="255"
                                       aria-describedby="bot-order-channel">
                                <label class="form-label" id="bot-order-channel">
                                    <span class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span>
                                    –ö–∞–Ω–∞–ª –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ (id)
                                </label>
                            </div>


                        </div>
                        <div class="col-md-6 col-12">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control"
                                       placeholder="id –∫–∞–Ω–∞–ª–∞"
                                       aria-label="id –∫–∞–Ω–∞–ª–∞"
                                       v-model="botForm.main_channel"
                                       maxlength="255"
                                       disabled="true"
                                       aria-describedby="bot-main-channel">
                                <label class="form-label" id="bot-main-channel">–ö–∞–Ω–∞–ª –¥–ª—è –ø–æ—Å—Ç–æ–≤ (id,—Ä–µ–∫–ª–∞–º–Ω—ã–π)</label>
                            </div>
                        </div>

                        <div class="col-12 mb-2" v-if="botForm.order_channel">
                            <div class="form-check">
                                <input class="form-check-input"
                                       v-model="need_threads"
                                       type="checkbox"
                                       id="need-topics-mailing">
                                <label class="form-check-label" for="need-topics-mailing">
                                    –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –ø–æ —Ç–æ–ø–∏–∫–∞–º –¥–ª—è –∫–∞–Ω–∞–ª–∞ –∑–∞–∫–∞–∑–æ–≤ (–æ–Ω –∂–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–∞–Ω–∞–ª)
                                </label>
                            </div>

                        </div>
                        <div class="col-12 mb-2" v-if="need_threads && botForm.order_channel">

                            <div class="alert alert-light">
                                –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–ø–∏–∫–æ–≤ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –Ω–∏–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ
                                –¥–µ–π—Å—Ç–≤–∏–π:
                                <ul class="m-0 p-0">
                                    <li>1.–°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É</li>
                                    <li>2.–î–æ–±–∞–≤—å—Ç–µ –≤ –≥—Ä—É–ø–ø—É –≤–∞—à–µ–≥–æ –±–æ—Ç–∞</li>
                                    <li>3.–í—ã–¥–∞–π—Ç–µ –≤—Å–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞ –±–æ—Ç—É</li>
                                    <li>4.–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –≥—Ä—É–ø–ø—É –≤ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–º–∞–º–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≥—Ä—É–ø–ø—ã (<strong
                                        class="fw-bold text-primary">–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "–¢–µ–º—ã"</strong>)
                                    </li>
                                    <li>5.–ü—Ä–æ–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ <strong class="fw-bold text-primary">"–ú–æ–π id"</strong> –≤
                                        –≥—Ä—É–ø–ø–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —É–∫–∞–∑–∞–Ω–∏—è –±–æ—Ç–∞
                                    </li>
                                </ul>


                            </div>
                            <!--
                                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                                            <p>–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–± —É–∑–Ω–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–ø–∏–∫–∞ –≤ –≥—Ä—É–ø–ø–µ –≤–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç "–ú–æ–π id"</p>

                                                            <button class="btn btn-outline-info"
                                                                    @click="createBotTopics"
                                                                    :disabled="!can_create_topics"
                                                                    type="button">
                                                                <i class="fa-solid fa-paperclip mr-2"></i>–°–æ–∑–¥–∞—Ç—å —Ç–æ–ø–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                                                            </button>
                                                        </div>
                            -->


                            <div class="row row-cols-3">
                                <div class="col" v-for="(thread, index) in botForm.message_threads">
                                    <div class="form-floating mb-2">
                                        <input type="number" class="form-control"
                                               min="0"
                                               max="10000"
                                               placeholder="–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–ø–∏–∫–∞"
                                               v-model="botForm.message_threads[index].value">
                                        <label for="">{{ thread.title }} ({{ thread.key }})</label>
                                    </div>
                                </div>
                            </div>

                            <h6 class="mb-2 mt-3">–°–æ–æ–±—â–µ–Ω–∏—è</h6>
                            <div class="mb-3 form-floating">
                                <textarea type="text" class="form-control"
                                          placeholder="–¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
                                          aria-label="–¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
                                          v-model="botForm.maintenance_message"
                                          maxlength="255"
                                          style="min-height:200px;"
                                          @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç –±–æ—Ç–∞!', 3)"
                                          aria-describedby="bot-maintenance-message" required></textarea>

                                <label class="form-label" id="bot-maintenance-message">
                                    <span class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span> –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è
                                    —Ä–µ–∂–∏–º–∞ —Ç–µ—Ö.—Ä–∞–±–æ—Ç
                                    <small class="text-gray-400 ml-3" style="font-size:10px;"
                                           v-if="botForm.maintenance_message">
                                        –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ {{ botForm.maintenance_message.length }}</small>
                                </label>
                            </div>

                        </div>

                    </div>

                    <div class="row py-3" v-show="tab===4">
                        <div class="col-12">
                            <div class="alert alert-primary" role="alert">
                                –í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —ç–∫—Å–ø–µ—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ. –û–Ω –Ω—É–∂–µ–Ω –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥
                                (—Å—Ç—Ä–∞–Ω–∏—Ü)
                                –±–æ—Ç–∞ —Å
                                –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –ö–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–∫–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å).
                                –ï—Å–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–æ—Ç–∞ –≤—ã–±—Ä–∞–Ω–æ "–≤–Ω–µ—à–Ω–µ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", —Ç–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–∞–¥–µ—Å—Ä–æ–≤–∞–Ω—ã
                                –Ω–∞
                                —É–∫–∞–∑–∞–Ω–Ω—É—é
                                –Ω–∏–∂–µ —Å—Å—ã–ª–∫—É.
                            </div>
                        </div>
                        <div class="col-md-12 col-12">
                            <div class="form-floating mb-3">


                                <input type="url" class="form-control"
                                       placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å"
                                       aria-label="—Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å"
                                       v-model="botForm.callback_link"
                                       aria-describedby="callback_link">
                                <label class="form-label" id="callback_link">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                                </label>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 order-1 mb-2 order-md-2 col-12">

                    <div class="card mb-2 border-light">
                        <div class="card-body">

                            <div class="form-floating mb-2">

                                <input type="text" class="form-control"
                                       placeholder="–¢–æ–∫–µ–Ω"
                                       aria-label="–¢–æ–∫–µ–Ω"
                                       v-model="botForm.bot_token"
                                       maxlength="255"
                                       minlength="40"
                                       @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞!')"
                                       aria-describedby="bot-token" required>
                                <label class="form-label" id="bot-token">
                                    –¢–æ–∫–µ–Ω –±–æ—Ç–∞
                                </label>
                            </div>

                            <button type="submit"
                                    id="save-bot-btn"
                                    @click="messages = []"
                                    :disabled="!botForm.bot_token||spent_time_counter>0"
                                    title="–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–æ—Ç–∞"
                                    class="btn btn-primary min-menu-btn w-100">
                                <template v-if="spent_time_counter>0">
                                    –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥–æ–∂–¥–∞—Ç—å {{ spent_time_counter }} —Å–µ–∫.
                                </template>
                                <template v-else>
                                    <span v-if="!bot">–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞</span>
                                    <span v-else><i class="fa-regular fa-floppy-disk"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</span>
                                </template>
                            </button>
                        </div>


                    </div>

                    <template v-if="profile.is_admin||false">


                        <div class="input-group mb-2">
                            <div class="form-floating">
                                <select class="form-select"
                                        required
                                        :disabled="servers.length===0"
                                        v-model="botForm.server"
                                        id="floatingSelect" aria-label="Floating label select example">
                                    <option
                                        :disabled="server.disabled"
                                        :value="server.key" v-for="server in servers">
                                        {{ server.title || '–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è' }}
                                        ({{ server.current_count || 0 }} –∏–∑ {{ server.max_bot_limit || 0 }})
                                    </option>
                                </select>
                                <label for="floatingSelect"> <span
                                    class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span>
                                    –í—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è</label>
                            </div>
                            <button
                                @click="updateWebHook"
                                :disabled="bot==null"
                                class="input-group-text text-danger">
                                <i class="fa-solid fa-right-left"></i>
                            </button>
                        </div>


                    </template>
                    <div class="card border-light mb-2">
                        <div class="card-body">
                            <p v-if="botForm.bot_domain">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞</p>

                            <a
                                class="btn btn-success w-100 p-3 mb-3"
                                :href="'https://t.me/'+botForm.bot_domain"
                                target="_blank"><i class="fa-solid fa-arrow-up-right-from-square"></i> {{
                                    botForm.bot_domain
                                }}</a>

                            <button
                                type="button"
                                data-bs-toggle="modal"
                                data-bs-target="#bot-balance-payment"
                                v-if="profile.is_manager"
                                class="btn btn-primary p-3 w-100 mb-3">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –±–æ—Ç–∞
                            </button>

                            <template v-if="profile.is_admin">
                                <div class="col-12">
                                    <div class="alert alert-primary" role="alert">
                                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –í–Ω–µ—Å–∏—Ç–µ —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é –≤–∞–º –¥–∞–ª –ö–ª–∏–µ–Ω—Ç! –≠—Ç–∞ —Å—É–º–º–∞
                                        –±—É–¥–µ—Ç –±–∞–ª–∞–Ω—Å–æ–º
                                        –ö–ª–∏–µ–Ω—Ç–∞
                                        –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞! –£–∫–∞–∂–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –±–æ—Ç–∞ - —ç—Ç–æ —Å—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Å–ø–∏—Å—ã–≤–∞—Ç—å
                                        —Å –∫–ª–∏–µ–Ω—Ç–∞
                                        –∫–∞–∂–¥—ã–π
                                        –¥–µ–Ω—å –ø–æ–∫–∞ –±–∞–ª–∞–Ω—Å –±–æ—Ç–∞ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–≤–µ–Ω 0.
                                        <br>
                                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∏—Å–ª–∏—Ç—å –∫–∞–∫—É—é-—Ç–æ –Ω–µ–±–æ–ª—å—à—É—é —Å—É–º–º—É –¥–ª—è —Ç–æ–≥–æ
                                        —á—Ç–æ–±—ã
                                        –∫–ª–∏–µ–Ω—Ç
                                        –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –Ω—É–ª–µ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –æ–ø–æ–≤–µ—â–µ–Ω
                                        –æ–± —ç—Ç–æ–º –∏
                                        –¥–æ–ª–∂–µ–Ω
                                        –±—É–¥–µ—Ç –ø–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á—ë—Ç –±–æ—Ç–∞!
                                    </div>
                                </div>
                                <div class="col-md-12 col-12">
                                    <div class="mb-3 form-floating">
                                        <input type="number" class="form-control"
                                               placeholder="–ë–∞–ª–∞–Ω—Å"
                                               aria-label="–ë–∞–ª–∞–Ω—Å"
                                               v-model="botForm.balance"
                                               min="0"
                                               @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ —Å—É–º–º—É –±–∞–ª–∞–Ω—Å–∞ –±–æ—Ç–∞!', 1)"
                                               aria-describedby="bot-balance" required>
                                        <label class="form-label" id="bot-balance">
                                            <span class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span> –ë–∞–ª–∞–Ω—Å
                                            –±–æ—Ç–∞, —Ä—É–±
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-12 col-12">
                                    <div class="mb-3 form-floating">

                                        <input type="number" class="form-control"
                                               placeholder="–°–ø–∏—Å–∞–Ω–∏–µ"
                                               aria-label="–°–ø–∏—Å–∞–Ω–∏–µ"
                                               v-model="botForm.tax_per_day"
                                               min="0"
                                               @invalid="alert('–í—ã –Ω–µ –≤–≤–µ–ª–∏ —Å—É–º–º—É —Å–ø–∏—Å–∞–Ω–∏—è –±–æ—Ç–∞!', 1)"
                                               aria-describedby="bot-tax-per-day" required>
                                        <label class="form-label" id="bot-tax-per-day">
                                            <span class="badge rounded-pill text-bg-danger m-0">–ù—É–∂–Ω–æ</span> –°–ø–∏—Å–∞–Ω–∏–µ –∑–∞
                                            —Å—É—Ç–∫–∏, —Ä—É–±
                                        </label>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="card border-light">
                        <div class="card-body">
                            <div class="col-md-12 col-12">

                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox"
                                           :value="need_company_select"
                                           v-model="need_company_select" id="bot-select-company">
                                    <label class="form-check-label" for="bot-select-company">
                                        –í—ã–±—Ä–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
                                    </label>
                                </div>
                                <p class="alert alert-danger"
                                   @click="need_company_select=true"
                                   v-if="botForm.company_id==null">–í–Ω–∏–º–∞–Ω–∏–µ! –í—ã –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞!</p>
                                <p class="card alert alert-success cursor-pointer"
                                   @click="need_company_select=true"
                                   v-else>
                                    –í—ã–±—Ä–∞–Ω –∫–ª–∏–µ–Ω—Ç <span v-if="company" class="font-bold">#{{ company.id }} {{
                                        company.title
                                    }}</span>
                                </p>
                            </div>
                            <div class="col-md-12 col-12" v-if="need_company_select">s

                                <div
                                    class="w-100 p-2"
                                    style="overflow-y:scroll;max-height:300px;">
                                    <CompanyList
                                        v-if="!load"
                                        :is-simple="true"
                                        :selected="botForm.company_id"
                                        v-on:callback="companyListCallback"/>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">

                    <div
                        v-if="messages.length>0"
                        v-for="(message, index) in messages"
                        class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> {{ message || '–û—à–∏–±–∫–∞' }}
                        <button type="button" class="btn-close"
                                @click="removeMessage(index)"></button>
                    </div>

                </div>

            </div>


        </template>

    </form>


    <!-- Modal -->
    <div class="modal fade" id="bot-balance-payment" tabindex="-1" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <form
                v-on:submit.prevent="submitBotBalancePayment"
                class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –±–æ—Ç–∞</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <template v-if="bot">
                        <div class="alert alert-light mb-2">
                            <p class="mb-2">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å: <strong
                                class="text-primary fw-bold">{{ profile.manager.balance || 0 }} ‚ÇΩ</strong></p>
                            <p class="mb-2">–¢–∞—Ä–∏—Ñ –≤ –±–æ—Ç–µ <strong class="text-primary fw-bold">{{ bot.tax_per_day }}
                                ‚ÇΩ\–¥–µ–Ω—å</strong></p>
                            <p class="mb-2">–ë–∞–ª–∞–Ω—Å –≤ –±–æ—Ç–µ <strong class="text-primary fw-bold">{{ bot.balance }}
                                ‚ÇΩ</strong></p>
                            <p class="mb-2"><strong class="fw-bold">–í–∞–∂–Ω–æ!</strong> –ë—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏
                                —Å—É–º–º—ã –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è, –æ—Ç–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ!</p>
                        </div>
                        <div class="d-flex flex-wrap mb-2" v-if="this.profile.manager.balance>0">
                            <button type="button"
                                    @click="selectPaymentVariant(1)"
                                    class="btn btn-light text-primary">1 –º–µ—Å—è—Ü
                            </button>
                            <button type="button"
                                    @click="selectPaymentVariant(3)"
                                    class="btn btn-light text-primary">3 –º–µ—Å—è—Ü–∞
                            </button>
                            <button type="button"
                                    @click="selectPaymentVariant(6)"
                                    class="btn btn-light text-primary">6 –º–µ—Å—è—Ü–µ–≤
                            </button>
                            <button type="button"
                                    @click="selectPaymentVariant(12)"
                                    class="btn btn-light text-primary">1 –≥–æ–¥
                            </button>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="number"
                                   min="1"
                                   v-model="balanceForm.amount"
                                   :max="profile.manager.balance || 0 "
                                   class="form-control" id="bot-balance" placeholder="name@example.com">
                            <label for="bot-balance">–í–Ω–æ—Å–∏–º–∞—è —Å—É–º–º–∞, ‚ÇΩ</label>
                        </div>
                    </template>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button type="submit"
                            :disabled="spent_time_counter>0"
                            class="btn btn-primary">
                        <template v-if="spent_time_counter>0">
                            –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥–æ–∂–¥–∞—Ç—å {{ spent_time_counter }} —Å–µ–∫.
                        </template>
                        <template v-else>
                            –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
                        </template>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="select-script-for-menu" tabindex="-1" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">–í—ã–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–∞</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <template v-if="select_script_step===0">
                        <BotSlugList v-on:select="selectVariant($event)"/>
                    </template>

                    <template v-if="select_script_step===1">
                        <div class="alert alert-light">
                            –í–Ω–∏–º–∞–Ω–∏–µ! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø —Å–∫—Ä–∏–ø—Ç–∞ –≤ –º–µ–Ω—é
                        </div>
                        <div class="row row-cols-3">
                            <div
                                v-for="item in script_types"
                                class="col mb-2">
                                <div class="card" @click="selectVariantStep2(item)">
                                    <div class="card-body text-center cursor-pointer text-primary fw-bold">
                                        {{ item.title }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>


</template>
<script>

import {mapGetters} from "vuex";
import {Vue3JsonEditor} from 'vue3-json-editor'

export default {
    components: {
        Vue3JsonEditor
    },
    props: ["bot"],
    data() {
        return {
            balanceForm: {
                amount: 0,
            },
            load_photo: true,
            loadCommandEditor: true,
            select_script_modal: null,
            select_script_step: 0,
            script_types: [
                {
                    title: "–ú–∞–≥–∞–∑–∏–Ω",
                    uri: '/menu',
                },
                {
                    title: "–û—Ç–∑—ã–≤—ã",
                    uri: '/feedback',
                },
                {
                    title: "–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã",
                    uri: '/wheel',
                },
                {
                    title: "–ü—Ä–æ—Ñ–∏–ª—å",
                    uri: '/profile',
                },
                {
                    title: "–ó–∞–∫–∞–∑—ã",
                    uri: '/orders',
                },
                {
                    title: "–í–≤–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞",
                    uri: '/new-promo-code',
                },
                {
                    title: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
                    uri: '/contacts',
                },
                {
                    title: "–ö–æ—Ä–∑–∏–Ω–∞",
                    uri: '/cart',
                },
            ],
            showCode: false,
            tab: 0,
            bot_types: [],
            spent_time_counter: 0,
            can_create: true,
            can_create_topics: true,
            messages: [],
            servers: [],
            need_company_select: false,
            selected_warning: null,
            page: null,
            step: 0,
            templates: [],
            load: false,
            loadPage: false,
            needPageListUpdate: false,
            need_threads: false,
            need_company: false,
            need_cashback_config: false,
            need_cashback_rules: false,
            need_cashback_fired: false,
            need_payments: false,
            need_shop: false,
            command: null,
            company: null,
            warnings: [
                {
                    title: "–°—É–º–º–∞ —á–µ–∫–∞ –±–æ–ª—å—à–µ —á–µ–º",
                    key: "bill_sum_more_then"
                },
                {
                    title: "–°—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∫—ç—à–±—ç–∫–∞ –±–æ–ª—å—à–µ —á–µ–º",
                    key: "cashback_up_sum_more_then"
                },
                {
                    title: "–°—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–∏—è –∫—ç—à–±—ç–∫–∞ –±–æ–ª—å—à–µ —á–µ–º",
                    key: "cashback_down_sum_more_then"
                }
            ],
            cashback_fire_periods: [
                {
                    title: '–ù–µ —Å–≥–æ—Ä–∞–µ—Ç',
                    value: 0,
                },
                {
                    title: '7 –¥–Ω–µ–π',
                    value: 7,
                },
                {
                    title: '15 –¥–Ω–µ–π',
                    value: 15,
                },
                {
                    title: '30 –¥–Ω–µ–π',
                    value: 30,
                },
                {
                    title: '60 –¥–Ω–µ–π',
                    value: 60,
                },
                {
                    title: '60 –¥–Ω–µ–π',
                    value: 90,
                },
                {
                    title: '120 –¥–Ω–µ–π',
                    value: 120,
                },
                {
                    title: '180 –¥–Ω–µ–π',
                    value: 180,
                },
                {
                    title: '360 –¥–Ω–µ–π',
                    value: 360,
                }
            ],
            needMenuBtn: false,
            botForm: {
                title: '–ù–∞–∑–≤–∞–Ω–∏–µ –±–æ—Ç–∞',
                short_description: '–û–ø–∏—Å–∞–Ω–∏–µ –≤ —à–∞–ø–∫–µ –±–æ—Ç–∞',
                long_description: '–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞',
                bot_type: 0,
                is_template: false,
                auto_cashback_on_payments: false,
                template_description: null,
                bot_domain: null,
                bot_token: null,
                company_id: null,
                creator_id: null,
                bot_token_dev: null,
                order_channel: null,
                message_threads: null,
                cashback_config: null,
                server: "main",
                main_channel: null,
                vk_shop_link: null,
                callback_link: null,
                balance: 70,
                tax_per_day: 10,
                welcome_message: "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é!",
                image: null,
                cashback_fire_percent: 0,
                cashback_fire_period: 0,
                max_cashback_use_percent: 0,
                description: "–≠—Ç–æ –≤–∞—à –±–æ—Ç! –í–æ—Ç —Ç–∞–∫–æ–µ –≤–æ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —É –Ω–µ–≥–æ.",
                info_link: null,
                social_links: [],
                maintenance_message: "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã",
                payment_provider_token: null,
                level_1: 10,
                level_2: 0,
                level_3: 0,
                commands: null,
                menu: {
                    text: "–ú–µ–Ω—é",
                    url: null
                },
                selected_bot_template_id: null,
                pages: [],
                amo: null,
                warnings: []
            },
        }
    },
    watch: {
        'isValidTelegramToken': {
            handler(val) {
                if (this.profile.is_admin && (this.servers || []).length === 0)
                    this.loadCurrentServers()
            },
            deep: true
        },
        'botForm.bot_token': {
            handler(val) {
                if (this.isValidTelegramToken)
                    this.getMe()
            },
            deep: true
        },

        'need_threads': function (oVal, nVal) {
            let threads = [
                {
                    title: '–û—Ç–∑—ã–≤—ã',
                    key: 'reviews',
                    value: null,
                },
                {
                    title: '–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ cashback',
                    key: 'cashback',
                    value: null,
                },
                {
                    title: '–í–æ–ø—Ä–æ—Å—ã',
                    key: 'questions',
                    value: null,
                },
                {
                    title: '–ö–æ–Ω–∫—É—Ä—Å—ã',
                    key: 'actions',
                    value: null,
                },
                {
                    title: '–ó–∞–∫–∞–∑—ã',
                    key: 'orders',
                    value: null,
                },
                {
                    title: '–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤',
                    key: 'ask-money',
                    value: null,
                },
                {
                    title: '–î–æ—Å—Ç–∞–≤–∫–∞',
                    key: 'delivery',
                    value: null,
                },
                {
                    title: '–û—Ç–≤–µ—Ç—ã',
                    key: 'response',
                    value: null,
                },
                {
                    title: '–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å',
                    key: 'callback',
                    value: null,
                }
            ];

            if (this.need_threads && !this.botForm.message_threads) {
                this.botForm.message_threads = threads
            }

            if (this.need_threads && this.botForm.message_threads) {
                threads.forEach(item => {
                    let index = this.botForm.message_threads.findIndex(sub => sub.key === item.key)

                    if (index === -1)
                        this.botForm.message_threads.push(item)
                })
            }
        },
        'need_payments': function (oVal, nVal) {
            if (!this.need_payments) {
                this.botForm.auto_cashback_on_payments = false
            }
        },

    },
    computed: {
        ...mapGetters(['getSlugs', 'getCurrentCompany']),
        profile() {
            return window.profile
        },
        isValidTelegramToken() {
            if (!this.botForm.bot_token)
                return false

            const tokenRegex = /^[0-9]{8,10}:[a-zA-Z0-9_-]{35}$/;
            return tokenRegex.test(this.botForm.bot_token);
        },
        filteredWarnings() {
            if (this.botForm.warnings.length === 0)
                return this.warnings;

            return this.warnings.filter(item => {
                return !(this.botForm.warnings.findIndex(sub => sub.rule_key === item.key) >= 0)
            })
        }
    },
    mounted() {

        this.getActualBotTypes()
        this.select_script_modal = new bootstrap.Modal('#select-script-for-menu', {})
        //this.loadCurrentCompany()
        if (localStorage.getItem("cashman_admin_bot_creator_counter") != null) {
            let time = localStorage.getItem("cashman_admin_bot_creator_counter")
            this.startTimer(time === "null" || time == null ? 0 : time)
        }

        window.addEventListener('store_current_company-change-event', (event) => {
            this.company = this.getCurrentCompany
        });


        window.addEventListener('add-payment-system-event', (event) => {
            this.tab = 1
            this.need_payments = true

            this.$nextTick(() => {
                let paymentTokenInput = document.querySelector("#payment_provider_token-input")
                paymentTokenInput.classList = "form-control border-danger";
                paymentTokenInput.focus()

                setTimeout(() => {
                    let paymentTokenInput = document.querySelector("#payment_provider_token-input")
                    paymentTokenInput.classList = "form-control";
                }, 5000)
            })

        });

        if (this.bot)
            this.$nextTick(() => {
                this.botForm = {
                    id: this.bot.id || null,

                    title: this.bot.title || '',
                    short_description: this.bot.short_description || '',
                    long_description: this.bot.long_description || '',

                    is_template: this.bot.is_template || false,
                    auto_cashback_on_payments: this.bot.auto_cashback_on_payments || false,
                    template_description: this.bot.template_description || null,
                    bot_domain: this.bot.bot_domain || null,
                    bot_token: this.bot.bot_token || null,
                    bot_token_dev: this.bot.bot_token_dev || null,
                    order_channel: this.bot.order_channel || null,
                    message_threads: this.bot.message_threads || null,
                    cashback_config: this.bot.cashback_config || null,
                    main_channel: this.bot.main_channel || null,
                    balance: this.bot.balance || null,
                    server: this.bot.server || "main",
                    tax_per_day: this.bot.tax_per_day || null,
                    vk_shop_link: this.bot.vk_shop_link || null,
                    callback_link: this.bot.callback_link || null,
                    cashback_fire_percent: this.bot.cashback_fire_percent || 0,
                    cashback_fire_period: this.bot.cashback_fire_period || 0,
                    max_cashback_use_percent: this.bot.max_cashback_use_percent || 0,
                    image: this.bot.image || null,

                    description: this.bot.description || null,
                    creator_id: this.bot.creator_id || null,

                    info_link: this.bot.info_link || null,

                    social_links: this.bot.social_links || [],

                    maintenance_message: this.bot.maintenance_message || null,
                    welcome_message: this.bot.welcome_message || null,
                    payment_provider_token: this.bot.payment_provider_token || null,

                    level_1: this.bot.level_1,
                    level_2: this.bot.level_2,
                    level_3: this.bot.level_3,
                    company_id: this.bot.company_id,
                    commands: this.bot.commands || null,
                    warnings: this.bot.warnings || [],

                    amo: this.bot.amo || null,
                    menu: {
                        text: "–ú–µ–Ω—é",
                        url: null
                    },
                }

                if (!Array.isArray(this.botForm.commands))
                    this.botForm.commands = []

                this.botForm.menu = this.bot.menu || {
                    text: "–ú–µ–Ω—é",
                    url: null
                }

                if (this.botForm.menu.url !== null)
                    this.needMenuBtn = true

                if (this.botForm.commands == null)
                    this.autoAddCommands();

                if (this.botForm.message_threads)
                    this.need_threads = true

                if (this.botForm.payment_provider_token)
                    this.need_payments = true

                if ((this.botForm.cashback_config || []).length > 0)
                    this.need_cashback_config = true

                if (this.botForm.warnings.length > 0)
                    this.need_cashback_rules = true

                if (this.botForm.cashback_fire_period > 0)
                    this.need_cashback_fired = true

                if (this.bot.company)
                    this.company = this.bot.company
                //   this.setStep(localStorage.getItem("cashman_set_botform_step_index") || 0)
            })
        else {
            if (this.botForm.commands == null)
                this.autoAddCommands();
        }


    },
    methods: {
        selectPaymentVariant(month) {
            this.balanceForm.amount = Math.min(this.bot.tax_per_day * 31 * month, this.profile.manager.balance)
        },
        submitBotBalancePayment() {
            this.startTimer();

            let data = new FormData();

            Object.keys(this.balanceForm)
                .forEach(key => {
                    const item = this.balanceForm[key] || ''
                    if (typeof item === 'object')
                        data.append(key, JSON.stringify(item))
                    else
                        data.append(key, item)
                });

            data.append("bot_domain", this.bot.bot_domain)

            this.$store.dispatch("setBotBalance", {
                form: data
            })
                .then((response) => {
                    this.balanceForm.amount = 0
                    this.$notify({
                        title: "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞",
                        text: "–û—Ç–ª–∏—á–Ω–æ! –ë–∞–ª–∞–Ω—Å –±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω",
                        type: 'success'
                    });
                    window.location.reload()
                }).catch(() => {
                this.$notify({
                    title: "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞",
                    text: "–û—à–∏–±–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –±–æ—Ç–∞",
                    type: 'error'
                });
            })
        },
        getActualBotTypes() {
            this.$store.dispatch("getActualBotTypes").then((response) => {
                this.bot_types = response || []
            })
        },
        openSelectScriptModal() {
            this.select_script_step = 0
            this.select_script_modal.show()
        },
        selectBot(bot) {
            this.$emit("callback")
        },
        autoAddCommands() {

            this.botForm.commands = [
                {
                    command: "/start",
                    description: "–Ω–∞—á–Ω–∏ —Å —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã"
                },
                {
                    command: "/admins",
                    description: "–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤ —Å–∏—Å—Ç–µ–º–µ"
                },
                {
                    command: "/help",
                    description: "–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É"
                },
                {
                    command: "/about",
                    description: "–æ CashMan"
                }
            ]

        },
        startTimer(time) {
            this.spent_time_counter = time != null ? Math.min(time, 10) : 10;

            let counterId = setInterval(() => {
                    if (this.spent_time_counter > 0)
                        this.spent_time_counter--
                    else {
                        clearInterval(counterId)
                        this.spent_time_counter = null
                    }
                    localStorage.setItem("cashman_admin_bot_creator_counter", this.spent_time_counter)
                }, 1000
            )
        },
        alert(msg, tab = null) {
            if (tab != null)
                this.tab = tab
            this.messages.push(msg)
        },
        removeMessage(index) {
            this.messages.splice(index, 1)
        },
        getMe() {
            let token = this.botForm.bot_token || ''
            if (token.length < 40)
                return;

            this.$store.dispatch("getMe", {
                bot_token: token,
            }).then((resp) => {
                let username = resp.username || null
                let title = resp.first_name || null
                if (username)
                    this.botForm.bot_domain = username
                if (title)
                    this.botForm.title = title

                this.load_photo = false
                this.$nextTick(() => {
                    this.load_photo = true
                })
            })
        },
        addTextTo(object = {param: null, text: null}) {
            this.botForm[object.param] = object.text;

        },
        removeCommands(index) {
            this.botForm.commands.splice(index, 1)

            this.loadCommandEditor = false
            this.$nextTick(() => {
                this.loadCommandEditor = true
            })
        },
        addCommands() {
            if (!this.botForm.commands)
                this.botForm.commands = [];

            this.botForm.commands.push({
                command: null,
                description: null
            })
            this.loadCommandEditor = false
            this.$nextTick(() => {
                this.loadCommandEditor = true
            })
        },
        loadCurrentServers() {
            this.$store.dispatch("loadCurrentServers").then((resp) => {
                this.servers = resp
            })
        },
        addItem(name) {
            this.botForm[name].push("")
        },
        addSocialLinks() {
            this.botForm.social_links.push({
                title: null,
                url: null
            })
        },
        removeItem(name, index) {
            this.botForm[name].splice(index, 1)
        },
        updateWebHook() {
            this.$store.dispatch("updateBotWebhook", {
                dataObject: {
                    bot_id: this.bot.id,
                    bot_server: this.botForm.server || null
                }
            }).catch(error => {
                this.alert(error.response.data.message)
            })
        },
        addBot() {

            this.startTimer();

            let data = new FormData();

            Object.keys(this.botForm)
                .forEach(key => {
                    const item = this.botForm[key] || ''
                    if (typeof item === 'object')
                        data.append(key, JSON.stringify(item))
                    else
                        data.append(key, item)
                });


            if (this.company)
                data.append("company_id", this.company.id)
            /* else {
                 this.alert('–í—ã –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞', 0)
             }*/


            this.$store.dispatch((this.bot == null ? "createBot" : "updateBot"), {
                botForm: data
            })
                .then((response) => {

                    let bot = response.data

                    this.$emit("callback", bot)


                    this.$notify({
                        title: "–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–æ—Ç–æ–≤",
                        text: (this.bot == null ? "–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!" : "–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!"),
                        type: 'success'
                    });

                    this.$store.dispatch("updateBotWebhook", {
                        dataObject: {
                            bot_id: bot.id
                        }
                    }).catch(error => {
                        this.alert(error.response.data.message)
                    })

                    if (this.bot == null)
                        this.botForm = {
                            title: '',
                            server: 'main',
                            short_description: '',
                            long_description: '',
                            is_template: false,
                            auto_cashback_on_payments: false,
                            template_description: null,
                            bot_domain: null,
                            bot_token: null,
                            bot_token_dev: null,
                            order_channel: null,
                            message_threads: null,
                            main_channel: null,
                            balance: null,
                            tax_per_day: null,
                            callback_link: null,
                            cashback_fire_percent: 0,
                            cashback_fire_period: 0,
                            max_cashback_use_percent: 0,
                            image: null,

                            description: null,

                            info_link: null,

                            social_links: [],

                            maintenance_message: null,
                            payment_provider_token: null,

                            level_1: 10,
                            level_2: 0,
                            level_3: 0,


                            warnings: [],

                            selected_bot_template_id: null,

                            pages: [],


                        }

                })
                .catch(error => {
                    this.$notify({
                        title: "–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–æ—Ç–æ–≤",
                        text: error.response.data.message,
                        type: 'error'
                    });
                })


        },
        onJsonChange(value) {
            this.botForm.commands = value
        },
        removeCashBackConfig(index) {
            this.botForm.cashback_config.splice(index, 1)
        },
        addCashBackConfig() {

            this.botForm.cashback_config = this.botForm.cashback_config == null ? [] : this.botForm.cashback_config;

            this.botForm.cashback_config.push({
                title: null,
            })

        },
        getWarning(key) {
            let item = this.warnings.find(item => item.key === key)


            return (!item) ? {
                title: '–ù–µ –Ω–∞–π–¥–µ–Ω–æ'
            } : item;

        }
        ,
        removeWarning(index) {
            this.botForm.warnings.splice(index, 1)
        },
        /* loadCurrentCompany(company = null) {
             this.$store.dispatch("updateCurrentCompany", {
                 company: company
             }).then(() => {
                 this.company = this.getCurrentCompany
             })
         },*/
        companyListCallback(company) {
            this.load = true
            this.company = company
            this.botForm.company_id = company.id
            this.need_company_select = false
            //this.loadCurrentCompany(company)
            this.$nextTick(() => {
                this.load = false
            })

        },
        selectVariant(item) {
            this.select_script_step++
            this.botForm.menu.text = item.title || '–ú–µ–Ω—é'
            this.botForm.menu.url = (import.meta.env.VITE_ASSET_URL || '')
                + '/bot-client/simple/' + this.bot.bot_domain + '?slug=' + item.id + '#/s'


        },
        selectVariantStep2(item) {
            this.botForm.menu.url += item.uri
            this.select_script_modal.hide()
            this.select_script_step = 0
            this.$notify({
                title: "–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–æ—Ç–æ–≤",
                text: "–°–∫—Ä–∏–ø—Ç —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω",
                type: 'success'
            });
        },
        addWarning() {

            const item = this.selected_warning

            this.botForm.warnings.push({
                rule_key: item.key,
                rule_value: 0,
                is_active: true,
            })

            this.selected_warning = null

        }

    }
}
</script>
<style lang="scss">
.popper {
    background: #06135f !important;
    color: white !important;
    padding: 10px !important;
    border-radius: 10px !important;
}


.img-preview, .photo-loader {
    width: 100px;
    height: 100px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 42px;
    background: white;
    border-radius: 10px;
    border: 1px lightgray solid;
    position: relative;
}

.img-preview img, .photo-loader img {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    width: 100%;
    height: 100%;
    -o-object-fit: cover;
    object-fit: cover;
}

.img-preview .remove {
    display: none;
    position: absolute;
    z-index: 2;

    a {
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
    }
}

.img-preview:hover .remove {
    display: flex;
}

.fixed-footer {

    position: fixed;
    bottom: 0px;
    left: 0px;
    width: 100%;
    min-height: 70px;
    z-index: 990;
    padding: 0px;
    box-sizing: border-box;

    border: none;
    background: transparent;

    & .container {
        background: white;
        border: 1px #e3e3e3 solid;
        padding: 10px;
        box-sizing: border-box;
        box-shadow: 0px 0px 2px 0px;
        border-radius: 10px;
    }
}

.bot-sub-menu {
    position: sticky;
    top: 55px;
    background: white;
    z-index: 1000;
}

.bot-footer-menu {
    position: sticky;
    bottom: 10px;
    background: white;
    z-index: 990;
}

.custom-group-dropdown-btn {
    border-radius: 0px 5px 5px 0px !important;
    border-left: none !important;
}

.gradient-custom-2 {
    background: #fccb90;
    background: -webkit-linear-gradient(to right, #2489ee, #364cd8, #1a97c5, #1a1c9a);
    background: linear-gradient(to right, #2489ee, #364cd8, #021f64, #1a1c9a);
}

.logo {
    font-size: 64px;
    font-weight: lighter;
    background: linear-gradient(90deg, #007BFF, #00C6FF);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-family: Arial, sans-serif;
}


</style>
